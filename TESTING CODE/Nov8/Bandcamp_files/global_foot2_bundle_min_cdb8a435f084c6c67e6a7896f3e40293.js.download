/* concatenation of utils.js, identities.js, logout_common.js, autocomplete_vm.js, translate.js, lang_picker.js, menubar.js, jquery.event.move.js, popup_image.js, crumb.js, form.js, cookie_comm.js, playlist.js, title_play_indicator.js, image_utils.js, templ.js, playerviews.js, share_external.js, social_controls.js, footer.js, webapp_selector.js, nudialog.js, tpl_global_templates, contact.js, tpl_contact, tpl_contact_2018, tpl_contact_verification, tpl_contact_banner, val_all, mobile_navbar.js, bubble_message.js, tpl_fan_signup, captcha.js, money.js, fan_onboarding.js, fan_signup_utils.js, fan_signup_pane.js, fan_login_pane.js, fan_forgot_password_pane.js, fan_reset_password_pane.js, fan_existing_artist_pane.js, fan_action_pane.js, fan_almost_there_pane.js, fan_welcome_pane.js, fan_verify_nag.js, fan_dupe_fan_pane.js, fan_choose_account_pane.js, fan_genre_picker_pane.js, fan_newsletter_picker_pane.js, fan_welcome_2_pane.js, fan_signup_portable.js */
var Dom={_init:function(initElem){initElem=elt(initElem);if(!initElem)return false;if(!Y.lang.isUndefined(initElem.textContent)){Dom.getText=function(elem){elem=elt(elem);return elem?elem.textContent:""};Dom.setText=function(elem,text){elem=elt(elem);if(elem)elem.textContent=text}}else{Dom.getText=function(elem){elem=elt(elem);return elem?elem.innerText:""};Dom.setText=function(elem,text){elem=elt(elem);if(elem)elem.innerText=text}}if(Y.util.Dom.getStyle(initElem,"userSelect"))Dom.setUnselectable=
function(elem){elem=elt(elem);if(elem)elem.style.userSelect="none"};else if(Y.util.Dom.getStyle(initElem,"MozUserSelect"))Dom.setUnselectable=function(elem){elem=elt(elem);if(elem)elem.style.MozUserSelect="none"};else if(typeof initElem.style.WebkitUserSelect!=="undefined")Dom.setUnselectable=function(elem){elem=elt(elem);if(elem)elem.style.WebkitUserSelect="none"};else Dom.setUnselectable=function(elem){elem=elt(elem);if(elem)elem.unselectable="on"};initElem=null;return true},getText:function(elem){if(Dom._init(elem))return Dom.getText(elem);
else return""},setText:function(elem,text){if(Dom._init(elem))Dom.setText(elem,text)},getValue:function(formElem){formElem=elt(formElem);switch(formElem.type){case "checkbox":return formElem.checked?formElem.value:null;case "radio":var radios=document.getElementsByName(formElem.name);var i=0;for(var n=radios.length;i<n;i++)if(radios[i].checked)return radios[i].value;return null}return formElem.value},setUnselectable:function(elem){if(Dom._init(elem))Dom.setUnselectable(elem)},initActiveElement:function(){var noActiveElement=
false;try{noActiveElement=Y.lang.isUndefined(document.activeElement)}catch(e){return}if(noActiveElement&&document.addEventListener){var handleBlur=function(event){var node=Y.util.Event.getTarget(event);if(node==document.activeElement)document.activeElement=null};var handleFocus=function(event){var node=Y.util.Event.getTarget(event);if(node)document.activeElement=node};document.activeElement=null;document.addEventListener("focus",handleFocus,true);document.addEventListener("blur",handleBlur,true)}},
focus:function(elem){elem=elt(elem);try{elem.focus()}catch(e){}},select:function(elem,doFocus){elem=elt(elem);try{elem.select();if(doFocus)elem.focus()}catch(e){}},getDocumentHeight:function(){return document.documentElement[Browser.type=="gecko"?"offsetHeight":"scrollHeight"]},copyStyles:function(srcElem,destElem){var destStyle=destElem.style;var getStyle=Y.util.Dom.getStyle;for(var i=2;i<arguments.length;i++){var propName=arguments[i];destStyle[propName]=getStyle(srcElem,propName)}},wrapElem:function(elem,
wrapperElem){if(Y.lang.isString(wrapperElem))wrapperElem=document.createElement(wrapperElem);Y.util.Dom.insertBefore(wrapperElem,elem).appendChild(elem);return wrapperElem},replaceElem:function(oldElem,newElem){Y.util.Dom.insertAfter(newElem,oldElem);oldElem.parentNode.removeChild(oldElem)},removeElem:function(elem){elem.parentNode.removeChild(elem)},display:function(elemOrId,displayValue){if(Y.lang.isArray(elemOrId))return Y.util.Dom.batch(elemOrId,function(el){this.display(el,displayValue)},this,
true);elemOrId=Y.util.Dom.get(elemOrId);if(!elemOrId)return;if(displayValue==undefined)displayValue="";else if(displayValue==false)displayValue="none";else if(displayValue&&typeof displayValue!="string")displayValue=elemOrId.tagName=="SPAN"||elemOrId.tagName=="INPUT"?"inline":"block";if(Browser.type!="ie"&&(displayValue=="block"||displayValue=="inline"))switch(elemOrId.tagName.toLowerCase()){case "tr":displayValue="table-row";break;case "td":displayValue="table-cell";break}Y.util.Dom.setStyle(elemOrId,
"display",displayValue)},disable:function(elemOrId,disableValue){if(Y.lang.isArray(elemOrId))return Y.util.Dom.batch(elemOrId,function(el){this.disable(el,disableValue)},this,true);var el$$0=elt(elemOrId);if(el$$0)el$$0.disabled=disableValue},getParentByClassName:function(elemOrId,className){var D=Y.util.Dom;for(var el=elt(elemOrId);el;){if(D.hasClass(el,className))return el;el=el.parentNode}return el},getCousinByClassName:function(elemOrId,parentClassName,cousinClassName){var el=this.getParentByClassName(elemOrId,
parentClassName);if(!el)return null;return Y.util.Dom.getElementsByClassName(cousinClassName,null,el)[0]},scrollToElement:function(revealElt,clearance,gently){if(revealElt.charAt&&revealElt.charAt(0)!="#")revealElt="#"+revealElt;revealElt=$(revealElt);if(!revealElt.length)return;revealElt.parents().each(function(i,domElem){if(domElem.style&&domElem.style.display=="none")Dom.display(domElem)});var animElt=document.scrollingElement;if(!animElt)animElt=document.documentElement&&document.documentElement.scrollTop!=
null?document.documentElement:document.body;if(clearance==null)clearance=-10;if(gently){var viewHeight=document.documentElement.clientHeight;var eltHeight=revealElt.height();var viewTop=animElt.scrollTop;var viewBottom=animElt.scrollTop+viewHeight;var eltTop=revealElt.offset().top;var eltBottom=revealElt.offset().top+eltHeight;if(eltTop>=viewTop){if(eltBottom<viewBottom)return;clearance+=eltBottom-viewHeight}else clearance+=eltTop}else clearance+=revealElt.offset().top;$(animElt).animate({"scrollTop":clearance},
500)},scrollToParamElt:function(id_param){var e$$0;id_param=id_param||"goto";try{if(window.location.search&&window.location.href.indexOf("#")==-1){params=window.location.search.slice(1).split("\x26");for(i=0,n=params.length;i<n;i++){param=params[i].split("\x3d");if(param[0]==id_param&&param[1]){Y.lang.later(10,window,function(){Dom.scrollToElement(elt(param[1]))});break}}}}catch(e){}},disableControls:function(rootElt,tag){tag=tag||["INPUT","TEXTAREA","SELECT","BUTTON"];if(Y.lang.isArray(tag)){var i=
0;for(var n=tag.length;i<n;++i)this.disableControls(rootElt,tag[i]);return}if(Y.lang.isArray(rootElt)){i=0;for(n=rootElt.length;i<n;++i)this.disableControls(rootElt[i],tag);return}rootElt=elt(rootElt);if(!rootElt)return;var e$$0;var elts=rootElt.getElementsByTagName(tag);i=0;for(n=elts.length;i<n;++i)try{elts[i].disabled=true}catch(e){}},enableControls:function(rootElt,tag){tag=tag||["INPUT","TEXTAREA","SELECT","BUTTON"];if(Y.lang.isArray(tag)){var i=0;for(var n=tag.length;i<n;++i)this.enableControls(rootElt,
tag[i]);return}if(Y.lang.isArray(rootElt)){i=0;for(n=rootElt.length;i<n;++i)this.enableControls(rootElt[i],tag);return}rootElt=elt(rootElt);if(!rootElt)return;var e$$0;var elts=rootElt.getElementsByTagName(tag);i=0;for(n=elts.length;i<n;++i)try{elts[i].disabled=false}catch(e){}},elementToIndex:function(element,className){element=className?Dom.getParentByClassName(element,className):element;if(!element||!element.id)return null;var match=element.id.match(/\w(\d+)$/);if(!match||!match[1])return null;
return parseInt(match[1])},hideEverythingStack:[],hideEverythingThanksAndroid:function(){if(Browser.make=="androidbrowser"){var args=Array.prototype.slice.call(arguments);if(args.length==0)return;var devlog=$(".logView")[0];if(devlog)args.push(devlog);$(this.hideEverythingStack[0]).css("visibility","inherit");$(args).css("visibility","visible");$(args).each(function(i,elt){});this.hideEverythingStack.unshift(args);$(document.body).css("visibility","hidden")}},unhideEverythingThanksAndroid:function(){if(Browser.make==
"androidbrowser"){var args=Array.prototype.slice.call(arguments);var top=this.hideEverythingStack[0];var found_one=false;if(top&&top.length>0)$(args).each(function(i,elti){$(top).each(function(j,eltj){found_one=found_one||elti==eltj})});if(!found_one){Log.error("Elt not found unhiding for android fixup");return}this.hideEverythingStack.shift();elems=this.hideEverythingStack[0]||document.body;$(elems).css("visibility","visible");$(elems).each(function(i,elt){})}},hackLinkClicksThanksSafari:function(elts,
clickHandler){elts=$(elts);if(Browser.platform!="iphone"){if(clickHandler)elts.on("click",clickHandler);return}elts.on({"touchend":function(ev){var href=this.getAttribute("href");if(href&&href.substring(0,1)!="#")this.setAttribute("href","#"+href)},"click":function(ev){var href=this.getAttribute("href");if(href&&href.substring(0,1)=="#")this.setAttribute("href",href.substring(1));if(clickHandler)return clickHandler.apply(this,arguments)}})},inViewport:function(el){var top=el.offsetTop;var left=el.offsetLeft;
var width=el.offsetWidth;for(var height=el.offsetHeight;el.offsetParent;){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft}return top<window.pageYOffset+window.innerHeight&&left<window.pageXOffset+window.innerWidth&&top+height>window.pageYOffset&&left+width>window.pageXOffset},getCursorPosition:function(el){var sel;var pos=0;if(document.selection){el.focus();sel=document.selection.createRange();sel.moveStart("character",-el.value.length);pos=sel.text.length}else if(el.selectionStart!==undefined)pos=
el.selectionStart;return pos},setCursorPosition:function(el,pos){var range;if(el.setSelectionRange){el.focus();el.setSelectionRange(pos,pos)}else if(el.createTextRange){range=el.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}},measureHiddenHeight:function(el,destinationParent){var $el=$(el);var parentWidth=$(destinationParent).width();$el.css({"display":"block","position":"absolute","visibility":"hidden","width":parentWidth});
var targetHeight=$el.height();$el.css({"display":"none","position":"","visibility":"","width":""});return targetHeight},xxx:null};
var FieldHints={WRAPPER_CLASS:"fieldHintWrapper",ACTIVE_CLASS:"fieldHintActive",HINT_CLASS:"fieldHint",NATIVE_PLACEHOLDER:"placeholder"in document.createElement("input"),USE_TITLE_ATTR:true,init:function(rootNode){var FH=FieldHints;Iter.each(FH._getFieldElements(rootNode),function(elem){if(FH._getHintText(elem)){FH._setupHint(elem);FH._showHint(elem)}})},_getFieldElements:function(rootNode){rootNode=rootNode?elt(rootNode):null;rootNode=rootNode||document;var inputElems=rootNode.getElementsByTagName("INPUT");
inputElems=Iter.findAll(inputElems,function(elem){return elem.type=="text"});var textareaElems=rootNode.getElementsByTagName("TEXTAREA");return inputElems.concat(Iter.collect(textareaElems))},_handleFocus:function(event){FieldHints._hideHint(this)},_handleBlur:function(event){FieldHints._showHint(this)},_handleHintClick:function(event){var elem=Y.util.Dom.getNextSibling(this);$assert(elem.tagName=="INPUT"&&elem.type=="text"||elem.tagName=="TEXTAREA");setTimeout(function(){Dom.focus(elem)},10)},updateHint:function(elem){elem=
elt(elem);if(!elem)return;var wrapperEl=elem.parentNode;if(Y.util.Dom.hasClass(wrapperEl,FieldHints.WRAPPER_CLASS))Dom.setText(elem._fieldhint,this._getHintText(elem));else FieldHints._setupHint(elem)},_setupHint:function(elem){if(this.NATIVE_PLACEHOLDER){if(this.USE_TITLE_ATTR)elem.placeholder=elem.title;return}var wrapperEl=elem.parentNode;if(Y.util.Dom.hasClass(wrapperEl,FieldHints.WRAPPER_CLASS))return;if(Y.util.Dom.getStyle(wrapperEl,"position")!="relative"){var wrapperTagName=elem.tagName==
"TEXTAREA"?"div":"span";wrapperEl=Dom.wrapElem(elem,wrapperTagName)}Y.util.Dom.addClass(wrapperEl,FieldHints.WRAPPER_CLASS);var hintEl=document.createElement("span");Y.util.Dom.insertBefore(hintEl,elem);hintEl.className=FieldHints.HINT_CLASS;Dom.setText(hintEl,this._getHintText(elem));Dom.setUnselectable(hintEl);elem._fieldhint=hintEl;Dom.copyStyles(elem,hintEl,"paddingTop","paddingLeft","borderTopWidth","borderLeftWidth","marginTop","marginLeft","fontSize","lineHeight");var ieLessThan7=Browser.type==
"ie"&&Browser.version[0]<7;if(!ieLessThan7)Dom.copyStyles(elem,wrapperEl,"paddingTop");if(Browser.type=="gecko"){hintEl.style.top=elem.offsetTop+"px";var marginTop=Y.util.Dom.getStyle(elem,"marginTop");var marginTopInt=parseInt(marginTop);if(!isNaN(marginTopInt))hintEl.style.marginTop="-"+marginTop}else if(ieLessThan7)hintEl.style.border="none";Y.util.Event.on(elem,"focus",FieldHints._handleFocus);Y.util.Event.on(elem,"blur",FieldHints._handleBlur);Y.util.Event.on(hintEl,"click",FieldHints._handleHintClick)},
jiggleHint:function(elem){elem=elt(elem);if(!elem)return;var wrapperEl=elem.parentNode;if(!Y.util.Dom.hasClass(wrapperEl,FieldHints.WRAPPER_CLASS))return;if(Browser.type=="gecko"){var hintEl=elem.previousSibling;hintEl.style.top=elem.offsetTop+"px";var marginTop=Y.util.Dom.getStyle(elem,"marginTop");var marginTopInt=parseInt(marginTop);if(!isNaN(marginTopInt))hintEl.style.marginTop="-"+marginTop}},jiggleAll:function(rootElem){Y.util.Dom.getElementsByClassName(FieldHints.WRAPPER_CLASS,null,rootElem,
function(elem){if(elem.firstChild&&elem.firstChild.nextSibling)FieldHints.jiggleHint(elem.firstChild.nextSibling)})},_getHintText:function(elem){return this.USE_TITLE_ATTR?elem.title:elem.getAttribute("placeholder")},_showHint:function(elem){if(!this.NATIVE_PLACEHOLDER&&this._getHintText(elem)&&!elem.value&&elem!=document.activeElement)Y.util.Dom.addClass(elem.parentNode,FieldHints.ACTIVE_CLASS)},_hideHint:function(elem){if(FieldHints._isHintVisible(elem))Y.util.Dom.removeClass(elem.parentNode,FieldHints.ACTIVE_CLASS)},
_isHintVisible:function(elem){return Y.util.Dom.hasClass(elem.parentNode,FieldHints.ACTIVE_CLASS)}};
var Ellipses={_outerClass:"ellipsizer",_innerClass:"ellipsizee",_moreClass:"ellipsisWrapper",_spacerClass:"ellipsisSpacer",init:function(rootNode){rootNode=rootNode||document.body;if(rootNode.style.maxHeight==null)return;var elems=Y.util.Dom.getElementsByClassName(Ellipses._outerClass,null,rootNode,function(elem){var innerEl=document.createElement("span");innerEl.className=Ellipses._innerClass;for(var children=elem.childNodes;children.length;)innerEl.appendChild(children[0]);elem.appendChild(innerEl);
Ellipses._updateElement(elem)})},_updateElement:function(elem){var child=Y.util.Dom.getElementsByClassName(Ellipses._innerClass,null,elem)[0];if(child.offsetHeight>elem.offsetHeight)Ellipses._show(elem);else{Ellipses._hide(elem);elem.style.maxHeight="none"}},_show:function(elem){var moreElem=Y.util.Dom.getElementsByClassName(Ellipses._moreClass,null,elem)[0];var spacerElem=Y.util.Dom.getElementsByClassName(Ellipses._spacerClass,null,elem)[0];if(moreElem){moreElem.style.display="block";spacerElem.style.display=
"block"}else{moreElem=document.createElement("div");moreElem.className=Ellipses._moreClass;elem.insertBefore(moreElem,elem.firstChild);moreElem.innerHTML='\x3ca class\x3d"morelink" href\x3d"#"\x3e\x26hellip;more\x3c/a\x3e';var linkElem=Y.util.Dom.getElementsByClassName("morelink",null,elem)[0];Y.util.Event.addListener(linkElem,"click",Ellipses._toggle,elem,false);spacerElem=document.createElement("div");spacerElem.className=Ellipses._spacerClass;elem.insertBefore(spacerElem,elem.firstChild)}var numLines=
Math.max(1,Math.round(elem.offsetHeight/moreElem.offsetHeight));var numSpacerLines=numLines-1;var brs=[];for(var i=0;i<numSpacerLines;i++)brs.push("\x3cbr\x3e");spacerElem.innerHTML=brs.join("")},_hide:function(elem){var moreElem=Y.util.Dom.getElementsByClassName(Ellipses._moreClass,null,elem)[0];var spacerElem=Y.util.Dom.getElementsByClassName(Ellipses._spacerClass,null,elem)[0];if(moreElem){moreElem.style.display="none";spacerElem.style.display="none"}},_toggle:function(evt,elem){var moreElem=Y.util.Dom.getElementsByClassName(Ellipses._moreClass,
null,elem)[0];if(moreElem){if(moreElem.oldHeight){elem.style.maxHeight="";elem.style.maxHeight=moreElem.oldHeight;moreElem.oldHeight=null}else{moreElem.oldHeight=elem.style.maxHeight;elem.style.maxHeight="none"}Ellipses._updateElement(elem)}Y.util.Event.stopEvent(evt)}};
var Dialog={_id:0,instances:[],asycnOpenOnFB:function(title,body,buttons,width,options){if(window.FacebookData){var patchYui=false;FacebookUtils.correctSrollThen(patchYui,Dialog,Dialog.open_inner,title,body,buttons,width,options)}else return Dialog.open(title,body,buttons,width,options)},open:function(title,body,buttons,width,options){var elemId="dlg"+Dialog._id++;var opts;var dlg;var attr;var phoneView=window.MediaView&&window.MediaView.mode=="phone";opts={width:!phoneView?width||"30em":null,modal:true,
close:true,underlay:"none",dragOnly:true,strings:{close:TM("Close")},visible:false,zIndex:112};$.extend(opts,options||{});dlg=new Y.widget.Dialog(elemId,opts);dlg.setHeader('\x3cdiv class\x3d"content"\x3e'+Text.escapeHtml(Text.collate(title,"Bandcamp"))+"\x3c/div\x3e");dlg.setBody(Text.collate(body,"\x26nbsp;"));if(buttons&&!Y.lang.isArray(buttons))buttons=[buttons];if(!buttons)buttons=Dialog.buttons.standardSet();dlg.cfg.queueProperty("buttons",buttons);dlg.cfg.queueProperty("keylisteners",Dialog.keyListeners.standardSet(dlg));
dlg.cfg.queueProperty("constraintoviewport",true);if(window.MediaView&&MediaView.mode=="phone")dlg.cfg.addProperty("autofocus",{value:false});var useAutoCentering=!window.FacebookData&&!phoneView&&!(Browser.platform=="iphone"||Browser.platform=="android")&&opts.fixedcenter===undefined;if(useAutoCentering)dlg.cfg.queueProperty("fixedcenter",true);dlg.hideEvent.subscribe(function(){Dialog.destacken(dlg);if(phoneView)Dom.unhideEverythingThanksAndroid(dlg.element,dlg.mask);Y.lang.later(0,dlg,dlg.destroy);
$.event.trigger("bc_dialog_close")});dlg.destroyEvent.subscribe(function(){if(phoneView)Dom.unhideEverythingThanksAndroid(dlg.element,dlg.mask);Dialog.destacken(dlg)});dlg.hideMaskEvent.subscribe(function(){if(Dialog.instances.length)$(document.body).addClass("masked")});if(Browser.type=="ie"||Browser.type=="gecko"){dlg._onElementFocus_orig=dlg._onElementFocus;dlg._onElementFocus=function(e){if(Y.util.Event.getTarget(e).tagName!="OBJECT"&&Y.util.Event.getTarget(e).tagName!="EMBED")dlg._onElementFocus_orig(e)}}dlg.render(document.body);
if(buttons.length==0){dlg.footer.style.display="none";Y.util.Dom.addClass(dlg.body,"footerless")}else{Y.util.Dom.addClass(dlg.body,"footered");Y.util.Dom.batch(dlg.footer.getElementsByTagName("button"),function(elem){elem.innerHTML="\x3cdiv\x3e"+Text.escapeHtml(Dom.getText(elem))+"\x3c/div\x3e"})}if(!useAutoCentering||Browser.type=="opera")dlg.center();dlg.show();$.event.trigger("bc_dialog_open");if(phoneView){Y.util.Event.on(dlg.mask,"click",function(){Dom.scrollToElement(dlg.element)});Dom.hideEverythingThanksAndroid(dlg.element,
dlg.mask)}Dialog.enstacken(dlg);return dlg},openTemplate:function(title,templName,hash,buttons,width,options){var body=Templ.render(templName,hash);return Dialog.open(title,body,buttons,width,options)},alert:function(title,message,onClose,showCancel,okText,showClose){if(window.FacebookData){var patchYui=false;return FacebookUtils.correctSrollThen(patchYui,Dialog,Dialog.alert_inner,title,message,onClose,showCancel)}else return Dialog.alert_inner(title,message,onClose,showCancel,okText,showClose)},
alert_inner:function(title,message,onClose,showCancel,okText,showClose){var buttons=showCancel?Dialog.buttons.standardSet():[Dialog.buttons.ok()];if(okText)buttons[0].text=okText;if(onClose)buttons[0].handler=function(){this.cancel();onClose.call(this)};var dlg=Dialog.open(title,message,buttons,null,{close:showClose||false});Y.util.Dom.addClass(dlg.body,"alertDlg");return dlg},buttons:{standardSet:function(okHandler,okText,cancelHandler,cancelText){return[Dialog.buttons.ok(okHandler,okText),Dialog.buttons.cancel(cancelHandler,
cancelText)]},ok:function(okHandler,okText){okHandlerWrapper=function(){this.cancel();if(okHandler)okHandler()};return{text:okText||"OK",isDefault:true,handler:okHandlerWrapper}},cancel:function(cancelHandler,cancelText){cancelHandlerWrapper=function(){this.cancel();if(cancelHandler)cancelHandler()};return{text:cancelText||"Cancel",handler:cancelHandlerWrapper}}},keyListeners:{standardSet:function(dlg){return[Dialog.keyListeners.escape(dlg)]},escape:function(dlg){return new Y.util.KeyListener(document,
{keys:Y.util.KeyListener.KEY.ESCAPE},{fn:function(type,args){setTimeout(function(){dlg.cancel()},1)},scope:dlg,correctScope:true})}},enstacken:function(dlg){Dialog.instances.push(dlg)},destacken:function(dlg){var index=Iter.index(Dialog.instances,dlg);if(index>=0)Dialog.instances.splice(index,1)}};if(Y&&Y.widget&&Y.widget.Dialog)Y.widget.Dialog.prototype._focusOnShow=function(){if(this.cfg.getProperty("autofocus")!==false)Y.widget.Panel.prototype._focusOnShow.apply(this,arguments)};
var Time={timeFormats:{en:{yyyyMd:{form:"%-m/%-d/%Y"},yyyyMMdd:{form:"%m/%d/%Y"},yyyyMMM:{form:"%b %Y"},yyyyMMMM:{form:"%B %Y"},yyyyMMMd:{form:"%b %-d, %Y"},yyyyMMMMd:{form:"%B %-d, %Y"},yyyyMMMdhmm:{form:"%b %-d, %Y %-I:%M %p"},yyyyMMMMdhmm:{form:"%B %-d, %Y %-I:%M %p"},MMMMd:{form:"%B %-d"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%l:%M%p %Z"}},fr:{yyyyMd:{form:"%d/%m/%Y"},yyyyMMdd:{form:"%d/%m/%Y"},yyyyMMM:{form:"%b %Y",localize:["month_short"]},yyyyMMMM:{form:"%B %Y",localize:["month"]},yyyyMMMd:{form:"%-d %b %Y",
localize:["month_short"]},yyyyMMMMd:{form:"%-d %B %Y",localize:["month"]},yyyyMMMdhmm:{form:"%-d %b %Y \u00e0 %H:%M",localize:["month_short"]},yyyyMMMMdhmm:{form:"%-d %B %Y \u00e0 %H:%M",localize:["month"]},MMMMd:{form:"%-d %B",localize:["month"]},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%l:%M%p %Z"}},ja:{yyyyMd:{form:"%Y/%-m/%-d"},yyyyMMdd:{form:"%Y/%m/%d"},yyyyMMM:{form:"%Y\u5e74%-m\u6708"},yyyyMMMM:{form:"%Y\u5e74%-m\u6708"},yyyyMMMd:{form:"%Y\u5e74%-m\u6708%-d\u65e5"},yyyyMMMMd:{form:"%Y\u5e74%-m\u6708%-d\u65e5"},
yyyyMMMdhmm:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M"},yyyyMMMMdhmm:{form:"%Y\u5e74%-m\u6708%-d\u65e5 %H:%M"},MMMMd:{form:"%-m\u6708%-d\u65e5"},hhmmss:{form:"%H:%M:%S"},hhmmzz:{form:"%l:%M%p %Z"}}},localizedTimeValues:{fr:{month_short:["janv.","f\u00e9vr.","mars","avr.","mai","juin","juil.","ao\u00fbt","sept.","oct.","nov.","d\u00e9c."],month:["janvier","f\u00e9vrier","mars","avril","mai","juin","juillet","ao\u00fbt","septembre","octobre","novembre","d\u00e9cembre"]}},get_locale:function(locale){if(typeof locale===
"undefined"||locale=="")if("Translate"in window)locale=Translate.locale;else locale="en";if(locale=="qq")locale="ja";return locale},to_ui:function(date,format,locale,asUTC){var s;var d;if(typeof format==="undefined")format=1;if(typeof date==="string")date=new Date(date);locale=Time.get_locale(locale);if(typeof date["getUTCFullYear"]==="function"){if(typeof asUTC==="undefined")asUTC=true;d=new Date(date);if(asUTC){d.year=date.getUTCFullYear();d.month=date.getUTCMonth()+1;d.mday=date.getUTCDate();d.hour=
date.getUTCHours();d.min=date.getUTCMinutes();d.sec=date.getUTCSeconds();d.tz="UTC"}else{d.year=date.getFullYear();d.month=date.getMonth()+1;d.mday=date.getDate();d.hour=date.getHours();d.min=date.getMinutes();d.sec=date.getSeconds();d.tz=date.toTimeString().match(/\((.*)\)/)[1]}date=d}var badFormatStr="\x3cd'oh bad to_ui format\x3e";if(typeof format==="number")switch(format){case 1:s=Time.to_ui(date,2)+" "+Time.to_ui(date,3);break;case 2:s=date.month+"/"+date.mday+"/"+date.year%100;break;case 3:var hour12;
var min_str;var ampm;hour12=date.hour>12?date.hour-12:date.hour;if(hour12==0)hour12=12;min_str=date.min<10?"0"+date.min:""+date.min;ampm=date.hour>=12?"pm":"am";s=hour12+":"+min_str+ampm;break;case 4:s=date.month+"/"+date.mday+"/"+date.year;break;case 5:s=Time.to_ui(date,4)+" "+Time.to_ui(date,3);break;case 6:s=Time.tables.B[date.month-1]+" "+date.mday+", "+date.year;break;case 7:s=Time.to_ui(date,6)+" "+Time.to_ui(date,3);break;case 8:s=Time.to_ui(date,7)+" "+date.tz;break;case 9:s=Time.strftime(date,
"%Y-%m-%d");break;case 10:s=Time.strftime(date,"%d %B %Y %H:%M:%S");break;case 11:s=Time.tables.b[date.month-1]+" "+date.mday+", "+date.year;break;case 12:s=Time.strftime(date,"%Y-%m-%d %H:%M:%S");break;case 13:s=Time.strftime(date,"%B %Y");break;case 14:s=Time.strftime(date,"%m/%d/%Y");break;default:s=badFormatStr}else if(typeof format==="string"){var formattingObj=Time.timeFormats[locale][format];var formatStr=formattingObj["form"];if("localize"in formattingObj){var localize=formattingObj["localize"];
var locale_values=Time.localizedTimeValues[locale];localize.forEach(function(field){var values=locale_values[field];switch(field){case "month_short":formatStr=formatStr.replace(/%(b)/g,function(m0,m1){return values[date.month-1]});break;case "month":formatStr=formatStr.replace(/%(B)/g,function(m0,m1){return values[date.month-1]});break;default:formatStr=badFormatStr;break}})}s=Time.strftime(date,formatStr)}else s=badFormatStr;return s},toUi:function(date,fourDigitYear,asUTC,as24){if(Y.lang.isString(date))date=
new Date(date);var hour=date[asUTC?"getUTCHours":"getHours"]();var min=date[asUTC?"getUTCMinutes":"getMinutes"]();min=min<10?"0"+min:min;if(as24){hour=hour<10?"0"+hour:hour;var ampm=""}else{var hour12=hour>12?hour-12:hour;if(hour12==0)hour12=12;ampm=hour>=12?"pm":"am";hour=hour12}return Time.toUiDate(date,fourDigitYear,asUTC)+" "+hour+":"+min+ampm},toUiDate:function(date,fourDigitYear,asUTC){if(Y.lang.isString(date))date=new Date(date);var year=date[asUTC?"getUTCFullYear":"getFullYear"]().toString();
if(!fourDigitYear)year=year.substr(2);return date[asUTC?"getUTCMonth":"getMonth"]()+1+"/"+date[asUTC?"getUTCDate":"getDate"]()+"/"+year},relativeTimeFormats:{en:{today:"today",yesterday:"yesterday",days_ago:"{{days_ago}} days ago",one_hour_ago:"1 hour ago",hours_ago:"{{hours_ago}} hours ago",one_minute_ago:"1 minute ago",minutes_ago:"{{minutes_ago}} minutes ago",seconds_ago:"{{seconds_ago}} seconds ago",just_now:"just now"},fr:{today:"aujourd'hui",yesterday:"hier",days_ago:"il y a {{days_ago}} jours",
one_hour_ago:"il y a 1 heure",hours_ago:"il y a {{hours_ago}} heures",one_minute_ago:"il y a 1 minute",minutes_ago:"il y a {{minutes_ago}} minutes",seconds_ago:"il y a {{seconds_ago}} secondes",just_now:"\u00e0 l'instant"},ja:{today:"\u4eca\u65e5",yesterday:"\u6628\u65e5",days_ago:"{{days_ago}}\u65e5\u524d",one_hour_ago:"1\u6642\u9593\u524d",hours_ago:"{{hours_ago}}\u6642\u9593\u524d",one_minute_ago:"1\u5206\u524d",minutes_ago:"{{minutes_ago}}\u5206\u524d",seconds_ago:"{{seconds_ago}}\u79d2\u524d",
just_now:"\u3061\u3087\u3046\u3069\u4eca"}},timeStr:function(timeInSeconds){var str="";for(timeInSeconds=Math.floor(timeInSeconds);timeInSeconds>0;){var part=timeInSeconds%60;var partstr=part.toString();if(partstr.length<2)partstr="0"+partstr;if(str.length>0)str=partstr+":"+str;else str=partstr;timeInSeconds-=part;timeInSeconds/=60}if(str.length==0)str="00:00";else if(str.length<3)str="00:"+str;return str},calc_days_ago:function(date){return Math.floor((new Date-date)/(60*60*24*1E3))},relative_day:function(date,
format,locale){if(Y.lang.isString(date))date=new Date(date);locale=Time.get_locale(locale);var localeFormats=Time.relativeTimeFormats[locale];var days_ago=Time.calc_days_ago(date);if(days_ago==0)return localeFormats.today;else if(days_ago==1)return localeFormats.yesterday;if(format)return Time.to_ui(date,format,locale);var str=localeFormats.days_ago;var vars={days_ago:days_ago};return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},relative_time:function(date,format,locale){if(Y.lang.isString(date))date=
new Date(date);locale=Time.get_locale(locale);var localeFormats=Time.relativeTimeFormats[locale];var days_ago=Time.calc_days_ago(date);if(days_ago!=0)return Time.relative_day(date,format,locale);var secondsAgo=(new Date-date)/1E3;var minutesAgo=secondsAgo/60;var hoursAgo=minutesAgo/60;secondsAgo=Math.floor(secondsAgo);minutesAgo=Math.floor(minutesAgo);hoursAgo=Math.floor(hoursAgo);var str;var vars={};if(hoursAgo>4)return localeFormats.today;else if(hoursAgo>1){vars.hours_ago=hoursAgo;str=localeFormats.hours_ago}else if(hoursAgo>
0)return localeFormats.one_hour_ago;else if(minutesAgo>1){vars.minutes_ago=minutesAgo;str=localeFormats.minutes_ago}else if(minutesAgo>0)return localeFormats.one_minute_ago;else if(secondsAgo>15){vars.seconds_ago=secondsAgo;str=localeFormats.seconds_ago}else return localeFormats.just_now;return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},toUpcomingDate:function(date,asUTC){if(Y.lang.isString(date))date=new Date(date);return Time.getMonthName(date[asUTC?"getUTCMonth":"getMonth"]())+
" "+date[asUTC?"getUTCDate":"getDate"]()},getMonthName:function(i){var m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return m[i]},strToDate:function(str){if(!str)return null;str=str.replace(/-/g,"/");if(!~str.indexOf("UTC")&&!~str.indexOf("GMT"))str+=" UTC";var d=new Date(str);var missingYearResultsInNaN=isNaN(new Date("3/7"));var tryAddingYear=isNaN(d)||!missingYearResultsInNaN;if(tryAddingYear){var recentMonths=3;var mindate=new Date;mindate.setMonth(mindate.getMonth()-
recentMonths);var year=(new Date).getFullYear()-1;for(var y=year;y<year+3;y++){var candiDate=new Date(str+" "+y);if(candiDate>mindate){d=candiDate;break}}if(isNaN(d))return null}else{var fullYear=d.getFullYear();if(fullYear<2E3&&str.indexOf(fullYear)==-1){var twoDigitYearStr=fullYear.toString().substr(2,2);var twoDigitYear=parseInt(twoDigitYearStr);var offset=25;var twoDigitCutoff=parseInt(((new Date).getFullYear()+25).toString().substr(2,2));if(twoDigitYear<=twoDigitCutoff)d.setFullYear(fullYear+
100)}}return d},tables:{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],p:["AM","PM"],P:["A","P"]},formats:{"a":function(d){return Time.tables.a[d.getUTCDay()]},"A":function(d){return Time.tables.A[d.getUTCDay()]},"b":function(d){return Time.tables.b[d.getUTCMonth()]},
"B":function(d){return Time.tables.B[d.getUTCMonth()]},"-d":function(d){return d.getUTCDate()},"d":function(d){return TextFormat.pad(d.getUTCDate(),"0",10)},"e":function(d){return TextFormat.pad(d.getUTCDate()," ",10)},"H":function(d){return TextFormat.pad(d.getUTCHours(),"0",10)},"-I":function(d){var I=d.getUTCHours()%12;return I===0?12:I},"I":function(d){var I=d.getUTCHours()%12;return TextFormat.pad(I===0?12:I,"0",10)},"l":function(d){var I=d.getUTCHours()%12;return I===0?12:I},"j":function(d){var ms=
d-new Date(d.getUTCFullYear()+"/1/1 GMT");var doy=parseInt(ms/6E4/60/24,10)+1;return TextFormat.pad(doy,"0",100)},"-m":function(d){return d.getUTCMonth()+1},"m":function(d){return TextFormat.pad(d.getUTCMonth()+1,"0",10)},"M":function(d){return TextFormat.pad(d.getUTCMinutes(),"0",10)},"p":function(d){return Time.tables.p[d.getUTCHours()>=12?1:0]},"P":function(d){return Time.tables.P[d.getUTCHours()>=12?1:0]},"s":function(d){return parseInt(d.getTime()/1E3)},"S":function(d){return TextFormat.pad(d.getUTCSeconds(),
"0",10)},"u":function(d){var dow=d.getUTCDay();return dow===0?7:dow},"U":function(d){var doy=parseInt(Time.formats.j(d),10);var rdow=6-d.getUTCDay();var woy=parseInt((doy+rdow)/7,10);return TextFormat.pad(woy,"0",10)},"w":function(d){return d.getUTCDay().toString()},"W":function(d){var doy=parseInt(Time.formats.j(d),10);var rdow=7-Time.formats.u(d);var woy=parseInt((doy+rdow)/7,10);return TextFormat.pad(woy,"0",10)},"y":function(d){return TextFormat.pad(d.getUTCFullYear()%100,"0",10)},"Y":function(d){return d.getUTCFullYear().toString()},
"Z":function(d){return"UTC"},"%":function(d){return"%"}},aggregates:{"c":"%a %b %e %X %Y","x":"%m/%d/%y","X":"%H:%M:%S"},strftime:function(date,fmt){for(;fmt.match(/%[cDhnrRtTxX]/);)fmt=fmt.replace(/%([cDhnrRtTxX])/g,function(m0,m1){return Time.aggregates[m1]});fmt=fmt.replace(/%(\-[dmI])/g,function(m0,m1){return Time.formats[m1](date)});return fmt.replace(/%([aAbBCdegGHIjlmMpPsSuUVwWyYzZ%])/g,function(m0,m1){return Time.formats[m1](date)})}};
var TextFormat={currency:function(num,currencyInfo,numericOnly,informal,terse){if(num.is_money){if(!window.CurrencyData)Log.server("Missing CurrencyData for TextFormat.currency on "+window.location.pathname,"error");currencyInfo=window.CurrencyData.info[num.currency];num=num.amount/100}var fmt=currencyInfo||{prefix:"$",symbol:"USD",places:2};var places=num>=1||num==0?fmt.places:2;if(informal&&num>=1&&Math.round(num)==num)places=0;var base=num.toFixed(places);if(numericOnly)return base;base=TextFormat.commafyNumber(base);
if(fmt.symbol&&!terse)base+=" "+fmt.symbol;return fmt.prefix_utf8+base},money:function(input,currency,format){if(!window.CurrencyData)Log.server("Missing CurrencyData for TextFormat.money on "+window.location.pathname,"error");if(input&&input.is_money){if("number"===typeof currency)format=currency;currency=input.currency;input=input.amount/100}input=input||0;currency=currency||"USD";format=format||1;var fmt=CurrencyData.info[currency];var places=fmt.places;var isWholeNumber=input===Math.round(input);
if(isWholeNumber){if(format===2||format===7)places=0}else if(places===0)places=2;var s=input.toFixed(places);if(format!==5&&format!==8)s=this.commafyNumber(s);if(format===4)if(s[0]==="-")s="("+s.substr(1)+")";if(format===1||format===2)s=fmt.prefix_utf8+s;else if(format===6||format===7)s=fmt.prefix_utf8+" "+s;if(format===5)s=Array(8-s.length).join(" ")+s;return s},million_usd:function(value,locale){var s="";switch(locale){case "ja":if(value>=100)s=(value/100).toFixed(1)+"\u5104\u30c9\u30eb";else s=
(value*100).toFixed(0)+"\u4e07\u30c9\u30eb";break;case "fr":if(value>=100)s=value.toFixed(0)+" millions de dollars";else s=value.toFixed(1)+" millions de dollars";s=s.replace(".",",");break;default:if(value>=100)s="$"+value.toFixed(0)+" million";else s="$"+value.toFixed(1)+" million";break}return s},toMb:function(num,si){var base=si?1E3:1024;var d=1;var n=base;var m=Iter.find([" bytes","K","MB","GB","TB","PB"],function(){if(num<n)return true;else{d=n;n*=base;return false}});if(!m)return num.toString();
var a=Math.round(num/d*10);if(a%10==0)return a/10+m;else return(a/10).toFixed(1)+m},pad:function(x,str,r){for(x=x.toString();parseInt(x,10)<r&&r>1;r/=10)x=str+x;return x},_determine_locale_separators:function(){var test=(1.2).toFixed(1);if(test.indexOf(".")>=0)TextFormat._separators={decimal:".",thousands:","};else TextFormat._separators={decimal:",",thousands:"."}},commafyNumber:function(str){if(!TextFormat._separators)TextFormat._determine_locale_separators();var parts=str.split(TextFormat._separators.decimal);
var intpart=parts[0];var decimalpart=parts[1]?TextFormat._separators.decimal+parts[1]:"";var isNeg=false;if(intpart.substr(0,1)==="-"){intpart=intpart.substr(1);isNeg=true}var length=intpart.length;var out="";for(var i=0;(length-i)%3>0;){out+=intpart.substr(i,1);i++}if(out.length>0&&length-i>0)out+=TextFormat._separators.thousands;for(;length-i>3;){out+=intpart.substr(i,3)+TextFormat._separators.thousands;i+=3}if(length-i>0)out+=intpart.substr(i);return(isNeg?"-":"")+out+decimalpart},noOrphan:function(str){return str.replace(/([^ ]+) +([^ ]+)$/,
"$1\u00a0$2")}};function addExpandEventListeners(field){$(field).off(".bcExpand").on("paste.bcExpand keyup.bcExpand focus.bcExpand",updateFieldHeight)}function updateFieldHeight(event){var field=event.target;var maxHeight=250;var clientHeight=parseInt(field.clientHeight);var scrollHeight=parseInt(field.scrollHeight);if(scrollHeight>clientHeight){if(scrollHeight>maxHeight)scrollHeight=maxHeight;field.style.height=scrollHeight+"px"}}
function addShrinkEventListeners(field,maxInactiveHeight){$(field).blur(function(event){shrinkFieldHeight(event,maxInactiveHeight)})}function shrinkFieldHeight(event,maxInactiveHeight){var field=event.target;var contentHeight=parseInt(field.scrollHeight);if(contentHeight>maxInactiveHeight)field.style.height=maxInactiveHeight+"px"}
function addCharacterCountdownEventListeners(field,counterDiv,max){function update(doTruncate){var remaining=max-$(field).val().length;$(counterDiv).toggleClass("notable",remaining<=0);if(remaining<0&&doTruncate){$(field).val($(field).val().substr(0,max));remaining=0}$(counterDiv).find(".counter").text(""+remaining)}$(field).on("input",function(){update(true)});if(!("oninput"in field)||Browser.make==="ie"&&Browser.version[0]<=9)$(field).on("paste cut keyup",function(){setTimeout(update,0,true)});
update(false)}function InterruptibleTimer(){this._timer=null}InterruptibleTimer.prototype={start:function(code,delay){this.stop();this._timer=setTimeout(code,delay)},stop:function(){clearTimeout(this._timer)}};
var FarbLoader={_ready:false,whenready:function(callback){if(FarbLoader._ready){callback();return}var cssLoaded=false;var scriptLoaded=false;var checkinit=function(){if(cssLoaded&&scriptLoaded){FarbLoader._ready=true;callback()}};var cssSuccessFn=function(){Log.debug("farb css loaded");cssLoaded=true;checkinit()};var scriptSuccessFn=function(){Log.debug("farb script loaded");scriptLoaded=true;checkinit()};YAHOO.util.Get.css(FarbtasticUrls.css,{onSuccess:cssSuccessFn});YAHOO.util.Get.script(FarbtasticUrls.js,
{onSuccess:scriptSuccessFn})}};
var PopupPicker={pick:function(x,y,startcolor,onchange){var event=$.Event("click",{pageX:x,pageY:y});if(!startcolor)startcolor="#FF0000";var dialog=$("\x3cdiv\x3e").dialog({dialogClass:"popuppicker",width:"225",modal:true,position:{my:"center",at:"center",of:event}});dialog.html("\x3cdiv id\x3d'popup_picker'\x3e\x3cdiv id\x3d'picker_container'\x3e\x3c/div\x3e\x3cdiv class\x3d'swatches'\x3e\x3cspan id\x3d'picker_oldcolor' class\x3d'swatch'\x3e\x3c/span\x3e\x3cspan id\x3d'picker_newcolor' class\x3d'swatch'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e");var oldswatch=
$("#picker_oldcolor");var newswatch=$("#picker_newcolor");var currentcolor=startcolor;dialog.on("dialogbeforeclose",function(){onchange(currentcolor,true)});var colorpicked=function(color){newswatch.css("background",color);currentcolor=color;onchange(currentcolor,false)};FarbLoader.whenready(function(){var farb=$.farbtastic("#picker_container",colorpicked);farb.setColor(startcolor);$("#picker_oldcolor,#picker_newcolor").css("background",farb.color);oldswatch.click(function(){currentcolor=startcolor;
farb.setColor(currentcolor)})});return dialog},destroy:function(picker){picker.remove()}};
var WatchInput={watchInput:function(eltID,defaultValue,valueType){$assert(typeof eltID=="string");if(this.__watching==null)this.__watching={};var stuff=this.__watching[eltID]={};stuff.__watchInput_elt=eltID;stuff.__watchInput_default=defaultValue;stuff.__watchInput_type=valueType||"float";var Self=this;setTimeout(function(){Self.__watchInput(eltID)},500)},__watchInput:function(whichID){var stuff=this.__watching[whichID];if(!stuff)return;var e$$0;var el=elt(stuff.__watchInput_elt);if(!el){this.__watching[whichID]=
null;return}var val=el.value==undefined?el.innerHTML:el.value;switch(stuff.__watchInput_type){case "float":var amt=parseFloat(val);if(isNaN(amt))amt=stuff.__watchInput_default;break;case "integer":amt=parseInt(val);if(isNaN(amt))amt=stuff.__watchInput_default;break;default:amt=val;break}if(amt!=stuff.__watchInput_Last&&this.inputChanged)try{this.inputChanged(amt,stuff.__watchInput_elt)}catch(e){Log.error(e)}stuff.__watchInput_Last=amt;var Self=this;setTimeout(function(){Self.__watchInput(whichID)},
500)}};
var Expression={eval:function(expr,eval_lambda,handle_constants){var p=this.init(expr,eval_lambda,handle_constants);var value=this.parse_top(p);if(this.next_token(p).kind!="end")throw"Expression error: '"+p.expr+"' -- end expected";return value},dump:function(expr,eval_lambda,handle_constants){for(var p=this.init(expr,eval_lambda,handle_constants);true;){var t=this.next_token(p);console.log(t.kind+" "+t.value);if(t.kind=="end")break}},init:function(expr,eval_lambda,handle_constants){var p={};p.expr=
expr;p.handle_constants=handle_constants;p.eval_lambda=eval_lambda;p.return_prev_token=false;p.short_circuit=false;return p},OPERATORS:["||","\x26\x26","\x3c\x3d","\x3d\x3d","!\x3d","\x3e\x3d","\x3c","\x3e","+","-","*","/","%","!","(",")"],next_token:function(p){if(p.return_prev_token){p.return_prev_token=false;return p.previous_token}var token={};p.expr=p.expr.replace(/^\s+/,"");if(p.expr=="")token.kind="end";else{for(var i=0;i<this.OPERATORS.length;++i){var op=this.OPERATORS[i];if(p.expr.substr(0,
op.length)==op){token.kind=op;p.expr=p.expr.slice(op.length);break}}if(!token.kind){var m;m=p.expr.match(/^(\'[^\']*\')/)||p.expr.match(/^(\"[^\"]*\")/)||p.expr.match(/([^\s\+\-\*\/\%\(\)\<\=\>\!\&\|\'\"]+)/);if(m){token.value=m[1];token.kind="term";p.expr=p.expr.slice(token.value.length)}}}p.previous_token=token;return token},backup:function(p){p.return_prev_token=true},is_true:function(val){return val!==false&&val!=null},parse_top:function(p){return this.parse_boolean_op(p)},parse_boolean_op:function(p){for(var value=
this.parse_comparison_op(p);true;)switch(this.next_token(p).kind){case "||":if(this.is_true(value)){var s=p.short_circuit;p.short_circuit=true;this.parse_boolean_op(p);p.short_circuit=s}else value=this.parse_comparison_op(p);break;case "\x26\x26":if(!this.is_true(value)){s=p.short_circuit;p.short_circuit=true;this.parse_boolean_op(p);p.short_circuit=s}else value=this.parse_comparison_op(p);break;default:this.backup(p);return value}},parse_comparison_op:function(p){var value=this.parse_additive_op(p);
for(var op;true;)switch(op=this.next_token(p).kind){case "\x3c":case "\x3c\x3d":case "\x3d\x3d":case "!\x3d":case "\x3e\x3d":case "\x3e":value=this.evaluate_comparison(op,value,this.parse_additive_op(p));break;default:this.backup(p);return value}},evaluate_comparison:function(op,l,r){if(op==="\x3d\x3d")if(l&&l.is_money)return r&&r.is_money&&l.currency===r.currency&&l.amount===r.amount;else return l==r;else if(op==="!\x3d")return!this.evaluate_comparison("\x3d\x3d",l,r);else{if("undefined"===typeof l||
"undefined"===typeof r)Log.error("Expression: inequality comparison with an undefined operand will always return false");if(l&&l.is_money){if(!(r&&r.is_money))throw"money cannot be compared with non-money";if(l.currency!==r.currency)throw"money comparison currency mismatch";l=l.amount;r=r.amount}switch(op){case "\x3c":return l<r;case "\x3e":return l>r;case "\x3c\x3d":return l<=r;case "\x3e\x3d":return l>=r;default:throw"invalid comparison operator: "+op;}}},parse_additive_op:function(p){for(var value=
this.parse_multiplicative_op(p);true;)switch(this.next_token(p).kind){case "+":value+=this.parse_multiplicative_op(p);break;case "-":value-=this.parse_multiplicative_op(p);break;default:this.backup(p);return value}},parse_multiplicative_op:function(p){for(var value=this.parse_term(p);true;)switch(this.next_token(p).kind){case "*":value*=this.parse_term(p);break;case "/":value/=this.parse_term(p);break;case "%":value%=this.parse_term(p);break;default:this.backup(p);return value}},parse_term:function(p){var token=
this.next_token(p);var value;switch(token.kind){case "(":value=this.parse_top(p);if(this.next_token(p).kind!=")")throw"Expression error: '"+p.expr+"' -- unbalanced parentheses";break;case "+":value=this.parse_term(p);break;case "-":value=-this.parse_term(p);break;case "!":value=!this.is_true(this.parse_term(p));break;case "term":if(!p.short_circuit){var con=p.handle_constants;if(con){con=this.constant(token.value);if(con)value=con.v}if(!con)if(p.eval_lambda)value=p.eval_lambda(token.value);else throw"Expression error: '"+
p.expr+"' -- not a term";}}return p.short_circuit?1:value},constant:function(x){var m;if(x.match(/^\d/))if(x.match(/e|E|\./))return{"v":parseFloat(x)};else return{"v":parseInt(x)};else if(m=x.match(/^\'(.*)\'$/)||x.match(/^\"(.*)\"$/))return{"v":m[1]};else if(x=="true")return{"v":true};else if(x=="false")return{"v":false};else if(x=="nil")return{"v":null};else return null}};
var StatusSpinny={spinnyID:"status-spinny",spinningClass:"spinning",timeouts:[],showQueue:[],showingQueue:false,isShown:false,spinny:function(spins){var spinnyEl=$("#"+StatusSpinny.spinnyID);if(spinnyEl.length===0)spinnyEl=$('\x3cdiv id\x3d"'+StatusSpinny.spinnyID+'"\x3e\x3c/div\x3e').appendTo(document.body);if(typeof spins=="boolean")spinnyEl[spins?"addClass":"removeClass"](StatusSpinny.spinningClass);return spinnyEl},show:function(speed,spins,message,duration){if(message===undefined||message==null)message=
"";StatusSpinny.resetTimeouts();var showFn=function(){StatusSpinny.isShown=true;StatusSpinny.spinny(spins).html(message).fadeIn(speed);if(typeof duration=="number")StatusSpinny.timeout(duration)};if(StatusSpinny.isShown)StatusSpinny.scheduleShow(message,showFn);else showFn()},scheduleShow:function(message,showFn){StatusSpinny.showQueue.push({message:message,fn:showFn});if(!StatusSpinny.showingQueue){StatusSpinny.showingQueue=true;var runShowScheduler=function(){StatusSpinny.hide(100,null,function(){if(StatusSpinny.showQueue.length>
2){for(var queuedShow=StatusSpinny.showQueue.shift();StatusSpinny.showQueue.length>1&&queuedShow.message==StatusSpinny.showQueue[1].message;)StatusSpinny.showQueue=StatusSpinny.showQueue.slice(2);queuedShow.fn()}else if(StatusSpinny.showQueue.length>0)StatusSpinny.showQueue.shift().fn();else{StatusSpinny.showingQueue=false;return null}window.setTimeout(runShowScheduler,1500)})};runShowScheduler()}},wouldShowAfter:function(afterTime,speed,spins,message,duration){var uniqueTimeoutID=StatusSpinny.timeoutId();
var spinny=StatusSpinny.spinny();spinny.on(uniqueTimeoutID,function(){StatusSpinny.show(speed,spins,message,duration)});window.setTimeout(function(){spinny.trigger(uniqueTimeoutID)},afterTime);return uniqueTimeoutID},hide:function(speed,cancelID,animCB){if(cancelID!==undefined&&typeof cancelID=="string")StatusSpinny.spinny().off(cancelID);if(speed===undefined)speed="fast";StatusSpinny.spinny().fadeOut(speed,animCB);StatusSpinny.isShown=false},timeout:function(duration){var uniqueTimeoutID=StatusSpinny.timeoutId();
var spinny=StatusSpinny.spinny();spinny.on(uniqueTimeoutID,StatusSpinny.hide);StatusSpinny.timeouts.push(uniqueTimeoutID);window.setTimeout(function(){spinny.trigger(uniqueTimeoutID)},duration)},resetTimeouts:function(){for(;StatusSpinny.timeouts.length>0;)StatusSpinny.spinny().off(StatusSpinny.timeouts.shift())},timeoutId:function(){return(new Date).getTime()+""+Math.random()},zzz:null};
$.extend(Url,{parseVideoURL:function(url){var parts=Url.toHash(url);var params=Url.parseQuery(parts.search);var path=parts.pathname.replace(/^\/*(.*?)\/*$/,"$1");var youtubeIDRe=/^[\w,\-]+$/;var vimeoIDRe=/^\d+$/;var id=null;var type=null;if(parts.protocol)if(/(^|\.)youtube\.com$/.test(parts.host)){if(/^\/watch\/?$/.test(parts.pathname)&&youtubeIDRe.test(params["v"])){id=params["v"];type="y"}}else if(/(^|\.)youtu\.be$/.test(parts.host)){if(youtubeIDRe.test(path)){id=path;type="y"}}else if(/(^|\.)vimeo\.com$/.test(parts.host))if(vimeoIDRe.test(path)){id=
path;type="v"}return{id:id,type:type}},makeVideoUrl:function(videoID,videoType){if(videoID)switch(videoType){case "y":return"http://www.youtube.com/watch?v\x3d"+encodeURIComponent(videoID);case "v":return"http://vimeo.com/"+encodeURIComponent(videoID)}return null}});
var EmailAddressPattern={toHash:function(str){var EMAIL_ADDRESS_PATTERN=/^([^\s\(\)"'\/><,@]+)@(\w[^\s\(\)"'\/><&,@]*\w)?\.(\w[^\s\(\)"'\/><&,@]*\w)$/;var matches=str.match(EMAIL_ADDRESS_PATTERN);return!matches?null:{address:matches[0],left:matches[1],domain:matches[2],tld:matches[3]}}};var TaskQueue=function(){this.queue=[]};TaskQueue.prototype.addTask=function(task,delay){this.queue.push({task:task,delay:delay})};
TaskQueue.prototype.run=function(){var item=this.queue.shift();var self=this;if(item)setTimeout(function(){item.task();self.run()},item.delay)};var PromiseQueue=function(){this._queue=[]};PromiseQueue.prototype.add=function(fn){this._queue.push(fn);if(this._queue.length===1)this.execute()};PromiseQueue.prototype.execute=function(){var self=this;if(this._queue.length===0)return;var firstFn=this._queue[0];firstFn().then(function(){self._queue.splice(self._queue.indexOf(firstFn),1);self.execute()})};
var Identities=function($){function IdentitiesVM(data){var self=this;this.initialData=data;this.user=ko.observable(data.user);this.fan=ko.observable(data.fan);this.partner=ko.observable(data.partner);this.isAdmin=ko.observable(data.is_admin);this.ip_country_code=data.ip_country_code;this.pageBand=data.page_band&&new BandVM(data.page_band);this.bmgr=new BandsMgr(data.bands);this.lmgr=new LabelsMgr(data.labels);this.labels=this.lmgr.labels;this.labelIds=ko.computed(function(){return Iter.collect(self.labels(),
function(label){return label.id})});this.linkedNonLabelMemberBands=ko.computed(function(){return Iter.findAll(self.bmgr.bands(),function(b){return!self.lmgr.isLabelMemberBand(b.id)})});this.linkedNonLabelBands=ko.computed(function(){return Iter.findAll(self.linkedNonLabelMemberBands(),function(b){return $.inArray(b.id,self.labelIds())===-1})});this.hasLabels=ko.computed(function(){return self.labels().length>0});this.pageBandParentLabel=ko.computed(function(){return Iter.find(self.labels(),function(label){return label.id===
data.page_band_parent_label_id})});var pageLabelForAdmin=data.page_label&&new LabelVM(data.page_label);this.pageLabel=ko.computed(function(){return self.pageBandParentLabel()||self.pageBand&&self.labels()&&Iter.find(self.labels(),function(label){return label.id===self.pageBand.id})||pageLabelForAdmin});this.isPageBandMember=ko.observable(data.is_page_band_member);this.isParentLabel=ko.computed(function(){return!!self.pageBandParentLabel()});this.hasFullAccess=ko.computed(function(){return self.isPageBandMember()||
self.isAdmin()});this.hasLimitedAccess=ko.computed(function(){return self.isParentLabel()&&data.page_band&&!data.page_band.authed});this.isPageBand=function(bandID){return self.pageBand&&bandID===self.pageBand.id};this.isMemberOfBand=function(bandID){return self.bmgr.bandByID(bandID)||self.lmgr.isMemberBandAuthed(bandID)};this.activeLicenses=ko.observableArray(data.active_licenses);this.subscribedToPageBand=ko.observable(data.subscribed_to_page_band||false);this.updateFromHash=function(updateHash){if(updateHash.bands)self.bmgr.updateBands(Iter.collect(updateHash.bands,
function(b){return new BandVM(b)}));if(updateHash.page_band&&self.pageBand){if(updateHash.page_band.name)self.pageBand.name(updateHash.page_band.name);if(updateHash.page_band.photo)self.pageBand.photo(updateHash.page_band.photo);if(updateHash.page_band.trackpipe_local_url)self.pageBand.trackpipeLocalUrl(updateHash.page_band.trackpipe_local_url)}self.isPageBandMember(updateHash.is_page_band_member)};this.add=function(newEntities){if(newEntities.bands&&newEntities.bands.length>0)self.bmgr.addBands(newEntities.bands);
if(newEntities.labels&&newEntities.labels.length>0)self.lmgr.addLabels(newEntities.labels)};this.remove=function(entities){if(entities.bands&&entities.bands.length>0)self.bmgr.removeBands(entities.bands);if(entities.labels&&entities.labels.length>0){self.lmgr.removeLabels(entities.labels);self.bmgr.removeBands(entities.labels)}}}function BandVM(data){var self=this;this.id=data.id;this.name=ko.observable(data.name);this.photo=ko.observable(data.photo||data.bio&&data.bio.image_id);this.trackpipeUrl=
ko.observable(data.trackpipe_url||data.url);this.trackpipeLocalUrl=ko.observable(data.trackpipe_local_url||data.url||data.trackpipe_url);this.trackpipeUrlHttps=ko.observable(data.trackpipe_url_https);this.isPro=ko.observable(data.is_pro);this.hasService=ko.observable(data.has_service);this.serviceName=ko.observable(data.service_name);this.serviceUrlFragment=ko.observable(data.service_url_fragment);this.isLabel=ko.observable(data.is_label);this.isLabelMemberBand=ko.observable(false)}function BandsMgr(initial_bands){var self=
this;var bandsArray;this.addBands=function(bands){var newBandVMs;var args;newBandVMs=Iter.collect(bands,function(b){return b instanceof BandVM?b:new BandVM(b)});args=[Number.MAX_VALUE,0].concat(newBandVMs);bandsArray.splice.apply(bandsArray,args)};this.bandByID=function(band_id){return Iter.find(bandsArray(),function(b){return b.id===band_id})};this.removeBands=function(band_ids){var bandsToRemove=Iter.findAll(bandsArray(),function(b){return!!Iter.find(band_ids,function(id){return id===b.id})});bandsArray.removeAll(bandsToRemove)};
this.updateBandName=function(bandId,newBandName){var bandToUpdate=self.bandByID(bandId);if(bandToUpdate)bandToUpdate.name(newBandName)};this.updateBands=function(newArray){bandsArray(newArray)};bandsArray=ko.observableArray(Iter.collect(initial_bands||[],function(b){return new BandVM(b)}));this.bands=ko.computed(function(){var bands=bandsArray.slice(0);bands.sort(function(a,b){a=a.name().toLowerCase();b=b.name().toLowerCase();return a<b?-1:a>b?1:0});return bands}).extend({throttle:1});this.anyPro=
ko.computed(function(){return!!Iter.find(bandsArray(),function(b){return b.isPro()})})}function LabelVM(data){var self=this;this.id=data.id;this.name=ko.observable(data.name);this.url=ko.observable(data.url);this.memberBands=ko.observableArray(Iter.collect(data.member_bands,function(band){var bandVM=new BandVM(band);bandVM.isLabelMemberBand(true);bandVM.isAuthed=ko.observable(band.authed);return bandVM}));this.memberBandIds=ko.computed(function(){return Iter.collect(self.memberBands(),function(memberBand){return memberBand.id})})}
function LabelsMgr(initialLabels){var self=this;this.labels=ko.observableArray(Iter.collect(initialLabels||[],function(label){return new LabelVM(label)}));var memberBandsAuthHash=ko.computed(function(){var hash={};Iter.each(self.labels(),function(label){Iter.each(label.memberBands(),function(band){hash[band.id]=hash[band.id]||band.isAuthed()})});return hash});this.isMemberBandAuthed=function(memberBandID){return memberBandsAuthHash()[memberBandID]};this.isLabelMemberBand=function(memberBandID){return memberBandID in
memberBandsAuthHash()};this.labelByID=function(labelId){return Iter.find(self.labels(),function(l){return l.id===labelId})};this.addLabels=function(labels){var newLabelVMs=Iter.collect(labels,function(l){return new LabelVM(l)});var args=[Number.MAX_VALUE,0].concat(newLabelVMs);self.labels.splice.apply(self.labels,args)};this.removeLabels=function(labelIds){Iter.each(labelIds,function(labelId){var labelToRemove=self.labelByID(labelId);self.labels.remove(labelToRemove)})}}var instance=new IdentitiesVM(($("#pagedata").data("blob")||
{}).identities||{});instance.BandVM=BandVM;instance.BandsMgr=BandsMgr;return instance}(jQuery);
(function($){var Logout={logoutAndRedirect:function(overrideUrl){Crumb.ajax({url:"/api/login/1/logout",type:"POST",dataAs:"JSON",success:function(response){if(overrideUrl)window.location.href=overrideUrl;else if(response.ok&&response.redirect_url)window.location.href=response.redirect_url;else window.location.href=siteroot_https},error:function(jqXHR,errorType,exception){window.location.href=overrideUrl||siteroot_https}})},initialize:function(){$(".logout-action").click(function(){if($(this).parents()[4]==
$("#menubar")[0])Stats.record({"kind":"click","click":"menubar_logout"});var overrideUrl=null;var overrideParam=$(this).data("logout-override");if(overrideParam==="corp_home")overrideUrl=siteroot_https;Logout.logoutAndRedirect(overrideUrl);return false})}};window.Logout=Logout;Logout.initialize()})(jQuery);
var AutocompleteVM=function($,ko){function AutocompleteResultsVM(){var self=this;this.hidden=ko.observable(true);this.genreResult=ko.observable(null);this.genreName=ko.computed(function(){var toReturn=null;if(self.genreResult()&&self.searchText)toReturn=self.searchText.charAt(0).toUpperCase()+self.searchText.slice(1).toLowerCase();return toReturn});this.hasGenreResult=false;this.autocompleteResults=ko.observableArray([]);this.tagResult=ko.observable();this.hasTagResult=false;this.tagStatParams=this.searchText=
null;this.tagName=ko.computed(function(){return self.tagResult()?self.tagResult().name:null});this.tagUrl=ko.computed(function(){return self.tagResult()?self.tagResult().url:null});this.enterPressed=false;this.selected_index=-1;this.hasResults=ko.computed(function(){return self.genreResult()||self.autocompleteResults().length>0||self.tagResult()>0});this.hasAutocompleteResults=ko.computed(function(){return self.autocompleteResults().length>0});this.show=ko.computed(function(){return self.hasResults()&&
!self.hidden()});this.showDiscover=ko.computed(function(){return!self.hasResults()&&!self.hidden()});this.keyboard_focus=ko.computed(function(){return self.selected_index<0});this.discoverGenre=function(){self.discoverJumpRedirect(self.genreResult().genre,self.genreResult().subgenre)};this.discoverJumpRedirect=function(genre,subgenre){if($("#discover").length){var discover=$("#discover");var pill=HomeControl.discoverVM.genres.pills().filter(function(obj){return obj.value==genre})[0];HomeControl.discoverVM.genres.selectPill(pill);
$("html, body").animate({scrollTop:discover.offset().top},1E3);if(subgenre){pill=HomeControl.discoverVM.subgenres.pills().filter(function(obj){return obj.value==subgenre})[0];HomeControl.discoverVM.subgenres.selectPill(pill)}HomeControl.discoverVM.setupScrollers();var currentPageItems=HomeControl.discoverVM.currentPage().items();if(currentPageItems&&currentPageItems.length>0){HomeControl.discoverVM.player.currentItem(currentPageItems[0]);HomeControl.discoverVM.player.playlist.load([HomeControl.discoverVM.player.currentItem().featuredTrack])}}else{window.location.href=
siteroot_https+"?from\x3dsearch\x26g\x3d"+genre+"\x26t\x3d"+subgenre+"#discover";return false}};this.newResults=function(r){var cur_len=this.autocompleteResults().length;for(var i=0;i<cur_len&&i<r.length;i++)if(r[i]&&this.autocompleteResults()[i].url!==r[i].url)this.autocompleteResults.replace(this.autocompleteResults()[i],ko.observable(r[i]));if(cur_len>r.length)for(i=0;i<cur_len-r.length;i++)this.autocompleteResults.remove(this.autocompleteResults()[i+r.length]);else if(cur_len<r.length)for(i=0;i<
r.length-cur_len;i++)this.autocompleteResults.push(ko.observable(r[i+cur_len]))};this.wipe=function(){self.genreResult(null);self.autocompleteResults([]);self.tagResult()}}function Result(data){this.name=data.name;this.bandName=data.band_name;this.noImg=false;if(data.img_id)this.img=ImageUtils.imageURL(data.img_id,3);else if(data.art_id)this.img=ImageUtils.artURL(data.art_id,3);else if(data.img)this.img=data.img;else this.noImg=true;this.url=data.url+"?from\x3dsearch\x26"+data.stat_params;if(document.getElementById("menubar-vm"))if(Identities.user())this.url+=
"\x26logged_in_menubar\x3dtrue";else this.url+="\x26logged_out_menubar\x3dtrue";else if(document.getElementById("header-wrapper"))this.url+="\x26corp_header\x3dtrue";this.artType=false;this.typeText=getType(data.type,data.is_label)}function TagResult(data,stat_params){this.name=data.display_name;this.url=siteroot_https+"/tag/"+data.norm_name+"?from\x3dsearch\x26"+stat_params;if(document.getElementById("menubar-vm"))if(Identities.user())this.url+="\x26logged_in_menubar\x3dtrue";else this.url+="\x26logged_out_menubar\x3dtrue";
else if(document.getElementById("header-wrapper"))this.url+="\x26corp_header\x3dtrue"}function getType(typeChar,isLabel){switch(typeChar){case "t":return TM("Track");case "a":return TM("Album");case "f":return TM("Fan");case "b":return isLabel?TM("Label"):TM("Artist");default:return""}}var levDist=function(s,t){var d=[];var n=s.length;var m=t.length;if(n===0)return m;if(m===0)return n;for(var i=n;i>=0;i--)d[i]=[];for(i=n;i>=0;i--)d[i][0]=i;for(var j=m;j>=0;j--)d[0][j]=j;for(i=1;i<=n;i++){var s_i=
s.charAt(i-1);for(j=1;j<=m;j++){if(i==j&&d[i][j]>4)return n;var t_j=t.charAt(j-1);var cost=s_i==t_j?0:1;var mi=d[i-1][j]+1;var b=d[i][j-1]+1;var c=d[i-1][j-1]+cost;if(b<mi)mi=b;if(c<mi)mi=c;d[i][j]=mi;if(i>1&&j>1&&s_i==t.charAt(j-2)&&s.charAt(i-2)==t_j)d[i][j]=Math.min(d[i][j],d[i-2][j-2]+cost)}}return d[n][m]};return $(function(){var vm;var unselectSelectedIndex=function(){if(vm.selected_index>-1){if(vm.selected_index<vm.autocompleteResults().length)document.getElementById("results-item-"+vm.selected_index).className=
"results-item";if(vm.selected_index==vm.autocompleteResults().length)document.getElementById("see-all").className="see-all";if(vm.selected_index==vm.autocompleteResults().length+1)document.getElementById("autocomplete-tags").className="autocomplete-tags";vm.selected_index=-1}if(document.getElementById("autocomplete-form"))document.getElementById("autocomplete-form").className="searchwidget autocomplete-form keyboard-focus"};var selectSelectedIndex=function(){if(vm.selected_index>-1){if(document.getElementById("autocomplete-form"))document.getElementById("autocomplete-form").className=
"searchwidget autocomplete-form";if(vm.selected_index<vm.autocompleteResults().length)document.getElementById("results-item-"+vm.selected_index).className+=" elem-selected";if(vm.selected_index==vm.autocompleteResults().length)document.getElementById("see-all").className+=" selected";if(vm.selected_index==vm.autocompleteResults().length+1)document.getElementById("autocomplete-tags").className+=" selected"}};var initializeAutocomplete=function(){var pagedata=$("#pagedata").data("blob")||{};var cfg=
pagedata.cfg;if(cfg&&cfg.BALLS_disable_autocomplete||document.getElementById("menubar-vm")&&cfg&&!cfg.menubar_autocomplete_enabled)return;vm=new AutocompleteResultsVM;$(".autocomplete-form").submit(function(){return!($(".you-autocomplete-me").val()==""||vm.searchText=="")});$(".see-all").click(function(e){e.preventDefault();var $form=$(".autocomplete-form");if($form)$form.submit()});$(document.body).click(function(){vm.hidden(true)});$(document).scroll(function(){vm.hidden(true)});$(".you-autocomplete-me").click(function(e){e.stopPropagation();
vm.hidden(false)});$(".you-autocomplete-me").keydown(function(e){var window_event=e||event||e;var code=window_event.keyCode||window_event.which;if(code==38){e.preventDefault();if($(".you-autocomplete-me").val()===vm.searchText){var curr_ind=vm.selected_index;unselectSelectedIndex();if(curr_ind>-1)vm.selected_index=curr_ind-1;else vm.selected_index=curr_ind;selectSelectedIndex()}}if(code==40){e.preventDefault();if($(".you-autocomplete-me").val()===vm.searchText){curr_ind=vm.selected_index;unselectSelectedIndex();
if(curr_ind<vm.autocompleteResults().length||curr_ind==vm.autocompleteResults().length&&vm.hasTagResult)vm.selected_index=curr_ind+1;else vm.selected_index=curr_ind;selectSelectedIndex()}}if(code==13){e.preventDefault();vm.enterPressed=true;if(vm.selected_index>-1&&$(".you-autocomplete-me").val()==vm.searchText)if(vm.selected_index==vm.autocompleteResults().length){var $form=$(".autocomplete-form");if($form)$form.submit()}else if(vm.selected_index==vm.autocompleteResults().length+1&&vm.hasTagResult)window.location.href=
vm.tagUrl();else window.location.href=vm.autocompleteResults()[vm.selected_index]().url;else if(vm.hasGenreResult&&$(".you-autocomplete-me").val()==vm.searchText)vm.discoverGenre();else{$form=$(".autocomplete-form");if($form)$form.submit()}}else vm.enterPressed=false;if(code==8)unselectSelectedIndex()});$(".you-autocomplete-me").keyup(function(e){var searchText=$(this).val();if(!searchText){vm.wipe();return}var window_event=e||event||e;var code=window_event.keyCode||window_event.which;if(code==38||
code==40){e.preventDefault();return}vm.hidden(false);var successFun=function(t1){return function(response){if(response.auto&&response.auto!="ac_error"&&$(".you-autocomplete-me").val()===searchText&&!vm.enterPressed&&$(".you-autocomplete-me").val()!=vm.searchText){vm.searchText=searchText;if(response.genre&&response.genre.match){vm.genreResult(response.genre.match);vm.hasGenreResult=true}else{vm.genreResult(null);vm.hasGenreResult=false}if(response.auto)vm.newResults(Iter.collect(response.auto.results,
function(r){return new Result(r)}));if(response.tag.matches&&response.tag.matches.length>0&&!vm.hasGenreResult&&levDist(response.tag.matches[0].display_name,searchText)<3){vm.tagResult(new TagResult(response.tag.matches[0],response.auto.stat_params_for_tag));vm.hasTagResult=true}else{vm.tagResult(null);vm.hasTagResult=false}unselectSelectedIndex();var mouseoverfun=function(ind){return function(){unselectSelectedIndex();vm.selected_index=ind;selectSelectedIndex()}};for(var i=0;i<vm.autocompleteResults().length;i++)if(document.getElementById("results-item-"+
i)){document.getElementById("results-item-"+i).onmouseover=mouseoverfun(i);document.getElementById("results-item-"+i).onmouseout=function(){unselectSelectedIndex()}}document.getElementById("see-all").onmouseover=function(){unselectSelectedIndex();vm.selected_index=vm.autocompleteResults().length;selectSelectedIndex()};document.getElementById("see-all").onmouseout=function(){unselectSelectedIndex()};document.getElementById("autocomplete-tags").onmouseover=function(){if(vm.hasTagResult){unselectSelectedIndex();
vm.selected_index=vm.autocompleteResults().length+1;selectSelectedIndex()}};document.getElementById("autocomplete-tags").onmouseout=function(){if(vm.hasTagResult)unselectSelectedIndex()}}}};if($(".you-autocomplete-me").val()===searchText&&searchText!=vm.searchText){var t1=new Date;$.ajax({url:"/api/fuzzysearch/1/autocomplete?q\x3d"+encodeURIComponent(searchText),type:"GET",dataAs:"JSON",success:successFun(t1.getMilliseconds()),error:function(){Log.error("genre autocomplete failed")}})}});return vm};
window.AutocompleteVM=initializeAutocomplete();window.initializeAutocomplete=initializeAutocomplete})}(jQuery,ko);
var Translate=function(){var pageData=$("#pagedata").data("blob");var locale$$0=pageData&&pageData.locale||"en";return{EN_DEFAULT:"en",locale:locale$$0,findMd5:function(str,context){var key=str+context;return window.bcStrings.md5s[key]!==undefined?window.bcStrings.md5s[key]:null},variableInterpolate:function(str,vars){if(typeof vars==="undefined")vars={};return str.replace(/\{\{(.*?)\}\}/g,function(w,expr){return vars[expr]})},checkForSingleQuote:function(str){if(str.indexOf("'")>=0&&(str.search(/[a-z]'[a-z]/)>=
0||str.search(/s' /)>=0||str.search(/'s /)>=0))Log.server("single quotes used in place of apostrophe, use [\u2019] character instead!! ["+str+"]","error")},translateMsg:function(str){var dev=arguments[1];var param;if(typeof dev==="string")param=2;else{param=1;dev=null}var vars=arguments[param++]||null;var note=arguments[param++]||null;var context=arguments[param++]||"";Translate.checkForSingleQuote(str);var localeStr=null;if(Translate.locale===Translate.EN_DEFAULT)localeStr=str;else if(Translate.locale===
"qq")if("Pseudoloc"in window)localeStr=Pseudoloc.str(str);else{Log.server("translateMsg called before initialization, locale "+Translate.locale+", translation in JS for string: "+str,"error");localeStr=str}else if(window.bcStrings.translations[Translate.locale]===undefined){Log.server("translateMsg called before strings initialized, locale "+Translate.locale+", translation in JS for string: "+str,"error");localeStr=str}else{var key=Translate.findMd5(str,context);if(key)localeStr=window.bcStrings.translations[Translate.locale][key];
if(!localeStr){Translate.missingTranslation("TM",locale$$0,str,context,dev);localeStr=str}}var renderedStr=Translate.variableInterpolate(localeStr,vars);return renderedStr},translatePlural:function(str,pluralStr,count){var dev=arguments[3];var param;if(typeof dev==="string")param=4;else{param=3;dev=null}var vars=arguments[param++]||{};var note=arguments[param++]||null;var context=arguments[param++]||"";Translate.checkForSingleQuote(str);Translate.checkForSingleQuote(pluralStr);vars.count=count;var s;
var which;if(count==1){s=str;which="s"}else{s=pluralStr;which="p"}var localeStr=null;if(Translate.locale===Translate.EN_DEFAULT)localeStr=s;else if(Translate.locale==="qq")if("Pseudoloc"in window)localeStr=Pseudoloc.str(s);else{Log.server("translateMsg called before initialization, locale "+Translate.locale+", translation in JS for string: "+s,"error");localeStr=s}else if(window.bcStrings.translations[Translate.locale]===undefined){Log.server("translateMsg called before strings initialized, locale "+
Translate.locale+", translation in JS for string: "+s,"error");localeStr=s}else{var key=Translate.findMd5(s,context);if(key)localeStr=window.bcStrings.translations[Translate.locale][key]&&window.bcStrings.translations[Translate.locale][key][which];if(!localeStr){Translate.missingTranslation("TP",locale$$0,s,context,dev);localeStr=s}}var renderedStr=Translate.variableInterpolate(localeStr,vars);return renderedStr},missingTranslation:function(tag_type,locale,str,context,dev){$.ajax({url:"/api/internationalization/1/missing_js_translation",
type:"POST",dataType:"JSON",data:ko.toJSON({"tag_type":tag_type,"locale":locale,"str":str,"context":context,"dev":dev})}).success(function(response){if(response.error)Log.server("Missing translation logging error. response.error: "+response.error,"error")}).fail(function(error){Log.server("Missing translation logging fail. Error: "+error,"error")})}}}();var T=Translate;var TM=Translate.translateMsg;var TP=Translate.translatePlural;
(function(window,$,ko){function initializeLangPicker(){var pageData=$("#pagedata").data("blob");var locale=pageData&&pageData.locale||null;if(typeof locale!=="undefined"&&locale!==null){var vmId=Browser.media_mode==="phone"?"#lang-picker-vm-m":"#lang-picker-vm";var lp=$(vmId);if(lp[0]){var locales_orig={};if(pageData.languages)locales_orig=pageData.languages;else locales_orig={fr:"Fran\u00e7ais",ja:"\u65e5\u672c\u8a9e",en:"English"};var langPickerVM=new LangPickerVM(locale,locales_orig);ko.applyBindings(langPickerVM,
lp[0]);var $menu=$(".lang-picker-content");$(".lang-picker-current-lang").click(function(){$menu.bcmenu($menu.is(":visible")?"hide":"show");return false});$(".lang-picker-content").bcmenu({show:function(){$(".pg-ft-nav:not(.lang-picker-container)").addClass("dimmed")},hide:function(){$(".pg-ft-nav").removeClass("dimmed")},triggerElements:".lang-picker-current-lang"});window.LangPicker=langPickerVM}}}function LangPickerVM(locale$$0,locales_obj){var self=this;self.pageData=$("#pagedata").data("blob");
self.mapDictToArray=function(dict){var result=[];for(var key in dict)if(dict.hasOwnProperty(key))result.push({key:key,value:dict[key]});return result};self.curr_locale=ko.observable(locale$$0);self.locales=ko.observableArray(self.mapDictToArray(locales_obj));self.display_locale=ko.pureComputed(function(){var loc=Iter.find(self.locales(),function(loc){return self.curr_locale()===loc.key});return loc&&loc.value});self.otherLocales=ko.pureComputed(function(){return Iter.findAll(self.locales(),function(loc){return loc.key!==
self.curr_locale()})});self.update_locale=function(locale){if(locale.key!==self.curr_locale()){$("#lang-picker-content").hide();var clientId=null;if(Url.isCustomDomain(window.location.hostname)){Cookie.set("bc_cdloc",locale.key,null,"/",window.location.hostname,false);clientId=ClientID}var ids=self.pageData.identities;var userId=ids&&ids.user&&ids.user.id;var fanId=ids&&ids.fan&&ids.fan.id;$.ajax({url:"/api/internationalization/1/update_locale",type:"POST",dataType:"JSON",data:ko.toJSON({"locale":locale.key,
"user_id":userId,"client_id":clientId,"fan_id":fanId})}).success(function(response){if(response.error)Log.server("update locale failed. response.error: "+response.error,"error");else{self.curr_locale(locale.key);Log.debug("Successful locale update; reloading page.");window.location.reload()}}).fail(function(jqXHR,textStatus){var buttons=[];buttons.push({text:TM("OK"),click:function(event){$(this).dialog("close")}});NuDialog.alert(TM("Network Error",null,"Dialog box title."),TM("There was a network error while processing your request. Please try again."),
{buttons:buttons})})}};self.show_dialog_phone=function(){var buttons=[];Iter.each(self.locales(),function(loc){if(self.curr_locale()!==loc.key)buttons.push({text:loc.value,value:loc.key,click:function(event){self.update_locale(loc);$(this).dialog("close")}})});NuDialog.alertHTML(TM("Language"),"",{buttons:buttons,dialogClass:"nu-dialog lang-picker-m"});$(".ui-dialog-buttonset\x3ebutton").after("\x3cbr\x3e")}}$(function(){initializeLangPicker()})})(window,jQuery,ko);
(function(){function initializeMenuBar(){var mb=$("#menubar-vm");var pagedata=$("#pagedata").data("blob")||{};var cfg=pagedata.cfg||{};if(mb[0]){var adminLevel=mb.data("initial-values").admin_level;if(adminLevel>0)if(!cfg.header_rework_2018)MenubarAdmin.addMenuItems($("#user-nav .user-menu"),adminLevel);else MenubarAdmin.addMenuItems($("#user-nav .user-menu \x3e :first-child"),adminLevel);var menubarVM=new MenubarVM(false);ko.applyBindings(menubarVM,mb[0]);mb.removeClass("loading");$("#menubar").bcmenubar({menu_position:{phone:{my:"top",
at:"bottom",collision:"flipfit"},other:{my:"left top",at:"left bottom"}}});$("#search-field").placeholder();$("#search-field").focus(function(){$("#search-field").addClass("focused")});$("#search-field").blur(function(){if($("#search-field").val()==="")$("#search-field").removeClass("focused")})}if(cfg.header_rework_2018){$(".artist-search-icon").click(function(event){$(".artist-search-icon").hide();$(".search-alt").show()});$(".artist-filter-text").keydown(function(event){event.stopPropagation()});
if(pagedata.launch_edit_design)Design.editDesign();var mbm=$("#menubar-2018-phone");if(mbm[0]&&!mbm.hasClass("mbm-ko-bound")){var mobileMenubarVM=new MenubarVM(true);ko.applyBindings(mobileMenubarVM,mbm[0]);mbm.removeClass("loading");mbm.addClass("mbm-ko-bound")}if(!pagedata.is_corp_home)$(document).ready(function(){function hasScrolled(){var currentScrollPos=Menubar.getScroll();if(currentScrollPos.top>0){$("body").addClass("first-scroll");if(currentScrollPos.top>hdHeight+50)if(prevScrollpos>currentScrollPos.top){$("body").removeClass("scroll-detected");
if(document.activeElement.className=="you-autocomplete-me")$(".you-autocomplete-me").blur()}else $("body").addClass("scroll-detected");$("body").removeClass("hide-tooltips")}else{$("body").removeClass("first-scroll");$("body").removeClass("scroll-detected");$("body").addClass("hide-tooltips")}prevScrollpos=currentScrollPos.top}var didScroll;var bannerDiv;var prevScrollpos;var hdHeight;bannerDiv=mbm[0]?mbm:$("#menubar.menubar-2018");hdHeight=bannerDiv.outerHeight();prevScrollpos=0;$(window).scroll(function(event){didScroll=
true;var scroll=Menubar.getScroll();if(scroll.left>0)$("#menubar-wrapper").css("left",-$(window).scrollLeft()+"px")});setInterval(function(){if(didScroll){hasScrolled();didScroll=false}},200)})}}function MenubarVM(isMobile){var self;self=this;this.isMobile=isMobile;this.root=self.isMobile?$("#menubar-2018-phone"):$("#menubar-vm");this.data=this.root.data("initial-values")||{};this.forceNoControl=self.data.force_no_control;this.hideArtistMenu=self.data.hide_artist_menu;this.showMobileMenu=ko.observable(false);
this.thing2=null;Iter.each(["fan","isAdmin","pageBand","partner","user"],function(key){self[key]=Identities[key]});this.showBandControls=ko.computed(function(){return Identities.pageBand&&Identities.hasFullAccess()&&!self.forceNoControl});this.showLimitedAccessControls=ko.computed(function(){return Identities.pageBand&&Identities.hasLimitedAccess()&&!self.forceNoControl});this.artistsMenu=new ArtistsMenuVM(this);this.statsLinkHref=ko.computed(function(){if(!self.pageBand)return"";if(Identities.isParentLabel()&&
!Identities.hasFullAccess())return Identities.pageBandParentLabel().url()+"/stats?band\x3d"+self.pageBand.id+"\x26from\x3dmenubar";else return self.pageBand.trackpipeLocalUrl()+"/stats?from\x3dmenubar"});this.statsLinkHref2018=ko.computed(function(){if(!self.pageBand)return"";if(Identities.isParentLabel())return Identities.pageBandParentLabel().url()+"/stats?band\x3d"+self.pageBand.id+"\x26from\x3dmenubar";else return self.pageBand.trackpipeLocalUrl()+"/stats?from\x3dmenubar"});this.ordersLinkHref=
ko.computed(function(){if(!self.pageBand)return"";if(Identities.isParentLabel())return Identities.pageBandParentLabel().url()+"/merch_orders";else return self.pageBand.trackpipeLocalUrl()+"/merch_orders"});this.addAlbumClick=function(){Stats.record({"kind":"click","click":"menubar_add_album"});return!LabelAddItemDialog.showDialog("album")};this.addTrackClick=function(){Stats.record({"kind":"click","click":"menubar_add_track"});return!LabelAddItemDialog.showDialog("track")};this.addMerchClick=function(){Stats.record({"kind":"click",
"click":"menubar_add_merch"});if(window.EditTralbum&&window.EditTralbum.viewModel&&window.EditTralbum.viewModel.createNewMerch){window.EditTralbum.viewModel.createNewMerch();return false}else return!LabelAddItemDialog.showDialog("merch")};this.addNewArtist=function(){Stats.record({"kind":"click","click":"menubar_add_new_artist"});if(self.data.lapsed_or_cancelled_label){window.location=self.data.lapsed_redirect_url;return}AddNewArtistDialog.showDialog()};this.addExistingArtist=function(){Stats.record({"kind":"click",
"click":"menubar_add_existing_artist"});if(self.data.lapsed_or_cancelled_label){window.location=self.data.lapsed_redirect_url;return}AddExistingArtistDialog.showDialog()};this.numCartItemsDisplay=ko.pureComputed(function(){if(typeof Sidecart==="undefined"||!Sidecart)return self.data.cart_quantity;else return Sidecart.ko_num_cart_items()>99?"99+":Sidecart.ko_num_cart_items()});this.hasCart=ko.pureComputed(function(){if(typeof Sidecart==="undefined"||!Sidecart)if(self.data.cart_quantity)return self.data.cart_quantity>
0;else{var pagedata=$("#pagedata").data("blob")||{};return pagedata.cart_quantity>0}else return Sidecart.ko_num_cart_items()>0});this.shrinkLogo=ko.pureComputed(function(){return self.data.gift_card_balance||self.hasCart()});this.goCart=function(){if(typeof Sidecart==="undefined"||!Sidecart)return window.location.href="/cart";if(!Sidecart.ko_num_cart_items()>0)return;if(!self.isMobile){var lastItemUrl=Sidecart.cart_items[Sidecart.cart_items.length-1].url;var a=document.createElement("a");a.href=lastItemUrl;
if(window.location.hostname==a.hostname&&window.location.pathname==a.pathname)Sidecart.wiggle();else return window.location.href="/cart"}else{var currentPos=Menubar.getScroll();if(currentPos.top>0){Dom.scrollToElement(document.body);var sidecart=$("#sidecart");if(!sidecart.hasClass("expanded"))Sidecart.show_cart_phone()}else Sidecart.toggle_cart_phone()}};this.currLocale=ko.pureComputed(function(){if(typeof LangPicker==="undefined"||!LangPicker){var pageData=$("#pagedata").data("blob");return pageData&&
pageData.locale||"English"}else return LangPicker.display_locale()});this.langPickerDialog=function(){LangPicker.show_dialog_phone()};if(window.initializeAutocomplete)this.AutocompleteVM=AutocompleteVM}function ArtistsMenuVM(menubar){function numberOfBandsToShow(){var numLabelBands=self.pageLabelMemberBands().length;var numLabelBandRows=Math.ceil(numLabelBands/self.columns());var numLinkedBands=self.otherLinkedAccounts().length;var numLinkedBandRows=Math.ceil(numLinkedBands/self.columns());var totalRows=
numLabelBandRows+numLinkedBandRows;var labelBandsDisplayed;var linkedBandsDisplayed;if(totalRows<maxRows||!self.hasLabels())return{"labelBands":numLabelBands,"linkedBands":numLinkedBands};if(numLinkedBands<numLabelBands){labelBandsDisplayed=(maxRows-numLinkedBandRows)*self.columns();if(numLabelBands>labelBandsDisplayed)--labelBandsDisplayed;return{"labelBands":labelBandsDisplayed,"labelBandsOverflow":numLabelBands-labelBandsDisplayed,"linkedBands":numLinkedBands}}else{linkedBandsDisplayed=(maxRows-
numLabelBandRows)*self.columns();if(numLinkedBands>linkedBandsDisplayed)--linkedBandsDisplayed;return{"labelBands":numLabelBands,"linkedBands":linkedBandsDisplayed,"linkedBandsOverflow":numLinkedBands-linkedBandsDisplayed}}}function columnize(bands,limit){var lbands;var colHeight;var columns;lbands=bands.slice(0,limit);lbands=lbands.sort(function(a,b){if(a.name()<b.name())return-1;if(a.name()>b.name())return 1;return 0});colHeight=Math.ceil(lbands.length/self.columns());for(columns=[];lbands.length>
0;)columns.push({bands:lbands.splice(0,colHeight)});return columns}var self=this;var maxRows=9;var maxCols=3;this.menubar=menubar;Iter.each(["bmgr","lmgr","hasLabels","isPageBand","isPageBandMember","isParentLabel","linkedNonLabelMemberBands","pageBandParentLabel","pageLabel"],function(key){self[key]=Identities[key]});this.toolsProfileBand=ko.computed(function(){if(menubar.showBandControls()||menubar.showLimitedAccessControls())return menubar.pageBand;else if(self.bmgr.bands().length===1)return self.bmgr.bands()[0];
else return null});this.options=ko.computed(function(){var b=self.toolsProfileBand();return{title:b?b.name():"artists",showPhoto:!!b,photo:b?b.photo():null,showPro:b?b.isPro():self.bmgr.anyPro(),toolsProfileEditable:b&&(Identities.isMemberOfBand(b.id)||menubar.isAdmin()),adminAccess:b&&!self.isPageBandMember()&&menubar.isAdmin()}});this.pageLabelMemberBands=ko.computed(function(){if(self.pageLabel())return self.pageLabel().memberBands();else if(Identities.lmgr&&Identities.lmgr.labels()){var memberBands=
[];Iter.each(Identities.lmgr.labels(),function(label){memberBands=memberBands.concat(label.memberBands())});return memberBands}else return[]});this.otherLinkedAccounts=ko.computed(function(){return Iter.findAll(self.linkedNonLabelMemberBands(),function(band){return(!self.pageLabel()||band.id!==self.pageLabel().id)&&(!self.toolsProfileBand()||band.id!==self.toolsProfileBand().id)})});this.columns=ko.computed(function(){var numLabelBands=self.pageLabelMemberBands().length;var numLinkedBands=self.otherLinkedAccounts().length;
var totalBands=numLabelBands+numLinkedBands;if(!self.hasLabels())return 1;if(totalBands>maxRows*maxCols-1)return maxCols;return Math.floor((totalBands-1)/maxRows)+1});this.labelBands=ko.computed(function(){return self.hasLabels()?columnize(self.pageLabelMemberBands(),numberOfBandsToShow().labelBands):null});this.labelBandsOverflow=ko.computed(function(){return numberOfBandsToShow().labelBandsOverflow});this.linkedBands=ko.computed(function(){return columnize(self.otherLinkedAccounts(),numberOfBandsToShow().linkedBands)});
this.linkedBandsOverflow=ko.computed(function(){return numberOfBandsToShow().linkedBandsOverflow});this.findPageBand=function(){var pageBandAccess=Identities.linkedNonLabelMemberBands().filter(function(band){return Identities.pageBand&&band.id==Identities.pageBand.id}).length==1;if(Identities.isAdmin()&&Identities.pageBand||pageBandAccess){Cookie.set("menubar_active_band",Identities.pageBand.id,60*60*24*30*3);return Identities.pageBand}else if(Cookie.get("menubar_active_band")&&Identities.bmgr.bandByID(parseInt(Cookie.get("menubar_active_band"))))return Identities.bmgr.bandByID(parseInt(Cookie.get("menubar_active_band")));
else return Identities.linkedNonLabelMemberBands()[0]};this.loggedInBand=ko.observable(self.findPageBand());this.setLoggedInBand=function(id){var newBand=self.bmgr.bandByID(id);if(newBand){Cookie.set("menubar_active_band",id,60*60*24*30*3);self.loggedInBand(newBand);if(!self.isPageBand(id))window.location.href=newBand.trackpipeUrlHttps()}};this.optionsLoggedInBand=ko.computed(function(){var b=self.loggedInBand();return{title:b?b.name():"",showPhoto:!!b,photo:b&&b.photo()?b.photo():null,showPro:b?
b.isPro():self.bmgr.anyPro(),toolsProfileEditable:b&&(Identities.isMemberOfBand(b.id)||menubar.isAdmin()),adminAccess:b&&!self.isPageBandMember()&&menubar.isAdmin()}});this.labelMemberBandsSearchTerm=ko.observable("");this.showLinkedBands=ko.observable(false);this.loggedInLabelMemberBandsCountStr=ko.pureComputed(function(){var count=self.loggedInLabelMemberBands().length;return TP("1 ARTIST","{{count}} ARTISTS",count,"pre")});this.loggedInLinkedBandsCountStr=ko.pureComputed(function(){var count=self.linkedNonLabelMemberBands().length-
1;return TP("1 LINKED ACCOUNT","{{count}} LINKED ACCOUNTS",count,"pre")});this.loggedInLabelMemberBands=ko.computed(function(){var b=self.loggedInBand();if(self.lmgr&&self.lmgr.labels()){var memberBands=[];Iter.each(self.lmgr.labels(),function(label){if(label.id==b.id)memberBands=memberBands.concat(label.memberBands())});if(menubar.pageBand){var first=menubar.pageBand.id;memberBands.sort(function(x,y){return x.id==first?-1:y.id==first?1:0})}return memberBands}else return[]});this.filteredLoggedInLabelMemberBands=
ko.computed(function(){return Iter.findAll(self.loggedInLabelMemberBands(),function(band){return band.name().toLowerCase().includes(self.labelMemberBandsSearchTerm().toLowerCase())})});this.activeLabelMemberBand=ko.observable(menubar.pageBand?menubar.pageBand.id:null);this.setActiveLabelMemberBand=function(id){if(self.activeLabelMemberBand()==id)self.activeLabelMemberBand(null);else self.activeLabelMemberBand(id)}}window.Menubar={initialize:initializeMenuBar,initialValues:$("#menubar-vm")[0]?$("#menubar-vm").data("initial-values"):
{},getScroll:function(){var b=document.body;var e=document.documentElement;return{left:parseFloat(window.pageXOffset||b.scrollLeft||e.scrollLeft),top:parseFloat(window.pageYOffset||b.scrollTop||e.scrollTop)}}};$(function(){initializeMenuBar()})})();
(function(jQuery,undefined){function Timer(fn$$0){function trigger(time){if(active){callback();requestFrame(trigger);running=true;active=false}else running=false}var callback=fn$$0;var active=false;var running=false;this.kick=function(fn){active=true;if(!running)trigger()};this.end=function(fn){var cb=callback;if(!fn)return;if(!running)fn();else{callback=active?function(){cb();fn()}:fn;active=true}}}function returnFalse(e){return false}function preventDefault(e){e.preventDefault()}function preventIgnoreTags(e){if(ignoreTags[e.target.tagName.toLowerCase()])return;
e.preventDefault()}function isLeftButton(e){return e.which===1&&!e.ctrlKey&&!e.altKey}function identifiedTouch(touchList,id){var i;var l;if(touchList.identifiedTouch)return touchList.identifiedTouch(id);i=-1;for(l=touchList.length;++i<l;)if(touchList[i].identifier===id)return touchList[i]}function changedTouch(e,event){var touch=identifiedTouch(e.changedTouches,event.identifier);if(!touch)return;if(touch.pageX===event.pageX&&touch.pageY===event.pageY)return;return touch}function mousedown(e){var data;
if(!isLeftButton(e))return;data={target:e.target,startX:e.pageX,startY:e.pageY,pageX:e.pageX,pageY:e.pageY,timeStamp:e.timeStamp};add(document,mouseevents.move,mousemove,data);add(document,mouseevents.cancel,mouseend,data)}function mousemove(e){var data=e.data;checkThreshold(e,data,e,removeMouse)}function mouseend(e){removeMouse()}function removeMouse(){remove(document,mouseevents.move,mousemove);remove(document,mouseevents.cancel,removeMouse)}function touchstart(e){var touch;var data;if(ignoreTags[e.target.tagName.toLowerCase()])return;
touch=e.changedTouches[0];data={target:touch.target,startX:touch.pageX,startY:touch.pageY,pageX:touch.pageX,pageY:touch.pageY,timeStamp:e.timeStamp,identifier:touch.identifier};add(document,touchevents.move+"."+touch.identifier,touchmove,data);add(document,touchevents.cancel+"."+touch.identifier,touchend,data)}function touchmove(e){var data=e.data;var touch=changedTouch(e,data);if(!touch)return;checkThreshold(e,data,touch,removeTouch)}function touchend(e){var data=e.data;var touch=identifiedTouch(e.changedTouches,
data.identifier);if(!touch)return;removeTouch(data)}function removeTouch(touchstart){remove(document,"."+touchstart.identifier,touchmove);remove(document,"."+touchstart.identifier,touchend)}function checkThreshold(e,data,touch,fn){var distX=touch.pageX-data.startX;var distY=touch.pageY-data.startY;if(distX*distX+distY*distY<threshold*threshold)return;return triggerStart(e,data,touch,distX,distY,fn)}function triggerStart(e,data,touch,distX,distY,fn){var node=data.target;var events;var touches;for(var time;node!==
document.documentElement;){events=jQuery.data(node,"events");if(events&&(events.movestart||events.move||events.moveend)){touches=e.targetTouches;time=e.timeStamp-data.timeStamp;data.type="movestart";data.distX=distX;data.distY=distY;data.deltaX=distX;data.deltaY=distY;data.pageX=touch.pageX;data.pageY=touch.pageY;data.velocityX=distX/time;data.velocityY=distY/time;data.targetTouches=touches;data.finger=touches?touches.length:1;trigger(data.target,data,[data,e]);return fn(data)}node=node.parentNode}}
function activeMousemove(e){var event=e.data.event;var timer=e.data.timer;updateEvent(event,e,e.timeStamp,timer)}function activeMouseend(e){var event=e.data.event;var timer=e.data.timer;removeActiveMouse();endEvent(event,timer,function(){setTimeout(function(){remove(event.target,"click",returnFalse)},0)})}function removeActiveMouse(event){remove(document,mouseevents.move,activeMousemove);remove(document,mouseevents.end,activeMouseend)}function activeTouchmove(e){var event=e.data.event;var timer=e.data.timer;
var touch=changedTouch(e,event);if(!touch)return;e.preventDefault();event.targetTouches=e.targetTouches;updateEvent(event,touch,e.timeStamp,timer)}function activeTouchend(e){var event=e.data.event;var timer=e.data.timer;var touch=identifiedTouch(e.changedTouches,event.identifier);if(!touch)return;removeActiveTouch(event);endEvent(event,timer)}function removeActiveTouch(event){remove(document,"."+event.identifier,activeTouchmove);remove(document,"."+event.identifier,activeTouchend)}function updateEvent(event,
touch,timeStamp,timer){var time=timeStamp-event.timeStamp;event.type="move";event.distX=touch.pageX-event.startX;event.distY=touch.pageY-event.startY;event.deltaX=touch.pageX-event.pageX;event.deltaY=touch.pageY-event.pageY;event.velocityX=.3*event.velocityX+.7*event.deltaX/time;event.velocityY=.3*event.velocityY+.7*event.deltaY/time;event.pageX=touch.pageX;event.pageY=touch.pageY;timer.kick()}function endEvent(event,timer,fn){timer.end(function(){event.type="moveend";trigger(event.target,event);
return fn&&fn()})}function isSetup(events){if(!events)return false;return(events.movestart?1:0)+(events.move?1:0)+(events.moveend?1:0)>1}function setup(data,namespaces,eventHandle){var events=jQuery.data(this,"events");if(isSetup(events))return;add(this,"dragstart.move drag.move",preventDefault);add(this,"mousedown.move",preventIgnoreTags);return true}function teardown(namespaces){var events=jQuery.data(this,"events");if(isSetup(events))return;remove(this,"dragstart drag",preventDefault);remove(this,
"mousedown touchstart",preventIgnoreTags);return true}var threshold=6;var add=jQuery.event.add;var remove=jQuery.event.remove;var trigger=function(node,type,data){jQuery.event.trigger(type,data,node)};var requestFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(fn,element){return window.setTimeout(function(){fn()},25)}}();var ignoreTags={textarea:true,input:true,
select:true};var mouseevents={move:"mousemove",cancel:"mouseup dragstart",end:"mouseup"};var touchevents={move:"touchmove",cancel:"touchend",end:"touchend"};jQuery.event.special.movestart={setup:setup,teardown:teardown,_default:function(e,event,touchmove){var data={event:event,timer:new Timer(function(time){trigger(e.target,event)})};if(event.identifier===undefined){add(event.target,"click",returnFalse);add(document,mouseevents.move,activeMousemove,data);add(document,mouseevents.end,activeMouseend,
data)}else{touchmove.preventDefault();add(document,touchevents.move+"."+event.identifier,activeTouchmove,data);add(document,touchevents.end+"."+event.identifier,activeTouchend,data)}}};jQuery.event.special.move=jQuery.event.special.moveend={setup:setup,teardown:teardown};add(document,"mousedown.move",mousedown);add(document,"touchstart.move",touchstart)})(jQuery);
(function(jQuery,undefined){var props=["changedTouches","targetTouches"];var l=props.length;for(var eprops=jQuery.event.props;l--;){var prop=props[l];var found=false;var i=0;for(var n=eprops.length;i<n;++i)if(eprops[l]==prop){found=true;break}if(!found)eprops.push(prop)}})(jQuery);
var PopupImage={_urls:[],_imgs:[],_preloading:false,_imgSizes:{},attach:function(elts){elts=$(elts);Dom.hackLinkClicksThanksSafari(elts,PopupImage.click);this.preload(elts,true)},delegate:function(container){$(container).delegate("a.popupImage","click",PopupImage.click)},preload:function(elts,check_attribute){if(window.MediaView&&MediaView.mode!="desktop")return;var self=this;$(elts).each(function(index,elt){if(!check_attribute||elt.getAttribute("data-image-preload")=="true")self._urls.push(elt.getAttribute("href"))});
if(this._urls.length&&!this._preloading)this._preloader()},preload_url:function(url){this._urls.push(url);if(!this._preloading)this._preloader()},_preloader:function(){if(this._urls.length){this._preloading=true;this._imgs.push(CommUtils.loadImage(this._urls.shift()));if(this._urls.length){var self=this;setTimeout(function(){self._preloader();self=null},100)}else this._preloading=false}},click:function(ev){if(ev.ctrlKey||ev.metaKey)return;var targetLink=ev.currentTarget;if(targetLink&&targetLink.tagName!=
"A")targetLink=$(targetLink).parents("A")[0];if(PopupImage.showFor(targetLink,false)){ev.preventDefault();ev.stopPropagation()}},showFor:function(targetLink,skipZoom){this.dismiss();var url=targetLink&&targetLink.href;if(!url)return false;var statclick=targetLink.getAttribute("data-statclick");if(statclick&&statclick.length>0)Stats.record({kind:"click",click:statclick});if(targetLink.getAttribute("data-image-error")){Log.debug("bailing on popup due to image load error: "+url);return false}var size=
PopupImage.getCachedImageSize(targetLink);var test_ui=false;if(size&&size.w&&size.h&&!test_ui){Log.debug("PopupImage.showFor: got cached image size; showing image immediately");PopupImage.show(url,size.w,size.h,targetLink,skipZoom);return true}Log.debug("PopupImage.showFor: no cached image size; delaying image display");var targetItem=$(targetLink).find("IMG")[0]||targetLink;var loading_indicator=document.createElement("div");loading_indicator.className="popupimage_loading";loading_indicator.style.top=
targetItem.offsetTop+"px";loading_indicator.style.left=targetItem.offsetLeft+"px";loading_indicator.style.width=targetItem.offsetWidth+"px";loading_indicator.style.height=targetItem.offsetHeight+"px";if(targetItem.offsetWidth<200||targetItem.offsetHeight<200)loading_indicator.innerHTML="\x3cdiv class\x3d'popupimage_spinny_sm'\x3e\x3c/div\x3e";else loading_indicator.innerHTML="\x3cdiv class\x3d'popupimage_spinny_lg'\x3e\x3c/div\x3e";loading_indicator.style.opacity=0;targetItem.offsetParent.appendChild(loading_indicator);
$(loading_indicator).delay(500).fadeTo("fast",.5);var img;var dismiss_loading=function(){if(loading_indicator)loading_indicator.parentNode.removeChild(loading_indicator);loading_indicator=null};var finishit=function(){img=new Image;img.onload=function(){PopupImage._imgSizes[img.src]={w:img.width,h:img.height};PopupImage.show(img.src,img.width,img.height,targetLink,skipZoom);img.onload=img.onerror=null;targetLink=img=url=null;dismiss_loading()};img.onerror=function(){Log.debug("image load error: "+
url);targetLink.setAttribute("data-image-error","1");img.onload=img.onerror=null;targetLink=img=url=null;dismiss_loading()};img.src=url};var cancelit=function(){img.onload=img.onerror=null;img.src=null;img=null;dismiss_loading()};if(test_ui)loading_indicator.onclick=finishit;else{loading_indicator.onclick=cancelit;finishit()}return true},show:function(url,width,height,src_image,skipZoom){if(window.FacebookData){var patchYui=true;FacebookUtils.correctSrollThen(patchYui,PopupImage,PopupImage.show_inner,
url,width,height,src_image,skipZoom)}else this.show_inner(url,width,height,src_image,skipZoom)},show_inner:function(url,width,height,src_image,skipZoom){if(window.MediaView&&window.MediaView.mode=="phone")return this.show_mobile(url,width,height,src_image,skipZoom);var lib=this;lib.dismiss();var dismiss=function(){lib.dismiss(this)};var D=Y.util.Dom;var vwrheight=D.getDocumentHeight();var vwrleft=D.getDocumentScrollLeft();var vwrtop=D.getDocumentScrollTop()+40;if(width&&height){var portwidth=D.getViewportWidth()-
60;var portheight=D.getViewportHeight()-60;if(portwidth/portheight>width/height){if(height>portheight){width*=portheight/height;height=portheight}}else if(width>portwidth){height*=portwidth/width;width=portwidth}if(height>portheight-80)var idealtop=(portheight-height)/2;else idealtop=60;vwrtop=D.getDocumentScrollTop()+idealtop-20}var do_zoom=!skipZoom&&src_image!=null;url=url.replace(/'/g,"\\'");var img_vwr=document.createElement("div");img_vwr.className="imageviewer_top";img_vwr.onclick=dismiss;
if(window.FacebookData)var tableDef="\x3ctable align\x3dcenter style\x3d'position:absolute; top:"+vwrtop+"px;left:"+"20px'\x3e\x3ctr\x3e\x3ctd\x3e";else tableDef="\x3ctable align\x3dcenter style\x3d'position:relative; top:"+vwrtop+"px;left:"+vwrleft+"px'\x3e\x3ctr\x3e\x3ctd\x3e";var disableNav=!!window.FacebookData;var hasNext=!disableNav&&this.hasNext(src_image);var hasPrev=!disableNav&&this.hasPrev(src_image);img_vwr.innerHTML="\x3cdiv id\x3d'popupimage_back' class\x3d'imageviewer_back' style\x3d'"+
(do_zoom?"visibilityx: hidden; ":"")+"height:"+vwrheight+"px;width:100%'\x3e\x3c/div\x3e"+tableDef+"\x3cdiv id\x3d'popupimage_dismiss' class\x3d'imageviewer_dismiss'"+(do_zoom?"style\x3d'visibility: hidden;' ":"")+"\x3e\x3c/div\x3e"+"\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd "+(width?" width\x3d'"+width+"px'":"")+(height?" height\x3d'"+height+"px'":"")+"\x3e"+"\x3ca onclick\x3d'return false' target\x3d'_blank' style\x3d'position:relative;display:inline-block;' href\x3d'"+url+"'\x3e"+"\x3cimg id\x3d'popupimage_image' class\x3d'imageviewer_image' src\x3d'"+
url+"'"+(width?" width\x3d'"+width+"px'":"")+(height?" height\x3d'"+height+"px'":"")+(do_zoom?"style\x3d'position: relative; visibility: hidden; opacity: 0.5; filter: alpha(opacity\x3d50);' ":"")+" /\x3e"+(hasPrev?"\x3cspan class\x3d'imageviewer_nav prev' "+(do_zoom?"style\x3d'display:none;'":"")+" onclick\x3d'PopupImage.goPrev(event);'\x3e\x3cspan class\x3d'imageviewer_navicon prev'\x3e\x3c/span\x3e\x3c/span\x3e":"")+(hasNext?"\x3cspan class\x3d'imageviewer_nav next' "+(do_zoom?"style\x3d'display:none;'":
"")+" onclick\x3d'PopupImage.goNext(event);'\x3e\x3cspan class\x3d'imageviewer_navicon next'\x3e\x3c/span\x3e\x3c/span\x3e":"")+"\x3c/a\x3e"+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"+"\x3c/div\x3e";document.body.appendChild(img_vwr);lib._current=img_vwr;lib._currentSrc=src_image;if(!lib._keys){var kl=Y.util.KeyListener;lib._keys=new kl(document,{ctrl:false,meta:false,keys:[kl.KEY.ESCAPE,kl.KEY.ENTER,kl.KEY.SPACE,kl.KEY.DOWN,kl.KEY.LEFT,kl.KEY.RIGHT,kl.KEY.UP]},{fn:function(type,args){if(type=="keyPressed")switch(args[0]){case kl.KEY.ESCAPE:case kl.KEY.ENTER:case kl.KEY.SPACE:lib.dismiss();
break;case kl.KEY.LEFT:case kl.KEY.UP:if(!disableNav)lib.goPrev();break;case kl.KEY.RIGHT:case kl.KEY.DOWN:if(!disableNav)lib.goNext();break}}})}lib._keys.enable();if(do_zoom){var the_image=elt("popupimage_image");var dest_xy=Y.util.Dom.getXY(the_image);var dest_wh=[width,height];var aspect=width*1/height;var src_xy=Y.util.Dom.getXY(src_image);var center_by_width=src_image.offsetHeight>src_image.offsetWidth;start_width=src_image.offsetWidth;start_height=src_image.offsetHeight;var src_wh=center_by_width?
[start_width,start_width/aspect]:[start_height*aspect,start_height];if(center_by_width)src_xy[1]+=src_image.offsetHeight/2-Math.round(src_wh[0]/aspect/2);else src_xy[0]+=src_image.offsetWidth/2-Math.round(src_wh[1]*aspect/2);src_xy[0]+=Math.round((dest_xy[0]-src_xy[0])/2);src_xy[1]+=Math.round((dest_xy[1]-src_xy[1])/2);src_wh[0]+=Math.round((dest_wh[0]-src_wh[0])/2);src_wh[1]+=Math.round((dest_wh[1]-src_wh[1])/2);the_image.width=src_wh[0]+"px";the_image.height=src_wh[1]+"px";the_image.left=src_xy[0]-
dest_xy[0]+"px";the_image.top=src_xy[1]-dest_xy[1]+"px";the_image.style.visibility="visible";var atts={opacity:{to:.9,from:.33},width:{to:dest_wh[0],from:src_wh[0]},height:{to:dest_wh[1],from:src_wh[1]},left:{to:0,from:src_xy[0]-dest_xy[0]},top:{to:0,from:src_xy[1]-dest_xy[1]}};anim=new YAHOO.util.Anim(the_image,atts,.2);anim.onComplete.subscribe(function(){elt("popupimage_dismiss").style.visibility="visible";var st=elt("popupimage_image").style;st.position=st.opacity=st.filter="";$(".imageviewer_nav").css("display",
"inline-block")});anim.animate();the_image=src_image=null}img_vwr=null;return elt("popupimage_image")},show_mobile:function(url,width,height,srcImage,skipZoom){function getPortSize(){var size={w:$(window).width(),h:$(window).height()};if(!phoneView){size.w-=40;size.h-=60}return size}function build(goto_url){Log.debug("PopupImage.build; goto_url: ",goto_url);var src_thumb=$(srcImage).closest(".popupImage");var src_gallery=$(srcImage).closest(".popupImageGallery");if(src_gallery.length>0)var all_thumbs=
src_gallery.find(".popupImage");else all_thumbs=$(src_thumb);var portSize=getPortSize();galleryElt=$("\x3cdiv class\x3d'popupimage_gallery'\x3e\x3c/div\x3e");galleryElt.append($("\x3cspan class\x3d'popupimage_widget popupimage_nav dismiss'\x3e\x3cspan class\x3d'popupimage_navicon dismiss'\x3e\x3c/span\x3e")).bind("click",function(e){dismiss()});if(all_thumbs.length>1){var navdotsElt=$("\x3cspan class\x3d'popupimage_widget popupimage_nav navdots'\x3e\x3c/span\x3e").appendTo(galleryElt).bind("click",
function(e){});for(i=0;i<all_thumbs.length;i++)navdotsElt.append($("\x3cspan class\x3d'popupimage_dot'\x3e\x3c/span\x3e"))}widgets=galleryElt.find(".popupimage_widget");var galleryCtr=$("\x3cul class\x3d'popupimage_container'\x3e\x3c/ul\x3e").css("width",101*all_thumbs.length+"%").appendTo(galleryElt);goto_url=goto_url||src_thumb.attr("href");all_thumbs.each(function(i){var this_thumb=$(this);var this_url=this_thumb.attr("href");var this_size=PopupImage.limitImageSize(PopupImage.getCachedImageSize(this_thumb)||
{},portSize);var show_image=this_url==goto_url&&this_size.w&&this_size.h;var html="\x3cli class\x3d'popupimage_item' id\x3d'popupimage_item_"+i+"' style\x3d'width:"+portSize.w+"px;'\x3e"+"\x3cimg "+(this_url==goto_url?"src":"data-src")+"\x3d'"+this_url+"'"+" style\x3d'display:"+(show_image?"block":"none")+";"+" width:"+(show_image?this_size.w+"px":"auto")+";"+" height:"+(show_image?this_size.h+"px":"auto")+";"+"'\x3e"+"\x3c/li\x3e";galleryCtr.append(html)});var container_left=0;var start_x=null;var min_x=
null;var max_x=null;var touch_action=null;galleryCtr.find(".popupimage_item").bind("touchstart",function(ev){touch_action="start";loadNeighbors(self)}).bind("touchmove",function(ev){touch_action="moving"}).bind("movestart",function(ev){container_left=$(this).closest(".popupimage_container")[0].offsetLeft;currentItem=$(this);touch_action="start"}).bind("move",function(ev){try{if(touch_action=="ignore"||Math.abs(ev.distY)>Math.abs(ev.distX)){goTo(ev,currentItem);touch_action="ignore";return false}touch_action=
"moving";var the_ctr=$(this).closest(".popupimage_container");var dist=ev.distX;if(dist>0&&!hasPrev($(this)))dist=Math.round(dist/2.5);else if(dist<0&&!hasNext($(this)))dist=Math.round(dist/2.5);the_ctr.css({left:container_left+dist})}catch(e){Log.note("move error: "+e.message)}}).bind("moveend",function(ev){if(touch_action=="moving")touch_action=finishMove(ev,this)?"moved":"revert";else Log.note("moveend not moving: "+touch_action)}).bind("click",function(ev){if(ev.target==this){dismiss();return}ev.stopPropagation();
switch(touch_action){case "moved":case "moving":case "revert":case "ignore":break;default:touch_action="click";var elt=$(this);if(ev.clientX>this.offsetWidth*.67)goNext(ev,this);else if(ev.clientX<this.offsetWidth*.33)goPrev(ev,this);else dismiss()}});galleryCtr.find(".popupimage_item img").bind("load",imgLoaded);globalListenersOn();$(document.body).append(galleryElt);Dom.hideEverythingThanksAndroid(galleryElt[0]);galleryElt.find(".popupimage_item").each(function(index,elt){elt=$(elt);if(elt.find("img").attr("src")==
goto_url)currentItem=elt});goTo(null,currentItem,true)}function imgLoaded(ev){var img=$(this);var imgEl=this;clearBusy(img.closest(".popupimage_item"));if(imgEl&&imgEl.style.width=="auto"&&imgEl.style.height=="auto"){if(Browser.type=="ie")img.css({display:"block"});var size={w:img.prop("width"),h:img.prop("height")};PopupImage._imgSizes[img.attr("src")]=size;var limitedSize=PopupImage.limitImageSize(size,getPortSize());img.css({width:limitedSize.w+"px",height:limitedSize.h+"px",display:"block"});
Log.debug("PopupImage: image loaded -- width: ",size.w,"height: ",size.h,imgEl)}loadNeighbors(this)}function loadNeighbors(item){item=$(item).closest(".popupimage_item");loadImg(item.prev(".popupimage_item"));loadImg(item.next(".popupimage_item"))}function loadImg(item){var img=$(item).find("img");var img_url=img.attr("data-src");if(!img_url)return;img.attr("src",img_url);img.attr("data-src",null)}function dismiss(){$(".popupimage_gallery").remove();globalListenersOff();if(galleryElt)Dom.unhideEverythingThanksAndroid(galleryElt[0]);
galleryElt=currentItem=widgets=null}function goTo(ev,elt,hard){elt=$(elt);if(ev)ev.preventDefault();var ctr=elt.closest(".popupimage_container");if(ctr)try{if(elt[0])hard?ctr.css({left:-elt[0].offsetLeft+"px"}):ctr.animate({left:-elt[0].offsetLeft+"px"},100,"linear")}catch(e){Log.note("goTo error: "+e.message)}startBusy(elt);highlightNavDot(elt[0]);currentItem=elt}function goNext(ev,elt){elt=$(elt||currentItem);if(elt.is(".popupimage_container")){Log.note("hmmm container got event: "+ev.which);elt=
$(ev.target).closest(".popupimage_item")}highlightNavDot(elt.next()[0]);goTo(ev,$(elt.next(".popupimage_item")[0]||elt))}function goPrev(ev,elt){elt=$(elt||currentItem);if(elt.is(".popupimage_container")){Log.note("hmmm container got event: "+ev.which);elt=$(ev.target).closest(".popupimage_item")}highlightNavDot(elt.prev()[0]);goTo(ev,$(elt.prev(".popupimage_item")[0]||elt))}function hasNext(el){return $(el).next(".popupimage_item")[0]!=null}function hasPrev(el){return $(el).prev(".popupimage_item")[0]!=
null}function finishMove(ev,elt){try{if(ev.distX<-35&&ev.velocityX<=0){goNext(null,elt);return true}else if(ev.distX>35&&ev.velocityX>=0){goPrev(null,elt);return true}goTo(null,elt);return false}catch(e){Log.note("finishMove error: "+e.message)}}function startBusy(elt){elt=$(elt);if(!elt.hasClass("loaded"))elt.data("loading-timer",setTimeout(function(){elt.addClass("loading")},250))}function clearBusy(elt){elt=$(elt);clearTimeout(elt.data("loading-timer"));elt.removeClass("loading");elt.addClass("loaded")}
function highlightNavDot(elt){if(!elt)return;var id=elt.id.match(/\d+/g);var navdots=$(".navdots");navdots.children().removeClass("active");$(navdots.children()[id]).addClass("active")}function fadeWidgets(elt,fadeUp){elt=$(elt||currentItem);try{if(anim_widgets){anim_widgets.stop(true);anim_widgets=null}if(anim_timer){clearTimeout(anim_timer);anim_timer=null}var these_widgets=widgets.find(".popupimage_navicon");these_widgets.css({opacity:1,display:"inline-block"});if(!hasNext(elt)){these_widgets.filter(".next").css({opacity:0});
these_widgets=these_widgets.not(".next")}if(!hasPrev(elt)){these_widgets.filter(".prev").css({opacity:0});these_widgets=these_widgets.not(".prev")}if(fadeUp)these_widgets.fadeIn(100,"swing");else these_widgets.css({opacity:1});anim_timer=setTimeout(function(){these_widgets.fadeOut(2E3,"swing")},2100);anim_widgets=these_widgets}catch(e){Log.note("fadeWidgets error: "+e.message)}}function popupKeys(ev){if(ev.ctrlKey||ev.metaKey)return;switch(ev.keyCode){case 13:case 27:case 32:dismiss();break;case 39:case 40:goNext(null,
currentItem);break;case 37:case 38:goPrev(null,currentItem);break}}function rotated(dontStallIt,which){if(!dontStallIt){if(rotatedTimeout)clearTimeout(rotatedTimeout);rotatedTimeout=setTimeout(function(){rotated(true)},500);return}if(!galleryElt)return;var img_url=$(currentItem).find("img").attr("src");dismiss();build(img_url)}function globalListenersOn(){$(document).on("keydown",popupKeys);$(document.body).on("orientationchange",function(){rotated(false,"orientation")});$(window).on("resize",function(){rotated(false,
"resize")})}function globalListenersOff(){$(document).off("keydown",popupKeys);$(document.body).off("orientationchange",rotated);$(window).off("resize",rotated)}function zoomIt(){var the_image=currentItem.find("img");var dest_xy=the_image.offset();var dest_wh={width:the_image.outerWidth(),height:the_image.outerHeight()};var dest_aspect=dest_wh.width*1/dest_wh.height;var container=galleryElt.find(".popupimage_container");var old_display=container.css("display");container.css({"display":"none"});var src_xy=
$(srcImage).offset();var src_wh={width:$(srcImage).outerWidth(),height:$(srcImage).outerHeight()};var src_aspect=src_wh.width*1/src_wh.height;center_by_width=dest_aspect<src_aspect;if(dest_aspect<src_aspect){src_xy.top+=Math.round(src_wh.height/2);src_wh.height=Math.round(src_wh.width/dest_aspect);src_xy.top-=Math.round(src_wh.height/2)}else{src_xy.left+=Math.round(src_wh.width/2);src_wh.width=Math.round(src_wh.height*dest_aspect);src_xy.left-=Math.round(src_wh.width/2)}src_xy.left+=Math.round((dest_xy.left-
src_xy.left)/2);src_xy.top+=Math.round((dest_xy.top-src_xy.top)/2);src_wh.width+=Math.round((dest_wh.width-src_wh.width)/2);src_wh.height+=Math.round((dest_wh.height-src_wh.height)/2);var zoom_image=$("\x3cimg/\x3e");zoom_image.attr({src:the_image.attr("src")});zoom_image.css({position:"absolute","z-index":galleryElt.css("z-index")+1,opacity:.33,width:src_wh.width+"px",height:src_wh.height+"px",left:src_xy.left+"px",top:src_xy.top+"px"});zoom_image.appendTo(document.body);zoom_image.animate({opacity:.9,
width:dest_wh.width+"px",height:dest_wh.height+"px",left:dest_xy.left+"px",top:dest_xy.top+"px"},150,"swing",function(){zoom_image.remove();container.css({display:old_display})})}var phoneView=window.MediaView&&window.MediaView.mode=="phone";if(phoneView&&$(srcImage).find("img").outerWidth()>$(window).width()/2){var gallery=$(srcImage).closest(".popupImageGallery");if(gallery.find(".popupImage").length<=1)return false}var galleryElt=null;var currentItem=null;var widgets=null;var anim_widgets=null;
var anim_timer=null;var rotatedTimeout=null;var e$$0;try{dismiss();build();if(!phoneView&&srcImage&&currentItem)zoomIt()}catch(e){Log.note("show_mobile error: "+e.message);return false}return true},limitImageSize:function(size,portSize){if(size&&size.w&&size.h){size={w:size.w,h:size.h};if(portSize.w/portSize.h>size.w/size.h){if(size.h>portSize.h){size.w*=portSize.h/size.h;size.h=portSize.h}}else if(size.w>portSize.w){size.h*=portSize.w/size.w;size.w=portSize.w}}return size},getCachedImageSize:function(elt){elt=
$(elt);var url=elt.attr("href");var size=PopupImage.getPresuppliedImageSize(elt)||PopupImage._imgSizes[url]||null;if(size)Log.debug("PopupImage: found cached size for image: ",url,"width: ",size.w,"height: ",size.h);return size},getPresuppliedImageSize:function(elt){elt=$(elt);var sizeStr=elt.attr("data-image-size");var e$$0;var sizeArr;var size=null;try{if(sizeStr){sizeArr=sizeStr.toString().split(",");if(sizeArr.length==2)size={w:parseInt(sizeArr[0]),h:parseInt(sizeArr[1])}}}catch(e){Log.note("getPresuppliedImageSize error: "+
e.message)}return size},hasNext:function(el){el=el||this._currentSrc;if(!el)return false;var sibs=$(el).closest(".popupImageGallery").find(".popupImage");var index=$.inArray(el,sibs);return index>-1&&index<sibs.length-1},goNext:function(event,el){if(event)Y.util.Event.stopEvent(event);el=el||this._currentSrc;if(!el)return;var sibs=$(el).closest(".popupImageGallery").find(".popupImage");var index=$.inArray(el,sibs);if(index>-1&&index<sibs.length-1){if(event)Y.util.Event.preventDefault(event);this.showFor(sibs[index+
1],true)}},hasPrev:function(el){el=el||this._currentSrc;if(!el)return false;var sibs=$(el).closest(".popupImageGallery").find(".popupImage");var index=$.inArray(el,sibs);return index>0},goPrev:function(event,el){if(event)Y.util.Event.stopEvent(event);el=el||this._currentSrc;if(!el)return;var sibs=$(el).closest(".popupImageGallery").find(".popupImage");var index=$.inArray(el,sibs);if(index>0){if(event)Y.util.Event.preventDefault(event);this.showFor(sibs[index-1],true)}},dismiss:function(el){el=el||
this._current;if(el&&el.parentNode)el.parentNode.removeChild(el);if(el==this._current){this._current=null;this._currentSrc=null}if(this._keys)this._keys.disable()},zzz:null};
var Crumb={ajax:function(settings){function addCrumb(){if(asJSON){originalData.crumb=_crumbs[endpoint];settings.data=ko.toJSON(originalData)}else{if(typeof originalData!=="string")originalData=$.param(originalData);if(_crumbs[endpoint])settings.data=originalData+"\x26"+Url.joinQuery({crumb:_crumbs[endpoint]})}}function retryCrumb(crumb){_crumbs[endpoint]=crumb;retries=retries+1;addCrumb();$.ajax(settings)}function eachCallback(callbacks,fn){if(!callbacks)return;if(!$.isArray(callbacks))callbacks=
[callbacks];for(var i=0;i<callbacks.length;i++)fn(callbacks[i])}var retries=0;var endpoint=Url.toHash(settings.url).pathname.substring(1);var asJSON=settings.dataAs==="JSON";var originalData=settings.data;if(!originalData)originalData=asJSON?{}:"";var originalErrorCallback=settings.error;var originalSuccessCallback=settings.success;var originalCompleteCallback=settings.complete;addCrumb();settings.success=function(data,status,xhr){var response=jQuery.parseJSON(xhr.responseText);if(response.error==
"invalid_crumb"&&retries<2){retryCrumb(response.crumb);return}var self=this;eachCallback(originalSuccessCallback,function(cb){cb.apply(self,[data,status,xhr])});eachCallback(originalCompleteCallback,function(cb){cb.apply(self,[xhr,status])})};settings.error=function(xhr,status,error){var self=this;if(xhr.status==403)try{var response=jQuery.parseJSON(xhr.responseText);if(response.error=="invalid_crumb"&&retries<2){retryCrumb(response.crumb);return}}catch(e){}eachCallback(originalErrorCallback,function(cb){cb.apply(self,
[xhr,status,error])});eachCallback(originalCompleteCallback,function(cb){cb.apply(self,[xhr,status])})};settings.complete=null;return $.ajax(settings)},get:function(url){var endpoint=Url.toHash(url).pathname.substring(1);if(_crumbs[endpoint])return _crumbs[endpoint];else return""},put:function(crumbs){$.extend(_crumbs,crumbs)}};
Y.lang.augmentObject(Form,{_lifeBoatEnabled:false,_formElem:null,_validateSections:null,_validateMessages:null,_onValidate:null,_customSubmitter:null,_submitOnEnter:false,_allowSubmit:false,_submitBlock:null,_cancellationListeners:null,_stack:new Array,_auxillaryValidationErrors:{},INTL_FLOAT_PATTERN:/^\d*,\d?\d?$/,init:function(elem$$0,lifeBoatMsg,cancelUrl,validateInfo,customSubmitter,submitOnEnter,notReady){if(Form._formElem)Form._push();elem$$0=elt(elem$$0);Form._formElem=elem$$0;window.onbeforeunload=
Form._navigate;Form._cancellationListeners=new Array;var elems=elem$$0.elements;for(var i=0;i<elems.length;i++){var x=elems[i];if(x.type=="submit"||x.type=="button")if(Form._isCancelButton(x)){anon=function(event){Form._cancelled(event,cancelUrl)};Y.util.Event.addListener(x,"click",anon);Form._cancellationListeners.push({"elt":x,"listener":anon})}}if(validateInfo)for(var sectionName in validateInfo.sections){var prefix=validateInfo.sections[sectionName].prefix;if(prefix)prefix=prefix+".";else prefix=
"";if(!window.Validators)Log.debug("Form.init: no form Validators installed");else{var validators=Validators[sectionName];for(var fieldName in validators){var validator=validators[fieldName];if(validator.type=="date")Form.interpretDateFieldOnChange(prefix+fieldName);else if(validator.type=="float")Form.interpretFloatSeparatorOnChange(prefix+fieldName);else if(validator.implicit_type=="url")Form.qualifyUrlFieldOnChange(prefix+fieldName);else if(validator.type=="isrc")Form.interpretISRCFieldOnChange(prefix+
fieldName);else if(validator.type=="upc")Form.interpretUPCFieldOnChange(prefix+fieldName)}}}Y.util.Event.addListener(elem$$0,"keydown",Form.filter_returnkey);Y.util.Event.addListener(elem$$0,"submit",Form._submitted);Form._lifeBoatEnabled=!!(lifeBoatMsg&&lifeBoatMsg.length);Form._lifeBoatMsg=lifeBoatMsg||"There are unsaved changes here. If you continue, you will lose them.";var show=Url.getQueryParam(location.toString(),"show_alert");switch(show){case null:break;case undefined:break;case "all":Y.util.Dom.getElementsByClassName("alert",
null,null,function(elem){Y.util.Dom.addClass(elem,"alertActive");elem.innerHTML="error text: "+elem.id+" lorem ipsum dolor sit amet."});break;default:elem$$0=Form.validate.get_alert_elt(show)||elt(show);if(elem$$0){Y.util.Dom.addClass(elem$$0,"alertActive");elem$$0.innerHTML="error text: "+elem$$0.id+" lorem ipsum dolor sit amet."}break}if(validateInfo&&Url.getQueryParam(location.href,"novalidate")==null){Form._validateSections=validateInfo.sections;Form._validateMessages=validateInfo.messages;Form._onValidate=
validateInfo.onValidate}Form._customSubmitter=customSubmitter;Form._submitOnEnter=submitOnEnter;if(!notReady)Form._allowSubmit=true},extend:function(formID,sectionName,suffix){var theForm=elt(formID);if(Form._formElem!=theForm){Log.debug("Form.extend: Form not initted, or wrong form is active: "+formID);return}var info=Form._validateSections[sectionName];if(!info){Log.debug("Form.extend: sectionName not found");return}var prefix=info.prefix;if(prefix)prefix=prefix+".";else prefix="";if(!window.Validators)Log.debug("Form.extend: no form Validators installed");
else{Form._extensions=Form._extensions||{};Form._extensions[sectionName]=Form._extensions[sectionName]||[];if(Iter.index(Form._extensions[sectionName],suffix)==-1)Form._extensions[sectionName].push(suffix);var validators=Validators[sectionName];for(var fieldName in validators){var validator=validators[fieldName];if(validator.type=="date")Form.interpretDateFieldOnChange(prefix+fieldName+suffix);else if(validator.type=="float")Form.interpretFloatSeparatorOnChange(prefix+fieldName+suffix);else if(validator.implicit_type==
"url")Form.qualifyUrlFieldOnChange(prefix+fieldName+suffix);else if(validator.type=="isrc")Form.interpretISRCFieldOnChange(prefix+fieldName+suffix);else if(validator.type=="upc")Form.interpretUPCFieldOnChange(prefix+fieldName+suffix)}}},allowSubmit:function(){Form._allowSubmit=true},canSubmit:function(){return Form._allowSubmit==true&&Form._submitBlock==null},_push:function(){var thisForm={lifeBoatEnabled:Form._lifeBoatEnabled,formElem:Form._formElem,validateSections:Form._validateSections,validateMessages:Form._validateMessages,
onValidate:Form._onValidate,customSubmitter:Form._customSubmitter,submitOnEnter:Form._submitOnEnter,allowSubmit:Form._allowSubmit,submitBlock:Form._submitBlock,cancellationListeners:Form._cancellationListeners,extensions:Form._extensions};Form._stack.push(thisForm)},detach:function(){Form._lifeBoatEnabled=false;Form._validateSections=null;Form._validateMessages=null;Form._onValidate=null;Form._submitOnEnter=false;Form._allowSubmit=false;Form._submitBlock=null;Form._extensions=null;if(Form._formElem){Y.util.Event.removeListener(Form._formElem,
"keydown",Form.filter_returnkey);Y.util.Event.removeListener(Form._formElem,"submit",Form._submitted);for(var i=0;i<Form._cancellationListeners.length;i++){var pair=Form._cancellationListeners[i];Y.util.Event.removeListener(pair["elt"],"click",pair["listener"])}}Form._cancellationListeners=null;Form._formElem=null;Form._pop()},setSubmitBlock:function(msg){Form._submitBlock=msg},interpretDateFieldOnChange:function(fieldName){var inputElem=Form._formElem.elements[fieldName];if(inputElem)Y.util.Event.on(inputElem,
"change",function(){var date=Time.strToDate(this.value);if(date){var dateStr=Time.toUiDate(date,true,true);if(dateStr!=this.value){Log.debug("normalizing date value '"+this.value+"' to '"+dateStr+"'");this.value=dateStr}}});inputElem=null},interpretFloatSeparatorOnChange:function(fieldName){var inputElem=Form._formElem.elements[fieldName];if(inputElem)Y.util.Event.on(inputElem,"change",Form.validate.priceOnChangeHandler);inputElem=null},qualifyUrlFieldOnChange:function(fieldName){var inputElem=Form._formElem.elements[fieldName];
if(inputElem)Y.util.Event.on(inputElem,"change",function(){var value=Y.lang.trim(this.value);value=value.replace(/^(https?:)(\w)/i,"$1//$2");if(value!=""&&value.search(/^https?:\/\//i)==-1)value="http://"+value;this.value=value});inputElem=null},interpretISRCFieldOnChange:function(fieldName){var inputElem=Form._formElem.elements[fieldName];if(inputElem)Y.util.Event.on(inputElem,"change",function(){var isrc=Form.validate.isrc(Y.lang.trim(this.value));if(isrc)this.value=isrc});inputElem=null},interpretUPCFieldOnChange:function(fieldName){var inputElem=
Form._formElem.elements[fieldName];if(inputElem)Y.util.Event.on(inputElem,"change",function(){var upc=Form.validate.upc(this.value);if(upc)this.value=upc});inputElem=null},disableLifeboat:function(){Form._lifeBoatEnabled=false},_isCancelButton:function(button){return button.name=="cancel"},filter_returnkey:function(e){if(e&&e.keyCode==13){if(Y.util.Event.getTarget(e).tagName!="TEXTAREA")Y.util.Event.stopEvent(e);if(Form._submitOnEnter)Form._submitted(e)}return true},_submitted:function(event){var target=
Y.util.Event.getTarget(event);if(target!=Form._formElem&&Y.util.Dom.getAncestorByTagName(target,"FORM")!=Form._formElem)return;Form.validate.clear_alerts();var errlist=null;if(Form._validateSections&&!Form._isCancelButton(target))errlist=Form.validateAndShowErrors();if(errlist&&errlist.length>0){Y.util.Event.stopEvent(event);return errlist}if(Form._customSubmitter)Form._customSubmitter(event)},_pop:function(){if(Form._stack.length>0){var prevForm=Form._stack.pop();Form._lifeBoatEnabled=prevForm.lifeBoatEnabled;
Form._formElem=prevForm.formElem;Form._validateSections=prevForm.validateSections;Form._validateMessages=prevForm.validateMessages;Form._onValidate=prevForm.onValidate;Form._customSubmitter=prevForm.customSubmitter;Form._submitOnEnter=prevForm.submitOnEnter;Form._allowSubmit=prevForm.allowSubmit;Form._submitBlock=prevForm.submitBlock;Form._cancellationListeners=prevForm.cancellationListeners;Form._extensions=prevForm.extensions}},_cancelled:function(event,url){Y.util.Event.stopEvent(event);Form._lifeBoatEnabled=
false;if(window!=top&&Dialog.iframeComm)Dialog.iframeComm.close(false);else if(url)location.href=url},validateAndShowErrors:function(sections){if(!sections)sections=Form._validateSections;$assert(sections);var errlist=[];for(var sectionName in sections){var sectionInfo=sections[sectionName];var extensions=Form._extensions?Form._extensions[sectionName]:null;if(extensions&&extensions.length>0){var errors=[];var i=0;for(var n=extensions.length;i<n;++i)errors=errors.concat(Form.validate.check_field_errors(sectionName,
sectionInfo,extensions[i])||[]);if(errors.length==0)errors=null}else errors=Form.validate.check_field_errors(sectionName,sectionInfo);if(errors)for(i=0;i<errors.length;i++){var err=errors[i];Log.warn('error in field "'+err.field+'": '+err.reason,err);Form.validate.show_alert(err);errlist.push(err)}}if(errlist&&errlist.length)this.revealError();return errlist},registerAuxillaryValidationError:function(fieldName,err){this._auxillaryValidationErrors[fieldName]=err},clearAuxillaryValidationError:function(fieldName){delete this._auxillaryValidationErrors[fieldName]},
revealError:function(){try{var dom=Y.util.Dom;var altElt=null;var errElt=dom.getElementsByClassName("alertActive")[0];var idMatch=errElt.id.match(/^(.*)[\_\-]alert$/);if(idMatch){altElt=dom.get(idMatch[1]);Log.warn(altElt?"using alt elt":"using err elt")}var y=altElt?-10:-50;Dom.scrollToElement(altElt||errElt,y)}catch(e){Log.error("validate: error scrolling to reveal error message")}},formIsDirty:function(elem){elem=elt(elem);if(elem.lifeboatDirty)return true;var elems=elem.elements;for(var i=0;i<
elems.length;i++){var x=elems[i];if(Form.fieldIsDirty(x)){Log.info("Form element "+x.name+" is dirty.");return true}}return false},formIsNotDirty:function(elem){elem=elt(elem);if(elem.lifeboatDirty)elem.lifeboatDirty=false;var elems=elem.elements;for(var i=0;i<elems.length;i++){var x=elems[i];Form.fieldIsNotDirty(x)}$(elem).triggerHandler("undirty")},dirtyForm:function(elem){elem=elem?elt(elem):Form._formElem;if(elem&&elem.tagName.toUpperCase()!="FORM")elem=Y.util.Dom.getAncestorByTagName(elem,"form");
if(elem){elem.lifeboatDirty=true;$(elem).triggerHandler("dirty")}},unDirty:function(){if(Form._lifeBoatEnabled)Form.formIsNotDirty(Form._formElem)},fieldHasLink:function(elem){var linkregex="(\\s|^)(http://|https://)?([^/\\s\\/]+(\\.[a-zA-Z]{2,4}))(/[^?\\s]*)?(\\?[^#\\s]*)?(#[^\\s]*)?(\\s|$)";rex=new RegExp(linkregex,"i");return rex.exec(elem.value)!=null},fieldIsDirty:function(elem){if(!elem.name)return false;if(elem.tagName.toLowerCase()=="button")return false;switch(elem.type){case "checkbox":case "radio":if(elem.checked!=
elem.defaultChecked)return true;break;case "submit":case "reset":case "image":case "button":return false;break;case "select-one":var o=elem.options;var dirtyIndex;var foundDefaultSelected=false;for(var i=0;i<o.length;i++){var option=o[i];if(option.defaultSelected)foundDefaultSelected=true;if(option.defaultSelected!=option.selected)dirtyIndex=i}if(dirtyIndex!=null)if(foundDefaultSelected||dirtyIndex>0)return true;break;case "hidden":return false;default:if(elem.defaultValue!=elem.value)return true;
break}return false},fieldIsNotDirty:function(elem){switch(elem.type){case "checkbox":case "radio":elem.defaultChecked=elem.checked;break;case "submit":case "reset":case "image":case "button":break;case "select-one":var o=elem.options;var dirtyIndex;var foundDefaultSelected=false;for(var i=0;i<o.length;i++){var option=o[i];option.defaultSelected=option.selected}break;case "hidden":break;default:elem.defaultValue=elem.value;break}},_navigate:function(){if(Form._lifeBoatEnabled&&Form.formIsDirty(Form._formElem))return Form._lifeBoatMsg},
validateField:function(field){var prefixMatch=field.name.match(/^([^\.]+)\./);var prefix=prefixMatch&&prefixMatch[1];var sectionName=Form.sectionNameForPrefix(prefix);var extensions=Form._extensions&&Form._extensions[sectionName];var fieldName=prefix?field.name.substr(prefix.length+1):field.name;suffix=null;if(extensions)for(var i=0;i<extensions.length;i++){var ext=extensions[i];if(fieldName.lastIndexOf(ext)===fieldName.length-ext.length){suffix=ext;fieldName=fieldName.substr(0,fieldName.length-ext.length);
break}}var validator=Validators[sectionName][fieldName];if(!validator)return;var error=Form.validate._check_value_error_inner(field.name,validator,field);if(error){error.suffix=suffix;Form.validate.show_alert(error)}return error},sectionNameForPrefix:function(prefix){for(var name in Form._validateSections){var section=Form._validateSections[name];if(section.prefix===prefix||!prefix&&!section.prefix)return name}return null},validate:{check_field_errors:function(sectionName,sectionInfo,suffix){if(!window.Validators){Log.debug("Form.validate: no form Validators installed");
return null}suffix=suffix||"";var validators=Validators[sectionName];var result=null;for(var fieldName in validators){var validator=validators[fieldName];if(sectionInfo.prefix)fieldName=sectionInfo.prefix+"."+fieldName+suffix;var err=Form.validate.check_value_error(fieldName,validator)||Form._auxillaryValidationErrors[fieldName];if(err){if(suffix)err.suffix=suffix;if(!result)result=[];result[result.length]=err;Log.info("field failed validation: "+fieldName)}}return result},check_value_error:function(fieldname,
validator){var elem=Form._formElem.elements[fieldname];if(!elem)return null;if(elem.type=="hidden"&&!$(elem).hasClass("validate-hidden"))return null;if(elem.disabled)return null;if(!validator){Log.debug("no validator");return null}var err=Form.validate._check_value_error_inner(fieldname,validator,elem);if(Form._onValidate){var overrideErr=Form._onValidate(elem,fieldname,validator,err);if(typeof overrideErr!="undefined"){Log.debug("onValidate override for field: "+fieldname+"; previous error: "+(err?
err.reason:"none"));err=overrideErr}}return err},_check_value_error_inner:function(fieldname,validator,elem,value){value=Y.lang.trim(typeof value==="undefined"?elem.value:value);var emptyValue=!value||elem.type=="checkbox"&&!elem.checked;if(emptyValue){if(validator["req"])if(typeof validator["req"]!="function"||validator["req"](fieldname)){Log.warn("required field "+fieldname+" empty");return{reason:"missingValue",field:fieldname,validator:validator}}return null}var type=validator["type"];switch(type){case "int":var num=
parseInt(value);if(isNaN(num)||validator.max!=null&&num>validator.max||validator.min!=null&&num<validator.min||!value.match(/^\d+$/)){Log.warn("bad number: "+fieldname);return{reason:"badNumber",field:fieldname,max:validator.max,min:validator.min,validator:validator}}break;case "float":num=parseFloat(value);if(isNaN(num)||validator.max!=null&&num>validator.max||validator.min!=null&&num<validator.min||!value.match(/^\d*(\.\d+)?$/)){Log.warn("bad float: "+fieldname);return{reason:"badNumber",field:fieldname,
max:validator.max,min:validator.min,validator:validator}}break;case "text":if(validator.max!=null&&value.length>validator.max||validator.min!=null&&value.length<validator.min){Log.warn("string length out of range: "+fieldname);return{reason:"stringLength",field:fieldname,max:validator.max,min:validator.min,validator:validator}}break;case "date":var newdate=Form.validate.validate_date(value);if(Y.lang.isString(newdate)){Log.warn("bad date: "+fieldname);return{reason:newdate,field:fieldname,validator:validator}}$assert(newdate);
var dateStr=Time.toUiDate(newdate,true,true);if(dateStr!=value)elem.value=dateStr;break;case "isrc":var newisrc=Form.validate.isrc(value,validator);if(newisrc);else{Log.warn("bad isrc: "+fieldname);return{reason:"badisrc",field:fieldname,validator:validator}}break;case "upc":var newupc=Form.validate.upc(value,validator);if(newupc)elem.value=newupc;else{Log.warn("bad upc: "+fieldname);return{reason:"badupc",field:fieldname,validator:validator}}break}if(validator["match"]){rex=new RegExp(validator["match"]);
if(!rex.test(value)){Log.warn("failed pattern match: "+fieldname);return{reason:"badFormat",field:fieldname,customMessage:validator["message"],validator:validator}}}if(validator["clientproc"])try{var fn=eval(validator["clientproc"]);var result=fn(fieldname,value);if(result){result.validator=validator;return result}}catch(e){Log.error("validate: error executing clientproc: "+validator["clientproc"])}return null},parsePrice:function(value){value=Y.lang.trim(value);if(value.search(Form.INTL_FLOAT_PATTERN)==
0)value=value.replace(",",".");return parseFloat(value)},validate_date:function(value){var d=Time.strToDate(value);if(d){var fullYear=d.getFullYear();if(fullYear>2037||fullYear<1902)return"dateOutOfRange";return d}return"dateFormat"},validate_price:function(id,required,nonzero_min,alert_id,alert1,alert2,zeroAlert,nonzero){var priceAlert=alert_id?elt(alert_id):Form.validate.get_alert_elt(id);var priceElem=elt(id)||Form._formElem.elements[id];if(priceElem){var value=Y.lang.trim(priceElem.value);if(value.length==
0&&priceAlert){if(required){Log.debug("Missing required price for ",id);FormUtils.showHideAlert(priceAlert,alert1||"Please provide the price.");Y.util.Dom.addClass(priceElem,"has-validation-error");return false}}else if(nonzero_min&&priceAlert){price=Form.validate.parsePrice(value);if(!isNaN(price))if(nonzero&&price==0&&zeroAlert){Log.debug("Zero price is not allowed for ",id);FormUtils.showHideAlert(priceAlert,zeroAlert);Y.util.Dom.addClass(priceElem,"has-validation-error");return false}else if(price<
nonzero_min&&(nonzero||price!=0)){Log.debug("Price out of range for ",id);var msg=alert2||"This price is too small to process.  Please enter "+(nonzero?"":"either zero, or ")+TextFormat.currency(nonzero_min,CurrencyData.current,false,true,true)+" or more.";FormUtils.showHideAlert(priceAlert,msg);Y.util.Dom.addClass(priceElem,"has-validation-error");return false}}}return true},validate_price_nonzero:function(id,required,nonzero_min,alert_id,alert1,alert2,zeroAlert){return Form.validate.validate_price(id,
required,nonzero_min,alert_id,alert1,alert2,zeroAlert,true)},priceOnChangeHandler:function(event){var value=Y.lang.trim(this.value);if(value!=""&&value.search(Form.INTL_FLOAT_PATTERN)==0)this.value=value.replace(",",".")},check_email_typos:function(email,firstname,lastname,logging){function makeSnippets(sections){var snippets=[];var emailSplit=email.split("@");for(var i=0;i<sections.length;i++){if(sections[i])for(var j=0;j<sections[i].length;j++)snippets.push(sections[i][j]);else snippets.push({orig:emailSplit[i]});
if(i==0)snippets.push({orig:"@"})}return snippets}function makeCorrectedString(snippets){var corrected="";for(var i=0;i<snippets.length;i++)corrected+=snippets[i].correction||snippets[i].orig;return corrected}function checkForCloseMatch(longString,shortString,strict){log("check for close match: "+(strict?"strict":"loose"));if(shortString.length<3)return null;if(!strict){var strContainsRegEx=new RegExp("(.?)"+shortString+"(.?)");if(strContainsRegEx.test(longString)){log(longString+" contains "+shortString);
var match=strContainsRegEx.exec(longString);return{orig:shortString,correction:shortString,before:match[1],after:match[match.length-1]}}}else if(shortString===longString){log("shortString "+shortString+" \x3d longString "+longString);return null}log(longString);log(shortString);for(var i=1;i<=shortString.length;i++){var firstPart=shortString.substring(0,i);var secondPart=shortString.substring(i);var wordCharRegEx=new RegExp("[a-z]");var extraLetterRegEx=new RegExp(firstPart+"(.)"+secondPart);if(match=
extraLetterRegEx.exec(longString)){log("extra letter match");if(strict||!strict&&/[A-Za-z0-9]/.test(match[1])){log("extra letter: "+firstPart+", "+secondPart);log(match);return{orig:firstPart+match[1]+secondPart,correction:shortString,before:"",after:""}}}var wrongLetterRegEx=new RegExp("(.?)"+firstPart+"(.)"+secondPart.substring(1)+"(.?)");if(match=wrongLetterRegEx.exec(longString)){log("wrong letter match");if(wordCharRegEx.test(match[2])){log("wrong letter: "+firstPart+", "+secondPart.substring(1));
log(match);return{orig:firstPart+match[2]+secondPart.substring(1),correction:shortString,before:match[1],after:match[match.length-1]}}}if(secondPart!=="mail"){var firstPartSubstring=firstPart.substring(0,firstPart.length-1);var missingLetterRegEx=new RegExp("(.*)"+firstPartSubstring+secondPart+"(.*)");if(match=missingLetterRegEx.exec(longString)){log("missing letter match");if(strict||!strict&&firstPartSubstring!=""&&firstPart.length!=1&&firstPart!=shortString[0]){log("missing letter: "+firstPartSubstring+
", "+secondPart);log(match);return{orig:firstPartSubstring+secondPart,correction:shortString,before:match[1],after:match[match.length-1]}}}}var newFirstPart=shortString.substring(0,i-1);var newSecondPart=shortString.substring(i+1);var switchedLetters=shortString.charAt(i)+shortString.charAt(i-1);var switchedLettersRegEx=new RegExp("(.?)"+newFirstPart+switchedLetters+newSecondPart+"(.?)");if(match=switchedLettersRegEx.exec(longString)){log("switched letter match");log("switched letters: "+newFirstPart+
", "+newSecondPart);log(match);return{orig:newFirstPart+switchedLetters+newSecondPart,correction:shortString,before:match[1],after:match[match.length-1]}}}return null}function checkForDomainTypo(rightPart){log("DOMAIN TYPO");var domains=["gmail","hotmail","outlook","yahoo","icloud","mail","mac","aol","zoho"];var spl=rightPart.split(".");var userDomain=spl.shift();var userEnding=spl.join(".");var userEndingSplit=userEnding.split(".");var lastPart=userEndingSplit[userEndingSplit.length-1];var result=
[];var correctedDomain;var correctedLastPart;var endsWithDigitsRegEx=new RegExp("\\d+");if(endsWithDigitsRegEx.test(lastPart)||lastPart==="con"){for(correctedLastPart=lastPart;endsWithDigitsRegEx.test(correctedLastPart);)correctedLastPart=correctedLastPart.replace(endsWithDigitsRegEx,"");correctedLastPart=correctedLastPart==="con"?"com":correctedLastPart}for(var i=0;i<domains.length;i++){var domain=domains[i];log(domain);if(userDomain.length>domain.length+1||userDomain.length<domain.length-1)continue;
else if(userDomain==domain){if(!correctedLastPart)return null}else{correctedDomain=checkForCloseMatch(userDomain,domain,true);if(correctedDomain&&correctedDomain.orig!=userDomain)correctedDomain=null}if(correctedDomain||correctedLastPart){result=[];var domainElem={orig:userDomain};var endingElem={orig:userEnding};if(correctedDomain)domainElem.correction=correctedDomain.correction;if(correctedLastPart){userEndingSplit[userEndingSplit.length-1]=correctedLastPart;endingElem.correction=userEndingSplit.join(".")}result.push(domainElem);
result.push({orig:"."});result.push(endingElem);log(result);return result}}return null}function checkForNameTypo(leftPart,firstname$$0,lastname$$0){function normalizeName(name){var nonLatinRegex=new RegExp("[^A-Za-z0-9\\[\\] ]","g");var initialsRegex=new RegExp("(^(\\w )+)|(( \\w)+$)","g");var alternates=[];if(nonLatinRegex.test(name)){alternates[maxPossibilities-1]="";alternates.fill("");var appendToAllAlternates=function(str){for(var i=0;i<alternates.length;i++)alternates[i]+=str};for(var i$$0=
0;i$$0<name.length;i$$0++){var x=name[i$$0];if(nonLatinRegex.test(x))if(latinMap[x]&&Array.isArray(latinMap[x]))for(var j=0;j<latinMap[x].length;j++)alternates[j]+=latinMap[x][j];else if(latinMap[x])appendToAllAlternates(latinMap[x]);else appendToAllAlternates(name[i$$0]);else appendToAllAlternates(name[i$$0])}}else alternates=[name];alternates=alternates.filter(function(elem,index,self){return index==self.indexOf(elem)});for(i$$0=0;i$$0<alternates.length;i$$0++)alternates[i$$0]=alternates[i$$0].replace(initialsRegex,
"").toLowerCase().replace(/[^a-z]/g,"");return[alternates.pop(),alternates]}function foundSimilarities(firstname,lastname){var shorterName=firstname.length<lastname.length?firstname:lastname;var longerName=firstname.length<lastname.length?lastname:firstname;log("checking for similarities in first and last name");for(var i=0;i<longerName.length-(shorterName.length-1);i++){var longerNameSubstring=longerName.substring(i,shorterName.length+1+i);if(checkForCloseMatch(shorterName,longerNameSubstring)||
checkForCloseMatch(longerNameSubstring,shorterName))return true}}log("NAME TYPO");if(!firstname$$0||firstname$$0==""||!lastname$$0||lastname$$0=="")return null;var latinMap={"\u00c1":"A","\u0102":"A","\u1eae":"A","\u1eb6":"A","\u1eb0":"A","\u1eb2":"A","\u1eb4":"A","\u01cd":"A","\u00c2":"A","\u1ea4":"A","\u1eac":"A","\u1ea6":"A","\u1ea8":"A","\u1eaa":"A","\u00c4":["A","AE"],"\u01de":"A","\u0226":"A","\u01e0":"A","\u1ea0":"A","\u0200":"A","\u00c0":"A","\u1ea2":"A","\u0202":"A","\u0100":"A","\u0104":"A",
"\u00c5":["A","AA"],"\u01fa":"A","\u1e00":"A","\u023a":"A","\u00c3":"A","\ua732":"AA","\u00c6":"[AE,E]","\u01fc":"AE","\u01e2":"AE","\ua734":"AO","\ua736":"AU","\ua738":"AV","\ua73a":"AV","\ua73c":"AY","\u1e02":"B","\u1e04":"B","\u0181":"B","\u1e06":"B","\u0243":"B","\u0182":"B","\u0106":"C","\u010c":"C","\u00c7":"C","\u1e08":"C","\u0108":"C","\u010a":"C","\u0187":"C","\u023b":"C","\u010e":"D","\u1e10":"D","\u1e12":"D","\u1e0a":"D","\u1e0c":"D","\u018a":"D","\u1e0e":"D","\u01f2":"D","\u01c5":"D",
"\u0110":"D","\u018b":"D","\u01f1":"DZ","\u01c4":"DZ","\u00c9":"E","\u0114":"E","\u011a":"E","\u0228":"E","\u1e1c":"E","\u00ca":"E","\u1ebe":"E","\u1ec6":"E","\u1ec0":"E","\u1ec2":"E","\u1ec4":"E","\u1e18":"E","\u00cb":"E","\u0116":"E","\u1eb8":"E","\u0204":"E","\u00c8":"E","\u1eba":"E","\u0206":"E","\u0112":"E","\u1e16":"E","\u1e14":"E","\u0118":"E","\u0246":"E","\u1ebc":"E","\u1e1a":"E","\ua76a":"ET","\u1e1e":"F","\u0191":"F","\u01f4":"G","\u011e":"G","\u01e6":"G","\u0122":"G","\u011c":"G","\u0120":"G",
"\u0193":"G","\u1e20":"G","\u01e4":"G","\u1e2a":"H","\u021e":"H","\u1e28":"H","\u0124":"H","\u2c67":"H","\u1e26":"H","\u1e22":"H","\u1e24":"H","\u0126":"H","\u00cd":"I","\u012c":"I","\u01cf":"I","\u00ce":"I","\u00cf":"I","\u1e2e":"I","\u0130":"I","\u1eca":"I","\u0208":"I","\u00cc":"I","\u1ec8":"I","\u020a":"I","\u012a":"I","\u012e":"I","\u0197":"I","\u0128":"I","\u1e2c":"I","\ua779":"D","\ua77b":"F","\ua77d":"G","\ua782":"R","\ua784":"S","\ua786":"T","\ua76c":"IS","\u0134":"J","\u0248":"J","\u1e30":"K",
"\u01e8":"K","\u0136":"K","\u2c69":"K","\ua742":"K","\u1e32":"K","\u0198":"K","\u1e34":"K","\ua740":"K","\ua744":"K","\u0139":"L","\u023d":"L","\u013d":"L","\u013b":"L","\u1e3c":"L","\u1e36":"L","\u1e38":"L","\u2c60":"L","\ua748":"L","\u1e3a":"L","\u013f":"L","\u2c62":"L","\u01c8":"L","\u0141":"L","\u01c7":"LJ","\u1e3e":"M","\u1e40":"M","\u1e42":"M","\u2c6e":"M","\u0143":"N","\u0147":"N","\u0145":"N","\u1e4a":"N","\u1e44":"N","\u1e46":"N","\u01f8":"N","\u019d":"N","\u1e48":"N","\u0220":"N","\u01cb":"N",
"\u00d1":"N","\u01ca":"NJ","\u00d3":"O","\u014e":"O","\u01d1":"O","\u00d4":"O","\u1ed0":"O","\u1ed8":"O","\u1ed2":"O","\u1ed4":"O","\u1ed6":"O","\u00d6":["O","OE"],"\u022a":"O","\u022e":"O","\u0230":"O","\u1ecc":"O","\u0150":"O","\u020c":"O","\u00d2":"O","\u1ece":"O","\u01a0":"O","\u1eda":"O","\u1ee2":"O","\u1edc":"O","\u1ede":"O","\u1ee0":"O","\u020e":"O","\ua74a":"O","\ua74c":"O","\u014c":"O","\u1e52":"O","\u1e50":"O","\u019f":"O","\u01ea":"O","\u01ec":"O","\u00d8":["O","OE"],"\u01fe":"O","\u00d5":"O",
"\u1e4c":"O","\u1e4e":"O","\u022c":"O","\u01a2":"OI","\ua74e":"OO","\u0190":"E","\u0186":"O","\u0222":"OU","\u1e54":"P","\u1e56":"P","\ua752":"P","\u01a4":"P","\ua754":"P","\u2c63":"P","\ua750":"P","\ua758":"Q","\ua756":"Q","\u0154":"R","\u0158":"R","\u0156":"R","\u1e58":"R","\u1e5a":"R","\u1e5c":"R","\u0210":"R","\u0212":"R","\u1e5e":"R","\u024c":"R","\u2c64":"R","\ua73e":"C","\u018e":"E","\u015a":"S","\u1e64":"S","\u0160":"S","\u1e66":"S","\u015e":"S","\u015c":"S","\u0218":"S","\u1e60":"S","\u1e62":"S",
"\u1e68":"S","\u0164":"T","\u0162":"T","\u1e70":"T","\u021a":"T","\u023e":"T","\u1e6a":"T","\u1e6c":"T","\u01ac":"T","\u1e6e":"T","\u01ae":"T","\u0166":"T","\u2c6f":"A","\ua780":"L","\u019c":"M","\u0245":"V","\ua728":"TZ","\u00da":"U","\u016c":"U","\u01d3":"U","\u00db":"U","\u1e76":"U","\u00dc":["U","UE"],"\u01d7":"U","\u01d9":"U","\u01db":"U","\u01d5":"U","\u1e72":"U","\u1ee4":"U","\u0170":"U","\u0214":"U","\u00d9":"U","\u1ee6":"U","\u01af":"U","\u1ee8":"U","\u1ef0":"U","\u1eea":"U","\u1eec":"U",
"\u1eee":"U","\u0216":"U","\u016a":"U","\u1e7a":"U","\u0172":"U","\u016e":"U","\u0168":"U","\u1e78":"U","\u1e74":"U","\ua75e":"V","\u1e7e":"V","\u01b2":"V","\u1e7c":"V","\ua760":"VY","\u1e82":"W","\u0174":"W","\u1e84":"W","\u1e86":"W","\u1e88":"W","\u1e80":"W","\u2c72":"W","\u1e8c":"X","\u1e8a":"X","\u00dd":"Y","\u0176":"Y","\u0178":"Y","\u1e8e":"Y","\u1ef4":"Y","\u1ef2":"Y","\u01b3":"Y","\u1ef6":"Y","\u1efe":"Y","\u0232":"Y","\u024e":"Y","\u1ef8":"Y","\u0179":"Z","\u017d":"Z","\u1e90":"Z","\u2c6b":"Z",
"\u017b":"Z","\u1e92":"Z","\u0224":"Z","\u1e94":"Z","\u01b5":"Z","\u0132":"IJ","\u0152":"OE","\u1d00":"A","\u1d01":"AE","\u0299":"B","\u1d03":"B","\u1d04":"C","\u1d05":"D","\u1d07":"E","\ua730":"F","\u0262":"G","\u029b":"G","\u029c":"H","\u026a":"I","\u0281":"R","\u1d0a":"J","\u1d0b":"K","\u029f":"L","\u1d0c":"L","\u1d0d":"M","\u0274":"N","\u1d0f":"O","\u0276":"OE","\u1d10":"O","\u1d15":"OU","\u1d18":"P","\u0280":"R","\u1d0e":"N","\u1d19":"R","\ua731":"S","\u1d1b":"T","\u2c7b":"E","\u1d1a":"R","\u1d1c":"U",
"\u1d20":"V","\u1d21":"W","\u028f":"Y","\u1d22":"Z","\u00e1":"a","\u0103":"a","\u1eaf":"a","\u1eb7":"a","\u1eb1":"a","\u1eb3":"a","\u1eb5":"a","\u01ce":"a","\u00e2":"a","\u1ea5":"a","\u1ead":"a","\u1ea7":"a","\u1ea9":"a","\u1eab":"a","\u00e4":["a","ae"],"\u01df":"a","\u0227":"a","\u01e1":"a","\u1ea1":"a","\u0201":"a","\u00e0":"a","\u1ea3":"a","\u0203":"a","\u0101":"a","\u0105":"a","\u1d8f":"a","\u1e9a":"a","\u00e5":["a","aa"],"\u01fb":"a","\u1e01":"a","\u2c65":"a","\u00e3":"a","\ua733":"aa","\u00e6":"[ae,e]",
"\u01fd":"ae","\u01e3":"ae","\ua735":"ao","\ua737":"au","\ua739":"av","\ua73b":"av","\ua73d":"ay","\u1e03":"b","\u1e05":"b","\u0253":"b","\u1e07":"b","\u1d6c":"b","\u1d80":"b","\u0180":"b","\u0183":"b","\u0275":"o","\u0107":"c","\u010d":"c","\u00e7":"c","\u1e09":"c","\u0109":"c","\u0255":"c","\u010b":"c","\u0188":"c","\u023c":"c","\u010f":"d","\u1e11":"d","\u1e13":"d","\u0221":"d","\u1e0b":"d","\u1e0d":"d","\u0257":"d","\u1d91":"d","\u1e0f":"d","\u1d6d":"d","\u1d81":"d","\u0111":"d","\u0256":"d",
"\u018c":"d","\u0131":"i","\u0237":"j","\u025f":"j","\u0284":"j","\u01f3":"dz","\u01c6":"dz","\u00e9":"e","\u0115":"e","\u011b":"e","\u0229":"e","\u1e1d":"e","\u00ea":"e","\u1ebf":"e","\u1ec7":"e","\u1ec1":"e","\u1ec3":"e","\u1ec5":"e","\u1e19":"e","\u00eb":"e","\u0117":"e","\u1eb9":"e","\u0205":"e","\u00e8":"e","\u1ebb":"e","\u0207":"e","\u0113":"e","\u1e17":"e","\u1e15":"e","\u2c78":"e","\u0119":"e","\u1d92":"e","\u0247":"e","\u1ebd":"e","\u1e1b":"e","\ua76b":"et","\u1e1f":"f","\u0192":"f","\u1d6e":"f",
"\u1d82":"f","\u01f5":"g","\u011f":"g","\u01e7":"g","\u0123":"g","\u011d":"g","\u0121":"g","\u0260":"g","\u1e21":"g","\u1d83":"g","\u01e5":"g","\u1e2b":"h","\u021f":"h","\u1e29":"h","\u0125":"h","\u2c68":"h","\u1e27":"h","\u1e23":"h","\u1e25":"h","\u0266":"h","\u1e96":"h","\u0127":"h","\u0195":"hv","\u00ed":"i","\u012d":"i","\u01d0":"i","\u00ee":"i","\u00ef":"i","\u1e2f":"i","\u1ecb":"i","\u0209":"i","\u00ec":"i","\u1ec9":"i","\u020b":"i","\u012b":"i","\u012f":"i","\u1d96":"i","\u0268":"i","\u0129":"i",
"\u1e2d":"i","\ua77a":"d","\ua77c":"f","\u1d79":"g","\ua783":"r","\ua785":"s","\ua787":"t","\ua76d":"is","\u01f0":"j","\u0135":"j","\u029d":"j","\u0249":"j","\u1e31":"k","\u01e9":"k","\u0137":"k","\u2c6a":"k","\ua743":"k","\u1e33":"k","\u0199":"k","\u1e35":"k","\u1d84":"k","\ua741":"k","\ua745":"k","\u013a":"l","\u019a":"l","\u026c":"l","\u013e":"l","\u013c":"l","\u1e3d":"l","\u0234":"l","\u1e37":"l","\u1e39":"l","\u2c61":"l","\ua749":"l","\u1e3b":"l","\u0140":"l","\u026b":"l","\u1d85":"l","\u026d":"l",
"\u0142":"l","\u01c9":"lj","\u017f":"s","\u1e9c":"s","\u1e9b":"s","\u1e9d":"s","\u1e3f":"m","\u1e41":"m","\u1e43":"m","\u0271":"m","\u1d6f":"m","\u1d86":"m","\u0144":"n","\u0148":"n","\u0146":"n","\u1e4b":"n","\u0235":"n","\u1e45":"n","\u1e47":"n","\u01f9":"n","\u0272":"n","\u1e49":"n","\u019e":"n","\u1d70":"n","\u1d87":"n","\u0273":"n","\u00f1":"n","\u01cc":"nj","\u00f3":"o","\u014f":"o","\u01d2":"o","\u00f4":"o","\u1ed1":"o","\u1ed9":"o","\u1ed3":"o","\u1ed5":"o","\u1ed7":"o","\u00f6":["o","oe"],
"\u022b":"o","\u022f":"o","\u0231":"o","\u1ecd":"o","\u0151":"o","\u020d":"o","\u00f2":"o","\u1ecf":"o","\u01a1":"o","\u1edb":"o","\u1ee3":"o","\u1edd":"o","\u1edf":"o","\u1ee1":"o","\u020f":"o","\ua74b":"o","\ua74d":"o","\u2c7a":"o","\u014d":"o","\u1e53":"o","\u1e51":"o","\u01eb":"o","\u01ed":"o","\u00f8":["o","oe"],"\u01ff":"o","\u00f5":"o","\u1e4d":"o","\u1e4f":"o","\u022d":"o","\u01a3":"oi","\ua74f":"oo","\u025b":"e","\u1d93":"e","\u0254":"o","\u1d97":"o","\u0223":"ou","\u1e55":"p","\u1e57":"p",
"\ua753":"p","\u01a5":"p","\u1d71":"p","\u1d88":"p","\ua755":"p","\u1d7d":"p","\ua751":"p","\ua759":"q","\u02a0":"q","\u024b":"q","\ua757":"q","\u0155":"r","\u0159":"r","\u0157":"r","\u1e59":"r","\u1e5b":"r","\u1e5d":"r","\u0211":"r","\u027e":"r","\u1d73":"r","\u0213":"r","\u1e5f":"r","\u027c":"r","\u1d72":"r","\u1d89":"r","\u024d":"r","\u027d":"r","\u2184":"c","\ua73f":"c","\u0258":"e","\u027f":"r","\u015b":"s","\u1e65":"s","\u0161":"s","\u1e67":"s","\u015f":"s","\u015d":"s","\u0219":"s","\u1e61":"s",
"\u1e63":"s","\u1e69":"s","\u0282":"s","\u1d74":"s","\u1d8a":"s","\u023f":"s","\u0261":"g","\u1d11":"o","\u1d13":"o","\u1d1d":"u","\u0165":"t","\u0163":"t","\u1e71":"t","\u021b":"t","\u0236":"t","\u1e97":"t","\u2c66":"t","\u1e6b":"t","\u1e6d":"t","\u01ad":"t","\u1e6f":"t","\u1d75":"t","\u01ab":"t","\u0288":"t","\u0167":"t","\u1d7a":"th","\u0250":"a","\u1d02":"ae","\u01dd":"e","\u1d77":"g","\u0265":"h","\u02ae":"h","\u02af":"h","\u1d09":"i","\u029e":"k","\ua781":"l","\u026f":"m","\u0270":"m","\u1d14":"oe",
"\u0279":"r","\u027b":"r","\u027a":"r","\u2c79":"r","\u0287":"t","\u028c":"v","\u028d":"w","\u028e":"y","\ua729":"tz","\u00fa":"u","\u016d":"u","\u01d4":"u","\u00fb":"u","\u1e77":"u","\u00fc":["u","ue"],"\u01d8":"u","\u01da":"u","\u01dc":"u","\u01d6":"u","\u1e73":"u","\u1ee5":"u","\u0171":"u","\u0215":"u","\u00f9":"u","\u1ee7":"u","\u01b0":"u","\u1ee9":"u","\u1ef1":"u","\u1eeb":"u","\u1eed":"u","\u1eef":"u","\u0217":"u","\u016b":"u","\u1e7b":"u","\u0173":"u","\u1d99":"u","\u016f":"u","\u0169":"u",
"\u1e79":"u","\u1e75":"u","\u1d6b":"ue","\ua778":"um","\u2c74":"v","\ua75f":"v","\u1e7f":"v","\u028b":"v","\u1d8c":"v","\u2c71":"v","\u1e7d":"v","\ua761":"vy","\u1e83":"w","\u0175":"w","\u1e85":"w","\u1e87":"w","\u1e89":"w","\u1e81":"w","\u2c73":"w","\u1e98":"w","\u1e8d":"x","\u1e8b":"x","\u1d8d":"x","\u00fd":"y","\u0177":"y","\u00ff":"y","\u1e8f":"y","\u1ef5":"y","\u1ef3":"y","\u01b4":"y","\u1ef7":"y","\u1eff":"y","\u0233":"y","\u1e99":"y","\u024f":"y","\u1ef9":"y","\u017a":"z","\u017e":"z","\u1e91":"z",
"\u0291":"z","\u2c6c":"z","\u017c":"z","\u1e93":"z","\u0225":"z","\u1e95":"z","\u1d76":"z","\u1d8e":"z","\u0290":"z","\u01b6":"z","\u0240":"z","\ufb00":"ff","\ufb03":"ffi","\ufb04":"ffl","\ufb01":"fi","\ufb02":"fl","\u0133":"ij","\u0153":"oe","\ufb06":"st","\u2090":"a","\u2091":"e","\u1d62":"i","\u2c7c":"j","\u2092":"o","\u1d63":"r","\u1d64":"u","\u1d65":"v","\u2093":"x"};var maxPossibilities=1;Object.keys(latinMap).forEach(function(key){maxPossibilities=Math.max(maxPossibilities,Array.isArray(latinMap[key])?
latinMap[key].length:1)});leftPart=leftPart.toLowerCase();var firstnameNormalized=normalizeName(firstname$$0);var lastnameNormalized=normalizeName(lastname$$0);firstname$$0=firstnameNormalized[0];lastname$$0=lastnameNormalized[0];var firstnameAlternates=firstnameNormalized[1];var lastnameAlternates=lastnameNormalized[1];log(firstname$$0);log(lastname$$0);log(firstnameAlternates);log(lastnameAlternates);if(foundSimilarities(firstname$$0,lastname$$0)||foundSimilarities(firstname$$0,firstname$$0[0]+
lastname$$0)||foundSimilarities(lastname$$0[0]+firstname$$0,lastname$$0))return null;var nicknames={"jenny":"jenni","peter":"pete","ann":"an","jono":"jona","joe":"jose","charlie":"charle","paul":"pabl"};var result=[];var fnameResult=searchForName(leftPart,0,firstname$$0);var newLeftPart;var startIndex;if(fnameResult){var squishedLeftPart=leftPart.substring(0,fnameResult.elem.index)+fnameResult.newLeftPart;if(fnameResult.elem.orig==nicknames[fnameResult.elem.correction])fnameResult=null;else if(isNameAlternate(fnameResult.elem.orig,
firstnameAlternates))fnameResult=null;else if(strIncludes(lastname$$0,leftPart)&&!strIncludes(lastname$$0,squishedLeftPart))fnameResult=null}if(fnameResult)if(fnameResult.elem.index+firstname$$0.length+lastname$$0.length>leftPart.length){newLeftPart=leftPart;startIndex=0}else{newLeftPart=fnameResult.newLeftPart;startIndex=fnameResult.startIndex}else{newLeftPart=leftPart;startIndex=0}var lnameResult=searchForName(newLeftPart,startIndex,lastname$$0);if(lnameResult&&isNameAlternate(lnameResult.elem.orig,
lastnameAlternates))lnameResult=null;log(fnameResult);log(lnameResult);var corrections=[];if(fnameResult&&!fnameResult.found)corrections.push(fnameResult.elem);if(lnameResult&&!lnameResult.found)corrections.push(lnameResult.elem);var doublePeriodRegex=new RegExp("(.*)\\.\\.(.*)");for(var dpCorrection=leftPart;doublePeriodRegex.test(dpCorrection);){var match=doublePeriodRegex.exec(dpCorrection);log(match);dpCorrection=match[1]+"."+match[2];corrections.push({index:match[1].length,orig:"..",correction:"."})}if(corrections.length==
0)return null;corrections.sort(function(a,b){return a.index-b.index});startIndex=0;for(var i$$1=0;i$$1<corrections.length;i$$1++){result.push({orig:leftPart.substring(startIndex,corrections[i$$1].index)});result.push({orig:corrections[i$$1].orig,correction:corrections[i$$1].correction});startIndex=corrections[i$$1].index+corrections[i$$1].orig.length}result.push({orig:leftPart.substring(startIndex)});result=result.filter(function(elem){return elem.correction||elem.orig!=""});log(result);return result}
function isNameAlternate(name,alternates){return alternates.indexOf(name)>-1}function strIncludes(substr,str){return str.indexOf(substr)!=-1}function searchForName(leftPart,index,name){log("");log("searchForName");log(leftPart);log("");if(leftPart.length<name.length-1||name.length<2)return null;var potentialName=leftPart.substring(0,name.length+1);var theRest=leftPart.substring(name.length+1);var result=checkForCloseMatch(potentialName,name);log(result);if(result){theRest=leftPart.substring(result.before.length+
result.orig.length);log({orig:result.orig,theRest:theRest,correction:name})}if(result&&result.orig!==result.correction&&(result.orig===name.substring(0,result.orig.length)&&theRest[0]==name[name.length-1]||result.orig.substring(0,name.length-1)===name.substring(0,name.length-1))){log("ignoring result");result=null}index+=result?result.before.length:0;if(result&&result.orig==result.correction)return{found:true,newLeftPart:theRest,startIndex:index+name.length,elem:{index:index,orig:result.orig}};else if(result){var startIndexOffset=
result.orig.length-result.correction.length;var toReturn={newLeftPart:theRest,startIndex:index+name.length+startIndexOffset,elem:{index:index,orig:result.orig,correction:name}};log("toReturn",toReturn);return toReturn}else return searchForName(leftPart.substring(1),index+1,name)}if(logging)var log=console.log;else log=function(){};if(!email||email==="")return null;var emailSplit=email.split("@");var leftPart=emailSplit[0].toLowerCase();var rightPart=emailSplit[1].toLowerCase();var personalSection=
checkForNameTypo(leftPart,firstname,lastname);var domainSection=checkForDomainTypo(rightPart);var result$$0={userEmail:email};if(!personalSection&&!domainSection)return null;result$$0.snippets=makeSnippets([personalSection,domainSection],email);result$$0.correctedEmail=makeCorrectedString(result$$0.snippets);if(result$$0.correctedEmail==result$$0.userEmail)result$$0.correctedEmail=null;var correctedSplit=result$$0.correctedEmail.split("@");if(personalSection)result$$0.personalSection=correctedSplit[0];
if(domainSection)result$$0.domainSection=correctedSplit[1];log(result$$0);return result$$0},isrc:function(value,validator){var i;var ct;i=value.replace(/ |-|\//g,"").toUpperCase();if(i.length!=12)return null;ct=i.substr(0,2);if(false&&validator){var found=Iter.find(validator["country_codes"],function(item){return item==ct});if(!found)return null}else if(!ct.match(/[A-Z]{2,2}/))return null;if(!i.substr(2,3).match(/[0-9A-Z]{3,3}/))return null;if(!i.substr(5,7).match(/[0-9]{7,7}/))return null;return i.substr(0,
2)+"-"+i.substr(2,3)+"-"+i.substr(5,2)+"-"+i.substr(7,5)},upc:function(value,validator){var i;i=value.replace(/ |-|\//g,"");if(i.length!=12&&i.length!=13)return null;if(i.match(/[^0-9]/))return null;if(i.length==12)return i.substr(0,6)+" "+i.substr(6,6);else return i.substr(0,7)+" "+i.substr(7,6)},clear_alerts:function(){var elems=Y.util.Dom.getElementsByClassName("alertActive",null,null);Iter.each(elems,Form.validate.clear_alert);$(".has-validation-error",Form._formElem).removeClass("has-validation-error")},
clear_alert:function(elem){FormUtils.showHideAlert(elem,null)},onchange_maybe_hide_alert:function(event,errobj){var targetEl=Y.util.Event.getTarget(event);if(errobj.validator&&!Form.validate.check_value_error(errobj.field,errobj.validator)){var alertEl=Form.validate.get_alert_elt(errobj.field);Y.util.Dom.removeClass(targetEl,"has-validation-error");Y.util.Dom.removeClass(alertEl,"alertActive");Form.validate.remove_onchange_listeners(targetEl)}},remove_onchange_listeners:function(elem){Y.util.Event.removeListener(elem,
"keyup",Form.validate.onchange_maybe_hide_alert);Y.util.Event.removeListener(elem,"change",Form.validate.onchange_maybe_hide_alert)},show_alerts:function(errors,scroll){if(scroll===undefined)scroll=true;if(!errors)errors=[{field:"generic",reason:"generic"}];else if(!Y.lang.isArray(errors))errors=[errors];for(var i=0;i<errors.length;i++)Form.validate.show_alert(errors[i]);if(scroll)Form.revealError()},show_alert:function(err){var elem=Form.validate.get_alert_elt(err.field);var errortext=Form.validate.get_error_text(err);
if(elem){FormUtils.showHideAlert(elem,errortext);if(window!=top&&Dialog.iframeComm)Dialog.iframeComm.updateDialogHeight();var fieldElem=Form._formElem.elements[err.field];Y.util.Dom.addClass(fieldElem,"has-validation-error");Y.util.Event.addListener(fieldElem,"keyup",Form.validate.onchange_maybe_hide_alert,err);Y.util.Event.addListener(fieldElem,"change",Form.validate.onchange_maybe_hide_alert,err)}else{var e$$0;try{Dialog.alert("Oops!",errortext)}catch(e){alert(errortext)}}},get_alert_elt:function(field){return elt(field+
"_alert")||elt(field+"-alert")||$(Form._formElem.elements[field]).siblings(".alert")[0]||$(Form._formElem.elements[field]).siblings(".license-alert")[0]||$(Form._formElem.elements[field]).closest("label").siblings(".alert")[0]||$(Form._formElem.elements[field]).closest(".fieldHintWrapper").siblings(".alert")[0]||$(Form._formElem.elements[field]).closest(".jquery-placeholder-wrapper").siblings(".alert")[0]||$(Form._formElem.elements[field]).closest(".acWidget").siblings(".alert")[0]},get_error_text:function(error){var reason=
error.reason;var fieldName=error.field;if(error.suffix)if(fieldName.lastIndexOf(error.suffix)==fieldName.length-error.suffix.length)fieldName=fieldName.substring(0,fieldName.length-error.suffix.length);var displayName=fieldName;if(window.Validators&&Validators._fieldNames&&Validators._fieldNames[displayName])displayName=Validators._fieldNames[displayName];if(Form._validateMessages){var messages=Form._validateMessages[fieldName];if(messages){var message=messages[reason];if(message)return message}}if(error.customMessage)return error.customMessage;
switch(reason){case "missingValue":if(displayName)return"Required field: "+displayName+".";else return"Required field.";case "badNumber":if(error.min!=null&&error.max!=null)return"A number between "+error.min+" and "+error.max+" is required.";else if(error.min!=null)return"A number (at least "+error.min+") is required.";else if(error.max!=null)return"A number (up to "+error.max+") is required.";else return"A number is required.";case "stringLength":if(error.min!=null&&error.max!=null)return"This value must be between "+
error.min+" and "+error.max+" characters.";else if(error.min!=null)return"This value is too short (minimum length: "+error.min+" characters).";else{$assert(error.max!=null);return"This value is too long (maximum length: "+error.max+" characters)."}case "badFormat":return"Invalid "+displayName+" format.";case "dateFormat":return"Please enter a date in the form mm/dd/yyyy.";case "dateOutOfRange":return"Please enter a date between 1902 and 2037.";case "badisrc":return"Please enter a valid ISRC code (or leave blank).";
case "badupc":return"Please enter a valid UPC/EAN code (or leave blank)."}if(displayName)return"error: field\x3d"+displayName+", reason\x3d"+reason;else return"error: "+reason}}});
var SimpleForm={submit:function(path,params,method){method=method?method:"post";var temp_form=document.createElement("form");temp_form.setAttribute("method",method);temp_form.setAttribute("action",path);for(var key in params){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",params[key]);temp_form.appendChild(hiddenField)}document.body.appendChild(temp_form);temp_form.submit()}};
if(!window.Cookie)throw"expected Cookie library";Cookie.CommChannel=function(channelName,uniquify){$assert(Text.notEmpty(channelName));this._id=Math.round(Math.random()*1E9);if(uniquify)channelName+=this._id;this._channelName=channelName;var namePrefix=Cookie.CommChannel.COOKIE_NAME_PREFIX+channelName;this._cookieName=namePrefix+"_"+this._id;this._namePattern=new RegExp("^"+Text.regexpEscape(namePrefix)+"_(\\d+)$");this._queue={last:0,msgs:[]};this._lastSeen={};this._scanTimer=null;Cookie.clear(this._cookieName)};
Cookie.CommChannel.EVENT_NAME="cookiecomm_message";Cookie.CommChannel.COOKIE_NAME_PREFIX="_comm_";Cookie.CommChannel.MAX_QUEUE_SIZE=5;Cookie.CommChannel.SCAN_TIMEOUT=250;Cookie.CommChannel.COOKIE_MAX_AGE=5;
Cookie.CommChannel.prototype={getName:function(){return this._channelName},startListening:function(){if(!this._scanTimer){var that=this;var timerCallback=function(){that._scanAllQueues()};this._scanTimer=setInterval(timerCallback,Cookie.CommChannel.SCAN_TIMEOUT);Log.info("Cookie comm channel "+this.getName()+" started listening.")}},stopListening:function(){if(this._scanTimer){clearInterval(this._scanTimer);this._scanTimer=null;Log.info("Cookie comm channel "+this.getName()+" stopped listening.")}},
subscribe:function(callback){$(document).on(Cookie.CommChannel.EVENT_NAME+"_"+this._id,callback)},unsubscribe:function(callback){$(document).off(Cookie.CommChannel.EVENT_NAME+"_"+this._id,callback)},send:function(msgName){$assert(U.isString(msgName));var msg=Iter.collect(arguments);Log.debug("Cookie comm channel "+this.getName()+" sending message "+msg[0],msg);for(var i=msg.length-1;i>0;i--)if(msg[i]==null)msg.pop();else break;var msgs=this._queue.msgs;msgs.push(msg);this._queue.last++;if(msgs.length>
Cookie.CommChannel.MAX_QUEUE_SIZE)this._queue.msgs=msgs.slice(1);if(this._writeTimeout)clearTimeout(this._writeTimeout);var self=this;this._writeTimeout=setTimeout(function(){self._writeQueue()},0)},cleanup:function(){Cookie.clear(this._cookieName);this.stopListening();this._lastSeen=this._queue=null},_writeQueue:function(){var json=JSON.stringify(this._queue);Cookie.set(this._cookieName,json,Cookie.CommChannel.COOKIE_MAX_AGE)},_scanAllQueues:function(){var cookies=Cookie.getAll();for(var name in cookies){var match=
this._namePattern.exec(name);if(!match)continue;var queueId=match[1]-0;if(queueId===this._id)continue;var json=cookies[name];$assert(!U.isArray(json),"we expect only one cookie per name");var queue=eval("("+json+")");this._scanOneQueue(queueId,queue)}},_scanOneQueue:function(queueId,queue){var lastIndex=queue.last;$assert(U.isNumber(lastIndex));var lastSeenIndex=this._lastSeen[queueId]||0;var newCount=lastIndex-lastSeenIndex;if(newCount>0){var newMsgs=queue.msgs.slice(-newCount);$assert(newMsgs.length);
this._lastSeen[queueId]=lastIndex;for(var i=0;i<newMsgs.length;i++){var msgArr=newMsgs[i];Log.debug("Cookie comm channel "+this.getName()+" received from "+queueId+" message "+msgArr[0],msgArr);msgArr.unshift(queueId);$.event.trigger(Cookie.CommChannel.EVENT_NAME+"_"+this._id,[msgArr]);if(!this._scanTimer)break}}}};var Player={};
Player.TrackInfo=function(){function TrackInfo(hash){this.update(hash)}TrackInfo.prototype={update:function(hash){var props=PROPS;for(var i=0;i<props.length;i++)this[props[i]]=hash[props[i]];return this},is_playable:function(){return!!this.file},is_busy:function(){return this.encoding_pending&&!this.encoding_error},mark_as_capped:function(){this["is_capped"]=true},copy:function(){var result={};var props=PROPS;for(var i=0;i<props.length;i++)result[props[i]]=this[props[i]];return result}};TrackInfo.is_same=
function(trackinfo_a,trackinfo_b){var props=PROPS;for(var i=0;i<props.length;i++)if(trackinfo_a[props[i]]!=trackinfo_b[props[i]])return false;return true};var PROPS=["tracknum","file","encoding_error","encoding_pending","title","title_link","id","track_license_id","has_lyrics","has_info","is_downloadable","free_album_download","has_free_download","duration","private","album_private","artist","album_preorder","unreleased_track","alt_link","continuous","video_source_type","video_caption","video_id",
"video_mobile_url","is_capped"];return TrackInfo}();
Player.Playlist=function(){function Playlist(player,playing_from,referer,options){options=options||{};this._options=options;this._player=player;this._playlist=[];this._playing_from=playing_from;if(options.url_params&&options.url_params.esig&&(options.url_params.album||options.url_params.track)){referer+="\x26esig\x3d"+options.url_params.esig+"\x26rsig\x3d"+options.url_params.rsig+(options.url_params.album?"\x26album\x3d"+options.url_params.album:"\x26track\x3d"+options.url_params.track);this._url_referrer=
options.url_params.url_referrer}this._referer=referer;this._track=0;this._loadedtrack=-1;this._loadpercent=0;this._duration=null;this._state="IDLE";this._unloaded=true;this._scrubbed=false;this._trackstate=!options.no_trackstate;this._trackchanged=EventSender.create(this,"trackchanged");this._trackplayed=EventSender.create(this,"trackplayed");this._trackcapped=EventSender.create(this,"trackcapped");this._scrubbedback=EventSender.create(this,"scrubbedback");this._completedplay=EventSender.create(this,
"completedplay");this._playlistchanged=EventSender.create(this,"playlistchanged");this._statechanged=EventSender.create(this,"statechanged");this._loaded=EventSender.create(this,"loaded");this._timechanged=EventSender.create(this,"time");this.first_playable_track=-1;this.last_playable_track=-1;this._ui_listeners=new Object;this._usecomm=true;var pageData=$("#pagedata").data("blob")||{};this._stream_buffer_duration_stats=pageData.cfg&&pageData.cfg.stream_buffer_duration_stats||null;this._buffering_start_time=
null;var that=this;this._player.onstate(function(target,arg){if(that._unloaded)return;that._handle_state({oldstate:that._state,newstate:arg.newstate})});this._player.ontime(function(target,arg){if(that._unloaded)return;that._handle_time(arg)});this._player.onloaded(function(target,arg){if(that._unloaded)return;that._handle_load(arg)});if(!Playlist.coordinator)Playlist.coordinator=new Player.PlaylistCoordinator;Playlist.coordinator.add(this)}Playlist.prototype={getoption:function(key){return this._options[key]},
add_track:function(trackinfo){trackinfo=new Player.TrackInfo(trackinfo);if(this._url_referrer&&trackinfo.file)for(var i in trackinfo.file)trackinfo.file[i]+="\x26urlref\x3d"+document.URL.replace(/\&/g,"/");var result=this._playlist.push(trackinfo)-1;this._playlist[result].tracknum=result;if(trackinfo.is_playable()){if(this.first_playable_track==-1){this.first_playable_track=result;this._track=result}this.last_playable_track=result}this._playlistchanged();return result},set_initial_track:function(i){if(this._playlist[i]&&
this._playlist[i].is_playable())this._track=i},update_trackinfo:function(i,trackinfo){trackinfo.tracknum=i;trackinfo=this._playlist[i].update(trackinfo);this._loadedtrack=-1;if(trackinfo.is_playable()){if(this.first_playable_track==-1||i<this.first_playable_track)this.first_playable_track=i;if(this.last_playable_track==-1||i>this.last_playable_track)this.last_playable_track=i}else{if(i==this.first_playable_track){this.first_playable_track=-1;for(var j=i+1;j<this._playlist.length;j++)if(this._playlist[j].is_playable()){this.first_playable_track=
j;break}}if(i==this.last_playable_track){this.last_playable_track=-1;for(j=i-1;j>=0;j--)if(this._playlist[j].is_playable()){this.last_playable_track=j;break}}}this._playlistchanged();if(this._state=="BUSY"&&trackinfo.is_playable())this.play()},playpause:function(){var result=null;switch(this._state){case "IDLE":case "COMPLETED":case "PAUSED":this.play();result=1;break;case "PLAYING":case "BUFFERING":this._player.pause();this._comm_stop();result=-1;break;case "BUSY":this._player.stop();this._comm_stop();
this._handle_state({newstate:"IDLE",oldstate:this._state});result=0;break}return result},play:function(){var tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}switch(this._state){case "IDLE":case "COMPLETED":case "BUSY":Log.debug("playlist loading track "+this._track);if(!tinfo)break;for(;!tinfo.is_playable()&&this._track<this.last_playable_track;){this._track++;tinfo=this._playlist[this._track]}if(!tinfo.is_playable()&&this._playlist.length==
1&&tinfo.encoding_pending)this._handle_state({newstate:"BUSY",oldstate:this._state});else if(this._playlist[this._track].file){this._load();this._player.play();if(this._usecomm)try{this._comm_start();this._stop_other_players()}catch(e){}}break;case "PAUSED":case "BUFFERING":this._player.play();if(this._usecomm)try{this._comm_start();this._stop_other_players()}catch(e){}break}var idx=this._track;this._trackplayed(idx)},pause:function(){switch(this._state){case "PLAYING":case "BUFFERING":this._player.pause();
this._comm_stop();break;case "BUSY":this._player.stop();this._comm_stop();this._handle_state({newstate:"IDLE",oldstate:this._state});break}},stop:function(){this._player.stop();this._handle_state({newstate:"IDLE",oldstate:this._state})},seek:function(pos){this._unloaded=false;var tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}if(pos<=2&&this._playstat==null){tinfo=this._playlist[this._track];if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);
return}else if(tinfo)this._scrubbedback(tinfo.id);this._scrubbed=true}this._player.seek(pos)},play_track:function(num,pos){var tinfo=this.get_track_info(num);if(tinfo&&tinfo.is_capped){this._reset();this._trackcapped(tinfo.id);return}if(this._loadedtrack!=num){this._state="IDLE";this._player.stop();this._track=num;this._load()}this._unloaded=false;if(pos!=null)this.seek(pos);else this.play()},percent_loaded:function(){return this._loadpercent||0},position:function(){return this._position},duration:function(){if(this._duration!=
null)return this._duration;else{var current_track=this.get_track_info();if(current_track)return current_track.duration;return 0}},init_complete:function(forceCue){if(this._trackstate&&this._loadstate());else if(forceCue||this._track>0)this._trackchanged(this._playlist[this._track])},register_listener:function(event_name,listener){var evlisteners=this._ui_listeners[event_name];if(evlisteners){$assert($.isArray(evlisteners),"expected array of event listeners");evlisteners.push(listener)}else{evlisteners=
new Array;evlisteners.push(listener);this._ui_listeners[event_name]=evlisteners}},player:function(){return this._player},unload:function(){this.stop();this._unloaded=true;this._playlist=[];this._track=0;this._loadedtrack=-1;this._loadpercent=0;this._position=0;this.first_playable_track=-1;this.last_playable_track=-1;this._playlistchanged();this._handle_state({newstate:"IDLE",oldstate:this._state})},load:function(tracks){this.unload();for(var i=0;i<tracks.length;i++)this.add_track(tracks[i])},_reset:function(){this.stop();
this._track=this.first_playable_track;this._trackchanged(this._playlist[this._track]);this._loadedtrack=-1},_handle_state:function(arg){if(this._state==arg.newstate)return;if(!(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING")){if(arg.newstate!="PAUSED")this._position=0;this._clearstate()}this._state=arg.newstate;if(arg.newstate=="COMPLETED"&&(arg.oldstate=="PLAYING"||arg.oldstate=="BUFFERING"||arg.oldstate=="PAUSED")){if(!this.seeking)if(this._track+1<=this.last_playable_track){this._state="IDLE";
this._player.stop();var current_track=this.get_track_info();if(current_track&&current_track.continuous==false)this._statechanged(arg);else this.next_track()}else{this._track=0;this._loadedtrack=-1;this._statechanged(arg);this._trackchanged(this._playlist[this.first_playable_track])}}else this._statechanged(arg);if(this._stream_buffer_duration_stats==true)if(arg.newstate=="BUFFERING"&&(arg.oldstate=="IDLE"||arg.oldstate=="COMPLETED"))this._buffering_start_time=Date.now();else if(this._buffering_start_time!=
null&&arg.newstate=="PLAYING"){buffering_duration=Date.now()-this._buffering_start_time;this._buffering_start_time=null;if(this._playstat)this._playstat.report_stream_buffer_duration(buffering_duration,this._options.hq)}},_handle_load:function(arg){if(arg.total==0)this._loadpercent=0;else this._loadpercent=100*arg.loaded/arg.total;this._loaded(this._loadpercent)},_handle_time:function(arg){if(this._trackstate)this._savestate(arg.position);this._position=arg.position;this._duration=arg.duration;this._timechanged(arg);
var trackinfo=this._playlist[this._track];if(this._playstat&&arg.duration>0)if(!this._playstat.play_progress(arg.position,arg.duration)){this._playstat=null;if(trackinfo&&trackinfo!="undefined")this._completedplay(trackinfo.id)}var is_complete=Player.PlayStat.is_complete(arg.position,arg.duration);if(is_complete&&this._scrubbed){this._scrubbed=false;if(trackinfo&&trackinfo!="undefined")this._completedplay(trackinfo.id,true)}},prev_track:function(){var idx=this._track;do idx--;while(idx>=0&&!this._playlist[idx].file);
if(idx==-1)idx=0;this._track=idx;if(this._isplaying()){this._state="IDLE";this._player.stop()}this.play()},next_track:function(){var idx=this._track;do idx++;while(idx<this._playlist.length&&!this._playlist[idx].file);if(idx==this._playlist.length)idx=0;this._track=idx;if(this._isplaying()){this._state="IDLE";this._player.stop()}this.play()},get_state:function(){return this._state},get_track:function(){return this._track},get_track_info:function(index){if(this._playlist.length==0)return null;if(typeof index!=
"undefined")return this._playlist[index].copy();return this._playlist[this._track].copy()},cap_playback_for_track:function(track_id){for(var i=0;this._playlist&&i<this._playlist.length;i++){var ti=this._playlist[i];if(ti.id==track_id){ti.mark_as_capped();break}}},length:function(){return this._playlist.length},_notify_listeners:function(notification,idx){var listeners=this._ui_listeners[notification];if(listeners)for(var i=listeners.length-1;i>=0;i--)listeners[i](idx)},_load:function(){if(this._loadedtrack==
this._track){this.seek(0);return}this._loadedtrack=this._track;this._unloaded=false;this._player.load(this._playlist[this._track].file,this._options.hq);this._loadpercent=0;var trackinfo=this._playlist[this._track];this._trackchanged(trackinfo);this._playstat=new Player.PlayStat(trackinfo,this._playing_from,this._referer);this._scrubbed=false},_isplaying:function(){return this._state=="PLAYING"||this._state=="PAUSED"||this._state=="BUFFERING"},_managestate:Browser.platform!="iphone",_loadstate:function(){if(!this._managestate)return false;
Log.debug("reading/clearing playlist state");var used_saved_state=false;try{var state=Cookie.get(COOKIE_NAME);Cookie.clear(COOKIE_NAME);if(state=JSON.parse(state))for(var i=0;i<this._playlist.length;i++)if(this._playlist[i].id==state.track_id){Log.debug("found player state, playing track "+i+" at pos "+state.pos);this.play_track(i,state.pos);used_saved_state=true;break}}catch(e){}return used_saved_state},_clearstate:function(){if(!this._managestate)return;try{Cookie.clear(COOKIE_NAME)}catch(e){}},
_savestate:function(pos){if(!this._managestate||this._state!="PLAYING"&&this._state!="BUFFERING")return;var track_id=this._playlist[this._track].id;if(Math.abs(this._saved_pos-pos)>SAVE_LATENCY||track_id!=this._saved_track_id){this._saved_track_id=track_id;this._saved_pos=pos;var params={track_id:track_id,pos:pos};try{var value=JSON.stringify(params);Cookie.set(COOKIE_NAME,value,COOKIE_LIFE)}catch(e){}}},_comm_start:function(){if(!this._comm){this._comm=new Cookie.CommChannel("playlist");this._comm.subscribe($.proxy(this._comm_recv,
this))}this._comm.startListening()},_comm_stop:function(){if(this._comm)this._comm.stopListening()},_comm_recv:function(event,args){switch(args[1]){case "stop":Log.debug("received cookie comm stop command.  stopping.");this.stop();break}},_stop_other_players:function(){this._comm.send("stop")}};var COOKIE_NAME="playlist_state";var COOKIE_LIFE=30;var SAVE_LATENCY=1;var PLAY_TRACK="play_track";Playlist.PLAY_TRACK=PLAY_TRACK;return Playlist}();
Player.PlaylistCoordinator=function(){function constructor(){this._playlists=[];this._playingcount=0;this._playing=EventSender.create(this,"playing");this._stopped=EventSender.create(this,"stopped")}constructor.prototype.add=function(pl){var self=this;pl.onstatechanged(function(arg){self._handle_playlist_statechanged(pl,arg)});this.onplaying(function(playingplaylist){if(pl!=playingplaylist)if(pl.getoption("savepos"))pl.pause();else pl.stop()})};constructor.prototype._handle_playlist_statechanged=
function(playlist,arg){var isplaying=arg.newstate=="PLAYING"||arg.newstate=="BUFFERING";var wasplaying=arg.oldstate=="PLAYING"||arg.oldstate=="BUFFERING";if(isplaying&&!wasplaying)this._playingcount++;else if(wasplaying&&!isplaying){this._playingcount--;if(this._playingcount==0)this._stopped()}if(isplaying)this._playing(playlist)};return constructor}();
Player.PlayStat=function(){function PlayStat(trackinfo,playing_from,referer){params={kind:"track play",track_id:trackinfo.id,track_license_id:trackinfo.track_license_id,from:playing_from,from_url:referer||location.toString()};_super.call(this,params,"started")}var _super=Stats.PhasedStat;for(var k in Stats.PhasedStat.prototype)PlayStat.prototype[k]=Stats.PhasedStat.prototype[k];PlayStat.prototype.play_progress=function(secs_played,secs_total){var partial=PlayStat.is_partial(secs_played,secs_total);
var complete=PlayStat.is_complete(secs_played,secs_total);if(!this._partial_sent&&partial){this._partial_sent=true;this.change_phase("partial")}if(!this._complete_sent&&complete){this._complete_sent=true;this.change_phase("complete");return false}return true};PlayStat.is_partial=function(secs_played,secs_total){var SKIP_WINDOW=10;var is_it=false;if(secs_played&&secs_total){partial=secs_total*SKIP_WINDOW/100;is_it=secs_played>partial}return is_it};PlayStat.is_complete=function(secs_played,secs_total){var COMPLETE_WINDOW=
10;var is_it=false;if(secs_played&&secs_total){complete=secs_total*(100-COMPLETE_WINDOW)/100;is_it=secs_played>complete}return is_it};PlayStat.prototype.report_stream_buffer_duration=function(duration,hq){Stats.record({kind:"stream buffer duration",duration_ms:duration,is_hq:hq});return true};return PlayStat}();
var TitlePlayIndicator={playing:false,browser_supported:!(Browser.make=="ie"&&Browser.version[0]<9),play:function(){if(!this.playing){this.playing=true;if(this.browser_supported)document.title="\u25b6\ufe0e "+document.title}},stop:function(){if(this.playing){this.playing=false;if(this.browser_supported)document.title=document.title.substring(3)}}};
var ImageUtils=function(){function dynamicURL(kind,image_id,format,is_https){if(!image_id)return TemplGlobals.static_siteroot+"/img/blank.gif";format=getFormat(format);var siteroot=ImageUtils.imageRoot(is_https);var ext;if(format.anim_ok)ext="";else if(format.file_format&&format.file_format!="original")ext="."+FORMAT_EXTENSIONS[format.file_format];else ext="";image_id=("000000000"+image_id).slice(-10);return siteroot+"/img/"+kind+image_id+"_"+format.id+ext}function getFormat(format){if(typeof format===
"object")return format;var fmts=TemplGlobals.image_formats;if(fmts)for(var i=0;i<fmts.length;++i)if(fmts[i].id==format||fmts[i].name==format)return fmts[i];Log.error("bad image format",format);return null}function calculateDimensions(width,height,format){format=getFormat(format);var format_width;var format_height;if(!format||format.resize_algo=="original"){format_width=width;format_height=height}else if(format.resize_algo=="thumb"){format_width=format.width;format_height=format.height}else if(format.resize_algo==
"fit")if(width<=format.width&&height<=format.height){format_width=width;format_height=height}else if(width/format.width>height/format.height){format_width=format.width;format_height=Math.round(height*(format.width/width))}else{format_width=Math.round(width*(format.height/height));format_height=format.height}else{Log.error("bad image resize algo",format);format_width=width;format_height=height}return{width:format_width,height:format_height}}var FORMAT_EXTENSIONS={"JPEG":"jpg","PNG":"png"};var returnVal=
{imageURL:function(image_id,format,is_https){return dynamicURL("",image_id,format,is_https)},artURL:function(art_id,format,is_https){return dynamicURL("a",art_id,format,is_https)},imageFormat:getFormat,imageDimensions:calculateDimensions,imageRoot:function(is_https){if("undefined"===typeof is_https)is_https=window.location.protocol==="https:";return is_https?TemplGlobals.image_siteroot_https:TemplGlobals.image_siteroot}};if("uploadImage"in window)returnVal.upload=uploadImage;return returnVal}();
var Templ=function(){function equalOperator(l,r){if(l==Templ.EMPTY)return l.equals(r);else if(r==Templ.EMPTY)return r.equals(l);else return Expression.evaluate_comparison("\x3d\x3d",l,r)}var EN_DEFAULT="en";var pageData$$0=$("#pagedata").data("blob");var locale=pageData$$0&&pageData$$0.locale||EN_DEFAULT;var locale_suffix=locale!==EN_DEFAULT?"."+locale:"";var start_re="(\\s+|^)";var open_paren_re="(\\()?";var scheme_re="(http://|https://)?";var host_re="(([^@\\./\\s\\/'\"\x3e\x3c\x26]+)(\\.[^@\\./\\s\\/'\"\x3e\x3c\x26]+)*(\\."+
"(?:[a-z]{2,})))";var port_re="(:\\d+)?";var path_re="(/[^?\\s]*?)?";var params_re="(\\?[^#\\s]*?)?";var anchor_re="(#[^\\s]*?)?";var close_paren_re="(\\))?";var end_re="([.,;](\\s|$)|\\s+|$)";var url_regex_loose_contextual=new RegExp(start_re+open_paren_re+scheme_re+host_re+port_re+path_re+params_re+anchor_re+close_paren_re+end_re,"i");var email_address_re="([^\\s\\(\\)\"'/\x3e\x3c,@]+@\\w([^\\s\\(\\)\"'/\x3e\x3c\x26,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/\x3e\x3c\x26,@]*\\w)";var email_regex_contextual=new RegExp(start_re+
open_paren_re+email_address_re+close_paren_re+end_re,"i");var tld_set={".com":true,".ru":true,".org":true,".net":true,".de":true,".jp":true,".uk":true,".br":true,".it":true,".pl":true,".fr":true,".in":true,".au":true,".ir":true,".info":true,".nl":true,".cn":true,".es":true,".cz":true,".kr":true,".ca":true,".eu":true,".ua":true,".co":true,".gr":true,".za":true,".ro":true,".biz":true,".ch":true,".se":true,".tw":true,".mx":true,".vn":true,".hu":true,".be":true,".tr":true,".at":true,".dk":true,".tv":true,
".me":true,".ar":true,".sk":true,".no":true,".us":true,".fi":true,".id":true,".cl":true,".xyz":true,".io":true,".pt":true,".by":true,".il":true,".ie":true,".nz":true,".kz":true,".hk":true,".lt":true,".cc":true,".my":true,".sg":true,".club":true,".bg":true,".edu":true,".pk":true,".su":true,".top":true,".th":true,".hr":true,".rs":true,".pe":true,".pro":true,".si":true,".lv":true,".az":true,".pw":true,".ae":true,".ph":true,".online":true,".ng":true,".ee":true,".ws":true,".ve":true,".pizza":true,".cat":true};
return{cfgFlags:pageData$$0&&pageData$$0.cfg||{},locale:locale,locale_suffix:locale_suffix,templates:{},globals:null,register:function(hashOfTemplates){$.extend(Templ.templates,hashOfTemplates)},refresh:function(set){$assert(set);var url="/js_templates?x\x3d"+Math.random()+"\x26set\x3d"+set;var head=document.getElementsByTagName("head")[0];var newscript=document.createElement("script");newscript.type="text/javascript";newscript.src=url;head.appendChild(newscript)},getGlobals:function(){if(!Templ.globals){var pageData=
$("#pagedata").data("blob");var newGlobals=pageData&&pageData.templglobals;var oldGlobals=typeof TemplGlobals!="undefined"?TemplGlobals:null;Templ.globals=$.extend({},oldGlobals,newGlobals)}return Templ.globals},RENDER_SPEED_TEST:false,render:function(templName,hash){var myhash=$.extend({},Templ.getGlobals(),hash);var context=new Templ.Context(myhash);var out=[];if(this.RENDER_SPEED_TEST){Log.debug("\x3e\x3e\x3e start rendering "+templName);var start_date=new Date;for(var i=0;i<100;++i){out=[];Templ.renderInternal(templName,
context,out)}var end_date=new Date;Log.debug("\x3e\x3e\x3e end rendering "+templName+" - "+(end_date-start_date)/100+"ms")}else{Templ.current_context=context;Templ.renderInternal(templName,context,out);Templ.current_context=null}return out.join("")},runWithContext:function(cb){var context=new Templ.Context(Templ.getGlobals());Templ.current_context=context;cb();Templ.current_context=null},renderElem:function(el,templName,hash){el=elt(el);Y.util.Dom.batch(Y.util.Dom.getChildren(el),function(thisEl){Y.util.Event.purgeElement(thisEl,
true)});el.innerHTML=Templ.render(templName,hash)},renderTableRow:function(el,templName,hash){el=elt(el);Y.util.Dom.batch(Y.util.Dom.getChildren(el),function(thisEl){Y.util.Event.purgeElement(thisEl,true)});var parent=document.createElement("DIV");parent.innerHTML="\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e"+Templ.render(templName,hash)+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";for(var newrow=parent.firstChild.firstChild.firstChild;el.firstChild!=null;)el.removeChild(el.firstChild);for(;newrow.firstChild!=
null;)el.appendChild(newrow.removeChild(newrow.firstChild))},renderInternal:function(templName,context,out){var tokens=Templ.templates[templName+Templ.locale_suffix]?Templ.templates[templName+Templ.locale_suffix]:Templ.templates[templName];if(!tokens){var msg="[template not found: "+templName+"]";out.push(msg);Log.server(msg,"warn")}else Templ.renderTokens(tokens,context,out)},renderTokens:function(tokens,context,out){if(tokens)for(var i=0;i<tokens.length;i++){var token=tokens[i];if(typeof token===
"string")out.push(token);else try{Templ.renderOneToken(token,context,out)}catch(e){Log.error("Error rendering token",token,"context",context);throw e;}}},renderOneToken:function(token,context,out){var i;var block;switch(token.type){case "translate":Templ.renderTokens(token.nodelist,context,out);break;case "translatePlural":for(i=0;i<token.blocks.length;i++){block=token.blocks[i];if(Templ.evalNCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "translateVariable":Templ.renderTokens(token.nodelist,
context,out);break;case "variable":if(!token.name)return;var value=Expression.eval(token.name,function(term){return context.resolve(term)});var filters=Templ.filters;Iter.each(token.filters,function(filterToken){var args=Iter.collect(filterToken[1],function(thisArg){return context.resolve(thisArg)});var filterFn=filterToken[0]?filters[filterToken[0]]:null;if(!filterFn){value="[template error: filter not found: "+filterToken[0]+"]";Log.error(value)}else{args.unshift(value);value=filterFn.apply(null,
args)}});if(value!=null){if($.isArray(value))value=value.join("");out.push(value)}break;case "assign":context.hash[token.to]=context.resolve(token.from);break;case "case":case "if":var blocks=token.blocks;for(i=0;i<blocks.length;i++){block=blocks[i];if(Templ.evalCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "for":var collection=context.resolve(token.collection_name);if(collection instanceof Templ.Range)collection=collection.expand();var nodelist=token.nodelist;
var offset=token.attribs.offset!=null?context.resolve(token.attribs.offset):0;var limit=collection?collection.length-offset:0;if(token.attribs.limit!=null)limit=Math.min(limit,context.resolve(token.attribs.limit));var collectionSlice=collection?collection.slice(offset,offset+limit):[];if(token.reversed)collectionSlice.reverse();context.stashLoopvars();for(i=0;i<limit;i++){context.hash[token.variable_name]=collectionSlice[i];context.hash.forloop={"length":limit,"index":i+1,"index0":i,"rindex":limit-
i,"rindex0":limit-i-1,"first":i===0,"last":i===limit-1};Templ.renderTokens(nodelist,context,out)}context.restoreLoopvars();break;case "include":var subtemplateName=context.resolve(token.template_name);Templ.renderInternal(subtemplateName,context,out);break;case "capture":var capture_out=[];Templ.renderTokens(token.nodelist,context,capture_out);var strval="";for(i=0;i<capture_out.length;i++)strval+=capture_out[i];context.hash[token.to]=strval;break;case "ef":blocks=token.blocks;for(i=0;i<blocks.length;i++){block=
blocks[i];if(Templ.evalNCondition(block,context)){Templ.renderTokens(block.attachment,context,out);break}}break;case "let":context.hash[token.variable]=Expression.eval(token.expression,function(term){return context.resolve(term)});break}},evalNCondition:function(block,context){if(block.type=="else_ncondition")return true;return Templ.isTrue(Expression.eval(block.expression,function(term){return context.resolve(term)}))},evalCondition:function(block,context){if(block.type=="else_condition")return true;
var result;var left=context.resolve(block.left);var operator=block.operator;if(!operator)result=Templ.isTrue(left);else{var operatorFn=Templ.operators[operator];if(!operatorFn){Log.error("template: unrecognized operator: "+operator);return false}var right=context.resolve(block.right);result=operatorFn(left,right)}if(block.child_relation=="or")result=Templ.isTrue(result)||Templ.isTrue(Templ.evalCondition(block.child_condition,context));else if(block.child_relation=="and")result=Templ.isTrue(result)&&
Templ.isTrue(Templ.evalCondition(block.child_condition,context));return result},isTrue:function(val){return val!==false&&val!=null},EMPTY:{equals:function(other){if(other==this)return true;return!other||other.toString()===""}},Range:function(start,end){this.start=start;this.end=end;this.expand=function(){var out=[];for(var i=this.start;i<=this.end;i++)out.push(i);return out}},operators:{"\x3d\x3d":equalOperator,"!\x3d":function(l,r){return!equalOperator(l,r)},"\x3c\x3e":function(l,r){return!equalOperator(l,
r)},"\x3c":function(l,r){return Expression.evaluate_comparison("\x3c",l,r)},"\x3e":function(l,r){return Expression.evaluate_comparison("\x3e",l,r)},"\x3c\x3d":function(l,r){return Expression.evaluate_comparison("\x3c\x3d",l,r)},"\x3e\x3d":function(l,r){return Expression.evaluate_comparison("\x3e\x3d",l,r)},"contains":function(l,r){if(typeof l==="string")return l.indexOf(r)>=0;if($.isArray(l)){for(var i=0;i<l.length;i++)if(l[i]==r)return true;return false}if(l instanceof Templ.Range)return r>=l.start&&
r<=l.end;return false}},filters:{size:function(input){return input?input.length:0},downcase:function(input){return input!=null?input.toString().toLowerCase():""},upcase:function(input){return input!=null?input.toString().toUpperCase():""},escape:function(input){return input!=null?Text.escapeHtml(input.toString()):""},escape_html_attr:function(input){return Templ.filters.escape(input)},noblanks:function(input,aggressive){var s;if(aggressive)s=input.replace(/(\n *)+/g,"").replace(/\n--/g,"\n");else s=
input.replace(/(\n *)+/g,"\n").replace(/\n--/g,"\n");return s},strip:function(input){return input!=null?input.toString().trim():""},strip_html:function(input){return input!=null?input.toString().replace(/<.*?>/g,""):""},strip_newlines:function(input){return input!=null?input.toString().replace(/\n/g,""):""},newline_to_br:function(input){return input!=null?input.toString().replace(/\n/g,"\x3cbr /\x3e\n"):""},newline_to_gap:function(input){return input!=null?input.toString().replace(/\n[\r\t ]*\n/g,
'\x3cbr /\x3e\x3cspan class\x3d"lightweightBreak" /\x3e\x3c/span\x3e\x3cbr /\x3e').replace(/\n/g,"\x3cbr /\x3e\n"):""},replace:function(input,str,repl){return Templ.filters.replace_regex(input,Text.regexpEscape(str),repl)},replace_regex:function(input,str,repl){if(input==null)return"";if(repl==null)repl="";input=input.toString();var result=input.replace(new RegExp(str,"gm"),repl);return result},replace_first:function(input,str,repl){if(repl==null)repl="";return input!=null?input.toString().replace(str,
repl):""},remove:function(input,str){return Templ.filters.replace(input,str)},remove_first:function(input,str){return Templ.filters.replace_first(input,str)},encode_uri_c:function(input){return input!=null?encodeURIComponent(input).replace(/'/g,"%27"):""},join:function(input,glue){if(glue==null)glue=" ";return $.isArray(input)?input.join(glue):input},sort:function(input){function comparator(a,b){if(a>b)return 1;if(a<b)return-1;return 0}return $.isArray(input)?input.slice(0).sort(comparator):input},
first:function(input){return $.isArray(input)?input[0]:null},last:function(input){return $.isArray(input)&&input.length?input[input.length-1]:null},edit_if_empty:function(input,club_id,fieldname,linktext){if(input&&input.length>0)return input;return Templ.filters.edit_field(linktext,club_id,fieldname)},edit_field:function(linktext,club_id,fieldname){return'\x3ca href\x3d"/edit?id\x3d'+club_id+"\x26focus\x3d"+fieldname+'"\x3e'+linktext+"\x3c/a\x3e"},date:function(date,format){if(typeof date=="string")date=
new Date(Date.parse(date));return Time.strftime(date,format)},time:function(input,format){return Time.to_ui(input,format,locale)},ui_datetime:function(input){return input?Time.toUi(input,false,true):""},ui_date:function(input,fourDigitYear){return input?Time.toUiDate(input,fourDigitYear,true):""},to_date:function(input){return new Date(input*1E3)},relative_day:function(input,format){return input?Time.relative_day(input,format,locale):""},relative_time:function(input,format){return input?Time.relative_time(input,
format,locale):""},json:function(input){return Y.lang.JSON.stringify(input)},plural:function(input,si,pl){if(pl==null)pl=si+"s";return input=="1"?si:pl},capitalize:function(input){return input.charAt(0).toUpperCase()+input.substring(1).toLowerCase()},capitalize_first_character:function(input){return input.charAt(0).toUpperCase()+input.slice(1)},titlecase:function(input){if(input!=null)return input.toString().replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()});
else return""},currency:function(input,currency,numeric,informal,terse){if(input==null)return"";return TextFormat.currency(input,window.CurrencyData?CurrencyData.info[currency||"USD"]:null,numeric,informal,terse)},money:function(input,currency,format){return TextFormat.money(input,currency,format)},million_usd:function(input){return TextFormat.million_usd(input,locale)},negate:function(input){if(input&&input.is_money)return{amount:-input.amount,currency:input.currency,is_money:true};else if("number"===
typeof input)return-input;return""},abs:function(input){if(input&&input.is_money)return{amount:Math.abs(input.amount),currency:input.currency,is_money:true};else if("number"===typeof input)return Math.abs(input);return""},truncate:function(input,len,ellipsis){ellipsis=ellipsis||"...";return Text.truncate(input,len,ellipsis)},add_query_parm:function(input,query_parm){if(!input)return"";if(query_parm===null||query_parm.length===0)return input;return input+(input.indexOf("?")>-1?"\x26":"?")+query_parm},
mb:function(input){return TextFormat.toMb(input)},mb_si:function(input){return TextFormat.toMb(input,true)},url:function(input,isHttps,prefix){var key=!isHttps?"url":"https_url";if(prefix){prefix=prefix+"";if(prefix.charAt(prefix.length-1)!="_")prefix=prefix+"_";key=prefix+key}return input[key]},commafy:function(input){return TextFormat.commafyNumber(""+input)},fan_link:function(input,style){return"\x3ca href\x3d'"+input.trackpipe_url+"' style\x3d'"+style+"'\x3e"+input.name+"\x3c/a\x3e"},html_autolink:function(input,
linkAttribs){var result="";var head="";var tail="";var display="";var href="";var post="";var qPre="";var qPost="";var qHref="";var qDisplay="";if(!input)return result;if(linkAttribs==null||typeof linkAttribs=="undefined"||linkAttribs==="")linkAttribs="";else if(linkAttribs[0]!==" ")linkAttribs=" "+linkAttribs;var ur=url_regex_loose_contextual.exec(input);var er=email_regex_contextual.exec(input);if(er){head=input.substring(0,er.index);tail=input.substring(er.index+er[0].length);post=er[6]?er[6]:
" ";qPre=Text.escapeHtml((er[1]||"")+(er[2]||""));qPost=Text.escapeHtml((er[5]||"")+post);qHref=Text.escapeHtml(er[3]);qDisplay=Text.escapeHtml(er[3]);result=Templ.filters.html_autolink(head,linkAttribs)+" "+qPre+'\x3ca href\x3d"mailto:'+qHref+'"\x3e'+qDisplay+"\x3c/a\x3e"+qPost+(tail?" ":"")+Templ.filters.html_autolink(tail,linkAttribs)}else if(ur){head=input.substring(0,ur.index);tail=input.substring(ur.index+ur[0].length);if(!ur[3]&&!tld_set[ur[7].toLowerCase()])return Templ.filters.html_autolink(head,
linkAttribs)+Text.escapeHtml(ur[0])+Templ.filters.html_autolink(tail,linkAttribs);display=[ur[4],ur[9]?ur[9]:"",ur[10],ur[11]].join("");href="";if(ur[3])href=[ur[3],ur[4],ur[9]?ur[9]:"",ur[10],ur[11]].join("");else href=["http://",ur[4],ur[9]?ur[9]:"",ur[10],ur[11]].join("");if(ur[2]!=="("&&ur[12]===")"){href=href+")";display=display+")"}post=ur[13]?ur[13]:" ";qPre=Text.escapeHtml((ur[1]||"")+(ur[2]||""));qPost=Text.escapeHtml((ur[12]||"")+post);qHref=Text.escapeHtml(href);qDisplay=Text.escapeHtml(display);
result=Templ.filters.html_autolink(head,linkAttribs)+" "+qPre+'\x3ca href\x3d"'+qHref+'"'+linkAttribs+"\x3e"+qDisplay+"\x3c/a\x3e"+qPost+(tail?" ":"")+Templ.filters.html_autolink(tail,linkAttribs)}else result=Text.escapeHtml(input);return result},plus:function(a,b){return a+b},minus:function(a,b){return a-b},times:function(a,b){return a*b},divided_by:function(a,b){if(a==Math.floor(a)&&b==Math.floor(b))return Math.floor(a/b);else return a/b},image:function(info,format){var id_only=typeof info=="number"||
!info;var image_id=id_only?info:info.image_id;var url=Templ.filters.image_url(image_id,format);if(id_only)return'src\x3d"'+url+'"';else{var dims=ImageUtils.imageDimensions(info.width,info.height,format);return'src\x3d"'+url+'" width\x3d"'+dims.width+'" height\x3d"'+dims.height+'"'}},image_url:function(image_id,format){return ImageUtils.imageURL(image_id,format,Templ.current_context.resolve("is_https"))},art:function(art_id,format){var url=Templ.filters.art_url(art_id,format);return'src\x3d"'+url+
'"'},art_url:function(art_id,format){return ImageUtils.artURL(art_id,format,Templ.current_context.resolve("is_https"))},popup_image:function(info,format){var id_only=typeof info=="number";var image_id=id_only?info:info.image_id;var url=Templ.filters.image_url(image_id,format);if(id_only)return'href\x3d"'+url+'"';else{var dims=ImageUtils.imageDimensions(info.width,info.height,format);return'href\x3d"'+url+'" data-image-size\x3d"'+dims.width+","+dims.height+'"'}},image_width:function(info,format){var dims=
ImageUtils.imageDimensions(info.width,info.height,format);return dims.width},image_height:function(info,format){var dims=ImageUtils.imageDimensions(info.width,info.height,format);return dims.height},possessify:function(name){if(name===null||typeof name!=="string")return name;if(!locale||locale==EN_DEFAULT)return/s$/.test(name)?name+"'":name+"'s";else return name},possessify_smart:function(name){if(name===null||typeof name!=="string")return name;if(!locale||locale==EN_DEFAULT)return/s$/.test(name)?
name+"\u2019":name+"\u2019s";else return name},enumerate_items:function(items,connector){if(typeof connector==="undefined")connector="and";var f=function(items){if(items.length===0||items===null)return"";if(items.length===1)return items[0];if(items.length===2)return items[0]+" "+connector+" "+items[1];return items[0]+", "+f(items.slice(1,items.length))};return f(items)},fan_page_url:function(username){return Templ.current_context.resolve("siteroot_current")+"/"+username},band_url:function(url_hints){if(!url_hints)return"";
var customDomain=url_hints.custom_domain;var customDomainVerified=url_hints.custom_domain_verified;var subdomain=url_hints.subdomain;var customDomainsActive=Templ.current_context.resolve("custom_domains_active");var basePortStr=Templ.current_context.resolve("base_port_str")||"";var baseDomainWithPort=Templ.current_context.resolve("sitedomain");if(customDomainsActive&&customDomain&&customDomainVerified)return"http://"+customDomain+basePortStr;else if(subdomain)return location.protocol+"//"+subdomain+
"."+baseDomainWithPort;return""},lpad:function(input,amount){if(typeof amount==="undefined")amount=10;input=String(input);var length=input.length;var result="";if(amount-length>0)result=(new Array(amount-length+1)).join(" ");return result+input},tralbum_url:function(url_hints){if(!url_hints)return"";var pagebase="";if(url_hints.item_type==="a")pagebase="/album/";else if(url_hints.item_type==="t")pagebase="/track/";else if(url_hints.item_type==="p")pagebase="/merch/";return Templ.filters.band_url(url_hints)+
pagebase+url_hints.slug},subscribe_url:function(url_hints){if(!url_hints)return"";var url_fragment=url_hints.subscribe_url_fragment||"subscribe";return Templ.filters.band_url(url_hints)+"/"+url_fragment},featured_track_url:function(url_hints,featured_track_number){if(!url_hints)return"";return Templ.filters.tralbum_url(url_hints)+"?t\x3d"+featured_track_number},hex_to_rgb:function(hex){if(!hex)return null;if(hex[0]==="#")hex=hex.substring(1);if(!hex.match(/[0-9A-Fa-f]{6}/))return null;var bigint=
parseInt(hex,16);var r=bigint>>16&255;var g=bigint>>8&255;var b=bigint&255;return r+", "+g+", "+b},fixnum:function(number,decimals){return number.toFixed(decimals)}},Context:function(hash){this.hash=hash||{};this.loopvars=null}}}();Templ.filters.h=Templ.filters.escape;Templ.filters.a=Templ.filters.attr=Templ.filters.escape_html_attr;Templ.filters.u=Templ.filters.encode_uri_c;
Templ.Context.prototype=function(){return{resolve:function(name){switch(name){case null:case "nil":case "null":case "":return null;case "true":return true;case "false":return false;case "empty":return Templ.EMPTY}var match;if(match=/^'(.*)'$/.exec(name))return match[1];if(match=/^"(.*)"$/.exec(name))return match[1];if(/^\d+$/.test(name))return parseInt(name);if(match=/^\((\S+)\.\.(\S+)\)$/.exec(name))return new Templ.Range(this.resolve(match[1]),this.resolve(match[2]));if(/^(\d[\d\.]+)$/.test(name))return parseFloat(name);
return this.variable(name)},variable:function(nameExpr){var method;if(!nameExpr.match(/^forloop[\[\.](first|last)$/)){var match=nameExpr.match(/\.(size|first|last)$/);if(match){method=match[1];nameExpr=nameExpr.substr(0,match.index)}}var val=null;try{val=eval("this.hash."+nameExpr)}catch(e){try{val=eval("this.hash."+nameExpr.replace(/\[([\w.]+)\]/,"[this.hash.$1]"))}catch(e2){Log.debug("Failed template hash lookup: ["+nameExpr+"]; message: "+e2.message)}}if(method)val=Templ.filters[method](val);return val},
stashLoopvars:function(){var vars=this.hash.forloop;if(vars){this.loopvars=this.loopvars||[];this.loopvars.push(vars)}},restoreLoopvars:function(){if(this.loopvars)this.hash.forloop=this.loopvars.pop()}}}();var gplaylist;var gplayerviews=[];
Player.init=function(tralbumdata,post_init_cb){Player.tralbum_data=tralbumdata;Player.private_streaming=Player.tralbum_data.playing_from.slice(0,17)=="private_streaming"?true:false;var initplayer=function(status){var player=null;var playlist=null;if(status.success){player=new Sound.SoundPlayer;playlist=new Player.Playlist(player,Player.tralbum_data.playing_from,null,{"hq":Player.tralbum_data.is_purchased||Player.tralbum_data.is_private_stream||Player.tralbum_data.is_band_member})}gplaylist=playlist;
var elems=Y.util.Dom.getElementsByClassName("inline_player",null,document);var relValue;if(elems.length)for(var i=0;i<elems.length;i++){var elem=elems[i];var options={};Log.debug("creating inline player view");if(elem.attributes.rel){options["onetrack"]=true;if(!relValue)relValue=elem.attributes.rel.value}gplayerviews.push(new Player.InlinePlayerView(playlist,elem,options))}if(playlist&&relValue){var params=Url.parseQuery(relValue);var trackinfo=Player.tralbum_data.trackinfo[params.tracknum-1];var index=
playlist.add_track(trackinfo);if(trackinfo.id===Player.tralbum_data.featured_track_id)playlist.set_initial_track(index)}var initial_track_set=false;elems=Y.util.Dom.getElementsByClassName("track_row_view",null,document);for(i=0;i<elems.length;i++){elem=elems[i];params=Url.parseQuery(elem.attributes.rel.value);trackinfo=Player.tralbum_data.trackinfo[params.tracknum-1];var trackrow=new Player.TrackRowView(playlist,elem,trackinfo,Player.private_streaming);if(playlist&&!initial_track_set)if(Player.tralbum_data.initial_track_num&&
trackinfo.track_num==Player.tralbum_data.initial_track_num&&trackinfo.file){Log.debug("setting initial track to t\x3dx override");playlist.set_initial_track(trackrow._tracknum);initial_track_set=true}else if(trackinfo.id===Player.tralbum_data.featured_track_id){Log.debug("setting initial track to featured track");playlist.set_initial_track(trackrow._tracknum)}}if(post_init_cb)post_init_cb(playlist);if(playlist)playlist.init_complete()};Sound.whenloaded(initplayer)};
Player.update=function(tralbumdata){if(!gplaylist)return;Player.tralbum_data=tralbumdata;for(var i=0;i<tralbumdata.trackinfo.length;i++)gplaylist.update_trackinfo(i,tralbumdata.trackinfo[i])};
Player.CollectionView=function(){function CollectionView(playlist){this._playlist=playlist;this._play_status_elements=[];this._play_hilite_elements=[];this._play_elapsed_time_elements={};this._waypoints=[];this._play_elem_stash={};this._track_list_ids={};this._playing_state="STOPPED";this._setup();if(playlist){playlist.onstatechanged(this._handle_statechange,this);playlist.onplaylistchanged(this._handle_playlistchange,this);playlist.onloaded(this._handle_loaded,this);playlist.ontime(this._handle_time,
this)}}var pagedata=$("#pagedata").data("blob")||{};var cfg=pagedata.cfg||{};CollectionView.prototype={is_playing:function(){return this._playing_state=="PLAYING"||this._playing_state=="BUFFERING"},currently_playing_track:function(){return this.is_playing()?this._current_track_list_entry():null},play:function(){this._playlist.play();return 1},playpause:function(track_id){if(track_id==null||track_id==""||track_id==this._current_track_list_entry().id)return this._playlist.playpause();else return this.play_track_id(track_id)},
play_track_num:function(track_num){track_num=track_num>0?track_num-1:track_num;this._playlist.play_track(track_num);return 1},play_track_id:function(track_id){var trackinfo=this.get_track_info(track_id);if(trackinfo&&typeof trackinfo!="undefined"&&trackinfo.track_num)this.play_track_num(trackinfo.track_num);return 1},get_track_info:function(track_id){for(var key in track_list)if(track_list.hasOwnProperty(key)&&track_list[key]["track_id"]==track_id)return track_list[key];return null},_setup:function(){var track_play_views=
Y.util.Dom.getElementsByClassName("track_play_view",null,null);var i=0;for(var length=track_play_views.length;i<length;i++){var elem=track_play_views[i];if(this._playlist&&elem.attributes["data-trackid"]){var trackhandler=function(trackid){return function(){playerview.playpause(trackid)}};var trackid=elem.attributes["data-trackid"].value;if(!trackid||trackid==""){Log.debug("_setup(): ignoring track_play_view with missing trackid");continue}var trackinfo=this.get_track_info(trackid);if(!trackinfo||
trackinfo=="undefined"){Log.debug("_setup(): ignoring track_play_view with invalid trackid");continue}Log.debug("_setup(): building a track control for trackid \x3d "+trackid);var table=document.createElement("table");table.setAttribute("style","border: none;");var tr=document.createElement("tr");tr.setAttribute("itemprop","tracks");tr.setAttribute("itemscope",null);tr.setAttribute("itemtype","http://www.schema.org/MusicRecording");var td=document.createElement("td");td.className="track_play_control";
var a=document.createElement("a");a.onclick=trackhandler(trackid);var play_status=document.createElement("div");play_status.className="play_status";play_status.setAttribute("data-trackid",trackid);a.appendChild(play_status);td.appendChild(a);tr.appendChild(td);td=document.createElement("td");td.className="track_play_name";td.innerHTML=trackinfo.title;tr.appendChild(td);td.onclick=trackhandler(trackid);table.appendChild(tr);elem.parentNode.replaceChild(table,elem);this._play_status_elements.push(play_status)}}var auxiliaryControls=
Y.util.Dom.getElementsByClassName("track_play_auxiliary",null,null);this._setup_aux_controls(auxiliaryControls);var hilites=Y.util.Dom.getElementsByClassName("track_play_hilite",null,null);this._setup_hilites(hilites);var timeElems=Y.util.Dom.getElementsByClassName("track_play_time",null,null);this._setup_time_elems(timeElems);var waypoints=$(".track_play_waypoint");this._setup_waypoints(waypoints);i=0;for(var len=track_list.length;i<len;i++)this._track_list_ids[track_list[i].track_id]=true},_setup_aux_controls:function(auxiliaryControls){var self=
this;if(auxiliaryControls==null||typeof auxiliaryControls=="undefined")return;var i=0;for(var len=auxiliaryControls.length;i<len;i++){var trackhandler_aux=function(elem){return function(event){Y.util.Event.stopEvent(event);var trackid=elem.attributes["data-trackid"].value;var played=playerview.playpause(trackid);var clickstat=elem.attributes["data-clickstat"];if(!!clickstat&&(played==0||played==1))Stats.record({kind:"click",click:clickstat.value});return false}};var elem$$0=auxiliaryControls[i];var trackid$$0=
elem$$0.attributes["data-trackid"].value;if(!trackid$$0||trackid$$0==""){Log.debug("_setup(): ignoring track_play_auxiliary with missing trackid");continue}if(elem$$0.tagName=="A")Dom.hackLinkClicksThanksSafari(elem$$0,trackhandler_aux(elem$$0));else elem$$0.onclick=trackhandler_aux(elem$$0)}},_setup_hilites:function(hilites){if(hilites==null||typeof hilites=="undefined")return;var i=0;for(var len=hilites.length;i<len;i++){var elem=hilites[i];if(elem.attributes["data-trackid"]){var assoc_tid=elem.attributes["data-trackid"].value;
if(assoc_tid)this._play_hilite_elements.push(elem)}}},_setup_time_elems:function(timeElems){if(timeElems==null||typeof timeElems=="undefined")return;var i=0;for(var len=timeElems.length;i<len;i++){var elem=timeElems[i];if(elem.attributes["data-trackid"]){var assoc_tid=elem.attributes["data-trackid"].value;if(assoc_tid){var track_info=this.get_track_info(assoc_tid);if(track_info){var elapsedElem=Y.util.Dom.getElementsByClassName("time_elapsed","span",elem)[0];if(elapsedElem){if(!this._play_elapsed_time_elements[assoc_tid])this._play_elapsed_time_elements[assoc_tid]=
[];this._play_elapsed_time_elements[assoc_tid].push(elapsedElem)}total_str=Time.timeStr(track_info.duration);var totalElem=Y.util.Dom.getElementsByClassName("time_total","span",elem)[0];if(totalElem)totalElem.innerHTML=total_str}}}}},_setup_waypoints:function(waypoints){if(waypoints==null||typeof waypoints=="undefined")return;this._waypoints=waypoints},_sleepyhead:function(aux_controls,hilites,time_elems,trackinfo){this._add_trackinfo(trackinfo);this._setup_aux_controls(aux_controls);this._setup_hilites(hilites);
this._setup_time_elems(time_elems)},_add_trackinfo:function(trackinfo){if(trackinfo===null||typeof trackinfo==="undefined")return;var trackid=trackinfo.track_id;if(this._track_list_ids[trackid]==null||!this._track_list_ids[trackid]){Log.debug("Adding track "+trackid+" to playlist");trackinfo["track_num"]=track_list.length+1;trackinfo["id"]=trackinfo["track_id"];trackinfo["file"]=trackinfo["file"]||trackinfo["streaming_url"];trackinfo["continuous"]=false;this._playlist.add_track(trackinfo);track_list.push(trackinfo)}},
_update_track_play_elements:function(trackinfo,aux_controls,hilites,time_elems){if(!trackinfo||trackinfo=="undefined"){Log.debug("_update_track_play_elements(): invalid/missing trackinfo, ignoring");return}var trackid=trackinfo.track_id;this._add_trackinfo(trackinfo);if(aux_controls&&typeof aux_controls!="undefined"){var i=0;for(var len=aux_controls.length;i<len;i++){var aux=aux_controls[i];aux.attributes["data-trackid"].value=trackid}}if(hilites&&typeof hilites!="undefined"){i=0;for(len=hilites.length;i<
len;i++)hilites[i].attributes["data-trackid"].value=trackid}if(time_elems&&typeof time_elems!="undefined"){i=0;for(len=time_elems.length;i<len;i++){var elem=time_elems[i];var elapsedElem=Y.util.Dom.getElementsByClassName("time_elapsed","span",elem)[0];if(elapsedElem){if(!this._play_elapsed_time_elements[trackid])this._play_elapsed_time_elements[trackid]=[];this._play_elapsed_time_elements[trackid].push(elapsedElem)}total_str=Time.timeStr(this.get_track_info(trackid).duration);var totalElem=Y.util.Dom.getElementsByClassName("time_total",
"span",elem)[0];if(totalElem)totalElem.innerHTML=total_str}}},_handle_loaded:function(percent){Log.debug("CollectionPlayerView._handle_loaded()")},_handle_playlistchange:function(){Log.debug("CollectionPlayerView._handle_playlistchange()")},_handle_statechange:function(arg){var handling=true;Log.debug("statechange");this._playing_state=arg.newstate;var current=this._current_track_list_entry();var elems=this._play_status_elements;var i=0;for(var len=elems.length;i<len;i++){var elem=elems[i];if(!elem.attributes["data-trackid"])continue;
var assoc_tid=elem.attributes["data-trackid"].value;if(!assoc_tid)continue;if(assoc_tid==current.id&&(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING"))$(elem).addClass("playing");else $(elem).removeClass("playing")}elems=this._play_hilite_elements;i=0;for(len=elems.length;i<len;i++){elem=elems[i];if(!elem.attributes["data-trackid"])continue;assoc_tid=elem.attributes["data-trackid"].value;if(!assoc_tid)continue;if(assoc_tid==current.id&&(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING"))$(elem).addClass("playing");
else{if(assoc_tid==current.id&&arg.newstate=="PAUSED")$(elem).addClass("paused");$(elem).removeClass("playing")}}elems=this._waypoints;i=0;for(len=elems.length;i<len;i++){elem=elems[i];if(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING"){$(elem).removeClass("done").addClass("playing");$("#track_play_waypoint, #track-play-waypoint-wrapper").removeClass("activated")}else $(elem).removeClass("playing").addClass("done");var itemContainer=$("[data-trackid\x3d'"+current.id+"']");if(itemContainer.length===
0)continue;var itemImg=$(".collection-item-art, .tralbum-art-large, .tralbum-art-medium",itemContainer)[0];var itemTitle=$(".collection-item-title",itemContainer)[0];var artistTitle=$(".collection-item-artist",itemContainer)[0];var parent=$(itemContainer).parent()[0];var isWishlist=$(parent).data("iswish");$("img",elem)[0].src=itemImg!=null?itemImg.src:"";$(".waypoint-item-title",elem)[0].innerHTML=itemTitle.innerHTML;$(".waypoint-artist-title",elem)[0].innerHTML=artistTitle.innerHTML;$(elem).unbind("click").click(function(){if(window.collectionTabs){if(isWishlist&&
window.collectionTabs.currentTab.name!=="wishlist")window.collectionTabs.switch("wishlist","wishlist-grid");else if(!isWishlist&&window.collectionTabs.currentTab.name!=="collection")window.collectionTabs.switch("collection","collection-grid");$("#track_play_waypoint, #track-play-waypoint-wrapper").removeClass("activated")}Dom.scrollToElement(itemContainer.filter(":visible"),-30)});$.waypoints("destroy");var isCollectionPage=!!window.collectionTabs;$(itemImg).waypoint(function(direction){var isActiveTab=
isCollectionPage&&(isWishlist&&window.collectionTabs.currentTab.name==="wishlist"||!isWishlist&&window.collectionTabs.currentTab.name==="collection");if(isActiveTab||!isCollectionPage)$("#track_play_waypoint, #track-play-waypoint-wrapper").toggleClass("activated",direction==="down");else $("#track_play_waypoint, #track-play-waypoint-wrapper").addClass("activated")}).waypoint(function(direction){var isActiveTab=isCollectionPage&&(isWishlist&&window.collectionTabs.currentTab.name==="wishlist"||!isWishlist&&
window.collectionTabs.currentTab.name==="collection");if(!handling)if(isActiveTab||!isCollectionPage)$("#track_play_waypoint, #track-play-waypoint-wrapper").toggleClass("activated",direction==="up");else $("#track_play_waypoint, #track-play-waypoint-wrapper").addClass("activated")},{offset:"80%"});if(window.collectionTabs)window.collectionTabs.nowPlayingCallback=function(){var tab=isWishlist?"wishlist":"collection";if(!Dom.inViewport(itemImg)||tab!==collectionTabs.currentTab.name)$("#track_play_waypoint, #track-play-waypoint-wrapper").addClass("activated");
else $("#track_play_waypoint, #track-play-waypoint-wrapper").removeClass("activated")}}var pageTitle=$("title").text();if(arg.newstate=="PLAYING"&&arg.oldstate!="PLAYING")pageTitle="\u25b6\ufe0e "+pageTitle;else pageTitle=pageTitle.replace("\u25b6\ufe0e ","");$("title").text(pageTitle);handling=false},_handle_time:function(arg){var tid=this._current_track_list_entry().id;if(this._play_elem_stash["time_elems_tid"]==null||this._play_elem_stash["time_elems_tid"]!=tid){this._play_elem_stash["time_elems_tid"]=
tid;this._play_elem_stash["time_elems_elapsed"]=this._play_elapsed_time_elements[tid]}var elapsedElems=this._play_elem_stash["time_elems_elapsed"];if(elapsedElems){var elapsed_str=Time.timeStr(arg.position);var i=0;for(var len=elapsedElems.length;i<len;i++)elapsedElems[i].innerHTML=elapsed_str}},_current_track_list_entry:function(){var trackinfo=this._playlist.get_track_info();return trackinfo}};return CollectionView}();
Player.TrackRowView=function(){function TrackRowView(playlist,elem,trackinfo,private_streaming){this._elem=elem;this._playlist=playlist;this._trackinfo=trackinfo||{};this._private_streaming=private_streaming;if(playlist){this._tracknum=playlist.add_track(trackinfo);this._trackinfo=playlist.get_track_info(this._tracknum)}else this._tracknum=nexttrack++;this._setup_elements();if(playlist){playlist.onstatechanged(this._state_changed,this);playlist.onplaylistchanged(this._handle_playlistchange,this)}}
TrackRowView.prototype={_state_changed:function(arg){var curTrack=this._playlist.get_track();var playing=curTrack==this._tracknum&&(arg.newstate=="PLAYING"||arg.newstate=="BUFFERING"||arg.newstate=="PAUSED");if(playing)YAHOO.util.Dom.addClass(this._elem,"current_track");else YAHOO.util.Dom.removeClass(this._elem,"current_track");if(curTrack==this._tracknum)switch(arg.newstate){case "PLAYING":case "BUFFERING":this._enable_button("pause");break;case "PAUSED":this._enable_button("play");break}else if(this._trackinfo.file)this._enable_button("play")},
findelem:function(classname){return Y.util.Dom.getElementsByClassName(classname,null,this._elem)[0]},play:function(){this._playlist.play_track(this._tracknum)},toString:function(){return"[TrackRowView: id\x3d"+this._elem.id+", title\x3d"+this._trackinfo.title+"]"},activeNodes:function(){if(window.MediaView&&MediaView.mode=="phone")return $(this._elem);return $(this._elems.playbutton)},_enable_button:function(playpause){var playButton=$(this._elems.playbutton);if(!playButton.length)return;playButton.removeClass("disabled");
if(this._playlist){var self=this;if(playpause=="play"){playButton.removeClass("playing");this.activeNodes().off("click.player").on("click.player",function(){self.play();return false})}else if(playpause=="pause"){playButton.addClass("playing");this.activeNodes().off("click.player").on("click.player",function(){self._playlist.playpause();return false})}}else{playButton.removeClass("playing");playButton.parent().attr("href",this._trackinfo.file)}},_setup_elements:function(){var elems={};this._elems=
elems;Templ.renderTableRow(this._elem,"_track_row",{tracknum:this._tracknum+1,track:this._trackinfo,private_streaming:this._private_streaming});this._elems.playbutton=this.findelem("play_status");this._elems.title=this.findelem("title");if(this._trackinfo.file)this._enable_button("play");else this.activeNodes().off("click.player").on("click.player",false);if(window.Fixup&&Fixup.trackRows)Fixup.trackRows(this._elem)},_handle_playlistchange:function(){correctinfo=this._playlist.get_track_info(this._trackinfo.tracknum);
if(!Player.TrackInfo.is_same(this._trackinfo,correctinfo)){this._trackinfo=correctinfo;this._setup_elements()}}};var nexttrack=0;return TrackRowView}();
Player.InlinePlayerView=function(){function InlinePlayerView(playlist,elem,options){this._playlist=playlist;this._options=options||{};this._elem=elem;this._elems={};this._tracklength=this._trackpos=this._loadpercent=0;var elems=this._elems;elems.next=this.find_elem("nextbutton");elems.prev=this.find_elem("prevbutton");elems.play=this.find_elem("playbutton");elems.title=this.find_elem("title");elems.title_link=this.find_elem("title_link");elems.prog=this.find_elem("progbar");elems.progthumb=this.find_elem("thumb");
elems.progfill=this.find_elem("progbar_fill");elems.message=this.find_elem("message");if(this._playlist){this._playlist.onstatechanged(this._handle_playstate,this);this._playlist.ontime(this._handle_time,this);this._playlist.onloaded(this._handle_loaded,this);this._playlist.ontrackchanged(this._handle_trackchange,this);this._playlist.onplaylistchanged(this._handle_playlistchange,this);var that=this;var volhandler=function(o,arg){that._handle_volumechange(arg)};this._playlist._player.onvolume(volhandler,
this);that=this;YAHOO.util.Event.addListener(elems.play,"click",this._handle_playclick,this,true);if(elems.next)YAHOO.util.Event.addListener(elems.next,"click",this._handle_nextclick,this,true);if(elems.prev)YAHOO.util.Event.addListener(elems.prev,"click",this._handle_prevclick,this,true);var thumbdrag=new YAHOO.util.DD(elems.progthumb);if(Browser.platform=="iphone"||window.MediaView&&MediaView.mode=="phone"){var touchstart=function(event$$0){function winwidth(){switch(window.orientation){case 0:case 180:return window.screen.width;
break;default:return window.screen.height;break}}function finishdrag(doseek){that._elem.removeEventListener("touchend",touchend);that._elem.removeEventListener("touchcancel",touchcancel);that._elem.removeEventListener("touchmove",touchmove);that._playlist.seeking=false;that._dragging=false;if(doseek)if(that._trackpos==that._tracklength)that._playlist.next_track();else if(that._trackpos==0&&rootPos<3)that._playlist.prev_track();else that._playlist.seek(that._trackpos);document.body.removeChild(seekText);
document.body.removeChild(seekMask)}function touchmove(event){if(startX==null){var thisY=event.changedTouches[0].screenY;if(Math.abs(event.changedTouches[0].screenY-initY)>Math.abs(event.changedTouches[0].screenX-initX)){finishdrag(false);return}}event.preventDefault();var thisX=event.changedTouches[0].screenX;thisX=thisX*1.4-viewWidth*.2;if(startX==null)startX=rootX=thisX;var curAmountPlayed=rootPos/that._tracklength;if(rootX!=desiredRootX){var movingAway=Math.abs(desiredRootX-thisX)>Math.abs(desiredRootX-
lastX);if(movingAway)if(rootX>desiredRootX)rootX--;else rootX++}var newPos=0;if(thisX<=rootX){if(rootX<=0)newPos=0;else newPos=thisX/rootX*rootPos;if(newPos<0)newPos=0}else{newPos=(thisX-rootX)/(viewWidth-rootX)*(that._tracklength-rootPos)+rootPos;if(newPos>that._tracklength)newPos=that._tracklength}that._trackpos=newPos;that._updateprog();var disp="";if(newPos==that._tracklength)disp="\x26gt;\x26gt;";else if(newPos==0&&rootPos<3)disp="\x26lt;\x26lt;";else disp=Time.timeStr(that._trackpos);seekText.innerHTML=
disp;lastX=thisX}function touchend(event){finishdrag(true)}function touchcancel(event){finishdrag(false)}if($(event$$0.target).closest(".playbutton, .nextbutton, .prevbutton").length)return;var initX=event$$0.touches[0].screenX;var initY=event$$0.touches[0].screenY;var rootPos=that._trackpos||0;var startX=null;var rootX=null;var viewWidth=winwidth();var desiredRootX=Math.round(viewWidth*rootPos/that._tracklength);var lastX=startX;var seekMask=document.createElement("div");var seekText=document.createElement("div");
seekMask.className="seekMask";seekText.className="seekText";YAHOO.util.Dom.addClass(seekMask,"seekmask");YAHOO.util.Dom.addClass(seekText,"seektext");document.body.appendChild(seekMask);document.body.appendChild(seekText);var dispx=window.pageXOffset;var dispy=window.pageYOffset;var disph=window.innerHeight;var dispw=window.innerWidth;seekMask.style.width=dispw+"px";seekMask.style.height=disph+"px";seekMask.style.left=dispx+"px";seekMask.style.top=dispy+"px";seekText.style.width=dispw+"px";seekText.style.height=
disph+"px";seekText.style.left=dispx+"px";seekText.style.top=dispy+"px";that._playlist.seeking=true;that._dragging=true;that._elem.addEventListener("touchmove",touchmove);that._elem.addEventListener("touchend",touchend);that._elem.addEventListener("touchcancel",touchcancel)};that=this;if(!!that._elem)that._elem.addEventListener("touchstart",touchstart)}thumbdrag.on("startDragEvent",function(ev){thumbdrag.resetConstraints();thumbdrag.setYConstraint(0,0);thumbdrag.setXConstraint(0,elems.prog.offsetWidth-
elems.progthumb.offsetWidth+1);this._dragging=true;this._playlist.seeking=true;this._dragoffset=ev.x-Y.util.Dom.getX(this._elems.progthumb)},this,true);thumbdrag.on("dragEvent",function(ev){var progLeft=Y.util.Dom.getX(this._elems.prog);var progRange=this._elems.prog.offsetWidth-this._elems.progthumb.offsetWidth;var pos=ev.e.clientX-progLeft-this._dragoffset;if(pos<0)pos=0;else if(pos>progRange)pos=progRange;pos*=this._tracklength/progRange;this._trackpos=pos;this._updateprog()},this,true);thumbdrag.on("endDragEvent",
function(ev){this._playlist.seek(this._trackpos);this._dragging=false;this._playlist.seeking=false},this,true);this._showhide_nextprev()}else{var trackinfo=Player.tralbum_data.trackinfo[0];elems.play.parentNode.href=trackinfo.file}}InlinePlayerView.prototype={_handle_playclick:function(evt){Y.util.Event.stopEvent(evt);this._playlist.playpause()},_handle_nextclick:function(evt){Y.util.Event.stopEvent(evt);if(!$(this._elems.next).hasClass("hiddenelem"))this._playlist.next_track()},_handle_thumb_grab:function(){},
_handle_prevclick:function(evt){Y.util.Event.stopEvent(evt);if(!$(this._elems.prev).hasClass("hiddenelem"))this._playlist.prev_track()},_handle_playstate:function(arg){switch(arg.newstate){case "PLAYING":YAHOO.util.Dom.removeClass(this._elems.play,"busy");YAHOO.util.Dom.addClass(this._elems.play,"playing");TitlePlayIndicator.play();break;case "BUFFERING":case "BUSY":YAHOO.util.Dom.removeClass(this._elems.play,"playing");YAHOO.util.Dom.addClass(this._elems.play,"busy");break;default:YAHOO.util.Dom.removeClass(this._elems.play,
"busy");YAHOO.util.Dom.removeClass(this._elems.play,"playing");TitlePlayIndicator.stop();break}},_handle_trackchange:function(trackinfo){this._showhide_nextprev();this._trackinfo=trackinfo;if(!this._options.onetrack){$(this._elem).find(".title-section").removeClass("hiddenelem");this._elems.title.innerHTML=Text.escapeHtml(trackinfo.title)}else if(this._elems.message)if(trackinfo.encoding_error){var text=trackinfo.encoding_error;text=Y.lang.JSON.stringify(text);text=text.slice(1,text.length-1);text=
Text.escapeHtml(text);var html='\x3ca style\x3d"color:red" href\x3d"#" onclick\x3d"Tracks.encoding_error(\''+text+"'); return false;\"\x3eupload error\x3c/a\x3e";Log.debug(html);YAHOO.util.Dom.removeClass(this._elems.message,"hiddenelem");this._elems.message.innerHTML=html}else if(trackinfo.encoding_pending){YAHOO.util.Dom.removeClass(this._elems.message,"hiddenelem");var prog="processing...";this._elems.message.innerHTML=Text.escapeHtml(prog)}else YAHOO.util.Dom.addClass(this._elems.message,"hiddenelem");
if((Browser.platform=="iPhone"||window.MediaView&&MediaView.mode=="phone")&&$(this._elem).find(".video-link")[0])if(trackinfo.video_id){var video_link=$(this._elem).find(".video-link");video_link.attr("data-href-mobile",trackinfo.video_mobile_url);video_link.attr("href","#");video_link.attr("data-caption",trackinfo.video_caption);video_link.removeClass("is-hidden")}else $(this._elem).find(".video-link").addClass("is-hidden");this._set_title_link(trackinfo.title_link);this._tracklength=this._playlist.get_track_info().duration||
trackinfo.duration||0;this._zero_time()},_set_title_link:function(href){var link=this._elems.title_link;if(!link)return;var title=this._elems.title;link.href=href;if(href){if(title.parentNode!=link){title.parentNode.insertBefore(link,title);link.appendChild(title)}}else if(title.parentNode==link){link.parentNode.insertBefore(title,link);link.parentNode.removeChild(link)}},_handle_volumechange:function(arg){this._display_volume(arg.volume)},_handle_playlistchange:function(){var trackinfo=this._playlist.get_track_info();
if(trackinfo)this._handle_trackchange(trackinfo)},_zero_time:function(){this._trackpos=0;this._updateprog()},_handle_time:function(arg){if(!this._dragging&&this._playlist.get_state()==="PLAYING")this._trackpos=arg.position;if(arg.duration)if(this._tracklength!=arg.duration)this._tracklength=arg.duration;this._updateprog()},_showhide_nextprev:function(){var cur=this._playlist.get_track();var first=this._playlist.first_playable_track;var last=this._playlist.last_playable_track;if(this._elems.prev)this.showhide_elem(this._elems.prev,
first>=0&&cur>first);if(this._elems.next)this.showhide_elem(this._elems.next,last>=0&&cur<last)},_handle_loaded:function(percent){this._loadpercent=percent;this._updateprog()},_updateprog:function(){var fillwidth=this._elems.prog.offsetWidth;var thumbrange=fillwidth-this._elems.progthumb.offsetWidth;var thumbpos=this._tracklength?this._trackpos/this._tracklength*thumbrange:0;this._elems.progthumb.style.left=thumbpos+"px";this._elems.progfill.style.width=this._loadpercent+"%";$(this._elem).find(".time.hiddenelem").removeClass("hiddenelem");
$(this._elem).find(".time_elapsed").text(Time.timeStr(this._trackpos));$(this._elem).find(".time_total").text(Time.timeStr(this._tracklength))},_display_volume:function(value){if(this._voltimer){clearTimeout(this._voltimer);this._voltimer=null}var volbars=this._elems["volbars"];if(!volbars){volbars=document.createElement("div");YAHOO.util.Dom.addClass(volbars,"volumebars");var barhtml='\x3cdiv class\x3d"volumebar"\x3e\x3c/div\x3e';var inner="";for(var i=0;i<12;i++)inner+=barhtml;inner+='\x3cimg class\x3d"volumebarimg" src\x3d"/img/volbang.png"\x3e';
inner+='\x3cimg class\x3d"volumebarimg" src\x3d"/img/volbang.png"\x3e';inner+='\x3cimg class\x3d"volumebarimg" src\x3d"/img/volbang.png"\x3e';inner+='\x3cimg class\x3d"volumebarimg" src\x3d"/img/vol1.png"\x3e';volbars.innerHTML=inner;this._elems["volbars"]=volbars;document.body.appendChild(volbars)}YAHOO.util.Dom.removeClass(volbars,"hiddenelem");var children=volbars.childNodes;for(i=0;i<children.length;i++)if(i/children.length<value)YAHOO.util.Dom.removeClass(children[i],"hiddenelem");else YAHOO.util.Dom.addClass(children[i],
"hiddenelem");var that=this;var hider=function(){that._hide_volume()};this._voltimer=setTimeout(hider,3E3)},_hide_volume:function(){U.addClass(this._elems["volbars"],"hiddenelem");this._voltimer=null},find_elem:function(classname){return Y.util.Dom.getElementsByClassName(classname,null,this._elem)[0]},showhide_elem:function(elem,bShow){if(bShow)U.removeClass(elem,"hiddenelem");else U.addClass(elem,"hiddenelem")},toString:function(){if(this._trackinfo)return"[InlinePlayerView: id\x3d"+this._elem.id+
", title\x3d"+this._trackinfo.title+"]";else return"[InlinePlayerView: id\x3d"+this._elem.id+", no track]"}};return InlinePlayerView}();
var FacebookUtils={_sdkLoadPromise:null,resizeTimer:null,initSDK:function(){if(FacebookUtils._sdkLoadPromise)return FacebookUtils._sdkLoadPromise;var dfd=new $.Deferred;window.fbAsyncInit=function(){Log.debug("Facebook SDK loaded");FB.init({appId:"165661066782720",status:true,cookie:true,xfbml:false});dfd.resolve()};$(document.body).prepend('\x3cdiv id\x3d"fb-root"\x3e\x3c/div\x3e');fbLocales={"en":"en_US","fr":"fr_FR","ja":"ja_JP","qq":"ja_JP"};var fbLocale;if("Translate"in window&&"locale"in Translate)fbLocale=
fbLocales[Translate.locale];if(!fbLocale){fbLocale="en_US";Log.server("Facebook SDK couldn't determine FB locale","error")}$.cachedScript("//connect.facebook.net/"+fbLocale+"/all.js");return FacebookUtils._sdkLoadPromise=dfd.promise()},initFbApp:function(){FacebookUtils.initSDK().done(function(){FacebookUtils.reportResize()})},onGeneric:function(response){Log.note("some sort of event")},reportResize:function(){if(FacebookUtils.resizeTimer)clearTimeout(FacebookUtils.resizeTimer);FacebookUtils.resizeTimer=
setTimeout(function(){if($("body.fb").height()){var dims={height:$("body.fb").height()+40,width:$("body.fb").width()};Log.note("reportResize cb: resize timer: "+FacebookUtils.resizeTimer+" setting height FB canvas tab to: "+dims.height+","+dims.width);FB.Canvas.setSize(dims)}clearTimeout(FacebookUtils.resizeTimer);FacebookUtils.resizeTimer=null},50)},inAppNav:function(pageType,paths,params){var path=pageType;if(paths&&paths.length>0)path+="/"+paths.join("/");if(FacebookData&&FacebookData.referer)params["ref"]=
FacebookData.referer;SimpleForm.submit("/fb_tab/"+path,params,"GET");if(FacebookData){$("body").hide();FB.Canvas.scrollTo(0,0)}},correctSrollThen:function(patchYui,_this,interceptedFn){var args=Array.prototype.slice.call(arguments);args.shift(),args.shift(),args.shift();FacebookData.positionInfo=null;FB.Canvas.getPageInfo(function(info){FacebookData.positionInfo=info;if(patchYui){_getDocumentScrollTop=Y.util.Dom.getDocumentScrollTop;_getViewportHeight=Y.util.Dom.getViewportHeight;_getDocumentHeight=
Y.util.Dom.getDocumentHeight;var iScrollTop=parseInt(info.scrollTop);Y.util.Dom.getDocumentScrollTop=function(){return iScrollTop};var iClientHeight=parseInt(info.clientHeight);Y.util.Dom.getViewportHeight=function(){return iClientHeight};Y.util.Dom.getDocumentHeight=function(){return iClientHeight*3}}if(interceptedFn){el=interceptedFn.apply(_this,args);if(el)FacebookUtils.fixCentering(el);if(patchYui){Y.util.Dom.getDocumentScrollTop=_getDocumentScrollTop;Y.util.Dom.getViewportHeight=_getViewportHeight;
Y.util.Dom.getDocumentHeight=_getDocumentHeight}return el}})},fixCentering:function(el){if(el.element)el=el.element;if(window.FacebookData.positionInfo){var scrollTop=parseInt(FacebookData.positionInfo.scrollTop);$("#"+el.id).css({top:scrollTop});FB.Canvas.scrollTo(0,scrollTop)}},xxx:null};
var GPlusUtils={_sdkLoadPromise:null,initSDK:function(fn){if(GPlusUtils._sdkLoadPromise)return GPlusUtils._sdkLoadPromise;window.___gcfg={parsetags:"explicit"};var promise=$.cachedScript("https://apis.google.com/js/plusone.js").promise().done(function(){Log.debug("Google Plus SDK loaded")});return GPlusUtils._sdkLoadPromise=promise},xxx:null};
var EmailIMUtils={alreadyStattedFromFocus:false,onFocus:function(){if(!self.alreadyStattedFromFocus){Stats.record({kind:"click",click:"email_tralbum"});self.alreadyStattedFromFocus=true}return false},xxx:null};
var SocialControls={initFromDOM:function(root){var self=this;var $root=$(root);var $containers=$root.add(".social-controls",$root).filter(".social-controls");$containers.each(function(){var $cont=$(this);self._initControlsOfType($cont.find(".facebook-like-ctrl"),"renderFacebookLike");self._initControlsOfType($cont.find(".facebook-share-ctrl"),"renderFacebookShare");self._initControlsOfType($cont.find(".twitter-ctrl"),"renderTwitterShare");self._initControlsOfType($cont.find(".tumblr-ctrl"),"renderTumblrShare");
self._initControlsOfType($cont.find(".gplus-ctrl, .gplus-plusone-ctrl"),"renderGPlusPlusOne");self._initControlsOfType($cont.find(".gplus-share-ctrl"),"renderGPlusShare");self._initControlsOfType($cont.find(".email-ctrl"),"renderEmailShare")})},renderFacebookLike:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,send:"false",layout:"button_count",width:"90","show-faces":"false"};data=$.extend(dataDefaults,data);var $like=$('\x3cdiv class\x3d"fb-like"\x3e\x3c/div\x3e').appendTo($elem);
$.each(data,function(key,val){if(key=="url")key="href";$like.attr("data-"+key,val)});FacebookUtils.initSDK().done(function(){FB.XFBML.parse($elem[0]);self._registerFBEventHandlers(elem,data);$elem.data("scResolvedData",data);Log.debug("SocialControls: rendered Facebook Like button")})},renderFacebookShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={u:data.url};var isDesktop=!window.MediaView||MediaView.mode==
"desktop";var fbUrl=Url.addQueryParams(isDesktop?"http://www.facebook.com/sharer.php":"http://m.facebook.com/sharer.php",params);var $fbLink=$elem.find(".facebook-link").first();if(!$fbLink.length)$fbLink=$('\x3ca class\x3d"facebook-link" title\x3d"Share on Facebook"\x3eShare\x3c/a\x3e').appendTo($elem);$fbLink.attr({"href":fbUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(fbUrl,"share_fb","toolbar\x3d0,status\x3d0,width\x3d626,height\x3d436");ev.preventDefault()}});
Log.debug("SocialControls: rendered Facebook share button")},renderTwitterShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={url:data.url};var isDesktop=!window.MediaView||MediaView.mode=="desktop";if(data.text)params.text=data.text;var twUrl=Url.addQueryParams("https://twitter.com/intent/tweet",params);var $twLink=$elem.find(".twitter-link").first();if(!$twLink.length){var tweet=TM("Tweet");var shareOnTwitter=
TM("Share on Twitter");$twLink=$('\x3ca class\x3d"twitter-link" title\x3d"'+shareOnTwitter+'"\x3e'+tweet+"\x3c/a\x3e").appendTo($elem)}$twLink.attr({"href":twUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(twUrl,"share_tw","toolbar\x3d0,status\x3d0,width\x3d550,height\x3d450");ev.preventDefault()}});Log.debug("SocialControls: rendered Twitter share button")},renderTumblrShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,
type:"link"};data=$.extend(dataDefaults,data);var params={};if(data.type=="audio"){params.external_url=data.url;if(data.text)params.caption=data.text}else{params.url=data.url;if(data.title)params.name=data.title;if(data.text)params.description=data.text}var tmUrl=Url.addQueryParams("http://www.tumblr.com/share/"+data.type,params);var $tmLink=$elem.find(".tumblr-link").first();if(!$tmLink.length)$tmLink=$('\x3ca class\x3d"tumblr-link" title\x3d"Share on Tumblr"\x3eShare on Tumblr\x3c/a\x3e').appendTo($elem);
$tmLink.attr({"href":tmUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on")});Log.debug("SocialControls: rendered Tumblr share button")},renderGPlusPlusOne:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href,size:"medium",annotation:"none"};data=$.extend(dataDefaults,data);var params={};$.each(data,function(key,val){if(key=="url")key="href";params[key]=val});params.callback=function(info){self._statClick(data,info.state)};GPlusUtils.initSDK().done(function(){gapi.plusone.render($elem[0],
params);Log.debug("SocialControls: rendered Google Plus +1 button")})},renderGPlusShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={url:data.url};var isDesktop=!window.MediaView||MediaView.mode=="desktop";var gpUrl=Url.addQueryParams("https://plus.google.com/share",params);var $gpLink=$elem.find(".gplus-link").first();if(!$gpLink.length)$gpLink=$('\x3ca class\x3d"gplus-link" title\x3d"Share on Google+"\x3eGoogle+\x3c/a\x3e').appendTo($elem);
$gpLink.attr({"href":gpUrl,"target":"_blank"}).click(function(ev){self._statClick(data,"on");if(isDesktop){window.open(gpUrl,"share_gp","menubar\x3d0,toolbar\x3d0,resizable\x3d1,scrollbars\x3d1,height\x3d460,width\x3d600");ev.preventDefault()}});Log.debug("SocialControls: rendered G+ share button")},renderEmailShare:function(elem,data){var self=this;var $elem=$(elem);var dataDefaults={url:location.href};data=$.extend(dataDefaults,data);var params={"body":data.url};if(data.text)params.body=data.text+
"\r\n\r\n"+params.body;if(data.subject)params.subject=data.subject;var emailUrl="mailto:?"+Url.joinQuery(params);var $emailLink=$elem.find(".email-link").first();if(!$emailLink.length)$emailLink=$('\x3ca class\x3d"email-link" title\x3d"Share via email"\x3eEmail\x3c/a\x3e').appendTo($elem);$emailLink.attr({"href":emailUrl}).click(function(ev){self._statClick(data,"on");setTimeout(function(){location.href=emailUrl},100);return false});Log.debug("SocialControls: rendered Email share button")},_initControlsOfType:function(elems,
renderMethodName){var self=this;$(elems).each(function(){self[renderMethodName](this,self._getData(this))})},_getData:function(elem,defaults){var $elem=$(elem);var elemData=$elem.data();var shareData=$elem.closest(".social-controls").data();return $.extend(defaults||{},shareData,elemData)},_statClick:function(data,eventType){var clickName=null;if(eventType=="on")clickName=data.stat||data.statOn;else if(eventType=="off")clickName=data.statOff;if(clickName)Stats.record({kind:"click",click:clickName})},
_initedFBEvents:false,_registerFBEventHandlers:function(){var self=this;if(!this._initedFBEvents){FacebookUtils.initSDK().done(function(){FB.Event.subscribe("edge.create",$.proxy(self,"_handleFBEvent","on"));FB.Event.subscribe("edge.remove",$.proxy(self,"_handleFBEvent","off"))});this._initedFBEvents=true}},_handleFBEvent:function(eventType,href,widget){var self=this;Log.debug("SocialControls: got Facebook event; eventType: "+eventType+"; href: "+href+"; widget: ",widget);if(!widget||!widget.dom||
!widget.dom.tagName){Log.error("SocialControls: can't stat FB Like/Unlike because event parameter 'widget' is missing or has changed");return}var data=$(widget.dom).closest(".facebook-like-ctrl").data("scResolvedData");if(!data||href!=data.url)return;self._statClick(data,eventType)},xxx:null};
var Footer={enhance:function(){this.initViewSwitcher($("#pgFt .view-switcher"))},initViewSwitcher:function(elems){var $elems=$(elems);if(MediaView.initType=="client"&&MediaView.mode=="desktop"&&Cookie.get("mvp")!="d")$elems.filter(".desktop").hide();$elems.on("click",function(){var cookieVal=$(this).hasClass("phone")?"d":"p";Cookie.set("mvp",cookieVal,60*60*24*30*3);location.href=Url.addQueryParams(location.href,{".reload":(new Date).getTime()});return false})},zzz:null};
$(document).ready($.proxy(Footer,"enhance"));
var WebappSelector=function(){if(typeof $!=="undefined")$(document).ready(function(){setTimeout(function(){WebappSelector.create_ui(window.siteroot,Identities.isAdmin())},1E3)});return{backendname:"unknown webapp",bc_cookie_set:false,siteroot:null,create_ui:function(siteroot,show_selector){if((show_selector||Cookie.get("bc_webapp"))&&siteroot){WebappSelector.siteroot=siteroot;var displaytext=WebappSelector.backendname;if(Cookie.get("bc_webapp")){WebappSelector.backendname=Cookie.get("bc_webapp");
WebappSelector.bc_cookie_set=true;displaytext=WebappSelector.backendname+" (forced)"}else if(Cookie.get("BACKENDID"))WebappSelector.backendname=displaytext=Cookie.get("BACKENDID");WebappSelector.refresh_ui(displaytext)}else{$("#pgFt").one("dblclick",function(event){if(event.target.tagName!="A"){WebappSelector.create_ui(siteroot,true);return false}});$("#pgFt").on("touchend",function(event){var now=(new Date).getTime();var last=$(this).data("lastTap")||0;if(now-last<500){$(this).off("touchend");WebappSelector.create_ui(siteroot,
true);return false}$(this).data("lastTap",now)})}},refresh_ui:function(text){var $link=$(".webapp-selector-link").off("click");var $nonMenubarLinks=$link.filter(".webapp-selector-ui .webapp-selector-link, .pg-ft-nav.connect .webapp-selector-link");if(!$nonMenubarLinks.length){var $nonMenubarLink=$('\x3ca href\x3d"#" class\x3d"webapp-selector-link"\x3e').text(text);$(".webapp-selector-ui").css("display","inline-block").append($nonMenubarLink);$(".pg-ft-nav.connect").append("\x3cli\x3e").append($('\x3cli class\x3d"headroom"\x3e').append($nonMenubarLink.clone(true)));
$(".pgft-phone .footer-extras").removeClass("hidden");$("#pgFt-inner").addClass("webapp-selector-visible");$link=$(".webapp-selector-link")}$link.text(text);$link.on("click",function(ev){WebappSelector.show_form(ev);return false})},show_form:function(){var buttons=[];if(WebappSelector.bc_cookie_set)buttons.push({text:"Default webapp",click:function(){var cookie_domain=WebappSelector.cookie_domain();Cookie.clear("bc_webapp","/",cookie_domain,false);WebappSelector.refresh_ui("reloading...");$(this).dialog("close");
window.location.reload()}});buttons.push({text:"OK",click:function(){var sel=elt("webappselectordialog.item");var selected_backend=sel.options[sel.selectedIndex].value;var cookie_domain=WebappSelector.cookie_domain();Cookie.set("bc_webapp",selected_backend,null,"/",cookie_domain,false);WebappSelector.refresh_ui("reloading...");$(this).dialog("close");window.location.reload()}});NuDialog.alertHTML("Select webapp backend",'\x3cselect id\x3d"webappselectordialog.item" style\x3d"width:100%"\x3e\x3c/select\x3e',
{buttons:buttons});WebappSelector.populate_machine_list()},populate_machine_list:function(){var machines=[];var serverSpecs=$("#webapp-selector-ui").data("webapps");Iter.each(serverSpecs,function(spec){for(var i=spec.hostnameRange[0];i<=spec.hostnameRange[1];i++){var hostname=spec.hostnameBase+(i<10?"0"+i:i);Iter.each(spec.appNumbers,function(appNumber){machines.push(hostname+"-"+appNumber)})}});var sel=elt("webappselectordialog.item");sel.innerHTML="";var opt;for(var i$$0=0;i$$0<machines.length;i$$0++){opt=
document.createElement("option");opt.value=machines[i$$0];opt.innerHTML=Text.escapeHtml(machines[i$$0]);if(machines[i$$0]==WebappSelector.backendname)opt.selected=true;sel.appendChild(opt)}},cookie_domain:function(){var cookie_domain=window.location.hostname;if(window.location.hostname.indexOf(WebappSelector.get_siteroot())>-1)cookie_domain=WebappSelector.get_siteroot();return cookie_domain},get_siteroot:function(){var siteroot=WebappSelector.siteroot;if(siteroot){siteroot=siteroot.replace("http://",
"").replace("https://","");if(siteroot.indexOf(":")>-1)siteroot=siteroot.substr(0,siteroot.indexOf(":"));return siteroot}return""}}}();
var NuDialog=function(){function mergeOptions(options){var classOverride={};if("string"===typeof options.dialogClass)classOverride.dialogClass=NuDialog.DEFAULT_OPTIONS.dialogClass+" "+options.dialogClass;else if($.isArray(options.dialogClass))classOverride.dialogClass=NuDialog.DEFAULT_OPTIONS+" "+options.dialogClass.join(" ");var merged=$.extend({},NuDialog.DEFAULT_OPTIONS);if(MediaView.mode==="phone")$.extend(merged,NuDialog.MOBILE_OPTIONS);$.extend(merged,options,classOverride);return merged}$(document).on("dialogclose",
function(){$.event.trigger("bc_dialog_close")});$(document).on("dialogopen",function(){$.event.trigger("bc_dialog_open")});return{DEFAULT_OPTIONS:{dialogClass:"nu-dialog",draggable:true,width:"35em",position:"center",modal:true,buttons:{"OK":function(){$(this).dialog("close")}},close:function(){$(this).remove()},defaultFocus:function(){var buttons=$("div.nu-dialog").find("button");if(buttons)if(buttons.length==1)buttons.focus();else{var defaultButton=$("div.nu-dialog").find("button.default");if(defaultButton&&
defaultButton.length==1)defaultButton.focus()}else $("div.nu-dialog").focus()}},MOBILE_OPTIONS:{width:300,draggable:false},alert:function(title,message,dialogOptions,messageIsRawHTML){var opts=dialogOptions||NuDialog.DEFAULT_OPTIONS;dialogOptions=mergeOptions($.extend({title:title,open:function(){if(opts.defaultFocus)opts.defaultFocus()}},dialogOptions));return $("\x3cdiv\x3e")[messageIsRawHTML?"html":"text"](message).dialog(dialogOptions)},alertHTML:function(title,messageHTML,dialogOptions){return NuDialog.alert(title,
messageHTML,dialogOptions,true)},showXHRError:function(json){if(window.isDebug)window.alert("FIXME: NuDialog.showXHRError is deprecated. Now code should use API endpoints and .showAPIError() instead.");if(json.error===true){var ax=json.exception&&json.exception.indexOf("ALERT: ");var dialogParams={};if(ax&&ax>=0){json.alert_text=json.exception.slice(ax+7);dialogParams.title="Note"}else{json.browser=Browser;dialogParams.title="Error"}NuDialog.showTemplate("xhr_error_dialog",json,dialogParams);return true}return false},
showAPIError:function(json){if(json.error){NuDialog.alert("API Error",json.error_message||"Unknown error.");return true}return false},showNetworkError:function(xhr,status,error){NuDialog.alert("Network Error","There was a network error. Please try again.\n(Status: "+status+")")},showTemplate:function(templateName,hash,dialogOptions){dialogOptions=mergeOptions(dialogOptions||{});hash=hash||{};return $("\x3cdiv\x3e").renderLiquid(templateName,hash).dialog(dialogOptions)},showViewModel:function(viewModel){var template=
viewModel.templateName();var hash="function"===typeof viewModel.templateHash?viewModel.templateHash():{};var dialogOptions="function"===typeof viewModel.dialogOptions?viewModel.dialogOptions():{};var $dialog=$("\x3cdiv\x3e").renderLiquid(template,hash);if("function"===typeof viewModel.$dialog)viewModel.$dialog($dialog);ko.applyBindings(viewModel,$dialog[0]);dialogOptions=mergeOptions(dialogOptions);$dialog.dialog(dialogOptions);return $dialog}}}();
            if ('undefined' === typeof window.Templ) {
                Log.server('Premature template registration: ' + ["xhr_error_dialog"], 'warn');
            }
            else {
                Templ.register({"xhr_error_dialog":["<div id=\"xhr-error-dialog\">\r\n    ",{"blocks":[{"attachment":["\r\n    <p>\r\n        ",{"filters":[["h",[]]],"name":"alert_text","type":"variable"},"\r\n    </p>\r\n    "],"expression":"alert_text ","type":"ncondition"},{"attachment":["\r\n    <h4>We regret to inform you that something odd happened.</h4>\r\n    \r\n    <p>\r\n        Please excuse the error.\r\n        ",{"blocks":[{"attachment":["\r\n            Artists: please  \r\n            <a href=\"/contact?subj=",{"filters":[["u",[]],["a",[]]],"name":"error_type","type":"variable"},"&amp;msg=",{"filters":[["a",[]]],"name":"error_for_email","type":"variable"},"\">click here</a> to let us know about the error. We'll get right on it.\r\n        "],"expression":"member_of_current_band ","type":"ncondition"}],"type":"ef"},"\r\n    </p>\r\n    \r\n    <div class=\"dlg_errorInfo\">\r\n    Some interesting stuff (to us):\r\n    <ul>\r\n        <li>url: ",{"filters":[["h",[]]],"name":"url","type":"variable"},"</li>\r\n        <li>error: ",{"filters":[["h",[]]],"name":"exception","type":"variable"},"</li>\r\n        <li>browser: ",{"filters":[["h",[]]],"name":"browser.make","type":"variable"}," ",{"filters":[["join",["'.'"]],["h",[]]],"name":"browser.version","type":"variable"}," ",{"filters":[["h",[]]],"name":"browser.platform","type":"variable"},"</li>\r\n        <li>date: ",{"filters":[["h",[]]],"name":"date","type":"variable"},"</li>\r\n        ",{"blocks":[{"attachment":["\r\n        <li>user: ",{"filters":[["h",[]]],"name":"user","type":"variable"},"</li>\r\n        "],"expression":"user ","type":"ncondition"}],"type":"ef"},"\r\n        <li>host: ",{"filters":[["h",[]]],"name":"host","type":"variable"},"</li>\r\n    </div>\r\n    "],"type":"else_ncondition"}],"type":"ef"},"\r\n</div>"]});
            }
        ;
$(document).ready(function(ev){var pagedata=$("#pagedata").data("blob");var cfg=pagedata.cfg||{};var match_long_url=new RegExp(TemplGlobals.siteroot+"/contact");$("a[href*\x3d'contact']").each(function(){var current_url=$(this).attr("href");if(current_url.match(match_long_url)||current_url.match(/^\/contact/))$(this).click(function(ev){ev.preventDefault();var dr=new RegExp(TemplGlobals.sitedomain);var is_custom_domain=window.location.host.match(dr)===null;if(MediaView.mode=="phone"||is_custom_domain||
Browser.make=="ie"){current_url=Url.addQueryParams(current_url,{p:location.href});window.open(current_url)}else{var q=Url.toHash(current_url).search;var params=Url.parseQuery(q);var fields=Contact.message_defaults(params,cfg);Contact.show_form_dlg(fields,ev)}})})});
var RecaptchaWrapper={_sdkLoadPromise:null,_gapi:new $.Deferred,_widget_id:null,initSDK:function(){if(RecaptchaWrapper._sdkLoadPromise)return RecaptchaWrapper._sdkLoadPromise;var gbootstrap=$.cachedScript("https://www.google.com/recaptcha/api.js?onload\x3dgcaptchaDependencyOnload\x26render\x3dexplicit").done(function(){Log.debug("ReCaptcha bootstrap loaded")});return RecaptchaWrapper._sdkLoadPromise=$.when(gbootstrap,RecaptchaWrapper._gapi)},resolve_gapi_deferred:function(){Log.debug("ReCaptcha API loaded");
RecaptchaWrapper._gapi.resolve()},public_key:function(){var pagedata=$("#pagedata").data("blob");return pagedata&&pagedata.recaptcha_public_key},is_rendered:function(){return typeof $("#are-you-human iframe").attr("id")!=="undefined"},render:function(){if(RecaptchaWrapper.is_rendered()){Log.debug("resetting");RecaptchaWrapper.reset()}else RecaptchaWrapper._widget_id=grecaptcha.render("are-you-human",{sitekey:RecaptchaWrapper.public_key(),theme:"white",callback:function(){Log.debug("Valid ReCaptcha response");
Form.validate.clear_alert($("#contact\\.captcha_alert"));$(document).trigger("human-detected")}});Contact.enable_the_buttons()},reset:function(){grecaptcha.reset(RecaptchaWrapper._widget_id)},fail:function(){Form.validate.show_alerts({field:"contact.captcha",reason:"recaptcha-not-reachable"},false)},safe_destroy:function(){if(!Contact.use_recaptcha())return;$(".pls-container").remove();RecaptchaWrapper.reset()},xxx:null};var gcaptchaDependencyOnload=function(){RecaptchaWrapper.resolve_gapi_deferred()};
var Contact={show_form:function(params,ev){var fields=params;var dr=new RegExp(TemplGlobals.sitedomain);var is_custom_domain=window.location.host.match(dr)===null;if(MediaView.mode=="phone"||is_custom_domain){fields["p"]=location.href;var current_url="/contact?"+Url.joinQuery(fields);window.open(current_url)}else{fields=Contact.message_defaults(params);Contact.show_form_dlg(fields,ev)}},validation:{sections:{contact:{prefix:"contact"}},messages:{"contact.generic":{generic:"Sorry, there was an unexpected problem. Please try that again.",
badBand:"Sorry, there was an unexpected problem. Please refresh the page and try again."},"contact.name":{missingValue:"please enter your name"},"contact.email":{missingValue:"please enter your email address",badFormat:"that's not a valid email address",noFacebook:"sorry, Facebook addresses are not supported.\x3cbr/\x3eplease enter a different email address."},"contact.message":{missingValue:"please enter your message",stringLength:"that message is too long"},"contact.fan_urls":{missingValue:"please provide your Fan Page URL",
badFormat:"hmm, this Fan Page URL doesn't look right...",badFormats:"hmm, not all of these Fan Page URLs look right..."},"contact.codes":{missingValue:"please provide your track/album code",badFormat:"hmm, this doesn't look like a Bandcamp track/album code...",badFormats:"hmm, not all of these track/album codes look right..."},"contact.fb_urls":{missingValue:"please provide your Facebook Page URL",badFormat:"hmm, this Facebook Page URL doesn't look right...",badFormats:"hmm, not all of these Facebook Page URLs look right..."},
"contact.band_urls":{missingValue:"please provide your Bandcamp URL",badFormat:"hmm, this Bandcamp URL doesn't look right...",badFormats:"hmm, not all of these Bandcamp URLs look right..."},"contact.dls":{missingValue:"please provide your download link",badFormat:"hmm, this download link doesn't look right...",badFormats:"hmm, not all of these download links look right..."},"contact.preorders":{missingValue:"please provide a link to the album's page",badFormat:"hmm, this album link doesn't look right...",
badFormats:"hmm, not all of these album links look right..."},"contact.original_email":{missingValue:"please enter the email address currently linked to the account",badFormat:"that's not a valid email address"},"contact.signup_date":{missingValue:"please enter the date you think you signed up"},"contact.purchased_item_url":{missingValue:"please provide the url of the item you purchased",badFormat:"hmm, this Bandcamp URL doesn't look right..."},"contact.purchase_email":{missingValue:"please enter the email address you think you used to purchase the item",
badFormat:"that's not a valid email address"},"contact.captcha":{"incorrect-captcha-sol":"please try again","captcha-timeout":"please try again","recaptcha-not-reachable":"apologies \u2014 human detection service unavailable, please try again later","malformed-api-response":"apologies \u2014 human detection service malfunctioning, please try again later","invalid-request-cookie":"please try again","missing-response":"please fill out the captcha"}}},subjects:{"Help setting up my Facebook app":{band_urls:"",
fb_urls:""},"Help! I can\u2019t log in!":{band_urls:"",original_email:"",signup_date:""},"Help! I never received my receipt.":{purchased_item_url:"",purchase_email:""},"Expired download":{dls:""},"Download code trouble":{codes:""},"Help with my Fan Account":{fan_urls:""},"Pre-order link not received":{preorders:""},"Fulfillment Inquiry":{band_urls:""},"Payment setup trouble":{band_urls:""}},message_defaults:function(params,cfg){var t;var band_id=(t=params["b"])&&(t=parseInt(t))?t:1;var from_order_details=
null;if(cfg.zendesk_help_docs&&location.href.match(/\/order_details\?(sig|payment_id|gift_id)=([^&]*)/))from_order_details=true;else if(!cfg.zendesk_help_docs&&location.href.match(/\/help\/physical_orders\/\?(sig|payment_id|gift_id)=([^&]*)/))from_order_details=true;return{subj:params["subj"]||null,msg:params["msg"]||"",email:params["email"]||null,name:params["name"]||null,band_id:band_id,band_name:params["n"]||"Bandcamp Support",from_url:params["p"]||encodeURIComponent(location.href),prev_referrer_url:params["prev_referrer_url"],
from_order_details:from_order_details}},populate_support_topic:function(){var subj=Contact.fields["subj"];if(subj in Contact.subjects)$.extend(Contact.fields,Contact.subjects[subj]);if(Contact.fields["band_id"]==1){Contact.check_for_banner();if(Contact.banner_msg)Contact.fields["banner_msg"]=Contact.banner_msg}},check_for_banner:function(){$.ajax({type:"POST",url:"/contact_banner_cb",dataType:"json",async:false,success:function(res){if(res.banner_msg)Contact.banner_msg=res.banner_msg;else delete Contact.banner_msg},
error:function(res){Log.info("check_for_banner failed: "+res.status)}})},show_form_page:function(fields,popped_open,return_url){window.Form.revealError=function(){};Contact.fields=fields;Contact.fields["use_captcha"]=Contact.use_recaptcha();Contact.popped_open=popped_open;Contact.return_url=return_url;Contact.populate_support_topic();Contact.fields["is_modal"]=false;if(popped_open&&Contact.fields["band_id"]!=1)Contact.validation.messages["contact.generic"]["badBand"]="Sorry, there was an unexpected problem. Please return to the artist's page and try again.";
Templ.renderElem("contact-form","contact_form_2018",Contact.fields);$("#contact\\.cancel").click(Contact.cancel_button);var toggleEdit=$(".toggle-edit");var toggleInput=$(".toggleable input");toggleEdit.click(function(){toggleInput.removeClass("no-edit");toggleInput.attr("readonly",false);toggleEdit.hide()});toggleInput.focusin(function(){if(!toggleInput.attr("readonly"))toggleEdit.hide()});Form.init("contactForm",null,null,Contact.validation,function(ev){Contact.submit_button(ev)});Contact.setup_recaptcha();
Contact.make_stretchy_textareas()},show_form_dlg:function(fields,ev){window.Form.revealError=function(){};Contact.fields=fields;Contact.populate_support_topic();Contact.fields["is_modal"]=true;if(window.FacebookData){var patchYui=false;FacebookUtils.correctSrollThen(patchYui,Contact,Contact.show_form_inner,ev)}else if(Contact.fields["banner_msg"]){var title=TM("Contact {{band_name}}",{band_name:Contact.fields["band_name"]},"Contact modal header title");var message=Templ.render("contact_support_alert",
{modal:true,banner_msg:Contact.fields["banner_msg"],faq_url:null});var okText=TM("Contact Bandcamp Support");var self=this;var cb=function(){self.show_form_inner(ev)};var dlg=Dialog.alert(title,message,cb,false,okText,true);Y.util.Dom.addClass(dlg.element,"contact-dlg");$(".mask").css("background","#000")}else this.show_form_inner(ev)},show_form_inner:function(ev$$0){Contact.fields["use_captcha"]=Contact.use_recaptcha();Contact.fields["language_msg"]=Contact.fields["band_id"]===1&&Translate&&Translate.locale!==
Translate.EN_DEFAULT;dlg_options={close:true,postmethod:"none",hideaftersubmit:false};var title=TM("Contact {{band_name}}",{band_name:Contact.fields["band_name"]},"Contact modal header title");var dlg=Dialog.openTemplate(title,"contact_form_2018",Contact.fields,[],"448px",dlg_options);Y.util.Dom.addClass(dlg.element,"contact-dlg");$(".mask").css("background","#000");$("#contact\\.cancel").click(function(ev){Contact.cancel_button(ev,dlg)});var toggleEdit=$(".toggle-edit");var toggleInput=$(".toggleable input");
toggleEdit.click(function(){toggleInput.removeClass("no-edit");toggleInput.attr("readonly",false);toggleEdit.hide()});toggleInput.focusin(function(){if(!toggleInput.attr("readonly"))toggleEdit.hide()});Form.init("contactForm",null,null,Contact.validation,function(ev){Contact.submit_button(ev,dlg)});Contact.setup_recaptcha();Contact.make_stretchy_textareas();dlg.destroyEvent.subscribe(function(){Form.detach()});ev$$0.stopPropagation();return dlg},use_recaptcha:function(){var pagedata=$("#pagedata").data("blob");
if(Contact.fields["band_id"]!=1&&!pagedata.identities.user&&RecaptchaWrapper.public_key())return true;else return false},setup_recaptcha:function(){if(Contact.use_recaptcha()){Contact.disable_the_buttons();RecaptchaWrapper.initSDK().then(RecaptchaWrapper.render,RecaptchaWrapper.fail)}},submit_button:function(ev,dlg){$.Event(ev).preventDefault();Contact.disable_the_buttons();Crumb.ajax({type:"POST",url:"/contact_cb",data:$("#contactForm").serialize(),dataType:"json",success:function(res,code,req){Contact.success(res,
code,req,dlg)},error:function(res,code,error){Contact.failure(res,code,error)}})},success:function(response,code,req,dlg){if(response.errors||response.error){Contact.enable_the_buttons();if(response.errors)Form.validate.show_alerts(response.errors,false);else{var error=Dialog.alert("Oops!",Contact.validation.messages["contact.generic"].generic,null,null,null,true);Y.util.Dom.addClass(error.element,"contact-dlg");$(".mask").css("background","#000")}RecaptchaWrapper.safe_destroy()}else{if(dlg){RecaptchaWrapper.safe_destroy();
dlg.destroy();if(!window.FacebookData){var verification_message=Templ.render("contact_form_verification",{band_name:Contact.fields["band_name"],ok:true,to_support:Contact.fields["band_id"]==1,from_order_details:Contact.fields["from_order_details"],return_url:false});var title=TM("Contact {{band_name}}",{band_name:Contact.fields["band_name"]},"Contact modal verification pane");var okText=TM("Done");dlg=Dialog.alert(title,verification_message,null,null,okText,true);Y.util.Dom.addClass(dlg.element,"contact-dlg");
$(".mask").css("background","#000")}}else if(Contact.popped_open)window.close();else{var url=Contact.return_url||TemplGlobals.siteroot;verification_message=Templ.render("contact_form_verification",{band_name:Contact.fields["band_name"],ok:true,to_support:Contact.fields["band_id"]==1,from_order_details:Contact.fields["from_order_details"],return_url:Contact.return_url});if(MediaView.mode=="phone"){$("#contact-banner").hide();$("html, body").animate({scrollTop:$("#contact-page-info").first().offset().top},
500)}dlg=$("#contact-form").replaceWith(verification_message)}$(".contact-verification-cancel").click(function(ev){Contact.cancel_button(ev,dlg)})}},failure:function(res,code,error){Contact.enable_the_buttons();Form.validate.show_alerts({field:"contact.generic",reason:"generic"},false);Log.info("contact callback failure: status: "+res.status+"; statusText: "+error)},cancel_button:function(ev,dlg){ev.stopPropagation();if(dlg){RecaptchaWrapper.safe_destroy();dlg.destroy()}else if(Contact.popped_open)window.close();
else{var url=Contact.return_url||TemplGlobals.siteroot;window.location=url}},disable_the_buttons:function(){$("#contact\\.send").addClass("disabled");$("#contact\\.send").prop("disabled",true);$("#contact\\.send").text="Sending...";$("#contact\\.cancel").addClass("disabled");$("#contact\\.cancel").prop("disabled",true)},enable_the_buttons:function(){$("#contact\\.send").removeClass("disabled");$("#contact\\.send").prop("disabled",false);$("#contact\\.send").text="Send";$("#contact\\.cancel").removeClass("disabled");
$("#contact\\.cancel").prop("disabled",false)},make_stretchy_textareas:function(){$("#contactForm textarea").each(function(){addExpandEventListeners(this);var maxInactiveHeight=52;if(this.name=="contact.message")if(this.value)maxInactiveHeight=$(this).height(0).height(this.scrollHeight);else maxInactiveHeight=150;addShrinkEventListeners(this,maxInactiveHeight)})},zzz:null};
var Launder=function(str){$.post("/ectotherm/launder_cb",{laundry:str}).done(function(response){if(Trackpipe.showXHRError(response))return;if(response.ok)alert(siteroot_https+response.next_url);else alert("Keep trying...")}).fail(function(){NuDialog.alert("Network Error","There was a network error. Please try again.")})};
            if ('undefined' === typeof window.Templ) {
                Log.server('Premature template registration: ' + ["contact_form"], 'warn');
            }
            else {
                Templ.register({"contact_form":["<form id=\"contactForm\" action=\"/no_js\" method=\"post\" accept-charset=\"utf-8\">\n    \n    ",{"blocks":[{"attachment":["\n    <div id=\"contact.banner\">",{"filters":[["h",[]]],"name":"banner_msg","type":"variable"},"</div>\n    "],"expression":"banner_msg ","type":"ncondition"}],"type":"ef"},"\n\n    ",{"blocks":[{"attachment":["\n        <div id=\"contact.languages\">",{"nodelist":["Our support in your language is still in progress. Please forgive us if we respond in English."],"type":"translate"},"</div>\n    "],"expression":"language_msg ","type":"ncondition"}],"type":"ef"},"\n\n    <input type=\"hidden\" name=\"contact.band_id\" value=\"",{"filters":[["a",[]]],"name":"band_id","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.from_url\" value=\"",{"filters":[["a",[]]],"name":"from_url","type":"variable"},"\"/>\n\n    <input type=\"hidden\" name=\"contact.platform\" value=\"",{"filters":[["a",[]]],"name":"platform","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.device\" value=\"",{"filters":[["a",[]]],"name":"device","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.app_version\" value=\"",{"filters":[["a",[]]],"name":"app_version","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.fan\" value=\"",{"filters":[["a",[]]],"name":"fan","type":"variable"},"\"/>\n\n    <div id=\"contact.generic\" class=\"alert\"></div>\n\n    <dl class=\"tableLayout\">\n        <dt>your name</dt>\n        <dd>\n            <input type=\"text\" class=\"textInput\" id=\"contact.name\" name=\"contact.name\" value=\"",{"filters":[["a",[]]],"name":"name","type":"variable"},"\"/>\n            <p id=\"contact.name_alert\" class=\"alert\"></p>\n        </dd>\n        <dt>email</dt>\n        <dd>\n            <input type=\"text\" class=\"textInput\" id=\"contact.email\" name=\"contact.email\" value=\"",{"filters":[["a",[]]],"name":"email","type":"variable"},"\"/>\n            <p id=\"contact.email_alert\" class=\"alert\"></p>\n        </dd>\n        <dt>subject</dt>\n        <dd>\n            <input type=\"text\" class=\"textInput\" id=\"contact.subject\" name=\"contact.subject\" value=\"",{"filters":[["a",[]]],"name":"subj","type":"variable"},"\"/>\n            <p id=\"contact.subject_alert\" class=\"alert\"></p>\n        </dd>\n        <dt>message</dt>\n        <dd>\n            <textarea rows=\"10\" class=\"textInput\" id=\"contact.message\" name=\"contact.message\">",{"filters":[["h",[]]],"name":"msg","type":"variable"},"</textarea>\n            <p id=\"contact.message_alert\" class=\"alert\"></p>\n        </dd>\n        ",{"blocks":[{"attachment":["\n        <dt>Fan Account URL</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.fan_urls\" name=\"contact.fan_urls\">",{"filters":[["h",[]]],"name":"fan_urls","type":"variable"},"</textarea>\n            <p id=\"contact.fan_urls_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"fan_urls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>download code</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.codes\" name=\"contact.codes\" >",{"filters":[["h",[]]],"name":"codes","type":"variable"},"</textarea>\n            <p id=\"contact.codes_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"codes","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>facebook URLs</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.fb_urls\" name=\"contact.fb_urls\">",{"filters":[["h",[]]],"name":"fb_urls","type":"variable"},"</textarea>\n            <p id=\"contact.fb_urls_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"fb_urls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>band URLs</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.band_url\" name=\"contact.band_urls\">",{"filters":[["h",[]]],"name":"band_urls","type":"variable"},"</textarea>\n            <p id=\"contact.band_urls_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"band_urls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>current login email</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.original_email\" name=\"contact.original_email\">",{"filters":[["h",[]]],"name":"original_email","type":"variable"},"</textarea>\n            <p id=\"contact.orginal_email_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"original_email","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>approximate signup date</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.signup_date\" name=\"contact.signup_date\">",{"filters":[["h",[]]],"name":"signup_date","type":"variable"},"</textarea>\n            <p id=\"contact.signup_date_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"signup_date","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>download links</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.dls\" name=\"contact.dls\">",{"filters":[["h",[]]],"name":"dls","type":"variable"},"</textarea>\n            <p id=\"contact.dls_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"dls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n        <dt>album page</dt>\n        <dd>\n            <textarea rows=\"2\" class=\"textInput\" id=\"contact.preorders\" name=\"contact.preorders\">",{"filters":[["h",[]]],"name":"preorders","type":"variable"},"</textarea>\n            <p id=\"contact.preorder_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"preorders","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n\n        ",{"blocks":[{"attachment":["\n        <dt>be human</dt>\n        <dd>\n            <div id=\"are-you-human\"></div>\n            <p id=\"contact.captcha_alert\" class=\"alert\"></p>\n        </dd>\n        "],"child_condition":null,"child_relation":null,"left":"use_captcha","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        \n        <div id=\"contact.support_alert\" class=\"alert\"></div>\n\n        <dd>\n            <button type=\"submit\" name=\"contact.send\" value=\"OK\" id=\"contact.send\"><div id=\"contact.send.text\">Send</div></button>\n            <button type=\"button\" name=\"contact.cancel\" value=\"Cancel\" id=\"contact.cancel\"><div>Cancel</div></button>\n        </dd>\n\n        \n    </dl>\n\n\n</form>\n"]});
            }
        ;

/* ------------- tpl_contact_2018 --------------- */

            if ('undefined' === typeof window.Templ) {
                Log.server('Premature template registration: ' + ["contact_form_2018"], 'warn');
            }
            else {
                Templ.register({"contact_form_2018":["<form id=\"contactForm\" action=\"/no_js\" method=\"post\" accept-charset=\"utf-8\">\n    ",{"blocks":[{"attachment":["\n        <div id=\"contact.languages\">",{"nodelist":["Our support in your language is still in progress. Please forgive us if we respond in English."],"type":"translate"},"</div>\n    "],"expression":"language_msg ","type":"ncondition"}],"type":"ef"},"\n\n    <input type=\"hidden\" name=\"contact.band_id\" value=\"",{"filters":[["a",[]]],"name":"band_id","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.band_name\" value=\"",{"filters":[["a",[]]],"name":"band_name","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.from_url\" value=\"",{"filters":[["a",[]]],"name":"from_url","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.prev_referrer_url\" value=\"",{"filters":[["a",[]]],"name":"prev_referrer_url","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.from_order_details\" value=\"",{"filters":[["a",[]]],"name":"from_order_details","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.platform\" value=\"",{"filters":[["a",[]]],"name":"platform","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.device\" value=\"",{"filters":[["a",[]]],"name":"device","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.app_version\" value=\"",{"filters":[["a",[]]],"name":"app_version","type":"variable"},"\"/>\n    <input type=\"hidden\" name=\"contact.fan\" value=\"",{"filters":[["a",[]]],"name":"fan","type":"variable"},"\"/>\n\n    \n    ",{"blocks":[{"attachment":["\n        ",{"blocks":[{"attachment":["\n            <input type=\"hidden\" name=\"contact.subject\" value=\"",{"filters":[["a",[]]],"name":"subj","type":"variable"},"\"/>\n        "],"expression":"subj ","type":"ncondition"}],"type":"ef"},"\n        ",{"blocks":[{"attachment":["\n            <input type=\"hidden\" name=\"contact.name\" value=\"",{"filters":[["a",[]]],"name":"name","type":"variable"},"\"/>\n        "],"expression":"name ","type":"ncondition"}],"type":"ef"},"\n    "],"expression":"from_order_details ","type":"ncondition"}],"type":"ef"},"\n\n    <div id=\"contact.generic\" class=\"alert\"></div>\n\n    <dl class=\"tableLayout\">\n        <div class=\"tableLayoutRow\">\n            <dt>",{"nodelist":["Email address"],"type":"translate"},"</dt>\n            <dd>\n                <div class=\"toggleable\">\n                    <input type=\"text\" class=\"textInput ",{"blocks":[{"attachment":["no-edit"],"expression":"email ","type":"ncondition"}],"type":"ef"},"\" id=\"contact.email\" name=\"contact.email\" value=\"",{"filters":[["a",[]]],"name":"email","type":"variable"},"\" ",{"blocks":[{"attachment":["readonly"],"expression":"email ","type":"ncondition"}],"type":"ef"},"/>\n                    ",{"blocks":[{"attachment":["\n                        <span class=\"toggle-edit\">",{"nodelist":["change"],"type":"translate"},"</span>\n                    "],"expression":"email ","type":"ncondition"}],"type":"ef"},"\n                </div>\n                <p id=\"contact.email_alert\" class=\"alert\"></p>\n            </dd>\n        </div>\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["Name"],"type":"translate"},"</dt>\n                <dd>\n                    <input class=\"textInput\" id=\"contact.name\" name=\"contact.name\" value=\"",{"filters":[["a",[]]],"name":"name","type":"variable"},"\"/>\n                    <p id=\"contact.name_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"expression":"!name || !from_order_details ","type":"ncondition"}],"type":"ef"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["Subject"],"type":"translate"},"</dt>\n                <dd>\n                    <input class=\"textInput\" id=\"contact.subject\" name=\"contact.subject\" value=\"",{"filters":[["a",[]]],"name":"subj","type":"variable"},"\"/>\n                    <p id=\"contact.subject_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"expression":"!subj || !from_order_details ","type":"ncondition"}],"type":"ef"},"\n        <div class=\"tableLayoutRow\">\n            <dt>",{"nodelist":["Message"],"type":"translate"},"</dt>\n            <dd>\n                <textarea rows=\"10\" class=\"textInput\" id=\"contact.message\" name=\"contact.message\">",{"filters":[["h",[]]],"name":"msg","type":"variable"},"</textarea>\n                <p id=\"contact.message_alert\" class=\"alert\"></p>\n            </dd>\n        </div>\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["Fan Account URL"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.fan_urls\" name=\"contact.fan_urls\">",{"filters":[["h",[]]],"name":"fan_urls","type":"variable"},"</textarea>\n                    <p id=\"contact.fan_urls_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"fan_urls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["download code"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.codes\" name=\"contact.codes\" >",{"filters":[["h",[]]],"name":"codes","type":"variable"},"</textarea>\n                    <p id=\"contact.codes_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"codes","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["facebook URLs"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.fb_urls\" name=\"contact.fb_urls\">",{"filters":[["h",[]]],"name":"fb_urls","type":"variable"},"</textarea>\n                    <p id=\"contact.fb_urls_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"fb_urls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["band URLs"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.band_url\" name=\"contact.band_urls\">",{"filters":[["h",[]]],"name":"band_urls","type":"variable"},"</textarea>\n                    <p id=\"contact.band_urls_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"band_urls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["current login email"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.original_email\" name=\"contact.original_email\">",{"filters":[["h",[]]],"name":"original_email","type":"variable"},"</textarea>\n                    <p id=\"contact.orginal_email_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"original_email","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["approximate signup date"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.signup_date\" name=\"contact.signup_date\">",{"filters":[["h",[]]],"name":"signup_date","type":"variable"},"</textarea>\n                    <p id=\"contact.signup_date_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"signup_date","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["link to item you purchased"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.purchased_item_url\" name=\"contact.purchased_item_url\">",{"filters":[["h",[]]],"name":"purchased_item_url","type":"variable"},"</textarea>\n                    <p id=\"contact.purchased_item_url_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"purchased_item_url","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["email you think you used to purchase the item"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.purchase_email\" name=\"contact.purchase_email\">",{"filters":[["h",[]]],"name":"purchase_email","type":"variable"},"</textarea>\n                    <p id=\"contact.purchase_email_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"purchase_email","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["download links"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.dls\" name=\"contact.dls\">",{"filters":[["h",[]]],"name":"dls","type":"variable"},"</textarea>\n                    <p id=\"contact.dls_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"dls","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["album page"],"type":"translate"},"</dt>\n                <dd>\n                    <textarea rows=\"1\" class=\"textInput\" id=\"contact.preorders\" name=\"contact.preorders\">",{"filters":[["h",[]]],"name":"preorders","type":"variable"},"</textarea>\n                    <p id=\"contact.preorder_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"preorders","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n\n        ",{"blocks":[{"attachment":["\n            <div class=\"tableLayoutRow\">\n                <dt>",{"nodelist":["Be human"],"type":"translate"},"</dt>\n                <dd>\n                    <div id=\"are-you-human\"></div>\n                    <p id=\"contact.captcha_alert\" class=\"alert\"></p>\n                </dd>\n            </div>\n        "],"child_condition":null,"child_relation":null,"left":"use_captcha","operator":null,"right":null,"type":"condition"}],"type":"if"},"\n\n        <div id=\"contact.support_alert\" class=\"alert\"></div>\n\n        <dd class=\"contact-action-buttons\">\n            <button type=\"submit\" name=\"contact.send\" value=\"OK\" id=\"contact.send\"><span id=\"contact.send.text\">",{"nodelist":["Send message to ",{"filters":[["h",[]]],"name":"band_name","type":"variable"},""],"type":"translate"},"</span></button>\n            ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    <button type=\"button\" name=\"contact.cancel\" value=\"Cancel\" id=\"contact.cancel\"><span>",{"nodelist":["cancel"],"type":"translate"},"</span></button>\n                "],"expression":"is_modal ","type":"ncondition"},{"attachment":["\n                    <button type=\"button\" name=\"contact.cancel\" value=\"Cancel\" id=\"contact.cancel\"><span>",{"nodelist":["go back"],"type":"translate"},"</span></button>\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"from_url ","type":"ncondition"}],"type":"ef"},"\n        </dd>\n    </dl>\n</form>\n"]});
            }
        ;

/* ------------- tpl_contact_verification --------------- */

            if ('undefined' === typeof window.Templ) {
                Log.server('Premature template registration: ' + ["contact_form_verification"], 'warn');
            }
            else {
                Templ.register({"contact_form_verification":["<div class=\"contact-verification\">\n    <div class=\"contact-verification-img\">\n        <img src=\"/img/blue-checkmark.svg\">\n    </div>\n    <div class=\"contact-verification-message\">\n        ",{"blocks":[{"attachment":["\n            <h1>",{"nodelist":["Thank you for your message!"],"type":"translate"},"</h1>\n            <p>",{"nodelist":["We have received it and will email you a response as soon as we can."],"type":"translate"},"</p>\n        "],"expression":"to_support ","type":"ncondition"},{"attachment":["\n            ",{"blocks":[{"attachment":["\n                <h1>",{"nodelist":["Your message was sent to ",{"nodelist":[{"filters":[["h",[]]],"name":"band_name","type":"variable"}],"type":"translateVariable","var_name":"band_name"}," and a copy of it was sent to your email."],"type":"translate"},"</h1>\n            "],"expression":"from_order_details ","type":"ncondition"},{"attachment":["\n                <h1>",{"nodelist":["Your message was sent to ",{"nodelist":[{"filters":[["h",[]]],"name":"band_name","type":"variable"}],"type":"translateVariable","var_name":"band_name"},"."],"type":"translate"},"</h1>\n            "],"type":"else_ncondition"}],"type":"ef"},"\n            <p>\n                <span>",{"nodelist":["Please allow 5-7 business days for a response."],"type":"translate"},"</span>\n                ",{"blocks":[{"attachment":["\n                    <br>\n                    <a href=\"#not-received\" class=\"contact-verification-cancel\">",{"nodelist":["What to do if you dont get a response."],"type":"translate"},"</a>\n                "],"expression":"from_order_details ","type":"ncondition"}],"type":"ef"},"\n            </p>\n        "],"type":"else_ncondition"}],"type":"ef"},"\n        ",{"blocks":[{"attachment":["\n            <p>\n                <a herf=\"",{"filters":[["a",[]]],"name":"return_url","type":"variable"},"\">",{"nodelist":["Return to Bandcamp"],"type":"translate"},"</a>\n            </p>\n        "],"expression":"return_url ","type":"ncondition"}],"type":"ef"},"\n    </div>\n</div>\n"]});
            }
        ;

/* ------------- tpl_contact_banner --------------- */

            if ('undefined' === typeof window.Templ) {
                Log.server('Premature template registration: ' + ["contact_support_alert"], 'warn');
            }
            else {
                Templ.register({"contact_support_alert":["\n\n",{"blocks":[{"attachment":["\n    ",{"nodelist":["\n    ",{"nodelist":["Hello from Bandcamp Support!"],"type":"translate"},"\n    "],"to":"greeting","type":"capture"},"\n\n    ",{"nodelist":["\n        ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Were experiencing an unusually high volume of emails."],"type":"translate"},"\n            "],"child_condition":null,"child_relation":null,"left":"banner_msg","operator":"==","right":"1","type":"condition"},{"attachment":["\n                ",{"nodelist":["Our support team is traveling from far and wide to meet up and work through ways to make the Bandcamp experience even better."],"type":"translate"},"\n            "],"child_condition":null,"child_relation":null,"left":"banner_msg","operator":"==","right":"2","type":"condition"},{"attachment":["\n                &nbsp; &nbsp;",{"nodelist":["Most of our support team is on holiday observing end-of-year festivities."],"type":"translate"},"&nbsp; &nbsp;\n        "],"child_condition":null,"child_relation":null,"left":"banner_msg","operator":"==","right":"3","type":"condition"}],"type":"case"},"\n    "],"to":"body","type":"capture"},"\n\n    ",{"nodelist":["\n        ",{"blocks":[{"attachment":["\n                ",{"nodelist":["We humbly ask that you give us an extra day or two to respond to your message."],"type":"translate"},"\n            "],"child_condition":null,"child_relation":null,"left":"banner_msg","operator":"==","right":"1","type":"condition"},{"attachment":["\n                ",{"nodelist":["Please allow us an extra day or two to reply to your message."],"type":"translate"},"\n        "],"child_condition":null,"child_relation":null,"left":"banner_msg","operator":"==","right":"2","type":"condition"},{"attachment":["\n                ",{"nodelist":["Please allow us an extra day or two to reply to your message."],"type":"translate"},"\n        "],"child_condition":null,"child_relation":null,"left":"banner_msg","operator":"==","right":"3","type":"condition"}],"type":"case"},"\n    "],"to":"response_time","type":"capture"},"\n\n    ",{"blocks":[{"attachment":["\n        <div id=\"contact-banner\" class=\"modal\">\n            <div class=\"contact-banner-img\">\n                \n                <img src=\"/img/waving-hand.svg\">\n            </div>\n            <div class=\"contact-banner-message\">\n                <p class=\"contact-banner-message-header\">\n                    <span>",{"filters":[],"name":"greeting","type":"variable"},"</span>\n                    <br>\n                    <strong>",{"filters":[],"name":"body","type":"variable"},"</strong>\n                </p>\n                <p>\n                    <span>",{"filters":[],"name":"response_time","type":"variable"},"</span>\n                </p>\n            </div>\n        </div>\n    "],"expression":"modal ","type":"ncondition"},{"attachment":["\n        <div id=\"contact-banner\" class=\"page\">\n            <div class=\"contact-banner-img\">\n                \n                <img src=\"/img/waving-hand.svg\">\n            </div>\n            <div class=\"contact-banner-message\">\n                <p>\n                    <span>",{"filters":[],"name":"greeting","type":"variable"},"</span>\n                    <strong>",{"filters":[],"name":"body","type":"variable"},"</strong>\n                    <span>",{"filters":[],"name":"response_time","type":"variable"},"</span>\n                </p>\n            </div>\n        </div>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n"],"expression":"banner_msg ","type":"ncondition"}],"type":"ef"},"\n"]});
            }
        ;

/* ------------- val_all --------------- */
Validators={"Account":{"paypal_email":{"max":100,"req":true,"type":"text"},"state":{"max":1,"type":"text"}},"Album":{"_tags":{"clientproc":"Tags.validate_tralbum_tags"},"about":{"type":"text"},"artist":{"max":100,"type":"text"},"audit":{"max":4294967295,"min":0,"type":"int"},"auto_repriced":{"type":"date"},"cat_number":{"clientproc":"CatNumber.validate_catalog_number"},"credits":{"type":"text"},"minimum_price":{"max":250000.0,"min":0.0,"type":"float"},"minimum_price_nonzero":{"type":"float"},"mod_date":{"type":"date"},"new_date":{"type":"date"},"price":{"max":250000.0,"min":0.0,"type":"float"},"publish_date":{"type":"date"},"purchase_title":{"max":200,"type":"text"},"purchase_url":{"implicit_type":"url","match":"(^)(\\()?(http://|https://)(([^@\\./\\s\\/'\"><&]+)(\\.[^@\\./\\s\\/'\"><&]+)*(\\.(?:[a-z]{2,})))(/[^?\\s]*?)?(\\?[^#\\s]*?)?(#[^\\s]*?)?(\\))?($)","max":200,"message":"Invalid URL.","type":"text"},"release_date":{"type":"date"},"set_price":{"max":250000.0,"min":0.01,"type":"float"},"tags":{"clientproc":"Tags.validate_tralbum_tags"},"title":{"max":300,"req":true,"type":"text"},"upc":{"max":13,"type":"upc"}},"AreaTag":{"alt":{"max":256,"type":"text"},"coords":{"max":256,"type":"text"},"href":{"max":1028,"type":"text"},"shape":{"max":32,"type":"text"},"target":{"max":256,"type":"text"},"title":{"max":256,"type":"text"}},"Art":{"new_date":{"type":"date"}},"Band":{"activation_date":{"type":"date"},"audit":{"max":4294967295,"min":0,"type":"int"},"auto_repriced":{"type":"date"},"bio":{"max":400,"type":"text"},"cache_date":{"type":"date"},"create_date":{"type":"date"},"currency":{"max":3,"type":"text"},"custom_domain":{"match":"^[a-z0-9][a-z0-9\\-]*(\\.[a-z0-9\\-]+){1,7}$","max":100,"type":"text"},"custom_domain_create":{"type":"date"},"custom_domain_last_check":{"type":"date"},"disabled_date":{"type":"date"},"fan_email":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","max":100,"message":"Invalid email address.","req":true,"type":"text"},"goods_return_policy":{"type":"text"},"goods_shipping_info":{"type":"text"},"home_page":{"max":1,"type":"text"},"last_mailing_list_export":{"type":"date"},"last_sales_export":{"type":"date"},"license_pref":{"max":65535,"min":0,"type":"int"},"mod_date":{"type":"date"},"name":{"max":100,"req":true,"type":"text"},"paypal_email":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","max":100,"message":"Invalid email address.","type":"text"},"promo_limit":{"max":4294967295,"min":0,"type":"int"},"subdomain":{"match":"^[a-z\\d][a-z\\d\\-]{2,}[a-z\\d]$","max":63,"min":4,"type":"text"},"website_url":{"max":100,"type":"text"}},"BandLocation":{},"BandNavbar":{},"BandSite":{"url":{"implicit_type":"url","match":"(^)(\\()?(http://|https://)(([^@\\./\\s\\/'\"><&]+)(\\.[^@\\./\\s\\/'\"><&]+)*(\\.(?:[a-z]{2,})))(/[^?\\s]*?)?(\\?[^#\\s]*?)?(#[^\\s]*?)?(\\))?($)","message":"Invalid URL."}},"BandSocialPref":{"thanks_text":{"type":"text"}},"CustomHeader":{"url":{"max":100,"type":"text"}},"Design":{"bg_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"},"bg_file_name":{"max":200,"type":"text"},"body_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"},"hd_ft_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"},"link_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"},"navbar_bg_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"},"secondary_text_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"},"text_color":{"match":"^[0-9A-F]{6,6}$","max":6,"type":"text"}},"DiscographyOrder":{"item_type":{"max":1,"req":true,"type":"text"},"order_number":{"max":65535,"min":0,"req":true,"type":"int"}},"DiscountCode":{"expire_date":{"type":"date"},"item_type":{"match":"^[atp]$","max":1,"type":"text"},"name":{"match":"^[a-z0-9_@#&\\*]+$","max":25,"req":true,"type":"text"},"new_date":{"req":true,"type":"date"},"percent":{"max":99,"min":1,"req":true,"type":"int"}},"DownloadDesc":{"hash":{"max":32,"min":32,"req":true,"type":"text"},"text":{"type":"text"}},"EmailAuth":{"address":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","max":100,"message":"Invalid email address.","req":true,"type":"text"},"country":{"max":100,"req":true,"type":"text"},"date_added":{"type":"date"},"postalcode":{"max":32,"req":true,"type":"text"}},"Encodings":{"aac_hi_file_size":{"max":4294967295,"min":0,"type":"int"},"aac_lo_file_size":{"max":4294967295,"min":0,"type":"int"},"aiff_lossless_file_size":{"max":4294967295,"min":0,"type":"int"},"alac_file_size":{"max":4294967295,"min":0,"type":"int"},"duration":{"type":"float"},"err_type":{"max":1,"type":"text"},"error":{"max":2147483647,"min":-2147483648,"type":"int"},"error_format":{"max":2147483647,"min":-2147483648,"type":"int"},"flac_file_size":{"max":4294967295,"min":0,"type":"int"},"mp3_128_file_size":{"max":4294967295,"min":0,"type":"int"},"mp3_320_file_size":{"max":4294967295,"min":0,"type":"int"},"mp3_v0_file_size":{"max":4294967295,"min":0,"type":"int"},"mp3_v2_file_size":{"max":4294967295,"min":0,"type":"int"},"new_date":{"type":"date"},"opus_lo_file_size":{"max":4294967295,"min":0,"type":"int"},"original_file_size":{"max":4294967295,"min":0,"type":"int"},"original_name":{"max":200,"type":"text"},"scrub_revision":{"max":32767,"min":-32768,"type":"int"},"scrubbed_flac_file_size":{"max":4294967295,"min":0,"type":"int"},"state":{"max":32767,"min":-32768,"type":"int"},"vorbis_file_size":{"max":4294967295,"min":0,"type":"int"},"vorbis_lo_file_size":{"max":4294967295,"min":0,"type":"int"},"wav_file_size":{"max":4294967295,"min":0,"type":"int"},"wav_lossless_file_size":{"max":4294967295,"min":0,"type":"int"}},"FacebookAppPref":{"fan_page_name":{"type":"text"},"mod_date":{"req":true,"type":"date"},"new_date":{"type":"date"}},"Fan":{"bio":{"max":400,"type":"text"},"name":{"max":60,"type":"text"},"website_url":{"max":60,"type":"text"}},"FanEmail":{"address":{"max":100,"type":"text"},"countrycode":{"max":2,"type":"text"},"date_added":{"type":"date"},"date_unsubscribed":{"type":"date"},"firstname":{"max":40,"type":"text"},"lastname":{"max":40,"type":"text"},"num_purchases":{"max":4294967295,"min":0,"type":"int"},"postalcode":{"max":32,"type":"text"}},"FanUnsubscribe":{"fan_email":{"max":100,"type":"text"}},"FeaturedFan":{"bio":{"type":"text"},"date":{"type":"date"},"mod_date":{"type":"date"},"published_date":{"type":"date"}},"FeaturedFanItem":{"comment":{"type":"text"},"item_type":{"max":1,"type":"text"},"sequence":{"max":4294967295,"min":0,"type":"int"}},"GoogleAnalytics":{"mod_date":{"req":true,"type":"date"},"new_date":{"type":"date"}},"HomePageStats":{"album_count":{"max":4294967295,"min":0,"req":true,"type":"int"},"charity_album_1":{"max":4294967295,"min":0,"type":"int"},"date":{"req":true,"type":"date"},"downloads_count_all_time":{"max":4294967295,"min":0,"req":true,"type":"int"},"revenue_30d":{"max":4294967295,"min":0,"req":true,"type":"int"},"revenue_total":{"max":4294967295,"min":0,"type":"int"},"sales_count_all_time":{"max":4294967295,"min":0,"req":true,"type":"int"},"top_album_1":{"max":4294967295,"min":0,"type":"int"},"top_album_10":{"max":4294967295,"min":0,"type":"int"},"top_album_11":{"max":4294967295,"min":0,"type":"int"},"top_album_12":{"max":4294967295,"min":0,"type":"int"},"top_album_13":{"max":4294967295,"min":0,"type":"int"},"top_album_14":{"max":4294967295,"min":0,"type":"int"},"top_album_15":{"max":4294967295,"min":0,"type":"int"},"top_album_16":{"max":4294967295,"min":0,"type":"int"},"top_album_17":{"max":4294967295,"min":0,"type":"int"},"top_album_18":{"max":4294967295,"min":0,"type":"int"},"top_album_19":{"max":4294967295,"min":0,"type":"int"},"top_album_2":{"max":4294967295,"min":0,"type":"int"},"top_album_20":{"max":4294967295,"min":0,"type":"int"},"top_album_3":{"max":4294967295,"min":0,"type":"int"},"top_album_4":{"max":4294967295,"min":0,"type":"int"},"top_album_5":{"max":4294967295,"min":0,"type":"int"},"top_album_6":{"max":4294967295,"min":0,"type":"int"},"top_album_7":{"max":4294967295,"min":0,"type":"int"},"top_album_8":{"max":4294967295,"min":0,"type":"int"},"top_album_9":{"max":4294967295,"min":0,"type":"int"},"track_count":{"max":4294967295,"min":0,"req":true,"type":"int"}},"ImageMap":{},"Invitation":{"date_accepted":{"type":"date"},"date_recipient_revoked":{"type":"date"},"date_sender_revoked":{"type":"date"},"date_sent":{"req":true,"type":"date"},"emailed_to":{"max":100,"req":true,"type":"text"}},"Ipn":{"payload":{"type":"text"},"start_date":{"req":true,"type":"date"},"state":{"max":1,"type":"text"},"transaction_type":{"max":1,"type":"text"}},"Location":{"geo_precision":{"max":32767,"min":-32768,"type":"int"},"latitude":{"type":"float"},"longitude":{"type":"float"},"population":{"max":4294967295,"min":0,"type":"int"},"source_text":{"max":200,"type":"text"}},"Package":{"audit":{"max":4294967295,"min":0,"type":"int"},"description":{"type":"text"},"download_type":{"max":1,"type":"text"},"edition_size":{"max":1000000,"min":0,"type":"int"},"fulfillment_days":{"max":99,"min":1,"type":"int"},"grid_index":{"max":65535,"min":0,"type":"int"},"min_price":{"max":250000.0,"min":0.01,"type":"float"},"mod_date":{"type":"date"},"new_date":{"type":"date"},"options_title":{"max":50,"type":"text"},"price":{"max":250000.0,"min":0.01,"req":true,"type":"float"},"release_date":{"type":"date"},"set_price":{"max":250000.0,"min":0.01,"type":"float"},"sku":{"max":20,"type":"text"},"title":{"max":200,"req":true,"type":"text"}},"PackageArt":{"file_name":{"max":200,"type":"text"},"height":{"max":4294967295,"min":0,"type":"int"},"index":{"max":65535,"min":0,"type":"int"},"size":{"max":4294967295,"min":0,"type":"int"},"width":{"max":4294967295,"min":0,"type":"int"}},"PackageOption":{"index":{"max":65535,"min":0,"type":"int"},"sku":{"max":20,"type":"text"},"title":{"max":50,"req":true,"type":"text"}},"Payment":{"access_expires_date":{"type":"date"},"auth_type":{"max":20,"type":"text"},"buyer_type":{"max":1,"type":"text"},"create_date":{"type":"date"},"download_successes":{"max":65535,"min":0,"type":"int"},"download_trials":{"max":65535,"min":0,"type":"int"},"ip_address":{"max":4294967295,"min":0,"type":"int"},"purchase_subtype":{"max":20,"type":"text"}},"PaypalAuth":{"band_receipt_date":{"type":"date"},"checkout_date":{"type":"date"},"currency":{"max":3,"type":"text"},"currency_rate":{"type":"float"},"email_date":{"type":"date"},"fan_receipt_date":{"type":"date"},"fee_amt":{"type":"float"},"final_call_date":{"type":"date"},"ip_address":{"max":39,"type":"text"},"item_credit":{"max":100,"type":"text"},"item_desc":{"max":127,"type":"text"},"item_detail":{"max":50,"type":"text"},"item_name":{"max":127,"type":"text"},"item_price":{"type":"float"},"item_title":{"max":300,"type":"text"},"item_title2":{"max":300,"type":"text"},"order_total":{"type":"float"},"payer_business":{"max":127,"type":"text"},"payer_countrycode":{"max":2,"type":"text"},"payer_firstname":{"max":40,"type":"text"},"payer_lastname":{"max":40,"type":"text"},"payer_note":{"max":255,"type":"text"},"payer_paypal_email":{"max":127,"type":"text"},"payer_paypal_status":{"max":10,"type":"text"},"payer_shiptocity":{"max":60,"type":"text"},"payer_shiptocountrycode":{"max":2,"type":"text"},"payer_shiptocountryname":{"max":60,"type":"text"},"payer_shiptoname":{"max":60,"type":"text"},"payer_shiptophonenum":{"max":30,"type":"text"},"payer_shiptostate":{"max":60,"type":"text"},"payer_shiptostreet":{"max":150,"type":"text"},"payer_shiptostreet2":{"max":150,"type":"text"},"payer_shiptozip":{"max":20,"type":"text"},"payment_date":{"type":"date"},"paypal_api_version":{"max":8,"type":"text"},"paypal_build":{"max":12,"type":"text"},"paypal_error_code":{"max":12,"type":"text"},"paypal_payment_date":{"type":"date"},"paypal_payment_type":{"max":7,"type":"text"},"paypal_pending_completed_date":{"type":"date"},"paypal_pending_reason":{"max":1,"type":"text"},"paypal_token":{"max":20,"type":"text"},"quantity":{"max":2147483647,"min":-2147483648,"type":"int"},"release_receipt_date":{"type":"date"},"seller_paypal_email":{"max":127,"type":"text"},"share":{"max":4294967295,"min":0,"type":"int"},"share_balance":{"max":2147483647,"min":-2147483648,"type":"int"},"ship_date":{"type":"date"},"ship_notes":{"type":"text"},"shipping":{"type":"float"},"sub_total":{"type":"float"},"tax":{"type":"float"},"usd_total":{"type":"float"}},"Promo":{"count":{"max":4294967295,"min":0,"req":true,"type":"int"},"create_date":{"req":true,"type":"date"},"item_type":{"max":20,"req":true,"type":"text"},"name":{"max":200,"req":true,"type":"text"},"promo_num":{"max":4294967295,"min":0,"req":true,"type":"int"},"seed":{"max":4294967295,"min":0,"req":true,"type":"int"}},"Recommendation":{"create_date":{"req":true,"type":"date"},"item_type":{"max":1,"req":true,"type":"text"},"score":{"max":4294967295,"min":0,"type":"int"},"why":{"max":200,"req":true,"type":"text"}},"RecommendationPref":{"headline":{"max":100,"req":true,"type":"text"},"mod_date":{"req":true,"type":"date"}},"Slug":{"base_text":{"max":195,"type":"text"},"create_date":{"type":"date"},"item_type":{"max":1,"type":"text"},"lifetime":{"max":4294967295,"min":0,"type":"int"},"text":{"max":200,"req":true,"type":"text"},"unique_hash":{"max":32,"req":true,"type":"text"}},"Tag":{"name":{"max":32,"type":"text"},"norm_name":{"max":32,"type":"text"},"synonym_of":{"max":4294967295,"min":0,"type":"int"}},"TagBlurb":{"info_url":{"max":4096,"type":"text"},"text":{"type":"text"}},"TaggedItem":{"item_type":{"max":32767,"min":-32768,"type":"int"}},"TosAgreement":{"description":{"type":"text"},"effective_date":{"type":"date"}},"Track":{"_tags":{"clientproc":"Tags.validate_tralbum_tags"},"about":{"type":"text"},"artist":{"max":100,"type":"text"},"audit":{"max":4294967295,"min":0,"type":"int"},"auto_repriced":{"type":"date"},"credits":{"type":"text"},"file_name":{"max":200,"type":"text"},"isrc":{"country_codes":["AF","AX","AL","DZ","AS","AD","AO","AI","AQ","AG","AR","AM","AW","AU","AT","AZ","BS","BH","BD","BB","BY","BE","BZ","BJ","BM","BT","BO","BA","BW","BV","BR","IO","BN","BG","BF","BI","KH","CM","CA","CV","KY","CF","TD","CL","CN","CX","CC","CO","KM","CG","CD","CK","CR","CI","HR","CU","CY","CZ","DK","DJ","DM","DO","EC","EG","SV","GQ","ER","EE","ET","FK","FO","FJ","FI","FR","GF","PF","TF","GA","GM","GE","DE","GH","GI","GR","GL","GD","GP","GU","GT","GG","GN","GW","GY","HT","HM","VA","HN","HK","HU","IS","IN","ID","IR","IQ","IE","IM","IL","IT","JM","JP","JE","JO","KZ","KE","KI","KP","KR","KW","KG","LA","LV","LB","LS","LR","LY","LI","LT","LU","MO","MK","MG","MW","MY","MV","ML","MT","MH","MQ","MR","MU","YT","MX","FM","MD","MC","MN","MS","MA","MZ","MM","NA","NR","NP","NL","AN","NC","NZ","NI","NE","NG","NU","NF","MP","NO","OM","PK","PW","PS","PA","PG","PY","PE","PH","PN","PL","PT","PR","QA","RE","RO","RU","RW","SH","KN","LC","PM","VC","WS","SM","ST","SA","SN","RS","CS","SC","SL","SG","SK","SI","SB","SO","ZA","GS","ES","LK","SD","SR","SJ","SZ","SE","CH","SY","TW","TJ","TZ","TH","TL","TG","TK","TO","TT","TN","TR","TM","TC","TV","UG","UA","AE","UK","GB","US","UM","UY","UZ","VU","VE","VN","VG","VI","WF","EH","YE","ZM","ZW","AK","AL","AR","AS","AZ","CA","CO","CT","DC","DE","FL","FM","GA","GU","HI","IA","ID","IL","IN","KS","KY","LA","MA","ME","MD","MH","MI","MN","MO","MP","MS","MT","NC","ND","NE","NH","NJ","NM","NV","NY","OH","OK","OR","PA","PR","PW","RI","SC","SD","TN","TX","UT","VI","VT","VA","WA","WI","WV","WY","AB","BC","MB","NB","NL","NT","NS","NU","ON","PE","QC","SK","YT","AG","BC","BS","CH","CL","CM","CO","CS","DF","DG","GR","GT","HG","JA","MI","MO","NA","NL","OA","PU","QR","QT","SI","SL","SO","TB","TL","TM","VE","YU","ZA"],"max":12,"type":"isrc"},"license_type":{"max":65535,"min":0,"type":"int"},"lyrics":{"type":"text"},"minimum_price":{"max":250000.0,"min":0.0,"type":"float"},"minimum_price_nonzero":{"type":"float"},"mod_date":{"type":"date"},"new_date":{"type":"date"},"price":{"max":250000.0,"min":0.0,"type":"float"},"publish_date":{"type":"date"},"release_date":{"type":"date"},"set_price":{"max":250000.0,"min":0.01,"type":"float"},"tags":{"clientproc":"Tags.validate_tralbum_tags"},"title":{"max":300,"req":true,"type":"text"},"track_number":{"max":65535,"min":0,"type":"int"}},"User":{"admin_level":{"max":32767,"min":-32768,"type":"int"},"audit":{"max":4294967295,"min":0,"type":"int"},"create_date":{"type":"date"},"disabled_date":{"type":"date"},"email":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","max":100,"message":"Invalid email address.","req":true,"type":"text"},"group_type":{"max":20,"type":"text"},"ip_address":{"max":100,"type":"text"},"last_login_date":{"type":"date"},"mod_date":{"type":"date"},"name":{"max":60,"req":true,"type":"text"},"tos_accepted_date":{"type":"date"}},"change_password":{"new_password":{"min":3,"req":true,"type":"text"},"old_password":{"min":3,"req":true,"type":"text"}},"confirm_accept_tos":{"confirm_accept_tos":{"req":true}},"contact":{"email":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","message":"Invalid email address.","req":true},"message":{"max":1999,"min":1,"req":true,"type":"text"},"name":{"req":true},"subject":{"max":300,"type":"text"}},"fan_link_paypal_email":{"paypal_email":{"max":100,"req":true,"type":"text"}},"forgot_password":{"name":{"req":true}},"login":{"password":{"min":3,"req":true,"type":"text"}},"paypal_email_address":{"paypal_email":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","message":"Invalid email address."}},"pick_subdomain":{"subdomain":{"match":"^[a-z\\d][a-z\\d\\-]{2,}[a-z\\d]$","min":4,"req":true,"type":"text"}},"profile_custom_domain_test":{"custom_domain":{"match":"^[a-z0-9][a-z0-9\\-]*(\\.[a-z0-9\\-]+){1,7}$","req":true}},"report":{"email":{"match":"(^)([^\\s\\(\\)\"'/><,@]+@\\w([^\\s\\(\\)\"'/><&,@]*\\w)?\\.\\w[^\\s\\(\\)\"'/><&,@]*\\w)($)","message":"Invalid email address.","req":true},"message":{"max":1999,"min":1,"req":true,"type":"text"},"name":{"req":true},"subject":{"max":300,"type":"text"}},"signup":{"password":{"min":3,"req":true,"type":"text"},"tos":{"req":true}},"user":{"name":{"req":true}}};;
var MobileNavbar={scrollNavActive:function(){var wrapper=$(".band-navbar-wrapper");var navTotalWidth=$("#band-navbar")[0].scrollWidth;if(navTotalWidth>$(wrapper).width()){$(wrapper).removeClass("flex");var scrollTarget=$("#band-navbar").find(".active");var scrollPosition=$(scrollTarget).offset().left;if(scrollPosition+scrollTarget.parent().width()>$(wrapper).width())$(wrapper).scrollLeft(scrollPosition)}else $(wrapper).addClass("flex")}};
$(document).ready(function(){if(window.MediaView&&MediaView.mode=="phone"&&$("#band-navbar").length)MobileNavbar.scrollNavActive()});var BubbleMessage=function(html,lifetime){if(!lifetime)lifetime=2E3;var node=$('\x3cdiv class\x3d"bubble-msg"\x3e\x3cspan class\x3d"bubble-msg-inner"\x3e'+html+"\x3c/span\x3e\x3c/div\x3e");node.appendTo(document.body).delay(150).fadeToggle("fast").delay(lifetime).fadeOut("fast",null,function(){$(this).remove()});return node.find(".bubble-msg-inner")};
            if ('undefined' === typeof window.Templ) {
                Log.server('Premature template registration: ' + ["fan/signup/fan_signup_pane","fan/signup/fan_login_pane","fan/signup/fan_forgot_password_pane","fan/signup/fan_reset_password_pane","fan/signup/fan_existing_artist_pane","fan/signup/fan_almost_there_pane","fan/signup/fan_welcome_pane","fan/signup/fan_email_link","fan/signup/fan_verify_nag_pane","fan/signup/fan_dupe_fan_pane","fan/signup/fan_choose_account_pane","fan/signup/fan_genre_picker_pane","fan/signup/fan_genre_picker_selected_genres","fan/signup/fan_newsletter_picker_pane","fan/signup/fan_welcome_2_pane","login/user_picker_text","home_2016/fan_verify_banner","postcheckout/download_2016/mobile_app_button","account/download_item_small","svg_shared","fan/signup/fan_action_pane","fan/tooltips/search_tooltip","fan/tooltips/feed_tooltip","fan/tooltips/discover_tooltip","fan/tooltips/follow_tooltip","fan/tooltips/wishlist_tooltip","fan/tooltips/wishlist_button_tooltip","fan/tooltips/fan_follow_tooltip","fan/tooltips/collection_tooltip","menubar","home/header_2015","rock_the_vote_banner","_autocomplete_search_widget"], 'warn');
            }
            else {
                Templ.register({"fan/signup/fan_signup_pane":["<form id=\"signup-vm\" class='signup-form modern-form signup-common-form ",{"blocks":[{"attachment":["visible"],"expression":"show ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible, \"immediate\": immediate }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n\n    <div class=\"signup-common-inner\">\n\n        <div class=\"item dialog-body choose-your-url\" data-bind=\"visible: loggedIn() && !showExistingArtist()\" style=\"display: none;\">\n            ",{"nodelist":["Please choose a URL for your fan account:"],"type":"translate"},"\n        </div>\n\n        <div class=\"item dialog-body existing-artist-standalone\" data-bind=\"visible: showExistingArtist\" ",{"blocks":[{"attachment":["style=\"display: none;\""],"expression":"pagedata && pagedata.identities && !pagedata.identities.user ","type":"ncondition"}],"type":"ef"},">\n            <p>",{"nodelist":["Greetings!"],"type":"translate"},"</p>\n\n            <p>",{"nodelist":["Fan accounts let you follow other artists and fans, give you instant streaming of your purchases via the free Bandcamp app, and <a ",{"nodelist":["target=\"_blank\" href=\"/fans\""],"type":"translateVariable","var_name":"fanslink"},">lots more</a>."],"type":"translate"},"</p>\n            \n            <p>",{"nodelist":["<strong>To add a Bandcamp fan account to your artist account, enter a fan URL below.</strong> If you prefer to keep your fan account separate from your artist account, please log out and return to sign up."],"type":"translate"},"</p>\n        </div>\n\n        <div class=\"skinny\">\n            ",{"blocks":[{"attachment":["\n                <div class=\"download-item-small-space-saver\">\n                ",{"blocks":[{"attachment":["\n                    ",{"template_name":"'account/download_item_small'","type":"include"},"\n                "],"expression":"rendered ","type":"ncondition"}],"type":"ef"},"\n                </div>\n            "],"expression":"download_item ","type":"ncondition"}],"type":"ef"},"\n            <div class=\"before-chooser\" data-bind=\"css: { 'disabled': chooserVisible }\">\n                <div class=\"existing-account-wrapper\" data-bind=\"css: { 'show-existing': inlineLoginVisible }\">\n                    <div class=\"item\" data-bind=\"visible: !loggedIn()\" ",{"blocks":[{"attachment":["style=\"display: none;\""],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"}],"type":"ef"},">\n                        ",{"blocks":[{"attachment":["<label for=\"email-input\" class=\"email-label\">",{"nodelist":["Email address"],"type":"translate"},"</label>"],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"\n                        <div class=\"email\">\n                            <div class=\"email-inner jquery-placeholder-wrapper\">\n                                <input id=\"email-input\" class=\"email-input\" type=\"email\" data-bind=\"\n                                    value: email,\n                                    hasfocus: email.focused,\n                                    valueUpdate: ['input', 'afterkeydown'],\n                                    css: {\n                                        'has-validation-error': email.error_msg(),\n                                        'error': email.error_msg()\n                                    },\n                                    enable: !chooserVisible()\n                                \" ",{"blocks":[{"attachment":["placeholder=\"",{"nodelist":["email"],"type":"translate"},"\""],"expression":"is_phone ","type":"ncondition"}],"type":"ef"}," disabled>\n                            </div>\n                            <span data-bind=\"visible: email.checking\" style=\"display: none;\">\n                                <!-- <img class=\"email-checking\" src=\"/img/playerbusy_transp.gif\"> -->\n                            </span>\n                            <div class=\"error-bubble log-in-error\" style=\"display: none;\" data-bind=\"animateVisible: email.error_key() === 'existing_fan'\"><span class=\"message\">",{"nodelist":["A fan with that email address already exists. Please <a ",{"nodelist":["href=\"#\" data-bind=\"click: function () { openLogin(true); }\""],"type":"translateVariable","var_name":"login_link"},">log in</a>."],"type":"translate"},"</span></div>\n                            <div class=\"error-bubble\" style=\"display: none;\" data-bind=\"animateVisible: email.error_key() === 'fan_already_linked_email'\"><span class=\"message\">",{"nodelist":["That address is attached to an existing fan account, but is not the primary address used for login. Please <a ",{"nodelist":["href=\"#\" data-bind=\"click: function () { openLogin(true); }\""],"type":"translateVariable","var_name":"login_link"},">log in</a> with your primary address."],"type":"translate"},"</span></div>\n                            <div class=\"error-bubble\" style=\"display: none;\" data-bind=\"animateVisible: email.error_key() === 'invalid'\"><span class=\"message\">",{"nodelist":["That email address doesnt look right."],"type":"translate"},"</span></div>\n                        </div>\n                    </div>\n\n                    <div data-bind=\"css: { 'show': inlineLoginVisible }\" class=\"existing-account-login\">\n                        <div class=\"account-message\">\n                            <p>\n                            <strong>",{"nodelist":["This address is associated with an existing artist account."],"type":"translate"},"</strong>\n                            ",{"blocks":[{"attachment":["</p><p>"],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},"\n                            ",{"nodelist":["To add a Bandcamp fan account to your artist account, enter your password below. If you prefer to keep your fan account separate from your artist account, enter a different email address above."],"type":"translate"},"</p>\n                            <p>",{"nodelist":["Fan accounts let you follow other artists and fans, give you instant streaming of your purchases via the free Bandcamp app, and <a ",{"nodelist":["href=\"/fans\""],"type":"translateVariable","var_name":"fanslink"},">lots more</a>."],"type":"translate"},"</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"item\" data-bind=\"visible: !loggedIn()\" ",{"blocks":[{"attachment":["style=\"display: none;\""],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"}],"type":"ef"},">\n                    ",{"blocks":[{"attachment":["<label for=\"password-input\" class=\"password-label\">\n                        <span>\n                            ",{"nodelist":["Password"],"type":"translate"},"\n                        </span>\n                    </label>"],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"\n                    <div class=\"password\" data-bind=\"visible: !passwordMasked()\">\n                        <div class=\"password-inner jquery-placeholder-wrapper\">\n                            <input id=\"password-input\" type=\"password\" class=\"password-input\" data-bind=\"\n                                value: password,\n                                errorBubble: password.error_msg,\n                                valueUpdate: 'input',\n                                hasfocus: password.focused,\n                                css: {\n                                    'has-validation-error': password.error_msg()\n                                },\n                                enable: !chooserVisible()\n                            \" ",{"blocks":[{"attachment":["placeholder=\"",{"nodelist":["password"],"type":"translate"},"\""],"expression":"is_phone ","type":"ncondition"}],"type":"ef"}," disabled autocomplete=\"new-password\">\n                        </div>\n                        <div class=\"error-bubble\" style=\"display: none;\">\n                            <span class=\"message\"></span>\n                            <span data-bind='visible: password.error_key() === \"incorrect\"' style=\"display: none;\">\n                                <!-- <a data-bind=\"click: function() { openForgotPassword(); }\">forgot your password?</a> -->\n                                <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/forgot_password\">",{"nodelist":["Forgot your password?"],"type":"translate"},"</a>\n                            </span>\n                        </div>\n                    </div>\n                    <div class=\"password masked\" data-bind=\"visible: passwordMasked\" style=\"display: none;\">\n                        &bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;\n                    </div>\n                </div>\n\n                ",{"nodelist":[{"blocks":[{"attachment":[{"nodelist":["choose your fan URL"],"type":"translate"}],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"},{"attachment":[{"nodelist":["username"],"type":"translate"}],"type":"else_ncondition"}],"type":"ef"}],"to":"placeholder","type":"capture"},"\n\n                ",{"nodelist":[{"blocks":[{"attachment":[{"nodelist":["Choose your fan URL"],"type":"translate"}],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"},{"attachment":[{"nodelist":["Username"],"type":"translate"}],"type":"else_ncondition"}],"type":"ef"}],"to":"username_label","type":"capture"},"\n\n                <div class=\"item ",{"blocks":[{"attachment":["existing-artist"],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"}],"type":"ef"},"\" data-bind=\"css: { 'existing-artist': loggedIn }\">\n                    ",{"blocks":[{"attachment":["<label for=\"username-input\" class=\"username-label\" data-bind=\"text: username.label, css: { 'artist-email': inlineLoginVisible }\">",{"filters":[],"name":"username_label","type":"variable"},"</label>"],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"\n                    <div class=\"username\" data-bind=\"css: { 'artist-email': inlineLoginVisible }\">\n                        <div class=\"username-inner jquery-placeholder-wrapper\">\n                            <div class=\"bandcamp-com\"><span>bandcamp.com/</span></div><input id=\"username-input\" type=\"text\" class=\"username-input\" data-bind=\"\n                                value: username.display,\n                                valueUpdate: 'input',\n                                hasfocus: username.focused,\n                                css: {\n                                    'has-validation-error': username.error_msg(),\n                                    'error': username.error_msg()\n                                },\n                                enable: !chooserVisible()",{"blocks":[{"attachment":[",\n                                attr: {\n                                    'placeholder': username.placeholder\n                                }"],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},"\n                            \" ",{"blocks":[{"attachment":["placeholder=\"",{"filters":[],"name":"placeholder","type":"variable"},"\""],"expression":"is_phone ","type":"ncondition"}],"type":"ef"}," disabled autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\">\n                        </div>\n                        <div class=\"error-bubble\" style=\"display: none;\" data-bind=\"animateVisible: usernameIsURL() && username.error_key()\">\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'missing'\">\n                                ",{"nodelist":["Please choose your URL."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'tooShort'\">\n                                ",{"nodelist":["Your URL must be at least 3 characters."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'tooLong'\">\n                                ",{"nodelist":["Your URL can be at most 60 characters."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'duplicate'\">\n                                ",{"nodelist":["That URL is already taken."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'invalid'\">\n                                ",{"nodelist":["Your URL must only contain letters, numbers, dashes, or underscores."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'undies'\">\n                                ",{"nodelist":["Your URL must contain at least one letter, number, or dash."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'isEmail'\">\n                                ",{"nodelist":["Your URL cannot be an email address."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'existingFanLoggedIn'\">\n                                ",{"nodelist":["A fan with that email address already exists. Please <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout?login=1\""],"type":"translateVariable","var_name":"login_link"},">log in</a>."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'fanAlreadyLinkedEmail'\">\n                                ",{"nodelist":["That address is attached to an existing fan account, but is not the primary address used for login. Please <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout?login=1\""],"type":"translateVariable","var_name":"login_link"},">log in</a> with your primary address."],"type":"translate"},"\n                            </span>\n\n                            <span data-bind=\"visible: suggestedUsername\">",{"nodelist":["How about ",{"nodelist":["<strong><a href=\"#\" data-bind=\"text: suggestedUsername, click: function () { useSuggestedUsername(); }\"></a></strong>"],"type":"translateVariable","var_name":"suggested_username"},"?"],"type":"translate"},"</span>\n                        </div>\n                        <div class=\"error-bubble\" style=\"display: none;\" data-bind=\"animateVisible: !usernameIsURL() && username.error_key()\">\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'missing'\">\n                                ",{"nodelist":["Please choose your username."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'tooShort'\">\n                                ",{"nodelist":["Your username must be at least 3 characters."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'tooLong'\">\n                                ",{"nodelist":["Your username can be at most 60 characters."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'duplicate'\">\n                                ",{"nodelist":["That username is already taken."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'invalid'\">\n                                ",{"nodelist":["Your username must only contain letters, numbers, dashes, or underscores."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'undies'\">\n                                ",{"nodelist":["Your username must contain at least one letter, number, or dash."],"type":"translate"},"\n                            </span>\n                            <span class=\"message\" data-bind=\"visible: username.error_key() === 'isEmail'\">\n                                ",{"nodelist":["Your username cannot be an email address."],"type":"translate"},"\n                            </span>\n\n                            <span data-bind=\"visible: suggestedUsername\">",{"nodelist":["How about ",{"nodelist":["<strong><a href=\"#\" data-bind=\"text: suggestedUsername, click: function () { useSuggestedUsername(); }\"></a></strong>"],"type":"translateVariable","var_name":"suggested_username"},"?"],"type":"translate"},"</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"item\">\n                    ",{"blocks":[{"attachment":["\n                    <div class=\"save-card\">\n                        <div class='save-card-inner jquery-placeholder-wrapper'>\n                            ",{"blocks":[{"attachment":["\n                            <div class=\"fancy-checkbox\">\n                                <input type=\"checkbox\" value=\"None\" id=\"save-card-input\" data-bind=\"\n                                    checked: saveCard,\n                                    enable: !chooserVisible()\n                                \" disabled>\n                                <label for=\"save-card-input\"></label>\n                            </div>\n                            "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                            <input id=\"save-card-input\" type=\"checkbox\" class=\"save-card-input\" data-bind=\"\n                                checked: saveCard,\n                                enable: !chooserVisible()\n                            \" disabled>\n                            "],"type":"else_ncondition"}],"type":"ef"},"\n                            <label for=\"save-card-input\" class=\"save-card-label\">\n                                <span class='terms-text'>\n                                    ",{"nodelist":["Remember my card for faster checkout."],"type":"translate"},"\n                                </span>\n                            </label>\n                        </div>\n                    </div>\n                    "],"expression":"signup_params.save_card ","type":"ncondition"}],"type":"ef"},"\n\n                    ",{"blocks":[{"attachment":["\n                    <div class=\"notify-me-container\">\n                        <div class=\"first\">\n                            <label for=\"notify-me-band\" class=\"notify-me\">\n                                <input id=\"notify-me-band\" name=\"notify-me-band\" type=\"checkbox\" data-bind=\"checked: notifyMeBand\" class=\"notify-me-checkbox\">\n                                <div class=\"notify-me-message\">",{"nodelist":["Add me to the mailing list for ",{"nodelist":[{"filters":[["h",[]]],"name":"artist","type":"variable"}],"type":"translateVariable","var_name":"seller"},"."],"type":"translate"},"</div>\n                            </label>\n                        </div>\n                        ",{"blocks":[{"attachment":["\n                        <div>\n                            <label for=\"notify-me-label\" class=\"notify-me\">\n                                <input id=\"notify-me-label\" name=\"notify-me-label\" type=\"checkbox\" data-bind=\"checked: notifyMeLabel\" class=\"notify-me-checkbox\">\n                                <div class=\"notify-me-message\">",{"nodelist":["Add me to the mailing list for ",{"nodelist":[{"filters":[["h",[]]],"name":"label","type":"variable"}],"type":"translateVariable","var_name":"seller"},"."],"type":"translate"},"</div>\n                            </label>\n                        </div>\n                        "],"expression":"label ","type":"ncondition"}],"type":"ef"},"\n                    </div>\n                    "],"expression":"show_notify_me ","type":"ncondition"}],"type":"ef"},"\n\n                    <div class=\"tos\">\n                        <div class='tos-inner jquery-placeholder-wrapper'>\n                            ",{"blocks":[{"attachment":["\n                            <div class=\"fancy-checkbox\">\n                                <input type=\"checkbox\" value=\"None\" id=\"tos-input\" data-bind=\"\n                                    checked: tos,\n                                    errorBubble: tos.error_msg,\n                                    css: {\n                                        'has-validation-error': tos.error_msg()\n                                    },\n                                    enable: !chooserVisible()\n                                \" disabled>\n                                <label for=\"tos-input\"></label>\n                            </div>\n                            "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                            <input id=\"tos-input\" type=\"checkbox\" class=\"tos-input\" data-bind=\"\n                                checked: tos,\n                                errorBubble: tos.error_msg,\n                                css: {\n                                    'has-validation-error': tos.error_msg()\n                                },\n                                enable: !chooserVisible()\n                            \" disabled>\n                            "],"type":"else_ncondition"}],"type":"ef"},"\n                            <label for=\"tos-input\" class=\"tos-label\">\n                                <span class='terms-text'>\n                                    ",{"nodelist":["I have read and agree to the <a ",{"nodelist":["href='/terms_of_use' target='_blank'"],"type":"translateVariable","var_name":"link"},">Terms of Use</a>."],"type":"translate"},"\n                                </span>\n                            </label>\n                        </div>\n                        <div class=\"error-bubble\" style=\"display: none;\"><span class=\"message\"></span></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"item\" data-bind=\"animateVisible: chooserVisible, animationType: 'slide'\" style=\"display: none;\">\n                <div class=\"chooser\">\n                    <div class=\"chooser-message\">",{"nodelist":["Please choose an artist account to associate this fan account with:"],"type":"translate"},"</div>\n                    <select data-bind=\"options: possibleUsers,\n                        optionsText: function(user) {\n                            return formatUser(user);\n                        },\n                        value: selectedUser\n                    \"></select>\n                </div>\n            </div>\n\n            <div class=\"buttons\" data-bind=\"css: { 'no-bottom-link': !bottomLinkVisible() }\">\n                <button class=\"submit\" type='submit' data-bind='enable: submitEnabled'>\n                    <span data-bind=\"text: submitText\">\n                        ",{"blocks":[{"attachment":["\n                            ",{"nodelist":["Complete setup"],"type":"translate"},"\n                        "],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"},{"attachment":["\n                            ",{"nodelist":["Sign up"],"type":"translate"},"\n                        "],"type":"else_ncondition"}],"type":"ef"},"\n                    </span>\n                </button>\n            </div>\n\n            <div class=\"item\" data-bind=\"visible: bottomLinkVisible\" ",{"blocks":[{"attachment":["style=\"display: none;\""],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"}],"type":"ef"},">\n                <div class=\"login-link hint\">\n                    ",{"nodelist":["Already have an account? <a ",{"nodelist":["href=\"#\" data-bind=\"click: function() { openLogin(); }\""],"type":"translateVariable","var_name":"login_link"},">Log in</a>."],"type":"translate"},"\n                </div>\n                ",{"blocks":[{"attachment":["\n                <div class=\"artist-signup hint\" data-bind=\"visible: artistSignupVisible\" ",{"blocks":[{"attachment":["style=\"display: none;\""],"expression":"pagedata && pagedata.identities && pagedata.identities.user ","type":"ncondition"}],"type":"ef"},">\n                    ",{"nodelist":["Are you an artist? <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/signup\""],"type":"translateVariable","var_name":"signup_link"},">Sign up for an artist account</a>."],"type":"translate"},"\n                </div>\n                "],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"\n            </div>\n        </div>\n        </div>\n</form>\n"],
"fan/signup/fan_login_pane":["<form id=\"signup-vm\" class='login-form modern-form signup-common-form ",{"blocks":[{"attachment":["visible"],"expression":"show ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n\n    <div class=\"signup-common-inner\">\n        <div class=\"before-chooser\" data-bind=\"css: { 'disabled': userChooserVisible }\">\n            <div class=\"item\">\n                ",{"blocks":[{"attachment":["<label for=\"email-input\" class=\"email-label\">",{"nodelist":["Username / email"],"type":"translate"},"</label>"],"expression":"!is_phone && !portable ","type":"ncondition"}],"type":"ef"},"\n                <div class=\"email\">\n                    <div class=\"email-inner jquery-placeholder-wrapper\">\n                        <input id=\"email-input\" type=\"email\" class=\"email-input\" data-bind=\"\n                            value: email,\n                            errorBubble: email.error_msg,\n                            valueUpdate: 'input',\n                            hasfocus: email.focused,\n                            css: {\n                                'has-validation-error': email.error_msg()\n                            }\n                        \" ",{"blocks":[{"attachment":["placeholder=\"",{"blocks":[{"attachment":[{"nodelist":["username / email"],"type":"translate"}],"expression":"is_phone ","type":"ncondition"},{"attachment":[{"nodelist":["Username / email"],"type":"translate"}],"type":"else_ncondition"}],"type":"ef"},"\""],"expression":"is_phone || portable ","type":"ncondition"}],"type":"ef"},">\n                    </div>\n                    <div class=\"error-bubble\" style=\"display: none;\"><span class=\"message\"></span></div>\n                </div>\n            </div>\n\n            <div class=\"item pass\">\n                ",{"blocks":[{"attachment":["<label for=\"password-input\" class=\"password-label\">",{"nodelist":["Password"],"type":"translate"},"</label>"],"expression":"!is_phone && !portable ","type":"ncondition"}],"type":"ef"},"\n                <div class=\"password\">\n                    <div class=\"password-inner jquery-placeholder-wrapper\">\n                        <input id=\"password-input\" type=\"password\" class=\"password-input\" data-bind=\"\n                            value: password,\n                            errorBubble: password.error_msg,\n                            valueUpdate: 'input',\n                            hasfocus: password.focused,\n                            css: {\n                                'has-validation-error': password.error_msg()\n                            }\n                        \" ",{"blocks":[{"attachment":["placeholder=\"",{"blocks":[{"attachment":[{"nodelist":["password"],"type":"translate"}],"expression":"is_phone ","type":"ncondition"},{"attachment":[{"nodelist":["Password"],"type":"translate"}],"type":"else_ncondition"}],"type":"ef"},"\""],"expression":"is_phone || portable ","type":"ncondition"}],"type":"ef"},">\n                    </div>\n                    <div class=\"error-bubble\" style=\"display: none;\"><span class=\"message\"></span></div>\n                </div>\n            </div>\n\n            <div class=\"two-factor\" data-bind=\"animateVisible: twofactorVisible, animationType: 'slide'\" style=\"display: none;\">\n                <div class=\"two-factor-heading-item\">",{"nodelist":["Please enter your two-factor authentication code below:"],"type":"translate"},"</div>\n\n                <div class=\"item\">\n                    ",{"blocks":[{"attachment":["<label for=\"two-factor-code-input\" class=\"two-factor-code-label\">",{"nodelist":["Code"],"type":"translate"},"</label>"],"expression":"!is_phone && !portable ","type":"ncondition"}],"type":"ef"},"\n                    <div class=\"two-factor-code\">\n                        <div class=\"two-factor-code-inner jquery-placeholder-wrapper\">\n                            <input id=\"two-factor-code-input\" type=\"text\" class=\"two-factor-code-input\" data-bind=\"\n                                value: twofactor,\n                                errorBubble: twofactor.error_msg,\n                                valueUpdate: 'input',\n                                hasfocus: twofactor.focused,\n                                css: {\n                                    'has-validation-error': twofactor.error_msg()\n                                }\n                            \" ",{"blocks":[{"attachment":["placeholder=\"",{"nodelist":["code"],"type":"translate"},"\""],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},">\n                        </div>\n                        <div class=\"error-bubble\"><span class=\"message\"></span></div>\n                    </div>\n                </div>\n\n                <div class=\"item two-factor-remember-wrapper\">\n                    <div class=\"item-inner two-factor-remember\">\n                        ",{"blocks":[{"attachment":["\n                        <div class=\"fancy-checkbox\">\n                            <input id=\"two-factor-remember-input\" type=\"checkbox\" class=\"two-factor-remember-input\" data-bind=\"\n                                checked: twofactorRemember,\n                                valueUpdate: 'input'\n                            \">\n                            <label for=\"two-factor-remember-input\"></label>\n                        </div>\n                        "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                        <input id=\"two-factor-remember-input\" type=\"checkbox\" class=\"two-factor-remember-input\" data-bind=\"\n                            checked: twofactorRemember,\n                            valueUpdate: 'input'\n                        \">\n                        "],"type":"else_ncondition"}],"type":"ef"},"\n                        <label for=\"two-factor-remember-input\" class=\"two-factor-remember-label\">",{"nodelist":["Remember this computer for 30 days"],"type":"translate"},"</label>\n                        <div class=\"error-bubble\"><span class=\"message\"></span></div>\n                    </div>\n                </div>\n\n                <div class=\"no-phone\" data-bind=\"visible: !twofactorHelpVisible()\">\n                    <a data-bind=\"click: showTwoFactorHelp\">",{"nodelist":["Help! I cant access my phone!"],"type":"translate"},"</a>\n                </div>\n            </div>\n\n            <div class=\"item two-factor-help\" data-bind=\"animateVisible: twofactorHelpVisible, animationType: 'slide'\" style=\"display: none;\">\n                <h3>",{"nodelist":["I dont have my phone on me right now"],"type":"translate"},"</h3>\n                <div class=\"help-text\">\n                    ",{"nodelist":["If you dont currently have access to your phone, youll need to log in using one of your backup codes. Enter one of your backup codes in the box above and log in as usual."],"type":"translate"},"\n                </div>\n                <div class=\"help-text\">\n                    ",{"nodelist":["Each backup code can only be used once, so once youve logged in, you should open your two-factor authentication settings (within your user settings) and generate a fresh set of backup codes if youre running short."],"type":"translate"},"\n                </div>\n                \n                <h3>",{"nodelist":["Ive lost or replaced my phone"],"type":"translate"},"</h3>\n                <div class=\"help-text\">\n                    ",{"nodelist":["Once youve logged in using a backup code as above, open your two-factor authentication settings and click the \"Add another authentication method\" link to add your new device."],"type":"translate"},"\n                </div>\n            </div>\n        </div>\n\n        <div class=\"item\" data-bind=\"animateVisible: userChooserVisible, animationType: 'slide'\" style=\"display: none;\">\n            <div class=\"chooser\">\n                <div class=\"chooser-message\">",{"nodelist":["Please choose an account:"],"type":"translate"},"</div>\n                <select data-bind=\"options: possibleUsers,\n                    optionsText: function(user) {\n                        return formatUser(user);\n                    },\n                    value: selectedUser\n                \"></select>\n            </div>\n        </div>\n\n        <div class=\"buttons\">\n            <button class=\"submit\" type=\"submit\" data-bind=\"enable: submitEnabled\">\n                <div data-bind=\"visible: !submitting()\">",{"nodelist":["Log in"],"type":"translate"},"</div>\n                <div data-bind=\"visible: submitting()\" style=\"display: none;\">",{"nodelist":["Please wait"],"type":"translate"},"&hellip;</div>\n            </button>\n        </div>\n\n        <div class=\"forgot-password-wrapper\">\n            <div class=\"forgot-password\">\n                <!-- <a href=\"#\" data-bind=\"click: function() { forgotPassword(); }\">Forgot your password?</a> -->\n                <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/forgot_password\">",{"nodelist":["Forgot your password?"],"type":"translate"},"</a>\n            </div>\n\n            <div class=\"change-email\">\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Sign up as <a ",{"nodelist":["href=\"#\" data-bind=\"click: function() { backToSignup(); }\""],"type":"translateVariable","var_name":"fan_link"},">a fan</a>, <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/signup\""],"type":"translateVariable","var_name":"artist_link"},">an artist</a> or <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/labels\""],"type":"translateVariable","var_name":"label_link"},">a label</a>."],"type":"translate"},"\n                "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Dont have an account? <a ",{"nodelist":["href=\"#\" data-bind=\"click: function() { backToSignup(); }\""],"type":"translateVariable","var_name":"fan_link"},">Sign up as a fan</a>."],"type":"translate"},"\n                "],"expression":"fan_signup_only ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Dont have an account? Sign up as <a ",{"nodelist":["href=\"#\" data-bind=\"click: function() { backToSignup(); }\""],"type":"translateVariable","var_name":"fan_link"},">a fan</a>, <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/signup\""],"type":"translateVariable","var_name":"artist_link"},">an artist</a> or <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/labels\""],"type":"translateVariable","var_name":"label_link"},">a label</a>."],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            </div>\n        </div>\n    </div>\n</form>\n"],
"fan/signup/fan_forgot_password_pane":["<form id=\"signup-vm\" class='forgot-password-form modern-form signup-common-form' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n\n    <div class=\"signup-common-inner\">\n        <div data-bind=\"visible: !sent()\">\n\n            <div class=\"item heading-item\">\n                ",{"nodelist":["Enter your email address below to reset your password:"],"type":"translate"},"\n            </div>\n\n            <div class=\"item\">\n                <div class=\"email\">\n                    <div class=\"email-inner jquery-placeholder-wrapper\">\n                        <input id=\"email-input\" class=\"email-input\" type=\"email\" data-bind=\"\n                            value: email,\n                            valueUpdate: 'input',\n                            errorBubble: email.error_msg\n                        \" placeholder=\"",{"nodelist":["Email address"],"type":"translate"},"\">\n                    </div>\n                    <div class=\"error-bubble\"><span class=\"message\"></span></div>\n                </div>\n            </div>\n\n            <div class=\"buttons\">\n                <button class=\"submit\" type=\"submit\" data-bind=\"click: submit, disable: submitDisabled\" disabled>\n                    ",{"nodelist":["Send"],"type":"translate"},"\n                </button>\n            </div>\n\n            <div class=\"change-email\">\n                <a href=\"#\" data-bind=\"click: function() { backToSignup(); }\">",{"nodelist":["Back to signup."],"type":"translate"},"</a>\n            </div>\n        </div>\n\n        <div data-bind=\"visible: sent\">\n            <div class=\"done\">\n                ",{"nodelist":["Thanks! Weve sent a password reset email to ",{"nodelist":["<span data-bind=\"text: email\"></span>"],"type":"translateVariable","var_name":"email_addr"},"."],"type":"translate"},"\n            </div>\n        </div>\n    </div>\n</form>\n"],
"fan/signup/fan_reset_password_pane":["<form id=\"signup-vm\" class='signup-form modern-form' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n\n    <div class=\"signup-common-inner\">\n        <!-- ko if: unrecoverableError() -->\n            <div class=\"item\">\n                ",{"nodelist":["Something is wrong and we cant reset your password. Here are some ideas for what\n                might be happening:"],"type":"translate"},"\n                <ul>\n                    <li>\n                        ",{"nodelist":["More than twenty-four hours has passed since you requested a password reset.\n                        For security, we limit the amount of time a password reset email can\n                        be used."],"type":"translate"},"  \n                    </li>\n                    <li>\n                        ",{"nodelist":["You clicked on a link in the reset password email, but the entire URL\n                        didnt make it through. Try copying the URL out of your email client\n                        and pasting it in the browsers location field."],"type":"translate"},"\n                    </li>\n                    <li>\n                        ",{"nodelist":["Youve already reset your password using this URL, or the URL from another email."],"type":"translate"},"\n                    </li>\n                </ul>\n            </div>\n        <!-- /ko -->\n\n        <!-- ko if: !unrecoverableError() && !reset() -->\n            <div class=\"item heading-item\">\n                ",{"nodelist":["Please enter a new password below."],"type":"translate"},"\n            </div>\n\n            <div class=\"divider\"></div>\n\n            <div class=\"item\">\n                <label for=\"password-input\" class=\"password-label\">\n                    ",{"nodelist":["Password:"],"type":"translate"},"\n                </label>\n                <div class=\"password\">\n                    <div class=\"password-inner jquery-placeholder-wrapper\">\n                        <input id=\"password-input\" class=\"password-input\" type=\"password\" data-bind=\"\n                            value: password,\n                            valueUpdate: 'input',\n                            errorBubble: password.error_msg\n                            \">\n                    </div>\n                    <div class=\"error-bubble\"><span class=\"message\"></span></div>\n                </div>\n            </div>\n\n            <div class=\"buttons\">\n                <button class=\"submit\" type=\"submit\" data-bind=\"click: submit, disable: submitDisabled\">",{"nodelist":["Reset"],"type":"translate"},"</button>\n            </div>\n        <!-- /ko -->\n\n    </div>\n</form>\n"],
"fan/signup/fan_existing_artist_pane":["<form id=\"signup-vm\" class='existing-artist-form modern-form signup-common-form ",{"blocks":[{"attachment":["visible"],"expression":"show ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n    <div class=\"signup-common-inner\">\n        <div class=\"dialog-body\">\n            <p class=\"greetings\">",{"nodelist":["Greetings!"],"type":"translate"},"</p>\n            <p>\n            ",{"blocks":[{"attachment":["\n                    ",{"blocks":[{"attachment":["\n                        ",{"nodelist":["You have a Bandcamp artist account. To follow this artist, youll need a Bandcamp fan account."],"type":"translate"},"\n                    "],"expression":"!action_item_type || action_item_type == 'b' || action_item_type == \"album\" || action_item_type == \"track\" ","type":"ncondition"},{"attachment":["\n                        ",{"nodelist":["You have a Bandcamp artist account. To follow this fan, youll need a Bandcamp fan account."],"type":"translate"},"\n                    "],"expression":"action_item_type == 'f' ","type":"ncondition"}],"type":"ef"},"\n            "],"child_condition":null,"child_relation":null,"left":"action","operator":"==","right":"'follow'","type":"condition"},{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["You have a Bandcamp artist account. To complete wishlisting this album, youll need a Bandcamp fan account."],"type":"translate"},"</p>\n                "],"expression":"!action_item_type || action_item_type == 'a' || action_item_type == 'album' ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["You have a Bandcamp artist account. To complete wishlisting this track, youll need a Bandcamp fan account."],"type":"translate"},"\n                "],"expression":"action_item_type == 't' || action_item_type == 'track' ","type":"ncondition"}],"type":"ef"},"\n            "],"child_condition":null,"child_relation":null,"left":"action","operator":"==","right":"'wishlist'","type":"condition"},{"attachment":["\n                ",{"nodelist":["You have a Bandcamp artist account. To redeem this gift card, youll need a Bandcamp fan account."],"type":"translate"},"\n            "],"child_condition":null,"child_relation":null,"left":"action","operator":"==","right":"'redeem'","type":"condition"}],"type":"case"},"\n            ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Fan accounts let you follow other artists and fans, and <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans\""],"type":"translateVariable","var_name":"fanslink"},">lots more</a>."],"type":"translate"},"\n                "],"expression":"is_phone && unsupported_device ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Fan accounts let you follow other artists and fans, give you instant streaming of your purchases via the free Bandcamp app, and <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans\""],"type":"translateVariable","var_name":"fanslink"},">lots more</a>."],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"!action ","type":"ncondition"},{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Fan accounts also let you follow other artists and fans, and <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans\""],"type":"translateVariable","var_name":"fanslink"},">lots more</a>."],"type":"translate"},"\n                "],"expression":"is_phone && unsupported_device ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Fan accounts also let you follow other artists and fans, give you instant streaming of your purchases via the free Bandcamp app, and <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans\""],"type":"translateVariable","var_name":"fanslink"},">lots more</a>."],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n            </p>\n\n            <p>",{"nodelist":["Would you like your artist and fan account to be one and the same, or would you prefer to keep your fan account separate from your artist account?"],"type":"translate"},"</p>\n        </div>\n\n        ",{"nodelist":[{"attribs":{},"collection_name":"bands","nodelist":[{"filters":[["h",[]]],"name":"band.band_name","type":"variable"},{"blocks":[{"attachment":[", "],"expression":"!forloop.last ","type":"ncondition"}],"type":"ef"}],"reversed":null,"type":"for","variable_name":"band"}],"to":"band_list","type":"capture"},"\n\n        <div class=\"buttons\">\n            <button class=\"create-account\" type=\"submit\">\n                ",{"nodelist":["Create my fan account as part of the <br>",{"filters":[["h",[]]],"name":"user_name","type":"variable"}," (",{"filters":[],"name":"band_list","type":"variable"},") artist account"],"type":"translate"},"\n            </button>\n\n            ",{"blocks":[{"attachment":["\n            <button class=\"log-me-out\" data-bind=\"click: logout\">\n                ",{"nodelist":["Log out of ",{"filters":[["h",[]]],"name":"user_name","type":"variable"}," and log in to an existing fan account, or create a new one"],"type":"translate"},"\n            </button>\n            "],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},"\n        </div>\n        ",{"blocks":[{"attachment":["\n        <div class=\"or\">",{"nodelist":["or"],"type":"translate"},"</div>\n\n        <div class=\"change-email\">\n            <a href=\"#\" data-bind=\"click: logout\">",{"nodelist":["Log out of ",{"filters":[["h",[]]],"name":"user_name","type":"variable"}," and log in to an existing fan account, or create a new one"],"type":"translate"},"</a>\n        </div>\n        "],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"\n    </div>\n</form>\n"],
"fan/signup/fan_almost_there_pane":["<form id=\"signup-vm\" class='existing-artist-form modern-form signup-common-form' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n\n    <div class=\"signup-common-inner\">\n        <div class=\"dialog-body\">\n            ",{"blocks":[{"attachment":["\n                <div class=\"almost-there\">",{"nodelist":["Youre almost there!"],"type":"translate"},"</div>\n            "],"expression":"!portable && is_phone ","type":"ncondition"}],"type":"ef"},"\n            <div class=\"almost-there-confirm\">",{"nodelist":["Please check ",{"nodelist":["<i>",{"filters":[["h",[]]],"name":"email","type":"variable"},"</i>"],"type":"translateVariable","var_name":"new_fan_email"},"<br> to activate your account."],"type":"translate"},"</div>\n            <button class=\"almost-there-button\">",{"nodelist":["Got it"],"type":"translate"},"</button>\n        </div>\n    </div>\n</form>\n"],
"fan/signup/fan_welcome_pane":[{"blocks":[{"attachment":["\n",{"template_name":"'svg_shared'","type":"include"},"\n<form id=\"signup-vm\" class='modern-form signup-common-form welcome-form",{"blocks":[{"attachment":[" visible"],"expression":"signup_params.pane == 'welcome' ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <img class=\"welcome-banner\" src=\"/img/bandcamp-mobile-banner-first-time2x.jpg\">\n\n    <div class=\"signup-common-inner\">\n        <div class=\"dialog-body\">\n            <div class=\"welcome-fan\">\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Thanks. Your account is active!"],"type":"translate"},"\n                "],"expression":"is_activation_view || signup_params.pane == 'welcome' ","type":"ncondition"},{"attachment":["\n                    ",{"blocks":[{"attachment":["\n                        ",{"nodelist":["Welcome to your new, improved artist and fan account."],"type":"translate"},"\n                    "],"expression":"is_band_member ","type":"ncondition"},{"attachment":["\n                        ",{"nodelist":["Welcome ",{"nodelist":[{"filters":[["h",[]]],"name":"username","type":"variable"}],"type":"translateVariable","var_name":"fan_name"},"!"],"type":"translate"},"\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            </div>\n            ",{"blocks":[{"attachment":["\n                <button class=\"welcome-collection-button\">",{"nodelist":["View your public collection"],"type":"translate"},"</button>\n            "],"expression":"unsupported_device ","type":"ncondition"},{"attachment":["\n                <div class=\"welcome-message\">\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Get the free Bandcamp app, sign in and listen to your music now!"],"type":"translate"},"\n                "],"expression":"action ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Be sure to grab the free Bandcamp app:"],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n                </div>\n                <div class=\"button-container\">\n                    <a class=\"download-button blue-button\" href='",{"filters":[["a",[]]],"name":"platform_app_url","type":"variable"},"'>\n                        <div class=\"button-inner\">\n                            <svg class=\"icon app-phone-logo\" width=\"87px\" height=\"76px\" viewBox=\"0 0 43 37\"><use xlink:href=\"#grab-app-opensignup\"></svg>\n                            <div class=\"missing-app\">",{"nodelist":["Get the Bandcamp app!"],"type":"translate"},"</div>\n                        </div>\n                    </a>\n                    ",{"blocks":[{"attachment":["\n                    <a class=\"listen-button no-action\" href='",{"filters":[["a",[]]],"name":"mobile_app_url","type":"variable"},"'>\n                        <div class=\"button-inner\">\n                            <div class=\"app-play-text\">",{"nodelist":["I have the app! Launch now."],"type":"translate"},"</div>\n                        </div>\n                    </a>\n                    "],"expression":"!action ","type":"ncondition"},{"attachment":["\n                    <a class=\"listen-button\" href='",{"filters":[["a",[]]],"name":"mobile_app_url","type":"variable"},"'>\n                        <div class=\"button-inner\">\n                            <svg class=\"icon app-play-logo\" width=\"44px\" height=\"60px\" viewBox=\"0 0 44 60\"><use xlink:href=\"#play-app\"></svg>\n                            <div class=\"app-play-text\">",{"nodelist":["I have the app! Listen now."],"type":"translate"},"</div>\n                        </div>\n                    </a>\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                </div>\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </div>\n        ",{"blocks":[{"attachment":["\n        <div class=\"no-action-links\">\n            ",{"nodelist":["\n            Alternatively, <a ",{"nodelist":["href=\"/",{"filters":[["h",[]]],"name":"username","type":"variable"},"\""],"type":"translateVariable","var_name":"profile_href"},">view your profile</a><br>\n            or<br>\n            go to the <a ",{"nodelist":["href=\"/\""],"type":"translateVariable","var_name":"bandcamp_href"},">Bandcamp homepage</a>.\n            "],"type":"translate"},"\n        </div>\n        "],"expression":"!action ","type":"ncondition"}],"type":"ef"},"\n    </div>\n</form>\n"],"expression":"is_phone && !portable ","type":"ncondition"},{"attachment":["\n<form id=\"signup-vm\" class='modern-form signup-common-form welcome-form' data-bind='css: { \"visible\": visible }' novalidate>\n    <div class=\"modal-welcome-message\">\n        <div>\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Welcome to your new, improved artist<br> and fan account!"],"type":"translate"},"\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Be sure to get the free Bandcamp app:"],"type":"translate"},"\n                "],"expression":"!unsupported_device ","type":"ncondition"}],"type":"ef"},"\n            "],"expression":"is_band_member ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["Welcome to your new fan account!"],"type":"translate"},"<br>\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["Grab the free Bandcamp app:"],"type":"translate"},"\n                "],"expression":"!unsupported_device ","type":"ncondition"}],"type":"ef"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </div>\n    </div>\n    <div class=\"buttons\">\n        ",{"blocks":[{"attachment":["\n        <button class=\"login get-app\" type=\"submit\" data-bind=\"click: getApp\">\n            ",{"nodelist":["Get app"],"type":"translate"},"\n        </button>\n        "],"expression":"!unsupported_device ","type":"ncondition"}],"type":"ef"},"\n        <button class=\"ok-button ",{"blocks":[{"attachment":["unsupported"],"expression":"unsupported_device ","type":"ncondition"}],"type":"ef"},"\" data-bind=\"click: submit\">\n            ",{"nodelist":["Close"],"type":"translate"},"\n        </button>\n    </div>\n</form>\n"],"expression":"portable && is_phone ","type":"ncondition"},{"attachment":["\n<form id=\"signup-vm\" class='modern-form signup-common-form welcome-form' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <div class=\"modal-welcome-message\">\n        ",{"blocks":[{"attachment":["\n            ",{"nodelist":["\n            Welcome to your new, improved artist and fan account!\n            "],"type":"translate"},"\n\n            <br>\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["\n                Click the feed link in the menu bar to view the latest releases from the artists you follow, and more.\n                "],"type":"translate"},"\n            "],"expression":"action == \"follow\" ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["\n                To view your wishlist, click the wishlist link in the menu bar.\n                "],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n\n            <br>\n\n            ",{"nodelist":["\n            Also, be sure to grab the free Bandcamp app for <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"app_store_url","type":"variable"},"\" target=\"_blank\" "],"type":"translateVariable","var_name":"ios_link"},">iOS</a> or <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"play_store_url","type":"variable"},"\""],"type":"translateVariable","var_name":"android_link"},">Android</a>.\n            "],"type":"translate"},"\n        "],"expression":"is_band_member ","type":"ncondition"},{"attachment":["\n            ",{"nodelist":["\n            Welcome to your new fan account!\n            "],"type":"translate"},"\n\n            <br>\n            ",{"nodelist":["\n            Be sure to grab the free Bandcamp app for <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"app_store_url","type":"variable"},"\" target=\"_blank\" "],"type":"translateVariable","var_name":"ios_link"},">iOS</a> or <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"play_store_url","type":"variable"},"\""],"type":"translateVariable","var_name":"android_link"},">Android</a>.\n            "],"type":"translate"},"\n            <br>\n        "],"type":"else_ncondition"}],"type":"ef"},"\n    </div>\n    <button class=\"almost-there-button\">",{"nodelist":["OK"],"type":"translate"},"</button>\n</form>\n"],"expression":"portable ","type":"ncondition"},{"attachment":["\n<form id=\"signup-vm\" class='welcome-form modern-form signup-common-form visible' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <div class=\"signup-common-inner\">\n        <div class=\"welcome-inner\">\n            <div class=\"welcome-phone\">\n                <img src=\"img/phone-app-collection-welcome-1%402x.gif\"></img>\n            </div>\n            <div class=\"welcome-app-promo\">\n                <div>\n                    ",{"nodelist":["\n                    We suggest you grab the free Bandcamp app from the App Store or Google Play Store.\n                    "],"type":"translate"},"\n                </div>\n                <div class=\"welcome-app-button-container\">\n                    <a href=\"",{"filters":[["a",[]]],"name":"app_store_url","type":"variable"},"\" target=\"_blank\"><div class=\"store-button app-store\"></div></a>\n                    <a href=\"",{"filters":[["a",[]]],"name":"play_store_url","type":"variable"},"\" target=\"_blank\"><div class=\"store-button google-play-store\"></div></a>\n                </div>\n                <div>\n                    ",{"nodelist":["\n                    It gives you powerful ways to browse the music on Bandcamp, and unlimited streaming of your purchases. <a ",{"nodelist":["data-bind=\"click: appLinkModal\" href=\"#\""],"type":"translateVariable","var_name":"email_href"},">Email yourself a link</a> to the app (to open on your phone).\n                    "],"type":"translate"},"\n                </div>\n                <button data-bind=\"enable: buttonEnabled\">",{"nodelist":["Right, whats next?"],"type":"translate"},"</button>\n            </div>\n        </div>\n    </div>\n</form>\n"],"type":"else_ncondition"}],"type":"ef"},"\n"],
"fan/signup/fan_email_link":["<div class=\"welcome-email-app-link\" data-bind=\"visible: appLinkSent()\">\n    ",{"nodelist":["\n    A link to download the Bandcamp app has been sent to ",{"nodelist":["<strong><span data-bind=\"text: appLinkEmail\"></span></strong>"],"type":"translateVariable","var_name":"address"},".\n    "],"type":"translate"},"\n</div>\n<div class=\"welcome-app-email-buttons\" data-bind=\"visible: !appLinkSent()\">\n    <button data-bind=\"click: closeAppLinkModal\" class=\"no-thanks\" type=\"button\">",{"nodelist":["No Thanks"],"type":"translate"},"</button>\n    <button data-bind=\"click: sendAppLinkEmail\" class=\"send\" type=\"button\">",{"nodelist":["Send"],"type":"translate"},"</button>\n</div>\n<div class=\"welcome-app-email-buttons okay\" data-bind=\"visible: appLinkSent()\">\n    <button data-bind=\"click: closeAppLinkModal\" class=\"okay\" type=\"button\" display=\"display: none\">",{"nodelist":["OK"],"type":"translate"},"</button>\n</div>\n"],
"fan/signup/fan_verify_nag_pane":["<form id=\"nag-vm\" class='modern-form signup-common-form action-form verify-nag visible' data-bind='submit: submit' novalidate>\n    <div data-bind=\"visible: !submitted()\">\n        <div data-bind=\"visible: !changingEmail()\">\n            <div class=\"nag-verify-text\">\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["\n                    Please check ",{"nodelist":["<div class=\"nag-fan-email\" data-bind=\"text: fanEmail\"></div><br>"],"type":"translateVariable","var_name":"email"}," to activate your account.\n                    "],"type":"translate"},"\n                "],"expression":"email ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["\n                    Please check your email to activate your account.\n                    "],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            </div>\n            ",{"blocks":[{"attachment":["\n            <a class=\"nag-email-change\" data-bind=\"click: changeEmail\">",{"nodelist":["change email / send again"],"type":"translate"},"</a>\n            "],"expression":"email ","type":"ncondition"}],"type":"ef"},"\n            <div class=\"nag-buttons",{"blocks":[{"attachment":[" no-email"],"expression":"!email ","type":"ncondition"}],"type":"ef"},"\">\n                <button class=\"nag-got-it\">",{"nodelist":["Got it"],"type":"translate"},"</button>\n            </div>\n        </div>\n        <div data-bind=\"visible: changingEmail()\">\n             <div class=\"nag-verify-text\">\n                ",{"nodelist":["\n                Please enter your email address:\n                "],"type":"translate"},"\n            </div>\n            <div class=\"nag-email-input\">\n                <input type=\"text\" data-bind=\"css: {'error': emailError}, value: fanEmail\"></input>\n                <div class=\"error-bubble\" style=\"display: none\" data-bind=\"visible: alreadyAFanError\">",{"nodelist":["A fan with that email address already exists."],"type":"translate"},"</div>\n                <div class=\"error-bubble\" style=\"display: none\" data-bind=\"visible: fanAlreadyLinkedEmailError\">",{"nodelist":["That address is attached to an existing fan account, but is not the primary address used for login."],"type":"translate"},"</div>\n                <div class=\"error-bubble\" style=\"display: none\" data-bind=\"visible: invalidEmailError\">",{"nodelist":["That email address doesnt look right."],"type":"translate"},"</div>\n            </div>\n            <div class=\"nag-buttons\">\n                <button class=\"nag-send-again\">",{"nodelist":["Send again"],"type":"translate"},"</button>\n                <button class=\"nag-cancel login\" data-bind=\"click: cancel\">",{"nodelist":["Cancel"],"type":"translate"},"</button>\n            </div>\n        </div>\n    </div>\n    <div data-bind=\"visible: submitted()\" style=\"display: none\">\n        <div class=\"nag-email-sent\">\n            ",{"nodelist":["\n            Email sent!\n            "],"type":"translate"},"\n        </div>\n        <button class=\"nag-done\">",{"nodelist":["Done"],"type":"translate"},"</button>\n    </div>\n</form>\n"],
"fan/signup/fan_dupe_fan_pane":["<form id=\"signup-vm\" class='dupe-fan-form modern-form signup-common-form ",{"blocks":[{"attachment":["visible"],"expression":"show ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible }, submit: submit' novalidate>\n    <a id=\"signup-anchor\"></a>\n    <div class=\"signup-common-inner\">\n        <div class=\"dialog-body\">\n        ",{"blocks":[{"attachment":["\n            <p>",{"nodelist":["Hello! Your email address <strong>",{"filters":[["h",[]]],"name":"email","type":"variable"},"</strong><br> is already linked to a fan account."],"type":"translate"},"</p>\n\n            <p>",{"nodelist":["Please either <a ",{"nodelist":[" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout?login=1\""],"type":"translateVariable","var_name":"logout_link"},">log out and log in as the fan linked to this address</a> or <a ",{"nodelist":[" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/settings\""],"type":"translateVariable","var_name":"change_link"},">change your address</a> to create a new fan account."],"type":"translate"},"</p>\n        "],"expression":"fan ","type":"ncondition"},{"attachment":["\n            <p>",{"nodelist":["Hello! Your email address <strong>",{"filters":[["h",[]]],"name":"email","type":"variable"},"</strong> is attached to an existing fan account, but is not the primary address used for login."],"type":"translate"},"</p>\n\n            <p>",{"nodelist":["Please either <a ",{"nodelist":[" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout?login=1\""],"type":"translateVariable","var_name":"logout_link"},">log out and log in as the fan linked to this address</a> or <a ",{"nodelist":[" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/settings\""],"type":"translateVariable","var_name":"change_link"},">change your address</a> to create a new fan account."],"type":"translate"},"</p>\n        "],"expression":"fan_already_linked_email ","type":"ncondition"}],"type":"ef"},"\n        </div>\n    </div>\n</form>\n"],
"fan/signup/fan_choose_account_pane":["<form id=\"signup-vm\" class='choose-account-form modern-form signup-common-form ",{"blocks":[{"attachment":["standalone"],"expression":"signup_params.standalone ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible }' novalidate>\n    <ul class=\"accounts-list\">\n        <li class=\"fan account\">\n            <div class=\"icon\"></div>\n            <div class=\"description\">\n                <a class=\"signup-button open-fan-signup\" \n                    ",{"blocks":[{"attachment":["\n                        href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fan_signup?from=",{"filters":[["h",[]]],"name":"fans_from","type":"variable"},"\">\n                    "],"expression":"signup_params.standalone ","type":"ncondition"},{"attachment":["\n                        href=\"#\" data-bind=\"click: openFanSignup\">\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                    ",{"nodelist":["Sign up as a fan"],"type":"translate"},"\n                </a>\n                <div class=\"text\">\n                    ",{"nodelist":["Follow your favorite artists, keep a wishlist, get instant streaming of your purchases, showcase your collection, and explore the music of like-minded fans. <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans?from=",{"filters":[["h",[]]],"name":"fans_from","type":"variable"},"\""],"type":"translateVariable","var_name":"link"},">learn more</a>"],"type":"translate"},"\n                </div>\n            </div>\n        </li>\n        <li class=\"artist account\">\n            <div class=\"icon\"></div>\n            <div class=\"description\">\n                <a class=\"signup-button\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/artists?from=",{"filters":[["h",[]]],"name":"artists_from","type":"variable"},"\">",{"nodelist":["Sign up as an artist"],"type":"translate"},"</a>\n                <div class=\"text\">\n                    ",{"nodelist":["Sell directly to your fans with total control over your music and pricing. Easy access to your customers data, real-time stats, music chart reporting, and more. <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/artists?from=",{"filters":[["h",[]]],"name":"artists_from","type":"variable"},"\""],"type":"translateVariable","var_name":"link"},">learn more</a>"],"type":"translate"},"\n                </div>\n            </div>\n        </li>\n        <li class=\"label account\">\n            <div class=\"icon\"></div>\n            <div class=\"description\">\n                <a class=\"signup-button\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/labels?from=",{"filters":[["h",[]]],"name":"labels_from","type":"variable"},"\">",{"nodelist":["Sign up as a label"],"type":"translate"},"</a>\n                <div class=\"text\">\n                    ",{"nodelist":["Unified accounting and stats across all your artists, a single fulfillment interface for all your merch, direct payments on a per-release basis, and a whole lot more. <a ",{"nodelist":["href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/labels?from=",{"filters":[["h",[]]],"name":"labels_from","type":"variable"},"\""],"type":"translateVariable","var_name":"link"},">learn more</a>"],"type":"translate"},"\n                </div>\n            </div>\n        </li>\n    </ul>\n</form>\n"],
"fan/signup/fan_genre_picker_pane":["<form id=\"signup-vm\" class='genre-picker-form modern-form signup-common-form ",{"blocks":[{"attachment":["skinny"],"expression":"skinny ","type":"ncondition"}],"type":"ef"},"' data-bind='css: { \"visible\": visible, \"has-selected-genres\": selectedGenres().length > 0 }, click: deselectClick' novalidate>\n    <div class=\"heading-wrapper\" ",{"blocks":[{"attachment":["data-bind=\"visible: showGenres\""],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},">\n        <h3>",{"nodelist":["Welcome, ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_name","type":"variable"}],"type":"translateVariable","var_name":"fan_name"},"! What are your favorite genres?"],"type":"translate"},"</h3>\n        <h4>",{"nodelist":["This will help us recommend music youll love."],"type":"translate"},"</h4>\n    </div>\n    ",{"blocks":[{"attachment":["\n    <div class=\"heading-wrapper mobile\"data-bind=\"visible: showSubgenres\">\n        <h3>",{"nodelist":["Want to get more specific?"],"type":"translate"},"<br/>",{"nodelist":["Pick any subgenres you like."],"type":"translate"},"</h3>\n    </div>\n    "],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},"\n    ",{"blocks":[{"attachment":["\n        ",{"template_name":"'fan/signup/fan_genre_picker_selected_genres'","type":"include"},"\n    "],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"\n\n    <div class=\"genres-overflow-wrapper hide-scrollbar\" data-bind=\"",{"blocks":[{"attachment":["visible: showGenres, "],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},"style: { height: genres_overflow_wrapper_height() }\" >\n        <ul class=\"genres clearfix\" data-bind=\"foreach: genres\">\n            <li class=\"genre top-level\" data-bind=\"attr: { 'id': cssId }, css: { ",{"blocks":[{"attachment":["'expanded': hasExpandedClass,"],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"}," 'selected': selected, 'long': isLong, 'search': isSearch }, click: expand\">\n                <div class=\"content\">\n                    <!-- ko if: isSearch -->\n                    <h3 class=\"search-heading\">",{"nodelist":["Not quite finding what youre looking for?"],"type":"translate"},"</h3>\n                    <h4 class=\"search-subheading\">",{"nodelist":["Try searching instead."],"type":"translate"},"</h3>\n                    <!-- /ko -->\n                    <!-- ko if: !isSearch -->\n                    <h3 class=\"genre-name\" data-bind=\"click: function () { ",{"blocks":[{"attachment":["if (expanded())"],"expression":"!is_phone ","type":"ncondition"}],"type":"ef"},"  { toggleSelect(false); } }\">\n                        <span class=\"genre-icon\"></span><span class=\"genre-name-text\" data-bind=\"text: name\"></span>\n                    </h3>\n                    <ul class=\"subgenres\" data-bind=\"foreach: subgenres\">\n                        <li class=\"subgenre\" data-bind=\"css: { 'selected': selected }, click: function () { toggleSelect(false); }\">\n                            <h3 class=\"subgenre-name\">\n                                <span class=\"genre-icon\"></span><span data-bind=\"text: name\"></span>\n                            </h3>\n                        </li>\n                    </ul>\n                    <!-- /ko -->\n                </div>\n            </li>\n        </ul>\n        <div class=\"search-wrapper\" data-bind=\"css: { 'searching': searching }, click: searchWrapperClick\">\n            <h2>",{"nodelist":["You can also search for your favorite genres:"],"type":"translate"},"</h2>\n            <div class=\"search-input-wrapper\">\n                <input type=\"text\" data-bind=\"css: { 'selected': searchSelectIndex() === 0 }, value: searchTerm, valueUpdate: 'input', hasFocus: searchHasFocus, click: searchClick, event: { 'keydown': searchInputKeypress, 'mouseover': searchInputMouseover }\" placeholder=\"",{"nodelist":["Search for any genre"],"type":"translate"},"\">\n                <a class=\"search\" data-bind=\"click: function () { expandSearch(); }\">\n                    <span class=\"search-icon\">&nbsp;</span>\n                    <svg class=\"search-spinner\" width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#search-spinner\"></use></svg>\n                </a>\n            </div>\n\n            <div class=\"search-results\" data-bind=\"css: { 'results-visible': searchResults().length > 0 }, event: { 'keydown': searchResultsKeypress }, style: { top: search_results_top()}\">\n                <ul data-bind=\"foreach: searchResults\">\n                    <!-- ko if: $data.isEmpty -->\n                    <li class=\"empty\">\n                        <span>",{"nodelist":["Nothing here... yet!"],"type":"translate"},"</span>\n                    </li>\n                    <!-- /ko -->\n                    <!-- ko if: !$data.isEmpty -->\n                    <li tabindex=\"0\" data-bind=\"css: { 'selected': $parent.searchSelectIndex() === ($index() + 1) }, click: function () { $parent.selectSearchResult($data); }, event: { 'mouseover': function () { $parent.searchResultsMouseover($index()); } }\">\n                        <span data-bind=\"html: displayName\"></span>\n                        <span data-bind=\"text: countText\" class=\"count\"></span>\n                    </li>\n                    <!-- /ko -->\n                </ul>\n            </div>\n        </div>\n    </div>\n\n\n    ",{"blocks":[{"attachment":["\n        <div class=\"genres-overflow-wrapper mobile hide-scrollbar\" data-bind=\"visible: showSubgenres\">\n            <ul class=\"genres clearfix\" data-bind=\"foreach: genres\">\n                <li class=\"genre top-level expanded\" data-bind=\"attr: { 'id': cssId }, css: { 'long': isLong, 'search': isSearch }, click: expand\">\n                    <div class=\"content\">\n                        <!-- ko if: isSearch -->\n                        <h3 class=\"search-heading\">",{"nodelist":["Not quite finding what youre looking for?"],"type":"translate"},"</h3>\n                        <h4 class=\"search-subheading\">",{"nodelist":["Try searching instead."],"type":"translate"},"</h3>\n                        <!-- /ko -->\n                        <!-- ko if: !isSearch -->\n                        <div class='genre-title'>\n                            <span data-bind=\"text: name\"></span>\n                        </div>\n                        <ul class=\"subgenres mobile\">\n                            <li class=\"subgenre selected\" data-bind=\"css: { 'selected': selected }, click: function () { if (expanded()) { toggleSelect(false); } }\">\n                                <h3 class=\"subgenre-name\">\n                                    <span class=\"genre-icon\"></span>",{"nodelist":["all "],"type":"translate"},"<span data-bind=\"text: name\"></span>\n                                </h3>\n                            </li>\n                            <!-- ko foreach: subgenres -->\n                            <li class=\"subgenre\" data-bind=\"css: { 'selected': selected }, click: function () { toggleSelect(false); }\">\n                                <h3 class=\"subgenre-name\">\n                                    <span class=\"genre-icon\"></span><span data-bind=\"text: name\"></span>\n                                </h3>\n                            </li>\n                            <!-- /ko -->\n                        </ul>\n                        <!-- /ko -->\n                    </div>\n                </li>\n            </ul>\n        </div>\n\n        ",{"template_name":"'fan/signup/fan_genre_picker_selected_genres'","type":"include"},"\n    "],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},"\n\n    <div class=\"buttons\">\n        <button class=\"next\" data-bind=\"click: next, enable: submitEnabled, css: { 'disabled': selectedGenres().length === 0 }\">\n            <!-- ko if: submitting() -->\n            ",{"nodelist":["Please wait..."],"type":"translate"},"\n            <!-- /ko -->\n            <!-- ko if: !submitting() && standalone()-->\n            ",{"nodelist":["Submit"],"type":"translate"},"\n            <!-- /ko -->\n            <!-- ko if: !submitting() && !standalone()-->\n            ",{"nodelist":["Next"],"type":"translate"},"\n            <!-- /ko -->\n        </button>\n    </div>\n</form>\n"],
"fan/signup/fan_genre_picker_selected_genres":["<div class=\"selected-genres-wrapper\" ",{"blocks":[{"attachment":["data-bind=\"visible: showGenres\""],"expression":"is_phone ","type":"ncondition"}],"type":"ef"},">\n    <div class=\"list-wrapper\" data-bind=\"css: { 'has-genres': selectedGenres().length > 0, 'no-animation': selectedGenres.noAnimation() }\">\n        <ul class=\"selected-genres\" data-bind=\"foreach: selectedGenres\">\n            <!-- ko if: isFake -->\n            <li class=\"selected-genre-placeholder\"></li>\n            <!-- /ko -->\n            <!-- ko if: !isFake -->\n            <li class=\"selected-genre\" data-bind=\"click: function () { toggleSelect(true); }, css: { 'visible': visible, 'hiding': hiding }\">\n                <h3 class=\"genre-name\">\n                    <span class=\"genre-icon\"></span><span data-bind=\"text: displayName\"></span>\n                </h3>\n            </li>\n            <!-- /ko -->\n        </ul>\n    </div>\n\n    <a data-bind=\"click: pageLeft, visible: showPageLeft\" class=\"page page-left\">\n        <span class=\"page-fade\"></span>\n        <svg class=\"icon\" viewBox= \"0 0 16 16\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#larr-onboarding-ico\"></use></svg>\n    </a>\n    <a data-bind=\"click: pageRight, visible: showPageRight\" class=\"page page-right\">\n        <span class=\"page-fade\"></span>\n        <svg class=\"icon\" viewBox=\"0 0 16 16\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#rarr-onboarding-ico\"></use></svg>\n    </a>\n</div>\n"],
"fan/signup/fan_newsletter_picker_pane":["<form id=\"signup-vm\" class='newsletter-picker-form modern-form signup-common-form' data-bind='css: { \"visible\": visible }' novalidate>\n    <div class=\"heading-wrapper\">\n        <div class=\"icon\">\n            <img src=\"/img/fan_signup/record-2x.png\">\n        </div>\n        <div class=\"text wide\">\n            <!-- ko if: hasSelectedGenres -->\n            <h2>",{"nodelist":["Great! Would you like to recieve our weekly newsletter alerting you to the best new music in your favorite genres?"],"type":"translate"},"</h2>\n            <!-- /ko -->\n\n            <!-- ko if: !hasSelectedGenres -->\n            <h2>",{"nodelist":["Would you like to recieve our weekly newsletter alerting you to the best new music on Bandcamp?"],"type":"translate"},"</h2>\n            <!-- /ko -->\n        </div>\n    </div>\n\n    <div class=\"email-abuse\">\n        ",{"nodelist":["Emails will be sent to ",{"nodelist":[{"filters":[["h",[]]],"name":"email","type":"variable"}],"type":"translateVariable","var_name":"email"},"."],"type":"translate"},"\n    </div>\n\n    <div class=\"buttons split\">\n        <button class=\"yes\" data-bind=\"click: chooseBestOf, disable: submitting\">",{"nodelist":["Yes please"],"type":"translate"},"</button>\n        <button class=\"no\" data-bind=\"click: skip\">",{"nodelist":["No thanks"],"type":"translate"},"</button>\n    </div>\n</form>\n"],
"fan/signup/fan_welcome_2_pane":["<form id=\"signup-vm\" class='welcome-2-form modern-form signup-common-form' data-bind='css: { \"visible\": visible }' novalidate>\n    ",{"blocks":[{"attachment":["\n        <div class=\"icon\">\n            <img src=\"/img/fan_signup/tent-2x.png\">\n        </div>\n        <h2 class=\"welcome\"><div class=\"to-bandcamp\">",{"nodelist":["Welcome to Bandcamp!"],"type":"translate"},"</div> ",{"nodelist":["Lets take a quick look around."],"type":"translate"},"</h2>\n        <div class=\"buttons split\">\n            <button data-bind=\"click: submit\">",{"nodelist":["Yes, lets"],"type":"translate"},"</button><button data-bind=\"click: skip\">",{"nodelist":["No thanks"],"type":"translate"},"</button>\n        </div>\n    "],"expression":"show_tooltips ","type":"ncondition"},{"attachment":["\n        <h2 class=\"welcome no-tooltips\">",{"nodelist":["Thanks! Your account is now active."],"type":"translate"},"</h2>\n        <div class=\"buttons\">\n            <button data-bind=\"click: submit\">",{"nodelist":["Got it"],"type":"translate"},"</button>\n        </div>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n</form>\n"],
"login/user_picker_text":[{"filters":[["h",[]]],"name":"username","type":"variable"},"\n",{"blocks":[{"attachment":["\n    ",{"expression":"(list.length - 3) ","type":"let","variable":"num_others"},"\n    ",{"nodelist":[{"attribs":{"limit":3},"collection_name":"list","nodelist":[{"filters":[["h",[]]],"name":"name","type":"variable"},{"blocks":[{"attachment":[", "],"expression":"!forloop.last ","type":"ncondition"}],"type":"ef"}],"reversed":null,"type":"for","variable_name":"name"}],"to":"list","type":"capture"},"\n    ",{"nodelist":["(",{"filters":[],"name":"list","type":"variable"}," and ",{"filters":[],"name":"num_others","type":"variable"}," more)"],"type":"translate"},"\n"],"expression":"list.length > 4 ","type":"ncondition"},{"attachment":["\n    (",{"attribs":{},"collection_name":"list","nodelist":[{"filters":[["h",[]]],"name":"name","type":"variable"},{"blocks":[{"attachment":[", "],"expression":"!forloop.last ","type":"ncondition"}],"type":"ef"}],"reversed":null,"type":"for","variable_name":"name"},")\n"],"expression":"list.length > 0 ","type":"ncondition"}],"type":"ef"}],
"home_2016/fan_verify_banner":["<div class=\"corpbanner verify-email\" ",{"blocks":[{"attachment":["style=\"display: none;\""],"expression":"cc_menubar || !show_verify_banner ","type":"ncondition"}],"type":"ef"}," data-email=\"",{"filters":[["a",[]]],"name":"verify_email","type":"variable"},"\">\n    <div class=\"text\">\n        ",{"nodelist":["Hey! Please verify your email by clicking the link we sent to ",{"nodelist":[{"filters":[["h",[]]],"name":"verify_email","type":"variable"}],"type":"translateVariable","var_name":"verify_email"},"."],"type":"translate"}," <a href=\"#\" id=\"resend-verification-email\" class=\"resend-verification-email\">",{"nodelist":["Change email / Send again"],"type":"translate"},"</a>\n    </div>\n\n    <a class=\"dismiss-banner\" id=\"dismiss-verification-banner\" href=\"#\">\n        <span class=\"ui-icon dismiss-icon\"></span>\n    </a>\n</div>\n"],
"postcheckout/download_2016/mobile_app_button":[{"blocks":[{"attachment":["\n<div class=\"button-container\">\n    <a class=\"listen-button ",{"blocks":[{"attachment":["blue-button"],"expression":"!is_redownload ","type":"ncondition"}],"type":"ef"},"\" href=\"",{"filters":[["a",[]]],"name":"app_tralbum_url_redirect","type":"variable"},"\"  data-bind=\"click: dtdWatch.bind($data, 'fan_listen_in_app')\">\n        <div class=\"button-inner\">\n            <svg class=\"icon app-play-logo\" width=\"24px\" height=\"31px\" viewBox=\"0 0 24 31\"><use xlink:href=\"#play-app-2\"></svg>\n            <div class=\"app-play-text\">",{"nodelist":["Listen now in the Bandcamp app"],"type":"translate"},"</div>\n        </div>\n    </a>\n</div>\n"],"expression":"cfg_mobile_download_fix ","type":"ncondition"},{"attachment":["\n<div class=\"button-container\">\n    ",{"blocks":[{"attachment":["\n    <a class=\"listen-button blue-button\" href='",{"filters":[["a",[]]],"name":"app_tralbum_url","type":"variable"},"'>\n        <div class=\"button-inner\">\n            <svg class=\"icon app-play-logo\" width=\"44px\" height=\"60px\" viewBox=\"0 0 44 60\"><use xlink:href=\"#play-app\"></svg>\n            <div class=\"app-play-text\">",{"nodelist":["Listen now in the Bandcamp app"],"type":"translate"},"</div>\n        </div>\n    </a>\n    <a class=\"download-button\" href='",{"filters":[["a",[]]],"name":"platform_app_url","type":"variable"},"'>\n        <div class=\"button-inner\">\n            <svg class=\"icon app-phone-logo\" width=\"87px\" height=\"76px\" viewBox=\"0 0 87 76\"><use xlink:href=\"#grab-app\"></svg>\n            <div class=\"missing-app\">",{"nodelist":["Dont have the Bandcamp app?"],"type":"translate"},"<br><div class=\"grab-it\">",{"nodelist":["Grab it here for free."],"type":"translate"},"</div></div>\n        </div>\n    </a>\n    "],"expression":"probably_has_app ","type":"ncondition"},{"attachment":["\n    <a class=\"download-button blue-button\" href='",{"filters":[["a",[]]],"name":"platform_app_url","type":"variable"},"'>\n        <div class=\"button-inner\">\n            <svg class=\"icon app-phone-logo\" width=\"87px\" height=\"76px\" viewBox=\"0 0 87 76\"><use xlink:href=\"#grab-app\"></svg>\n            <div class=\"missing-app\">",{"nodelist":["Dont have the Bandcamp app?"],"type":"translate"},"<br>",{"nodelist":["Grab it here for free."],"type":"translate"},"</div>\n        </div>\n    </a>\n    <a class=\"listen-button\" href='",{"filters":[["a",[]]],"name":"app_tralbum_url","type":"variable"},"'>\n        <div class=\"button-inner\">\n            <svg class=\"icon app-play-logo\" width=\"44px\" height=\"60px\" viewBox=\"0 0 44 60\"><use xlink:href=\"#play-app\"></svg>\n            <div class=\"app-play-text\">",{"nodelist":["Listen now in the Bandcamp app"],"type":"translate"},"</div>\n        </div>\n    </a>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n</div>\n"],"type":"else_ncondition"}],"type":"ef"}],
"account/download_item_small":["<div class=\"download-item-small-container\">\n    <img class=\"download-thumbnail\" ",{"filters":[["art",["\"art_embedded_player_large\""]]],"name":"download_item.art_id","type":"variable"}," title=\"",{"nodelist":["",{"filters":[["attr",[]]],"name":"download_item.title","type":"variable"}," Cover Art"],"type":"translate"},"\" alt=\"",{"nodelist":["",{"filters":[["attr",[]]],"name":"download_item.title","type":"variable"}," Cover Art"],"type":"translate"},"\"/>\n    \n    <div class=\"download-info\">\n        <div class=\"tralbum-title\">",{"filters":[["h",[]]],"name":"download_item.title","type":"variable"},"</div>\n        <div>",{"filters":[["h",[]]],"name":"download_item.artist","type":"variable"},"</div>\n    </div>\n</div>"],
"svg_shared":["<svg height=\"0\" width=\"0\" style=\"position:absolute;margin-left: -100%;\">\n    <path id=\"tweet\" d=\"M16.1,3.5c0.1,1-0.1,2.4-0.4,3.3c-0.3,0.9-0.7,1.9-1.3,2.7c-0.6,0.9-1.3,1.6-2.1,2.3 c-0.8,0.7-1.8,1.2-2.9,1.6C8.2,13.8,7,14,5.7,14c-2.2,0-4.1-0.6-5.7-1.6c2.5,0.2,4.1-0.5,5.5-1.5c-1.7,0-3-1.1-3.4-2.4 c0.5,0.1,1.3,0,1.7-0.1c-1.5-0.3-3-1.7-3-3.5c0.3,0.2,0.9,0.4,1.7,0.4C1.5,4.8,0.8,3.7,0.8,2.4c0-0.6,0.2-1.4,0.5-1.8 c1.7,2,4.4,3.6,7.6,3.7C8.3,1.4,10.6,0,12.5,0c1.1,0,2,0.4,2.7,1.1C16,1,16.8,0.7,17.5,0.3c-0.3,0.8-0.8,1.5-1.6,1.9 C16.6,2.1,17.3,2,18,1.7C17.5,2.4,16.9,3,16.1,3.5z\"></path>\n    <path id=\"buy-for-friend\" d=\"M3.5,4H7h3.5c1.8-0.3,2.4-1.9,2-2.9s-1.8-1.6-3.2-0.6S7,3,7,3S6.1,1.5,4.7,0.5 S1.9,0.1,1.5,1.1S1.7,3.7,3.5,4z M10.3,1c0.9-0.2,1.6,0.1,1.3,1.1C11.3,3.3,9,3.4,7.8,3.4C7.8,3.4,9.4,1.2,10.3,1z M3.8,1 c1.1,0.4,2.4,2.4,2.4,2.4c-1.3,0-3.4-0.3-3.8-1.3C2,1.1,3,0.8,3.8,1z M0,9h6V5H0V9z M7,5v4h7V5H7z M7,14h6v-4H7V14z M1,14h5v-4H1 V14z\"></path>\n    <path id=\"edit-profile-info\" d=\"M10,10.5c0,0.3-0.2,0.5-0.5,0.5h-8C1.2,11,1,10.8,1,10.5v-8C1,2.2,1.2,2,1.5,2h3.7V1H1.5C0.7,1,0,1.7,0,2.5v8 C0,11.3,0.7,12,1.5,12h8c0.8,0,1.5-0.7,1.5-1.5V7h-1V10.5z M12,1.4L10.5,0L6.4,4.4L5.8,6.6l2.2-0.9L12,1.4z\"/>\n    <path id=\"fb-logo-share-profile\" d=\"M3.9,12V6.3h1.8l0.3-2.1h-2V2.9c0-0.6,0.2-1,1-1l1.1,0V0.1C5.8,0.1,5.2,0,4.4,0C2.8,0,1.8,1,1.8,2.7v1.5 H0v2.1h1.8V12H3.9z\"/>\n    <polygon id=\"following-checkmark\" points=\"4.3,10.7 0,5.8 1.5,4.5 4.3,7.6 11,0 12.5,1.3 \"/>\n    <path id=\"follow-plus\" d=\"M 8,3 5,3 5,0 3,0 3,3 0,3 0,5 3,5 3,8 5,8 5,5 8,5 z\"></path>\n    <path id=\"share-profile\" d=\"M10.7,0.2C10.7,0.2,10.6,0.1,10.7,0.2L10.3,0c0,0-0.1,0-0.1,0L2.5,4.8c0,0,0,0,0,0L0.3,8.1c0,0,0,0.1,0,0.1 c0,0,0,0.1,0.1,0.1l3.3,0.9c0,0,0.1,0,0.1,0l5.1-6.5l-3.3,7c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0,0l0.9,2.2 c0,0,0.1,0.1,0.1,0.1c0,0,0,0,0,0c0,0,0.1,0,0.1-0.1l0.9-1.5l2.8,0.9c0,0,0,0,0,0c0,0,0,0,0,0c0,0,0,0,0.1-0.1l1.3-4.2c0,0,0,0,0,0 L10.7,0.2z\"/>\n    <path id=\"search-magnifier\" d=\"M10.1,10.4l-1.4-2c0,0,0,0,0,0C9.5,7.5,10,6.3,10,5c0-2.8-2.2-5-5-5S0,2.2,0,5s2.2,5,5,5c0.7,0,1.4-0.1,2-0.4 c0,0,0,0,0,0l1.5,2c0.3,0.4,1,0.5,1.4,0.2l0,0C10.3,11.5,10.4,10.9,10.1,10.4z M5,9C2.8,9,1,7.2,1,5c0-2.2,1.8-4,4-4s4,1.8,4,4 C9,7.2,7.2,9,5,9z\"/>\n    <polygon id=\"close-search-results\" points=\"8,0.7 7.3,0 4,3.3 0.7,0 0,0.7 3.3,4 0,7.3 0.7,8 4,4.7 7.3,8 8,7.3 4.7,4     \"/>\n    <path id=\"camera-icon\" d=\"M26,2H22a2,2,0,0,0-2-2H8A2,2,0,0,0,6,2H2A2,2,0,0,0,0,4V18a2,2,0,0,0,2,2H26a2,2,0,0,0,2-2V4A2,2,0,0,0,26,2ZM14,17a6,6,0,1,1,6-6A6,6,0,0,1,14,17ZM15,7H13v3H10v2h3v3h2V12h3V10H15Z\"/>\n    <g id=\"search-spinner\">\n        <circle  class=\"st1\" cx=\"7\" cy=\"1.5\" r=\"1.5\"/>\n        <ellipse class=\"st2\" transform=\"matrix(0.7071 -0.7071 0.7071 0.7071 0.9895 8.6109)\" cx=\"10.9\" cy=\"3.1\" rx=\"1.5\" ry=\"1.5\"/>\n        <circle  class=\"st3\" cx=\"12.5\" cy=\"7\" r=\"1.5\"/>\n        <ellipse class=\"st4\" transform=\"matrix(0.7071 -0.7071 0.7071 0.7071 -4.5104 10.8891)\" cx=\"10.9\" cy=\"10.9\" rx=\"1.5\" ry=\"1.5\"/>\n        <circle  class=\"st5\" cx=\"7\" cy=\"12.5\" r=\"1.5\"/>\n        <ellipse class=\"st6\" transform=\"matrix(0.7071 -0.7071 0.7071 0.7071 -6.7886 5.3891)\" cx=\"3.1\" cy=\"10.9\" rx=\"1.5\" ry=\"1.5\"/>\n        <ellipse class=\"st8\" transform=\"matrix(0.7071 -0.7071 0.7071 0.7071 -1.2887 3.111)\" cx=\"3.1\" cy=\"3.1\" rx=\"1.5\" ry=\"1.5\"/>\n        <circle  class=\"st7\" cx=\"1.5\" cy=\"7\" r=\"1.5\"/>\n    </g>\n    <path id=\"mobile-web-collection-arrow\" d=\"M 20.3,17.3 3,0 0.3,2.7 17.7,20 0.3,37.3 3,40 20.3,22.7 23,20 z\"></path>\n    <path id=\"homepage-mobile-arrow\" d=\"M 12.9,11 2.1,0.1 0,2.2 10.8,13.1 0,24 2.1,26.1 12.9,15.2 15,13.1 z\"></path>\n    <path id=\"collect-control-wishlist\" d=\"M10.5,20l-0.8-0.9c0,0-1.9-2.3-4.6-4.7l0,0C1.8,11.2,0.1,8.5,0,6c0-1.6,0.6-3,1.8-4.3C3.4,0.3,5-0.2,6.6,0.1 c1.8,0.3,3.1,1.6,3.9,2.5c0.9-1,2.3-2.2,4.1-2.5c1.6-0.2,3,0.3,4.5,1.5c1.3,1.2,2,2.6,2,4.1c0,2.5-1.7,5.3-5.3,8.6 c-2.6,2.4-4.4,4.7-4.4,4.7L10.5,20z M6.5,12.9c1.8,1.6,3.2,3.1,4,4c0.8-0.9,2.2-2.4,3.9-4c3.1-2.8,4.7-5.2,4.7-7.1 c0-1-0.4-1.9-1.3-2.7c-1-0.8-1.9-1.2-2.9-1c-2,0.3-3.6,2.7-3.6,2.7l-0.9,1.4L9.6,4.7c0,0-1.3-2.4-3.3-2.8c-1-0.2-2,0.2-3.1,1.1 C2.3,3.9,1.9,4.9,2,5.9C2,7.9,3.6,10.2,6.5,12.9L6.5,12.9z\"></path>\n    <path id=\"collect-control-purchased\" d=\"M10.5,20l-0.8-0.9c0,0-1.9-2.3-4.6-4.7l0,0C1.8,11.2,0.1,8.5,0,6c0-1.6,0.6-3,1.8-4.3C3.4,0.3,5-0.2,6.6,0.1 c1.8,0.3,3.1,1.6,3.9,2.5c0.9-1,2.3-2.2,4.1-2.5c1.6-0.2,3,0.3,4.5,1.5c1.3,1.2,2,2.6,2,4.1c0,2.5-1.7,5.3-5.3,8.6 c-2.6,2.4-4.4,4.7-4.4,4.7L10.5,20z\"></path>\n    <path id=\"collect-control-wishlisted\" d=\"M10.5,20l-0.8-0.9c0,0-1.9-2.3-4.6-4.7l0,0C1.8,11.2,0.1,8.5,0,6c0-1.6,0.6-3,1.8-4.3C3.4,0.3,5-0.2,6.6,0.1 c1.8,0.3,3.1,1.6,3.9,2.5c0.9-1,2.3-2.2,4.1-2.5c1.6-0.2,3,0.3,4.5,1.5c1.3,1.2,2,2.6,2,4.1c0,2.5-1.7,5.3-5.3,8.6c-2.6,2.4-4.4,4.7-4.4,4.7L10.5,20z\"></path>\n\n    <path id=\"facebook-like\" d=\"M2,0 L14,0 C15.15,0 16,0.85 16,2 L16,14 C16,15.15 15.15,16 14,16 L10.5142857,16 L10.5142857,9.82857143 L12.5714286,9.82857143 L12.9142857,7.31428571 L10.5142857,7.31428571 L10.5142857,5.82857143 C10.5142857,5.48571429 10.6285714,5.14285714 10.7428571,5.02857143 C10.8571429,4.8 11.2,4.68571429 11.6571429,4.68571429 L12.9142857,4.68571429 L12.9142857,2.51428571 C12.4571429,2.4 11.8857143,2.4 11.0857143,2.4 C10.1714286,2.4 9.37142857,2.62857143 8.8,3.2 C8.22857143,3.77142857 8,4.57142857 8,5.6 L8,7.42857143 L5.94285714,7.42857143 L5.94285714,9.82857143 L8,9.82857143 L8,16 L2,16 C0.85,16 0,15.15 0,14 L0,2 C0,0.85 0.85,0 2,0 Z\"/>\n    <polygon id=\"format-dropdown\" points=\"10,0 5,6 0,0 \"/>\n    <path id=\"direct-download\" d=\"M11.7,7.3c-0.4-0.4-1-0.4-1.4,0L7,10.6V1c0-0.5-0.5-1-1-1S5,0.5,5,1v9.6L1.7,7.3 c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4c0,0,4.9,4.9,5,5C5.5,13.9,5.7,14,6,14c0.4,0,0.5-0.1,0.7-0.3c0.1-0.1,5-5,5-5 C12.1,8.3,12.1,7.7,11.7,7.3z M10,15H2c-0.5,0-1,0.5-1,1s0.5,1,1,1h8c0.5,0,1-0.5,1-1S10.5,15,10,15z\"/>\n    <path id=\"mobile-gift-ribbon\" class=\"st0\" d=\"M46.3,0C37.4,0,31.1,8.3,28,13.5C24.9,8.3,18.6,0,9.7,0C4.1,0,0,3.5,0,8.2 C0,16.6,12.2,22,27.7,22C43.9,22,56,15,56,8.3c0-1.3-0.3-2.6-1-3.8C53.5,1.7,50.2,0,46.3,0z M9.6,12.8c-3.1-1.6-3.9-3.1-3.9-4.6 c0-1.5,1.5-3.1,4-3.1c6,0,10.8,6.6,13.4,10.9C16.2,15.5,12,14,9.6,12.8z M46.9,12.5c-2.8,1.6-7.4,3-14,3.4C35.5,11.6,40.1,5,46.1,5 c2.1,0,4,0.9,4,3C50.1,9.9,48.5,11.6,46.9,12.5z\"/>\n    <path id=\"grab-app\" d=\"M20.8,25c-0.8-0.8-2-0.8-2.8,0c-0.8,0.8-0.8,2,0,2.8l7.2,7.2H2c-1.1,0-2,0.9-2,2 c0,1.1,0.9,2,2,2h23.2L18,46.2c-0.8,0.8-0.8,2,0,2.8c0.8,0.8,2,0.8,2.8,0c0,0,10.3-10.3,10.6-10.6c0.3-0.3,0.6-0.8,0.6-1.4 c0-0.6-0.3-1.1-0.6-1.4C31.1,35.3,20.8,25,20.8,25z M77.6,0h-26C46,0,41,4,41,9.5V14v3v36v3v9.5C41,71,46,76,51.6,76h26 c5.5,0,9.4-5,9.4-10.5V56v-3V17v-3V9.5C87,4,83.1,0,77.6,0z M84,65.5c0,3.9-2.6,7.5-6.4,7.5h-26c-3.9,0-7.6-3.6-7.6-7.5V56h40 V65.5z M84,53H44V17h40V53z M84,14H44V9.5C44,5.6,47.7,3,51.6,3h26C81.4,3,84,5.6,84,9.5V14z M64,67c1.7,0,3-1.3,3-3s-1.3-3-3-3 s-3,1.3-3,3S62.4,67,64,67z\"/>\n    <path id=\"play-app\" d=\"M1,60c-0.2,0-0.3,0-0.5-0.1C0.2,59.7,0,59.4,0,59V1c0-0.4,0.2-0.7,0.5-0.9C0.9,0,1.3,0,1.6,0.2 l42,29c0.3,0.2,0.4,0.5,0.4,0.8s-0.2,0.6-0.4,0.8l-42,29C1.4,60,1.2,60,1,60z M2,2.9v54.2L41.3,30L2,2.9z\"/>\n    <path id=\"play-app-2\" d=\"M18.5525732,16 L2.96878417,5.61080735 L2.96878417,26.3891927 L18.5525732,16 Z M0,32 L0,0 L24,16 L0,32 Z\"/>\n    <g id=\"grab-app-opensignup\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <g id=\"collection\" transform=\"translate(-67.000000, -505.000000)\" fill=\"#FFFFFF\">\n            <g id=\"mweb-phone-icon-outline\" transform=\"translate(67.000000, 505.000000)\">\n                <path d=\"M21.15625,3.99017859 L21.15625,32.0098214 C21.15625,33.660914 22.5021235,35 24.1658079,35 L38.1466921,35 C39.8066944,35 41.15625,33.6581721 41.15625,32.0098214 L41.15625,3.99017859 C41.15625,2.33908604 39.8103765,1 38.1466921,1 L24.1658079,1 C22.5058056,1 21.15625,2.34182793 21.15625,3.99017859 Z M20.15625,3.99017859 C20.15625,1.7864638 21.9566023,0 24.1658079,0 L38.1466921,0 C40.3611098,0 42.15625,1.7852456 42.15625,3.99017859 L42.15625,32.0098214 C42.15625,34.2135362 40.3558977,36 38.1466921,36 L24.1658079,36 C21.9513902,36 20.15625,34.2147544 20.15625,32.0098214 L20.15625,3.99017859 Z\" id=\"Rectangle-1270\"></path>\n                <rect id=\"Rectangle-1271\" x=\"29.40625\" y=\"29.7322813\" width=\"2.5\" height=\"2.5\" rx=\"1.25\"></rect>\n                <path d=\"M20.65625,8.23228125 L41.65625,8.23228125 L41.65625,7.23228125 L20.65625,7.23228125 L20.65625,8.23228125 Z M20.65625,27.2322813 L41.65625,27.2322813 L41.65625,26.2322813 L20.65625,26.2322813 L20.65625,27.2322813 Z\" id=\"Combined-Shape\"></path>\n                <path d=\"M0.289491211,18.4374278 C0.289491211,18.8014278 0.601491211,19.1134278 0.965491211,19.1134278 L12.5874912,19.1134278 L8.86015581,23.298 C8.60015581,23.584 8.60015581,24 8.86015581,24.286 L9.22415581,24.702 C9.48415581,24.962 9.90015581,24.962 10.1601558,24.702 L16.0454912,18.6454278 C16.3054912,18.3594278 16.3054912,17.9434278 16.0454912,17.6574278 L9.96015581,11.298 C9.70015581,11.038 9.28415581,11.038 9.02415581,11.298 L8.66015581,11.714 C8.40015581,12 8.40015581,12.416 8.66015581,12.702 L12.5614912,17.1374278 L0.965491211,17.1374278 C0.601491211,17.1374278 0.289491211,17.4494278 0.289491211,17.8134278 L0.289491211,18.4374278 Z\" id=\"\"></path>\n            </g>\n        </g>\n    </g>\n\n    <g id=\"has-app\">\n        <path class=\"has-app-phone\" d=\"M18,56c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C16,55.1,16.9,56,18,56z M29,0H7 C3.1,0,0,3.1,0,7v48c0,3.9,3.1,7,7,7h22c3.9,0,7-3.1,7-7V7C36,3.1,32.9,0,29,0z M34,55c0,2.8-2.2,5-5,5H7c-2.8,0-5-2.2-5-5v-6h32 V55z M34,47H2V12h32V47z M34,10H2V7c0-2.8,2.2-5,5-5h22c2.8,0,5,2.2,5,5V10z\"/>\n        <path class=\"has-app-confirm\" d=\"M18,18c-6.4,0-11.5,5.1-11.5,11.5S11.6,41,18,41c6.4,0,11.5-5.1,11.5-11.5S24.4,18,18,18z M23.3,27.6l-5.8,5.8c0,0,0,0,0,0c-0.3,0.3-0.7,0.4-1.1,0.4c-0.4,0-0.8-0.1-1.1-0.4c0,0,0,0,0,0l-2.6-2.6c-0.6-0.6-0.6-1.5,0-2.1 s1.5-0.6,2.1,0l1.6,1.6l4.8-4.8c0.6-0.6,1.5-0.6,2.1,0C23.9,26.1,23.9,27.1,23.3,27.6z\"/>\n    </g>\n    <g id=\"no-app\">\n        <path class=\"no-app-phone\" d=\"M18,56c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C16,55.1,16.9,56,18,56z M29,0H7 C3.1,0,0,3.1,0,7v48c0,3.9,3.1,7,7,7h22c3.9,0,7-3.1,7-7V7C36,3.1,32.9,0,29,0z M34,55c0,2.8-2.2,5-5,5H7c-2.8,0-5-2.2-5-5v-6h32 V55z M34,47H2V12h32V47z M34,10H2V7c0-2.8,2.2-5,5-5h22c2.8,0,5,2.2,5,5V10z\"/>\n        <polygon class=\"no-app-bc-logo\" points=\"14,23 7,36 22,36 29,23\"/>\n    </g>\n\n    <g id=\"signup-promo-icon\">\n        <path id=\"signup-phone-background\" d=\"M25,52H5c-2.8,0-5-2.2-5-5V5c0-2.8,2.2-5,5-5h20c2.8,0,5,2.2,5,5v42C30,49.8,27.8,52,25,52z\"/>\n        <g id=\"signup-promo-phone\">\n            <path class=\"signup-phone-icon\" d=\"M25,0H5C2.2,0,0,2.2,0,5v42c0,2.8,2.2,5,5,5h20c2.8,0,5-2.2,5-5V5C30,2.2,27.8,0,25,0z M28,47 c0,1.7-1.3,3-3,3H5c-1.7,0-3-1.3-3-3v-6h26V47z M28,39H2V10h26V39z M28,8H2V5c0-1.7,1.3-3,3-3h20c1.7,0,3,1.3,3,3V8z M15,47 c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C13,46.1,13.9,47,15,47z\"/>\n            <polygon class=\"signup-bc-logo\" points=\"11.6,19 5.7,30 18.4,30 24.3,19\"/>\n        </g>\n    </g>\n\n    <path id=\"format-dropdown-selected\" d=\"M8.6,0.3C8.2-0.1,7.5-0.1,7,0.3L3.4,4L2,2.5c-0.4-0.4-1.2-0.4-1.6,0c-0.4,0.4-0.4,1.2,0,1.6 l2.2,2.2c0.2,0.2,0.5,0.3,0.8,0.3c0.3,0,0.6-0.1,0.8-0.3L8.6,2C9.1,1.5,9.1,0.8,8.6,0.3z\"/>\n    <defs>\n        <linearGradient id=\"ribbon-gradient\"  x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\n            <stop offset=\"0%\" stop-color=\"#00BAEF\"></stop>\n            <stop offset=\"90%\" stop-color=\"#1DA0C3\"></stop>\n        </linearGradient>\n    </defs>\n\n    <path id=\"rarr-ico\" d=\"M5,5 L0,9 L2,10 L8,5 L2,0 L0,1 L5,5 Z\"></path>\n    <path id=\"larr-ico\" d=\"M5,5 L0,9 L2,10 L8,5 L2,0 L0,1 L5,5 Z\" transform=\"rotate(-180 4 5)\"></path>\n\n    <path id=\"rarr-ico\" d=\"M5,5 L0,9 L2,10 L8,5 L2,0 L0,1 L5,5 Z\"></path>\n    <path id=\"larr-ico\" d=\"M5,5 L0,9 L2,10 L8,5 L2,0 L0,1 L5,5 Z\" transform=\"rotate(-180 4 5)\"></path>\n\n    <g id=\"larr-onboarding-ico\" transform=\"translate(9.000000, 9.000000) rotate(-180.000000) translate(-9.000000, -9.000000) translate(3.000000, 0.000000)\">\n        <polygon points=\"2.5701 0 0.4401 2.13 7.3071 8.996 0.4331 15.87 2.5641 18 11.5661 8.996\"></polygon>\n    </g>\n\n    <g id=\"rarr-onboarding-ico\" transform=\"translate(3.000000, 0.000000)\">\n        <polygon id=\"Fill-2\" points=\"2.5701 0 0.4401 2.13 7.3071 8.996 0.4331 15.87 2.5641 18 11.5661 8.996\"></polygon>\n    </g>\n\n    <g id=\"gift-card-icon\">\n      <path stroke=\"none\" d=\"M0,3h3v3H0V3z M6,3l2-1L6,0L4.5,2.3L3,0L1,2l2,1h1v3h5V3H6z M1,10h2V7H1V10z M4,10h4V7H4V10z\"></path>\n    </g>\n\n    <path id=\"not-shipped\" d=\"M 7.90718677 0.000324340051 4.74431206 3.16431746 1.58143735 0.000324340051 0 1.58288011 3.16287471 4.74575481 0 7.90751111 1.58143735 9.49006688 4.74431206 6.32607375 7.90718677 9.49006688 9.48974254 7.90751111 6.32574941 4.74575481 9.48974254 1.58288011z\"/>\n\n    <path id=\"checkmark-shipped\" d=\"M 4.661 6.503 1.382 3.367 0 4.812 3.279 7.948 4.458 9.075 4.724 9.33 12.327 1.381 10.882 8.8817842e-16z\"/>\n\n    <g id=\"menubar-collection-icon\" transform=\"translate(-47.000000, -2.000000)\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <path d=\"M54.1465894,19.6799258 C50.1323547,15.8700084 45.2341143,9.84766697 49.9031046,4.86982327 C55.8203299,-0.479190961 59.9134095,7.34857 59.9134095,7.34857 C59.9134095,7.34857 64.3977141,-0.182785409 69.9245714,4.86982327 C74.9157974,9.60700336 69.8568676,15.7576398 65.7325071,19.676829 C62.2976112,22.9395021 60.0175362,26 60.0175362,26 C60.0175362,26 57.6209078,22.9757786 54.1465894,19.6799258 Z\"></path>\n    </g>\n    <g id=\"menubar-feed-icon\" transform=\"translate(1.000000, -2.000000)\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n        <path d=\"M10.7350061,2.92043601 L0.23508111,15.6316003 C0.059217148,15.8445004 0.089240918,16.159656 0.302141078,16.33552 C0.391749142,16.4095398 0.504344716,16.4500301 0.62057095,16.4500301 L5.02519005,16.4500301 C5.30133242,16.4500301 5.52519005,16.6738878 5.52519005,16.9500301 C5.52519005,16.9780767 5.52283022,17.0060736 5.51813554,17.0337245 L4.06824669,25.5733267 C4.02202359,25.845573 4.20525159,26.1037435 4.47749787,26.1499665 C4.64292607,26.1780536 4.81141301,26.1212892 4.92611877,25.998823 L17.7335603,12.3248942 C17.9223323,12.1233508 17.911979,11.8069376 17.7104357,11.6181656 C17.6177807,11.531382 17.4955838,11.4830922 17.3686337,11.4830922 L11.021147,11.4830922 C10.7450046,11.4830922 10.521147,11.2592346 10.521147,10.9830922 C10.521147,10.9593643 10.522836,10.9356665 10.5262013,10.9121784 L11.6154417,3.30977966 C11.6546063,3.03642871 11.4647607,2.78308479 11.1914097,2.7439202 C11.01891,2.71920515 10.8459861,2.78608413 10.7350061,2.92043601 Z\"></path>\n    </g>\n    <g id=\"menubar-messages-icon\" transform=\"translate(-102.000000, -2.000000)\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <path d=\"M121.075428,24.0769317 C119.230997,25.291887 117.015665,26 114.63303,26 C108.208285,26 103,20.8512746 103,14.5 C103,8.14872538 108.208285,3 114.63303,3 C121.057776,3 126.266061,8.14872538 126.266061,14.5 C126.266061,16.2987735 125.848302,18.0010899 125.103465,19.5173049 L126.999807,24.6744948 L121.075428,24.0769317 Z\"></path>\n    </g>\n    <g id=\"menubar-search-icon\" transform=\"translate(-406.000000, -8.000000)\"  stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <g id=\"search\" transform=\"translate(138.000000, 0.000000)\">\n            <g id=\"tralbum-search-icon\" transform=\"translate(268.789227, 9.250000)\">\n                <path d=\"M9.32604736,10.5061728 L13.7670223,15.0740741\"></path>\n                <ellipse cx=\"5.66676784\" cy=\"5.9382716\" rx=\"5.66676784\" ry=\"5.9382716\"></ellipse>\n            </g>\n        </g>\n    </g>\n    <g id=\"menubar-cart-icon\" stroke-width=\"1\" fill-rule=\"evenodd\" transform=\"translate(0.000000, 1.000000)\">\n        <path d=\"M21.5,25 C22.3284271,25 23,24.3284271 23,23.5 C23,22.6715729 22.3284271,22 21.5,22 C20.6715729,22 20,22.6715729 20,23.5 C20,24.3284271 20.6715729,25 21.5,25 Z\" id=\"Oval-2\" class=\"cart-wheel\"></path>\n        <circle id=\"Oval-2-Copy\" class=\"cart-wheel\" opacity=\"0.900000036\" cx=\"9.5\" cy=\"23.5\" r=\"1.5\"></circle>\n        <polyline id=\"Path-12\" stroke-linecap=\"round\" stroke-linejoin=\"round\" points=\"0 0 5.48382775 0 8.66354067 18 22.7307177 18 26 3.4714075 6.20038278 3.28264788\" class=\"cart-body\" fill=\"none\"></polyline>\n    </g>\n\n    <path id=\"embed-icon\" d=\"M16.9010507,2.29863546 L22,6.97479576 L16.9010507,11.6504561 C16.4732287,12.0827007 15.8964372,12.0827007 15.4686152,11.6504561 C15.0407932,11.2179615 15.0638369,10.5169702 15.4916589,10.0849756 L18.9067864,6.97479576 L15.4916589,3.86461589 C15.0638369,3.43237129 15.0407932,2.73138005 15.4686152,2.29863546 C15.8964372,1.86664086 16.4732287,1.86664086 16.9010507,2.29863546 Z M10.4239474,13.0621167 C10.2830744,13.693402 9.79789935,14.0422921 9.22029864,13.9276623 C8.64192738,13.8126665 8.28727426,13.207702 8.42802078,12.576201 L11.4560527,0.887162281 C11.5969257,0.255876985 12.0821008,-0.0930131224 12.6597015,0.0216166899 C13.2380727,0.136612504 13.5927259,0.741577012 13.4519793,1.37307806 C12.2126857,6.15709364 11.2832154,9.74510533 10.6635686,12.1371131 C10.6103194,12.3426695 10.5304457,12.651004 10.4239474,13.0621167 Z M5.09981659,2.29863546 C5.52771136,1.86664086 6.10529946,1.86664086 6.53272863,2.29863546 C6.9606234,2.73138005 6.9606234,3.43237129 6.53272863,3.86461589 L3.09373973,6.97479576 L6.53272863,10.0849756 C6.9606234,10.5169702 6.9606234,11.2179615 6.53272863,11.6504561 C6.10529946,12.0827007 5.52771136,12.0827007 5.09981659,11.6504561 L0,6.97479576 L5.09981659,2.29863546 Z\"/>\n    <path id=\"email-link\" d=\"M0,2.0085302 C0,0.899249601 0.892622799,0 1.99508929,0 L16.0049107,0 C17.1067681,0 18,0.901950359 18,2.0085302 L18,9.9914698 C18,11.1007504 17.1073772,12 16.0049107,12 L1.99508929,12 C0.893231902,12 0,11.0980496 0,9.9914698 L0,2.0085302 Z M16.0588235,11 L17,10.0909091 L12.2941176,5.54545455 L17,1.90909091 L16.0588235,1 L9.24470588,6.46727273 L8.76282353,6.46727273 L1.94117647,1 L1,1.90909091 L5.70588235,5.54545455 L1,10.0909091 L1.94117647,11 L6.64705882,6.45454545 L8.76282353,8.27272727 L9.24470588,8.27272727 L11.3529412,6.45454545 L16.0588235,11 Z\"/>\n</svg>\n"],
"fan/signup/fan_action_pane":["<form id=\"signup-vm\" class='action-form modern-form signup-common-form' data-bind='css: { \"visible\": visible }, submit: openSignup' novalidate>\n    <a id=\"signup-anchor\"></a>\n\n    <div class=\"signup-common-inner\">\n        ",{"blocks":[{"attachment":["\n            ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["To wishlist this album please sign up for a free Bandcamp account or log in if you already have one:"],"type":"translate"},"\n                "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["To wishlist this album please <a ",{"nodelist":["href=\"#\" data-bind=\"click: openSignup\""],"type":"translateVariable","var_name":"signup_link"},">sign up</a> for a free Bandcamp account or <a ",{"nodelist":["href=\"#\" data-bind=\"click: openLogin\""],"type":"translateVariable","var_name":"login_link"},">log in</a> if you already have one:"],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"action_item_type == 'a' || action_item_type == 'album' ","type":"ncondition"},{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["To wishlist this track please sign up for a free Bandcamp account or log in if you already have one:"],"type":"translate"},"\n                "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["To wishlist this track please <a ",{"nodelist":["href=\"#\" data-bind=\"click: openSignup\""],"type":"translateVariable","var_name":"signup_link"},">sign up</a> for a free Bandcamp account or <a ",{"nodelist":["href=\"#\" data-bind=\"click: openLogin\""],"type":"translateVariable","var_name":"login_link"},">log in</a> if you already have one:"],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"action_item_type == 't' || action_item_type == 'track' ","type":"ncondition"}],"type":"ef"},"\n        "],"child_condition":null,"child_relation":null,"left":"action","operator":"==","right":"'wishlist'","type":"condition"},{"attachment":["\n            ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["To follow this artist please sign up for a free Bandcamp account or log in if you already have one:"],"type":"translate"},"\n                "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["To follow this artist please <a ",{"nodelist":["href=\"#\" data-bind=\"click: openSignup\""],"type":"translateVariable","var_name":"signup_link"},">sign up</a> for a free Bandcamp account or <a ",{"nodelist":["href=\"#\" data-bind=\"click: openLogin\""],"type":"translateVariable","var_name":"login_link"},">log in</a> if you already have one:"],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"action_item_type == 'b' || !action_item_type ","type":"ncondition"},{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["To follow this fan please sign up for a free Bandcamp account or log in if you already have one:"],"type":"translate"},"\n                "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["To follow this fan please <a ",{"nodelist":["href=\"#\" data-bind=\"click: openSignup\""],"type":"translateVariable","var_name":"signup_link"},">sign up</a> for a free Bandcamp account or <a ",{"nodelist":["href=\"#\" data-bind=\"click: openLogin\""],"type":"translateVariable","var_name":"login_link"},">log in</a> if you already have one:"],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"action_item_type == 'f' ","type":"ncondition"},{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["To follow this genre please sign up for a free Bandcamp account or log in if you already have one:"],"type":"translate"},"\n                "],"expression":"is_phone ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["To follow this genre please <a ",{"nodelist":["href=\"#\" data-bind=\"click: openSignup\""],"type":"translateVariable","var_name":"signup_link"},">sign up</a> for a free Bandcamp account or <a ",{"nodelist":["href=\"#\" data-bind=\"click: openLogin\""],"type":"translateVariable","var_name":"login_link"},">log in</a> if you already have one:"],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"action_item_type == 'g' ","type":"ncondition"}],"type":"ef"},"\n        "],"child_condition":null,"child_relation":null,"left":"action","operator":"==","right":"'follow'","type":"condition"},{"attachment":["\n            ",{"nodelist":["To finish redeeming your gift card, please <a ",{"nodelist":["href=\"#\" data-bind=\"click: openSignup\""],"type":"translateVariable","var_name":"signup_link"},">sign up</a> for a free Bandcamp account or <a ",{"nodelist":["href=\"#\" data-bind=\"click: openLogin\""],"type":"translateVariable","var_name":"login_link"},">log in</a> if you already have one."],"type":"translate"},"\n        "],"child_condition":null,"child_relation":null,"left":"action","operator":"==","right":"'redeem'","type":"condition"}],"type":"case"},"\n\n        <div class=\"buttons\">\n            <button class=\"signup\" type=\"submit\" data-bind=\"click: openSignup\">\n                ",{"nodelist":["Sign up"],"type":"translate"},"\n            </button>\n            <button class=\"login\" type=\"submit\" data-bind=\"click: openLogin\">\n                ",{"nodelist":["Log in"],"type":"translate"},"\n            </button>\n        </div>\n    </div>\n</form>\n"],
"fan/tooltips/search_tooltip":[{"blocks":[{"attachment":["\n<div class=\"",{"blocks":[{"attachment":["inner-circle-wrapper"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\">\n    <div class=\"inner-circle\"></div>\n</div>\n</div>\n"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n<div class=\"signup-tooltip search-tooltip\">\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        <div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>\n        ",{"blocks":[{"attachment":["\n            ",{"nodelist":["Search Bandcamp by artist, album or track. Browse music by genre, format, and more."],"type":"translate"},"\n        "],"expression":"cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n            ",{"nodelist":["You can search Bandcamp by artist, album or track."],"type":"translate"},"\n        "],"type":"else_ncondition"}],"type":"ef"},"\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>\n"],
"fan/tooltips/feed_tooltip":["<div class=\"",{"blocks":[{"attachment":["inner-circle-wrapper"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\">\n    <div class=\"inner-circle\"></div>\n    <div class=\"inner-circle-contents\">\n    ",{"blocks":[{"attachment":["\n        <a href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.feed_url","type":"variable"},"\">\n            <svg width=\"20px\" height=\"25px\" class=\"svg-icon\"><use xlink:href=\"#menubar-feed-icon\"></svg>\n        </a>\n    "],"expression":"cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n        <a class=\"dismiss-tooltip-alt\" href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.feed_url","type":"variable"},"\">",{"nodelist":["feed"],"type":"translate"},"</a>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n    </div>\n</div>\n\n<div class=\"signup-tooltip feed-tooltip",{"blocks":[{"attachment":["-header-2018"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\">\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        <div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>\n\n        ",{"nodelist":["Check your feed for new music in your favorite genres and from artists you follow."],"type":"translate"},"\n\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>"],
"fan/tooltips/discover_tooltip":["<div>\n    <div class=\"inner-circle\"></div>\n    <div class=\"inner-circle-contents\">\n        <a class=\"dismiss-tooltip-alt\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/#discover\">",{"nodelist":["discover"],"type":"translate"},"</a>\n    </div>\n</div>\n\n<div class=\"signup-tooltip discover-tooltip\">\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        <div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>\n        ",{"nodelist":["Discover lets you browse music by genre, format, and more."],"type":"translate"},"\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>"],
"fan/tooltips/follow_tooltip":["<div class=\"signup-tooltip follow-tooltip\">\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        ",{"blocks":[{"attachment":["<div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>"],"expression":"fan_onboarding.num_tooltips > 1 ","type":"ncondition"}],"type":"ef"},"\n\n        ",{"blocks":[{"attachment":["\n            ",{"nodelist":["Youre now following this artist and your email has been added to their mailing list (to undo, click \"Following\")."],"type":"translate"},"\n        "],"expression":"fan_onboarding.band_name.length > 26 ","type":"ncondition"},{"attachment":["\n            ",{"nodelist":["Youre now following ",{"nodelist":[{"filters":[["h",[]],["truncate",["26"]]],"name":"fan_onboarding.band_name","type":"variable"}],"type":"translateVariable","var_name":"bandname"}," and your email has been added to their mailing list (to undo, click \"Following\")."],"type":"translate"},"\n        "],"type":"else_ncondition"}],"type":"ef"},"\n        \n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>\n"],
"fan/tooltips/wishlist_tooltip":["<div class=\"",{"blocks":[{"attachment":["inner-circle-wrapper"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\">\n    <div class=\"inner-circle\"></div>\n    <div class=\"inner-circle-contents\">\n        ",{"blocks":[{"attachment":["\n            <a class=\"dismiss-tooltip-alt\" ",{"blocks":[{"attachment":["href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.wishlist_url","type":"variable"},"\""],"expression":"fan_onboarding && fan_onboarding.wishlist_url ","type":"ncondition"}],"type":"ef"},"><svg width=\"25.5px\" height=\"25px\" class=\"svg-icon\"><use xlink:href=\"#menubar-collection-icon\"></svg></a>\n        "],"expression":"cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n            <a class=\"dismiss-tooltip-alt\" ",{"blocks":[{"attachment":["href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.wishlist_url","type":"variable"},"\""],"expression":"fan_onboarding && fan_onboarding.wishlist_url ","type":"ncondition"}],"type":"ef"},">",{"nodelist":["wishlist"],"type":"translate"},"</a>\n        "],"type":"else_ncondition"}],"type":"ef"},"\n    </div>\n</div>\n\n<div class=\"signup-tooltip wishlist-tooltip\">\n\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        ",{"blocks":[{"attachment":["\n            <div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>"],"expression":"fan_onboarding.num_tooltips > 1 ","type":"ncondition"}],"type":"ef"},"\n\n        ",{"blocks":[{"attachment":["\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["This track is now in your wishlist."],"type":"translate"},"\n            "],"expression":"fan_onboarding.first_wishlisted_item_type == 't' ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["This album is now in your wishlist."],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        "],"expression":"fan_onboarding.first_wishlisted_item_title.length > 26 ","type":"ncondition"},{"attachment":["\n            ",{"nodelist":["",{"nodelist":[{"filters":[["h",[]],["truncate",["26"]]],"name":"fan_onboarding.first_wishlisted_item_title","type":"variable"}],"type":"translateVariable","var_name":"album_title"}," is now in your wishlist."],"type":"translate"},"\n        "],"type":"else_ncondition"}],"type":"ef"},"\n\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>"],
"fan/tooltips/wishlist_button_tooltip":["<div>\n    <div class=\"inner-circle\"></div>\n    <div class=\"inner-circle-contents\">\n        <div class=\"tralbum-wishlist-link\">\n            <a class=\"dismiss-tooltip-alt\" ",{"blocks":[{"attachment":["href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.wishlist_url","type":"variable"},"\""],"expression":"fan_onboarding && fan_onboarding.wishlist_url ","type":"ncondition"}],"type":"ef"},">",{"nodelist":["view"],"type":"translate"},"</a>\n        </div>\n\n        <div class=\"collection-wishlist-link\">\n            <span>\n                <span>\n                    <span class=\"bc-ui2 collect-item-icon trigger\"></span>\n                    <span class=\"text trigger\"><a>",{"nodelist":["in wishlist"],"type":"translate"},"</a></span>\n                </span>\n                <span class=\"view\"><a target=\"_blank\" href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.wishlist_url","type":"variable"},"\">&raquo;</a></span>\n            </span>\n        </div>\n    </div>\n</div>\n\n<div class=\"signup-tooltip wishlist-button-tooltip\">\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        <div class=\"signup-tooltip-body\">\n            ",{"blocks":[{"attachment":["\n                <div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>\n            "],"expression":"fan_onboarding.num_tooltips > 1 ","type":"ncondition"}],"type":"ef"},"\n\n            ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["This track is now in your wishlist."],"type":"translate"},"\n                "],"expression":"fan_onboarding.first_wishlisted_item_type == 't' ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["This album is now in your wishlist."],"type":"translate"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            "],"expression":"fan_onboarding.first_wishlisted_item_title.length > 26 ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["",{"nodelist":[{"filters":[["h",[]],["truncate",["26"]]],"name":"fan_onboarding.first_wishlisted_item_title","type":"variable"}],"type":"translateVariable","var_name":"album_title"}," is now in your wishlist."],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </div>\n\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>"],
"fan/tooltips/fan_follow_tooltip":["<div class=\"following-button-wrapper\">\n    ",{"blocks":[{"attachment":["\n        <a class=\"follow-fan-btn-inactive\">\n            <span class=\"following-msg\">",{"nodelist":["Following"],"type":"translate"},"</span>\n        </a>\n    "],"expression":"fan_onboarding.origin_page == 'home' ","type":"ncondition"},{"attachment":["\n        <button type=\"button\" class=\"follow-unfollow-inactive following\">\n            <span class=\"plus\">\n            <svg class=\"icon follow-plus\" width=\"10px\" height=\"10px\" viewBox=\"0 0 8 8\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#follow-plus\"></use></svg>\n            </span>\n            <span class=\"checkmark\">\n            <svg class=\"icon following-checkmark\" width=\"14px\" height=\"12px\" viewBox=\"0 0 14 10\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#following-checkmark\"></use></svg>\n            </span>\n            <div class=\"following-msg\">",{"nodelist":["Following"],"type":"translate"},"</div>\n        </button>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n</div>\n\n<div class=\"signup-tooltip fan-follow-tooltip\">\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        ",{"blocks":[{"attachment":["<div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>"],"expression":"fan_onboarding.num_tooltips > 1 ","type":"ncondition"}],"type":"ef"},"\n\n        ",{"blocks":[{"attachment":["\n            ",{"nodelist":["Youre now following this fan, which means youll get updates about their activity in your feed."],"type":"translate"},"\n        "],"expression":"fan_onboarding.fan_name.length > 26 || !fan_onboarding.fan_name ","type":"ncondition"},{"attachment":["\n            ",{"nodelist":["Youre now following ",{"nodelist":[{"filters":[["h",[]],["truncate",["26"]]],"name":"fan_onboarding.fan_name","type":"variable"}],"type":"translateVariable","var_name":"bandname"},", which means youll get updates about their activity in your feed."],"type":"translate"},"\n        "],"type":"else_ncondition"}],"type":"ef"},"\n\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>\n"],
"fan/tooltips/collection_tooltip":["<div>\n    <div class=\"inner-circle\"></div>\n    <div class=\"inner-circle-contents\">\n        <a class=\"dismiss-tooltip-alt\" ",{"blocks":[{"attachment":["href=\"",{"filters":[["a",[]]],"name":"fan_onboarding.collection_url","type":"variable"},"\""],"expression":"fan_onboarding && fan_onboarding.collection_url ","type":"ncondition"}],"type":"ef"},">",{"nodelist":["collection"],"type":"translate"},"</a>\n    </div>\n</div>\n\n<div class=\"signup-tooltip collection-tooltip\">\n\n    ",{"blocks":[{"attachment":["\n    <div class=\"signup-tooltip-inner\">\n        ",{"blocks":[{"attachment":["\n            <div class=\"position\">",{"nodelist":["Tip ",{"nodelist":[{"filters":[["h",[]]],"name":"(fan_onboarding.tooltip_number)","type":"variable"}],"type":"translateVariable","var_name":"tip_number"}," of ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_onboarding.num_tooltips","type":"variable"}],"type":"translateVariable","var_name":"number_of_tips"},""],"type":"translate"},"</div>"],"expression":"fan_onboarding.num_tooltips > 1 ","type":"ncondition"}],"type":"ef"},"\n\n        ",{"blocks":[{"attachment":["\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["This track is now in your collection."],"type":"translate"},"\n            "],"expression":"fan_onboarding.first_purchased_item_title == 't' ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["This album is now in your collection."],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        "],"expression":"!fan_onboarding.first_purchased_item_title || fan_onboarding.first_purchased_item_title.length > 26 ","type":"ncondition"},{"attachment":["\n            ",{"nodelist":["",{"nodelist":[{"filters":[["h",[]],["truncate",["26"]]],"name":"fan_onboarding.first_purchased_item_title","type":"variable"}],"type":"translateVariable","var_name":"album_title"}," is now in your collection."],"type":"translate"},"\n        "],"type":"else_ncondition"}],"type":"ef"},"\n\n        <a class=\"dismiss-tooltip\" href=\"#\">\n            ",{"blocks":[{"attachment":["\n                ",{"nodelist":["Got it, thanks!"],"type":"translate"},"\n            "],"expression":"fan_onboarding.current_index == (fan_onboarding.tooltips.length - 1) ","type":"ncondition"},{"attachment":["\n                ",{"nodelist":["Next tip"],"type":"translate"},"\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </a>\n    </div>\n    "],"expression":"fan_onboarding && fan_onboarding.tooltips ","type":"ncondition"}],"type":"ef"},"\n</div>"],
"menubar":["\n\n\n\n",{"expression":"!menubar.force_no_control && (page_identities.is_page_band_member || page_identities.is_admin) ","type":"let","variable":"has_full_access"},"\n",{"expression":"page_identities.page_band_parent_label_id && !page_identities.page_band.authed ","type":"let","variable":"has_limited_access"},"\n",{"expression":"has_full_access || has_limited_access ","type":"let","variable":"has_access"},"\n\n",{"blocks":[{"attachment":["\n ",{"blocks":[{"attachment":["\n     ",{"expression":"page_identities.page_band.name ","type":"let","variable":"artistsmenu_title"},"\n     ",{"expression":"true ","type":"let","variable":"artistsmenu_show_photo"},"\n     ",{"expression":"page_identities.page_band.photo ","type":"let","variable":"artistsmenu_photo"},"\n     ",{"expression":"page_identities.page_band.is_pro ","type":"let","variable":"artistsmenu_show_pro"},"\n\n "],"expression":"page_identities.page_band && has_access ","type":"ncondition"},{"attachment":["\n     ",{"expression":"page_identities.bands[0] ","type":"let","variable":"b"},"\n     ",{"expression":"b.name ","type":"let","variable":"artistsmenu_title"},"\n     ",{"expression":"true ","type":"let","variable":"artistsmenu_show_photo"},"\n     ",{"expression":"b.photo ","type":"let","variable":"artistsmenu_photo"},"\n     ",{"expression":"b.is_pro ","type":"let","variable":"artistsmenu_show_pro"},"\n\n "],"expression":"page_identities.bands.length == 1 ","type":"ncondition"},{"attachment":["\n     ",{"expression":"\"artists\" ","type":"let","variable":"artistsmenu_title"},"\n     ",{"expression":"false ","type":"let","variable":"artistsmenu_show_photo"},"\n     ",{"expression":"nil ","type":"let","variable":"artistsmenu_photo"},"\n     ",{"expression":"menubar.any_pro ","type":"let","variable":"artistsmenu_show_pro"},"\n "],"type":"else_ncondition"}],"type":"ef"},"\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n ",{"blocks":[{"attachment":["\n     ",{"expression":"page_identities.bands[0] ","type":"let","variable":"b"},"\n     ",{"expression":"b.name ","type":"let","variable":"artistsmenu_title"},"\n     ",{"expression":"true ","type":"let","variable":"artistsmenu_show_photo"},"\n     ",{"expression":"b.photo ","type":"let","variable":"artistsmenu_photo"},"\n     ",{"expression":"b.is_pro ","type":"let","variable":"artistsmenu_show_pro"},"\n "],"expression":"page_identities.bands.length >= 1 ","type":"ncondition"},{"attachment":["\n     ",{"expression":"\"artists\" ","type":"let","variable":"artistsmenu_title"},"\n     ",{"expression":"false ","type":"let","variable":"artistsmenu_show_photo"},"\n     ",{"expression":"nil ","type":"let","variable":"artistsmenu_photo"},"\n     ",{"expression":"menubar.any_pro ","type":"let","variable":"artistsmenu_show_pro"},"\n "],"type":"else_ncondition"}],"type":"ef"},"\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n\n",{"blocks":[{"attachment":["\n    ",{"expression":"\"\" ","type":"let","variable":"hide_unless_has_full_access"},"\n"],"expression":"page_identities.page_band && has_full_access ","type":"ncondition"},{"attachment":["\n    ",{"expression":"\"hidden-while-loading\" ","type":"let","variable":"hide_unless_has_full_access"},"\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n",{"blocks":[{"attachment":["\n    ",{"expression":"\"\" ","type":"let","variable":"hide_unless_has_access"},"\n    ",{"expression":"\"hidden-while-loading\" ","type":"let","variable":"hide_if_has_access"},"\n"],"expression":"page_identities.page_band && has_access ","type":"ncondition"},{"attachment":["\n    ",{"expression":"\"hidden-while-loading\" ","type":"let","variable":"hide_unless_has_access"},"\n    ",{"expression":"\"\" ","type":"let","variable":"hide_if_has_access"},"\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n",{"blocks":[{"attachment":["\n    ",{"expression":"\"\" ","type":"let","variable":"hide_if_not_logged_in_label"},"\n    ",{"expression":"\"hidden-while-loading\" ","type":"let","variable":"hide_if_logged_in_label"},"\n"],"expression":"page_identities.page_band && page_identities.page_band.is_label && has_full_access ","type":"ncondition"},{"attachment":["\n    ",{"expression":"\"hidden-while-loading\" ","type":"let","variable":"hide_if_not_logged_in_label"},"\n    ",{"expression":"\"\" ","type":"let","variable":"hide_if_logged_in_label"},"\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n",{"blocks":[{"attachment":["\n    ",{"blocks":[{"attachment":["\n        ",{"expression":"false ","type":"let","variable":"wide"},"\n        ",{"expression":"true ","type":"let","variable":"extra_wide"},"\n    "],"expression":"menubar.unshipped_order_count && menubar.unshipped_order_count >= 10 ","type":"ncondition"},{"attachment":["\n        ",{"expression":"true ","type":"let","variable":"wide"},"\n        ",{"expression":"false ","type":"let","variable":"extra_wide"},"\n    "],"type":"else_ncondition"}],"type":"ef"},"\n"],"expression":"page_identities.page_band && page_identities.page_band.is_label && menubar.artist_subscriptions_enabled ","type":"ncondition"},{"attachment":["\n        ",{"expression":"false ","type":"let","variable":"wide"},"\n        ",{"expression":"true ","type":"let","variable":"extra_wide"},"\n"],"expression":"!hide_search && page_identities.fan ","type":"ncondition"},{"attachment":["\n    ",{"expression":"false ","type":"let","variable":"wide"},"\n    ",{"expression":"false ","type":"let","variable":"extra_wide"},"\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n",{"blocks":[{"attachment":["\n    ",{"expression":"false ","type":"let","variable":"show_balance_number"},"\n"],"expression":"!cfg.header_rework_2018 && page_identities.bands.length > 0 && page_identities.fan ","type":"ncondition"},{"attachment":["\n    ",{"expression":"true ","type":"let","variable":"show_balance_number"},"\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n<div id=\"menubar-vm\" class=\"loading\" data-initial-values=\"",{"filters":[["json",[]],["a",[]]],"name":"menubar","type":"variable"},"\">\n<div id=\"menubar\" class=\"",{"blocks":[{"attachment":["menubar"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["menubar-2018"],"type":"else_ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["out"],"expression":"(!page_identities.page_band || menubar.force_no_control) && (!has_full_access || (is_admin && page_identities.page_band != 0)) ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["wide"],"expression":"wide ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["extra-wide"],"expression":"extra_wide ","type":"ncondition"}],"type":"ef"},"\">\n<ul id=\"site-nav\" class=\"menubar-section horizontal\">\n    \n    <li class=\"menubar-item bclogo\"><a href=\"",{"filters":[["a",[]]],"name":"siteroot_current","type":"variable"},"/?from=",{"blocks":[{"attachment":["menubar_logo_logged_out"],"expression":"!(page_identities.user) ","type":"ncondition"},{"attachment":["menubar_logo_logged_in"],"type":"else_ncondition"}],"type":"ef"},"\"><div class=\"logo\"></div></a></li>\n\n",{"blocks":[{"attachment":["\n    \n    ",{"blocks":[{"attachment":["\n    <!-- ko ifnot: showBandControls() || showLimitedAccessControls() -->\n    <div class=\"li-wrapper signup-tooltip-parent\" data-tooltip-id=\"d\">\n        <li id=\"explore\" class=\"menubar-item extended ",{"filters":[],"name":"hide_if_has_access","type":"variable"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"siteroot_current","type":"variable"},"/?from=",{"blocks":[{"attachment":["menubar_explore_logged_out"],"expression":"!(page_identities.user) ","type":"ncondition"},{"attachment":["menubar_explore_logged_in"],"type":"else_ncondition"}],"type":"ef"},"#discover\">",{"nodelist":["discover"],"type":"translate"},"</a>\n        </li>\n        <div class=\"signup-tooltip-outer discover-tooltip-outer\"></div>\n    </div>\n    <!-- /ko -->\n    "],"expression":"!hide_explore ","type":"ncondition"}],"type":"ef"},"\n\n    \n    <!-- ko if: user() && artistsMenu.bmgr.bands().length == 0 -->\n    ",{"blocks":[{"attachment":["\n    <div class=\"li-wrapper signup-tooltip-parent\" data-tooltip-id=\"f\">\n        <li id=\"feed-main\" class=\"feed-main menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.bands.length == 0 && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/feed?from=menubar\">\n                <span>",{"nodelist":["feed"],"type":"translate"},"</span>\n            </a>\n        </li>\n        <div class=\"signup-tooltip-outer feed-tooltip-outer\"></div>\n    </div>\n    "],"expression":"!hide_feed ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n\n    \n    <!-- ko if: showBandControls() && pageBand.isLabel() -->\n    <li class=\"menubar-item ",{"filters":[],"name":"hide_if_not_logged_in_label","type":"variable"},"\">\n        <a><span class=\"add-artist has-children\">",{"nodelist":["add artist"],"type":"translate"},"</span><span class=\"menucaret\"></span></a>\n        <ul class=\"menu\">\n            <li><a data-bind=\"click: addNewArtist\">",{"nodelist":["add new artist"],"type":"translate"},"</a></li>\n            <li><a data-bind=\"click: addExistingArtist\">",{"nodelist":["add existing artist"],"type":"translate"},"</a></li>\n        </ul>\n    </li>\n    <!-- /ko -->\n\n    \n    <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a><span class=\"add-music has-children\">",{"nodelist":["add music"],"type":"translate"},"</span><span class=\"menucaret\"></span></a>\n            <ul class=\"menu\">\n                <li><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_album'}, click: addAlbumClick\">",{"nodelist":["add album"],"type":"translate"},"</a></li>\n                <li><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_track'}, click: addTrackClick\">",{"nodelist":["add track"],"type":"translate"},"</a></li>\n            </ul>\n        </li>\n    <!-- /ko -->\n\n    \n    <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a id=\"menubar-add-merch-link\" data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_merch'}, click: addMerchClick\"><span class=\"add-music\">",{"nodelist":["add merch"],"type":"translate"},"</span></a>\n        </li>\n    <!-- /ko -->\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n        <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a>",{"nodelist":["+ add"],"type":"translate"},"</a>\n            <ul class=\"menu hidden-while-loading\">\n                \n                <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n                <ol data-bind=\"css: {'page-band-links': pageBand.isLabel()}\">\n                    <li class=\"submenu-item\"><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_album'}, click: addAlbumClick\">",{"nodelist":["album"],"type":"translate"},"</a></li>\n                    <li class=\"submenu-item\"><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_track'}, click: addTrackClick\">",{"nodelist":["track"],"type":"translate"},"</a></li>\n                    <li class=\"submenu-item\"><a id=\"menubar-add-merch-link\" data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_merch'}, click: addMerchClick\"><span class=\"add-music\">",{"nodelist":["merch"],"type":"translate"},"</span></a></li>\n                </ol>\n                <!-- /ko -->\n                <!-- ko if: showBandControls() && pageBand.isLabel() -->\n                <ol>\n                    <li class=\"submenu-item\"><a data-bind=\"click: addNewArtist\">",{"nodelist":["new artist"],"type":"translate"},"</a></li>\n                    <li class=\"submenu-item\"><a data-bind=\"click: addExistingArtist\">",{"nodelist":["existing artist"],"type":"translate"},"</a></li>\n                </ol>\n                <!-- /ko -->\n            </ul>\n        </li>\n        <!-- /ko -->\n"],"type":"else_ncondition"}],"type":"ef"},"\n\n    \n\n",{"blocks":[{"attachment":["\n    \n    ",{"blocks":[{"attachment":["\n    <!-- ko if: showBandControls() -->\n        <!-- ko if: !pageBand.hasService() && !pageBand.serviceName() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_full_access","type":"variable"}," ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"menubar.artist_service_active ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["disabled"],"expression":"menubar.page_path == '/edit_subscription' ","type":"ncondition"}],"type":"ef"},"\">\n            ",{"blocks":[{"attachment":["\n            <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/subscriptions?band_id=",{"filters":[["a",[]]],"name":"page_identities.page_band.id","type":"variable"},"&from=menubar\">\n                ",{"nodelist":["enable subscription"],"type":"translate"},"\n            </a>\n            "],"expression":"page_identities.page_band ","type":"ncondition"},{"attachment":["\n            <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/subscriptions?from=menubar\">\n                ",{"nodelist":["enable subscription"],"type":"translate"},"\n            </a>\n            "],"type":"else_ncondition"}],"type":"ef"},"\n        </li>\n        <!-- /ko -->\n\n        \n        ",{"blocks":[{"attachment":["\n        <!-- ko if: !pageBand.hasService() && pageBand.serviceName() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_full_access","type":"variable"}," hidden-while-loading disabled\">\n            <a><span class=\"subscription-name add-music has-children\" data-bind=\"text: pageBand.serviceName\">",{"filters":[["h",[]]],"name":"menubar.artist_service_name","type":"variable"},"</span></a>\n        </li>\n        <!-- /ko -->\n        "],"expression":"menubar.page_path == '/edit_subscription' ","type":"ncondition"}],"type":"ef"},"\n\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_full_access","type":"variable"}," ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!menubar.artist_service_active ","type":"ncondition"}],"type":"ef"},"\">\n        <!-- ko if: pageBand.hasService() -->\n            <a><span class=\"subscription-name add-music has-children\" data-bind=\"text: pageBand.serviceName\">",{"filters":[["h",[]]],"name":"menubar.artist_service_name","type":"variable"},"</span><span class=\"bc-ui menucaret\"></span></a>\n            <ul class=\"menu\">\n                <li><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_subscription?from=menubar'}\">edit <span data-bind=\"text: pageBand.serviceName\">",{"filters":[["h",[]]],"name":"menubar.artist_service_name","type":"variable"},"</span></a></li>\n                <li>\n                    <a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/' + pageBand.serviceUrlFragment() + '?from=menubar' }\">view <span data-bind=\"text: pageBand.serviceName\">",{"filters":[["h",[]]],"name":"menubar.artist_service_name","type":"variable"},"</span>\n                    </a>\n                </li>\n                <li class=\"",{"blocks":[{"attachment":["ui-state-disabled"],"expression":"!menubar.artist_service_has_subscribers ","type":"ncondition"}],"type":"ef"},"\">\n                    <a ",{"blocks":[{"attachment":["data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/subscribers?from=menubar'}\""],"expression":"menubar.artist_service_has_subscribers ","type":"ncondition"}],"type":"ef"},">\n                    ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["subscribers"],"type":"translate"},"\n                    "],"expression":"menubar.artist_service_name == \"subscription\" ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["supporters"],"type":"translate"},"\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                    </a>\n                </li>\n\n                <li>\n                    <a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/",{"filters":[["a",[]]],"name":"menubar.artist_service_url_fragment","type":"variable"},"?view=message_subscribers&from=menubar'}\">",{"blocks":[{"attachment":["\n                    ",{"nodelist":["message subscribers"],"type":"translate"},"\n                    "],"expression":"menubar.artist_service_name == \"subscription\" ","type":"ncondition"},{"attachment":["\n                    ",{"nodelist":["message supporters"],"type":"translate"},"\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                    </a>\n                </li>\n            </ul>\n        <!-- /ko -->\n        </li>\n    <!-- /ko -->\n    "],"expression":"menubar.artist_subscriptions_enabled ","type":"ncondition"}],"type":"ef"},"\n\n    \n    <!-- ko if: showBandControls() -->\n        ",{"blocks":[{"attachment":["\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_full_access","type":"variable"},"\">\n                <a href=\"/no_js/edit_design\">",{"nodelist":["design"],"type":"translate"},"</a>\n        </li>\n        "],"expression":"design_editable ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n    \n    \n    <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a data-bind=\"attr: {href: statsLinkHref}\">",{"nodelist":["stats"],"type":"translate"},"</a>\n        </li>\n    <!-- /ko -->\n\n    \n    ",{"blocks":[{"attachment":["\n    <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a data-bind=\"attr: {href: ordersLinkHref}\">\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["orders"],"type":"translate"},"\n                "],"expression":"menubar.unshipped_order_count == 0 ","type":"ncondition"},{"attachment":["\n                    ",{"blocks":[{"attachment":["\n                        <span class=\"num order\">1</span> order\n                    "],"expression":"menubar.unshipped_order_count== 1","type":"ncondition"},{"attachment":["\n                        <span class=\"num order\">",{"nodelist":[{"filters":[["h",[]]],"name":"menubar.unshipped_order_count","type":"variable"}],"type":"translateVariable","var_name":"order_count"},"</span> orders\n                    "],"type":"else_ncondition"}],"type":"translatePlural"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            </a>\n        </li>\n    <!-- /ko -->\n    "],"expression":"menubar.unshipped_order_count ","type":"ncondition"}],"type":"ef"},"\n\n    <!-- ko ifnot: showBandControls() || showLimitedAccessControls() -->\n    ",{"blocks":[{"attachment":["\n        \n        <li class=\"search extended menubar-item ",{"filters":[],"name":"hide_if_has_access","type":"variable"},"\">\n            <form class=\"autocomplete-form signup-tooltip-parent\" id=\"autocomplete-form\" action=\"/search\" method=\"get\" data-tooltip-id=\"s\">\n                <input id=\"search-field\" type=\"text\" class=\"you-autocomplete-me dismiss-tooltip-alt\" title=\"\" tabindex=\"1\" autocomplete=\"off\" maxlength=\"2048\" name=\"q\" placeholder=\"&nbsp;",{"nodelist":["search Bandcamp"],"type":"translate"},"&nbsp;&nbsp;&nbsp;\"><button tabindex=\"2\" type=\"submit\" title=\"search\">\n                    <span class=\"menubar-search-icon\">&nbsp;</span>&nbsp;</button>&nbsp;\n                <input type=\"hidden\" name=\"from\" value=\"fanbar\">\n                <input type=\"hidden\" name=\"",{"blocks":[{"attachment":["logged_out_menubar"],"expression":"!(page_identities.user) ","type":"ncondition"},{"attachment":["logged_in_menubar"],"type":"else_ncondition"}],"type":"ef"},"\" value=\"1\">\n                <div id=\"menubar-autocomplete-results\" class=\"menubar-autocomplete-results\" data-bind=\"with: AutocompleteVM\"> ",{"template_name":"'_autocomplete_search_widget'","type":"include"}," </div>\n                <div class=\"signup-tooltip-outer search-tooltip-outer\"></div>\n            </form>\n        </li>\n    "],"expression":"!hide_search ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n    <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n    \n    ",{"blocks":[{"attachment":["\n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a data-bind=\"attr: {href: ordersLinkHref}\"> <!-- clairenote change link to not pageband -->\n                ",{"blocks":[{"attachment":["\n                    ",{"nodelist":["orders"],"type":"translate"},"\n                "],"expression":"menubar.unshipped_order_count == 0 ","type":"ncondition"},{"attachment":["\n                    ",{"blocks":[{"attachment":["\n                        <span class=\"num order\">1</span> order\n                    "],"expression":"menubar.unshipped_order_count== 1","type":"ncondition"},{"attachment":["\n                        <span class=\"num order\">",{"nodelist":[{"filters":[["h",[]]],"name":"menubar.unshipped_order_count","type":"variable"}],"type":"translateVariable","var_name":"order_count"},"</span> orders\n                    "],"type":"else_ncondition"}],"type":"translatePlural"},"\n                "],"type":"else_ncondition"}],"type":"ef"},"\n            </a>\n        </li>\n    "],"expression":"menubar.unshipped_order_count ","type":"ncondition"}],"type":"ef"},"\n\n    \n        <li class=\"menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"},"\">\n            <a data-bind=\"attr: {href: statsLinkHref2018}\">",{"nodelist":["stats"],"type":"translate"},"</a>\n        </li>\n\n    ",{"blocks":[{"attachment":["\n        <li class=\"menubar-item\">\n        <!-- ko if: pageBand.hasService() -->\n            <a><span class=\"subscription-name add-music has-children ",{"filters":[],"name":"hide_unless_has_access","type":"variable"}," ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!menubar.artist_service_active ","type":"ncondition"}],"type":"ef"},"\">",{"nodelist":["subscription"],"type":"translate"},"</span></a>\n            <ul class=\"menu\">\n                <li class=\"submenu-item\"><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/' + pageBand.serviceUrlFragment() + '?from=menubar'}\"><strong data-bind=\"text: pageBand.serviceName\">",{"filters":[["h",[]]],"name":"menubar.artist_service_name","type":"variable"},"</strong></a></li> <!-- clairenote artist_service_name is for pageartist artist_service_has_subscribers too-->\n                <li class=\"submenu-item\"><a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/edit_subscription?from=menubar'}\">",{"nodelist":["edit"],"type":"translate"},"</a></li>\n                <li class=\"",{"blocks":[{"attachment":["ui-state-disabled"],"expression":"!menubar.artist_service_has_subscribers ","type":"ncondition"}],"type":"ef"}," submenu-item\">\n                    <a ",{"blocks":[{"attachment":["data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/subscribers?from=menubar'}\""],"expression":"menubar.artist_service_has_subscribers ","type":"ncondition"}],"type":"ef"},">",{"nodelist":["subscribers"],"type":"translate"},"</a>\n                </li>\n                <li class=\"submenu-item\">\n                    <a data-bind=\"attr: {href: pageBand.trackpipeLocalUrl() + '/",{"filters":[["a",[]]],"name":"menubar.artist_service_url_fragment","type":"variable"},"?view=message_subscribers&from=menubar'}\">",{"nodelist":["message subscribers"],"type":"translate"},"</a>\n                </li>\n            </ul>\n        <!-- /ko -->\n        </li>\n    "],"expression":"menubar.artist_subscriptions_enabled ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n    <!-- ko ifnot: showBandControls() || showLimitedAccessControls() -->\n    ",{"blocks":[{"attachment":["\n        \n        <li class=\"search extended menubar-item ",{"filters":[],"name":"hide_if_has_access","type":"variable"},"\">\n            <form class=\"autocomplete-form signup-tooltip-parent\" id=\"autocomplete-form\" action=\"/search\" method=\"get\" data-tooltip-id=\"s\">\n                <input id=\"search-field\" type=\"text\" class=\"you-autocomplete-me dismiss-tooltip-alt\" title=\"\" tabindex=\"1\" autocomplete=\"off\" maxlength=\"2048\" name=\"q\" placeholder=\"&nbsp;",{"nodelist":["Search and discover music"],"type":"translate"},"&nbsp;&nbsp;&nbsp;\"><label for=\"search-field\" tabindex=\"2\" type=\"submit\" title=\"search\">\n                    <svg width=\"16px\" height=\"17px\" class=\"menubar-search-icon\"><use xlink:href=\"#menubar-search-icon\"></svg></label>\n                <input type=\"hidden\" name=\"from\" value=\"fanbar\">\n                <input type=\"hidden\" name=\"",{"blocks":[{"attachment":["logged_out_menubar"],"expression":"!(page_identities.user) ","type":"ncondition"},{"attachment":["logged_in_menubar"],"type":"else_ncondition"}],"type":"ef"},"\" value=\"1\">\n                <div id=\"menubar-autocomplete-results\" class=\"menubar-autocomplete-results\" data-bind=\"with: AutocompleteVM\"> ",{"template_name":"'_autocomplete_search_widget'","type":"include"}," </div>\n                <div class=\"signup-tooltip-outer search-tooltip-outer header-2018\"></div>\n            </form>\n        </li>\n    "],"expression":"!hide_search ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n"],"type":"else_ncondition"}],"type":"ef"},"\n</ul>\n\n<ul id=\"user-nav\" class=\"menubar-section horizontal\">\n<!-- ko if: user() -->\n\n    \n    ",{"blocks":[{"attachment":["\n    <li class=\"menubar-item menubar-gift-card-balance ",{"blocks":[{"attachment":["hide-balance-number"],"expression":"!show_balance_number ","type":"ncondition"}],"type":"ef"}," ",{"filters":[],"name":"hide_if_logged_in_label","type":"variable"},"\"\n        data-bind=\"visible: !showBandControls() || !pageBand.isLabel()\">\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/redeem\">\n            <svg class=\"icon gift-card-icon-bordered\" width=\"9px\" height=\"10px\" viewBox=\"0 0 9 10\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#gift-card-icon\"></use></svg>\n            ",{"blocks":[{"attachment":["\n            <span class=\"gift-card-balance\">",{"filters":[["money",["1"]],["h",[]]],"name":"menubar.gift_card_balance","type":"variable"}," ",{"filters":[["h",[]]],"name":"menubar.gift_card_balance.currency","type":"variable"},"</span>\n            "],"expression":"show_balance_number ","type":"ncondition"}],"type":"ef"},"\n        </a>\n    </li>\n    "],"expression":"menubar.gift_card_balance && !cfg.header_rework_2018 && !is_tag_page ","type":"ncondition"}],"type":"ef"},"\n\n",{"blocks":[{"attachment":["\n    \n    <!-- ko if: artistsMenu.bmgr.bands().length == 0 -->\n    ",{"blocks":[{"attachment":["\n        <li id=\"feed-main\" class=\"feed-small-collection menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.bands.length == 0 && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/feed?from=menubar\">\n                <span>",{"nodelist":["feed"],"type":"translate"},"</span>\n            </a>\n        </li>\n    "],"expression":"!hide_feed && is_fan_page ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n\n    <!-- ko if: (fan() && !fan().private) -->\n    <!-- ko if: artistsMenu.bmgr.bands().length > 0 -->\n    ",{"blocks":[{"attachment":["\n        <li id=\"feed-main\" class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.bands.length > 0 && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/feed?from=menubar\">\n                <span>",{"nodelist":["feed"],"type":"translate"},"</span>\n            </a>\n        </li>\n    "],"expression":"!hide_feed ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n\n    ",{"blocks":[{"attachment":["\n        ",{"blocks":[{"attachment":["\n        <li id=\"collection-main\" class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"\">\n                <span>",{"nodelist":["collection"],"type":"translate"},"</span>\n                \n            </a>\n        </li>\n        "],"expression":"menubar.has_collection || (!menubar.has_collection && !menubar.has_wishlist) ","type":"ncondition"},{"attachment":["\n        <div class=\"li-wrapper signup-tooltip-parent\" data-tooltip-id=\"w\">\n            <li id=\"collection-main\" class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\">\n                <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/wishlist\">\n                    <span>",{"nodelist":["wishlist"],"type":"translate"},"</span>\n                    \n                </a>\n            </li>\n            <div class=\"signup-tooltip-outer wishlist-tooltip-outer\"></div>\n        </div>\n        "],"expression":"menubar.has_wishlist ","type":"ncondition"}],"type":"ef"},"\n    "],"expression":"!hide_collection_wishlist ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n\n\n    \n    <!-- ko if: artistsMenu.bmgr.bands().length > 0 && !hideArtistMenu -->\n    ",{"blocks":[{"attachment":["\n    <li\n        class=\"menubar-item artists-menu ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.bands.length > 0) ","type":"ncondition"}],"type":"ef"},"\"\n        data-bind=\"with: artistsMenu\"\n    >\n        <a>\n            <div>\n                <!-- ko if: options().showPhoto -->\n                <div class=\"userpic ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!artistsmenu_show_photo ","type":"ncondition"}],"type":"ef"},"\">\n                    <img ",{"filters":[["image",["'bio_navbar'"]]],"name":"artistsmenu_photo","type":"variable"},"\n                        data-bind=\"src_image: {image_id: options().photo, format: 'bio_navbar'}\"\n                    >\n                </div>\n                <!-- /ko -->\n\n                <span class=\"bandname\" data-bind=\"text: options().title\">",{"filters":[["h",[]]],"name":"artistsmenu_title","type":"variable"},"</span>\n                <div data-bind=\"visible: options().showPro\" class=\"menubar-badge-pro round3 ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!artistsmenu_show_pro ","type":"ncondition"}],"type":"ef"},"\">",{"nodelist":["PRO"],"type":"translate"},"</div>\n                <span class=\"bc-ui menucaret\"></span>\n            </div>\n        </a>\n        \n        <ul class=\"artists-menu menu hidden-while-loading\"\n            data-bind=\"\n                css: {\n                    'has-multiple-columns': columns() > 1 && (pageBandParentLabel() || pageLabel()),\n                    col1: columns() === 1,\n                    col2: columns() === 2,\n                    col3: columns() === 3\n                }\n            \"\n        >\n            <!-- ko if: toolsProfileBand() -->\n                <li class=\"page-band-links\" data-bind=\"css: {'page-label-links': pageLabel}\">\n                    <ol>\n                        <!-- ko if: options().toolsProfileEditable && !!toolsProfileBand().trackpipeLocalUrl() -->\n                        <li>\n                            <a data-bind=\"\n                                attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/profile?from=menubar&id=' + toolsProfileBand().id},\n                                css: {admin: options().adminAccess}\"\n                            >\n                                ",{"nodelist":["profile"],"type":"translate"},"\n                            </a>\n                        </li>\n                        <li>\n                            <a data-bind=\"\n                                attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/tools?from=menubar&id=' + toolsProfileBand().id},\n                                css: {admin: options().adminAccess}\"\n                            >\n                                ",{"nodelist":["tools"],"type":"translate"},"\n                            </a>\n                        </li>\n                        <!-- /ko -->\n\n                        <!-- ko ifnot: options().toolsProfileEditable && !!toolsProfileBand().trackpipeLocalUrl() -->\n                        <li class=\"ui-state-disabled\"><a>",{"nodelist":["profile"],"type":"translate"},"</a></li>\n                        <li class=\"ui-state-disabled\"><a>",{"nodelist":["tools"],"type":"translate"},"</a></li>\n                        <!-- /ko -->\n\n                        <li><a data-bind=\"attr: {href: toolsProfileBand().trackpipeLocalUrl()}\">",{"nodelist":["home"],"type":"translate"},"</a></li>\n                    </ol>\n                </li>\n            <!-- /ko -->\n            \n            <!-- ko if: labelBands() && isParentLabel() && (pageBandParentLabel() || pageLabel()) -->\n                <li class=\"parent-label\" data-bind=\"css: {'wide-parent-label': columns() > 2}\">\n                    <div class=\"sublist-title\" data-bind=\"css: {'show-in-single-column': !pageBandParentLabel()}\">",{"nodelist":["Label"],"type":"translate"},"</div>\n                    <ol>\n                        <li data-bind=\"template: {\n                            'name': 'band-parentlabel-template',\n                            'data': bmgr.bandByID(pageBandParentLabel().id)\n                        }\"></li>\n                    </ol>\n                </li>\n            <!-- /ko -->\n\n            <!-- ko if: labelBands() && labelBands().length > 0  && (pageBandParentLabel() || pageLabel())-->\n                <li class=\"label-member-bands\">\n                    <div class=\"sublist-title\" data-bind=\"css: {\n                        'show-in-single-column': otherLinkedAccounts().length > 1 &amp;&amp; !pageBandParentLabel()}\">",{"nodelist":["Label Artists"],"type":"translate"},"</div>\n                    <div class=\"multi-column-artist-menu no-pro-badges\">\n                    <!-- ko foreach: labelBands -->\n                        <ol>\n                        <!-- ko foreach: bands -->\n                            <li data-bind=\"template: {\n                                'name': 'band-menuitem-template'\n                            },\n                            css: {\n                                'ui-state-disabled': $parents[1].isPageBand($data.id)\n                            }\"></li>\n                        <!-- /ko -->\n                        <!-- ko if: $parent.labelBandsOverflow() > 0 && $index() === $parent.labelBands().length - 1 -->\n                            <li class=\"more\">\n                                <a data-bind=\"attr: {href: $parent.pageLabel().url() + '/artists?from=menubar_artist_dropdown'}\">\n                                    ",{"nodelist":["and ",{"nodelist":["<span data-bind=\"text: $parent.labelBandsOverflow()\"></span>"],"type":"translateVariable","var_name":"number"}," more..."],"type":"translate"},"\n                                </a>\n                            </li>\n                        <!-- /ko -->\n                        </ol>\n                    <!-- /ko -->\n                    </div>\n                </li>\n            <!-- /ko -->\n\n            <!-- ko if: otherLinkedAccounts().length > 0 -->\n            <li class=\"linked-bands\">\n                <div class=\"sublist-title\" data-bind=\"css: {\n                    'show-in-single-column': labelBands() &amp;&amp; labelBands().length > 0\n                }\">",{"nodelist":["Other Linked Artists/Labels"],"type":"translate"},"</div>\n                    <div class=\"multi-column-artist-menu\">\n                    <!-- ko foreach: linkedBands -->\n                        <ol>\n                        <!-- ko foreach: bands -->\n                            <li data-bind=\"template: {\n                                'name': 'band-menuitem-template'\n                            },\n                            css: {\n                                'ui-state-disabled': $root.artistsMenu.isPageBand($data.id)\n                            }\"></li>\n                        <!-- /ko -->\n                        <!-- ko if: $parent.linkedBandsOverflow() > 0  && $index() === $parent.linkedBands().length - 1 -->\n                            <li class=\"more\">\n                                <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/settings?pane=artists&from=menubar_artist_dropdown\">\n                                    ",{"nodelist":["and ",{"nodelist":["<span data-bind=\"text: $parent.linkedBandsOverflow()\"></span>"],"type":"translateVariable","var_name":"number"}," more..."],"type":"translate"},"\n                                </a>\n                            </li>\n                        <!-- /ko -->\n                        </ol>\n                    <!-- /ko -->\n                </div>\n            </li>\n            <!-- /ko -->\n\n            <!-- ko if: !hasLabels() -->\n            <li class=\"edit-artists\">\n                <ol>\n                    <li><a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/settings?pane=artists&from=menubar\">\n                    <!-- ko if: otherLinkedAccounts().length > 1 -->",{"nodelist":["edit artists..."],"type":"translate"},"<!-- /ko -->\n                    <!-- ko ifnot: otherLinkedAccounts().length > 1 -->",{"nodelist":["add more artists..."],"type":"translate"},"<!-- /ko -->\n                    </a></li>\n                </ol>\n            </li>\n            <!-- /ko -->\n        </ul>\n    </li>\n    "],"expression":"!menubar.hide_artist_menu && !hide_artist_menu ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n\n    \n    <!-- ko if: partner() -->\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!page_identities.partner ","type":"ncondition"}],"type":"ef"},"\">\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot","type":"variable"},"/partner\">",{"nodelist":["partner"],"type":"translate"},"</a>\n    </li>\n    <!-- /ko -->\n\n",{"blocks":[{"attachment":["\n    \n    ",{"blocks":[{"attachment":["\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user) ","type":"ncondition"}],"type":"ef"},"\">\n        <a class=\"gear-dropdown-toggle\">\n            <div>\n                <div class=\"gear ",{"blocks":[{"attachment":["admin"],"expression":"page_identities.is_admin ","type":"ncondition"}],"type":"ef"},"\" data-bind=\"css: {admin: isAdmin()}\"></div>\n                <span class=\"bc-ui menucaret\"></span>\n            </div>\n        </a>\n\n        <ul class=\"menu user-menu hidden-while-loading\">\n            ",{"blocks":[{"attachment":["\n                <!-- ko if: (fan() && !fan().private) -->\n                <li><a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/purchases?from=menubar\">",{"nodelist":["purchases"],"type":"translate"},"</a></li>\n                <!-- /ko -->\n            "],"expression":"cfg.order_history ","type":"ncondition"}],"type":"ef"},"\n            <li><a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/settings?from=menubar\">",{"nodelist":["settings"],"type":"translate"},"</a></li>\n            <li><a href=\"",{"filters":[["a",[]]],"name":"siteroot_current","type":"variable"},"/help?from=menubar\">",{"nodelist":["help"],"type":"translate"},"</a></li>\n            ",{"blocks":[{"attachment":["\n            <li><a href=\"",{"filters":[["a",[]]],"name":"siteroot_current","type":"variable"},"/basics?from=menubar\">",{"nodelist":["basics"],"type":"translate"},"</a></li>\n            "],"expression":"page_identities.bands && page_identities.bands.length > 0 ","type":"ncondition"}],"type":"ef"},"\n            <li><a class=\"logout-action\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout\">",{"nodelist":["log out"],"type":"translate"},"</a></li>\n        </ul>\n    </li>\n    "],"expression":"!hide_gear ","type":"ncondition"}],"type":"ef"},"\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n    <!-- ko if: showBandControls() || showLimitedAccessControls() -->\n    ",{"blocks":[{"attachment":["\n        \n        <li class=\"search extended menubar-item ",{"filters":[],"name":"hide_unless_has_access","type":"variable"}," search-alt\">\n            <form class=\"autocomplete-form signup-tooltip-parent\" id=\"autocomplete-form\" action=\"/search\" method=\"get\" data-tooltip-id=\"s\">\n                <input id=\"search-field\" type=\"text\" class=\"you-autocomplete-me dismiss-tooltip-alt search-alt\" title=\"\" tabindex=\"1\" autocomplete=\"off\" maxlength=\"2048\" name=\"q\"><label for=\"search-field\" tabindex=\"2\" type=\"submit\" title=\"search\">\n                    <svg width=\"16px\" height=\"17px\" class=\"menubar-search-icon\"><use xlink:href=\"#menubar-search-icon\"></svg></label>\n                <input type=\"hidden\" name=\"from\" value=\"fanbar\">\n                <input type=\"hidden\" name=\"",{"blocks":[{"attachment":["logged_out_menubar"],"expression":"!(page_identities.user) ","type":"ncondition"},{"attachment":["logged_in_menubar"],"type":"else_ncondition"}],"type":"ef"},"\" value=\"1\">\n                <div id=\"menubar-autocomplete-results\" class=\"menubar-autocomplete-results\" data-bind=\"with: AutocompleteVM\"> ",{"template_name":"'_autocomplete_search_widget'","type":"include"}," </div>\n                <div class=\"signup-tooltip-outer search-tooltip-outer header-2018 alt\"></div>\n            </form>\n        </li>\n    "],"expression":"!hide_search ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko --> <!-- claire minimized search for artist -->\n\n    ",{"blocks":[{"attachment":["\n        ",{"template_name":"'corp_hiring_banner'","type":"include"},"\n    "],"expression":"has_corp_header ","type":"ncondition"}],"type":"ef"},"\n\n    ",{"blocks":[{"attachment":["\n    <li class=\"menubar-item menubar-gift-card-balance\">\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/redeem\">\n            <svg class=\"icon gift-card-icon-bordered\" width=\"9px\" height=\"10px\" viewBox=\"0 0 9 10\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#gift-card-icon\"></use></svg>\n            <span class=\"gift-card-balance\">",{"filters":[["money",["1"]],["h",[]]],"name":"menubar.gift_card_balance","type":"variable"}," ",{"filters":[["h",[]]],"name":"menubar.gift_card_balance.currency","type":"variable"},"</span>\n        </a>\n    </li>\n    "],"expression":"menubar.gift_card_balance ","type":"ncondition"}],"type":"ef"},"\n\n    ",{"blocks":[{"attachment":["\n    <li data-bind=\"visible: hasCart\" class=\"menubar-item cart-wrapper ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!has_cart ","type":"ncondition"}],"type":"ef"},"\">\n        <a data-bind=\"click: goCart\">\n            <svg width=\"24px\" height=\"23px\" viewBox=\"3 0 20 28\" class=\"menubar-cart-icon\"><use xlink:href=\"#menubar-cart-icon\"></svg>\n            <span class=\"cart-count\" data-bind=\"text: numCartItemsDisplay\"></span>\n        </a>\n    </li>\n    "],"expression":"page_identities.user && !hide_cart_icon ","type":"ncondition"}],"type":"ef"},"\n\n    <!-- ko if: (fan() && !fan().private) -->\n    ",{"blocks":[{"attachment":["\n        <li id=\"feed-main\" class=\"signup-tooltip-parent menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\" data-tooltip-id=\"f\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/feed?from=menubar\">\n                <svg width=\"20px\" height=\"25px\" class=\"svg-icon\"><use xlink:href=\"#menubar-feed-icon\"></svg>\n            </a>\n            <div class=\"signup-tooltip-outer feed-tooltip-outer header-2018\"></div>\n        </li>\n    "],"expression":"!hide_feed ","type":"ncondition"}],"type":"ef"},"\n\n    ",{"blocks":[{"attachment":["\n        ",{"blocks":[{"attachment":["\n        <li id=\"collection-main\" class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"\">\n                <svg width=\"25.5px\" height=\"25px\" class=\"svg-icon\"><use xlink:href=\"#menubar-collection-icon\"></svg>\n            </a>\n        </li>\n        "],"expression":"menubar.has_collection || (!menubar.has_collection && !menubar.has_wishlist) ","type":"ncondition"},{"attachment":["\n        <li id=\"collection-main\" class=\"signup-tooltip-parent menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user && page_identities.fan && !page_identities.fan.private) ","type":"ncondition"}],"type":"ef"},"\" data-tooltip-id=\"w\">\n            <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/wishlist\">\n                <svg width=\"25.5px\" height=\"25px\" class=\"svg-icon\"><use xlink:href=\"#menubar-collection-icon\"></svg>\n            </a>\n            <div class=\"signup-tooltip-outer wishlist-tooltip-outer header-2018\"></div>\n        </li>\n        "],"expression":"menubar.has_wishlist ","type":"ncondition"}],"type":"ef"},"\n    "],"expression":"!hide_collection_wishlist ","type":"ncondition"}],"type":"ef"},"\n    <!-- /ko -->\n        ",{"blocks":[{"attachment":[" <!-- placeholder for artist message feature -->\n            <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user) ","type":"ncondition"}],"type":"ef"},"\">\n                <a href=\"#\">\n                    <svg width=\"26px\" height=\"25px\" class=\"svg-icon\"><use xlink:href=\"#menubar-messages-icon\"></svg>\n                </a>\n            </li>\n        "],"expression":"false ","type":"ncondition"}],"type":"ef"},"\n        <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(page_identities.user) ","type":"ncondition"}],"type":"ef"},"\">\n        <a>\n            <div data-bind=\"with: artistsMenu\">\n                <!-- ko if: optionsLoggedInBand() && optionsLoggedInBand().photo -->\n                <div class=\"userpic ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"page_identities.fan && !page_identities.bands[0] ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["admin"],"expression":"is_admin ","type":"ncondition"}],"type":"ef"},"\">\n                    <img ",{"blocks":[{"attachment":[{"filters":[["image",["'bio_navbar'"]]],"name":"page_identities.bands[0].photo","type":"variable"}],"expression":"!active_linked_band && page_identities.bands[0] ","type":"ncondition"}],"type":"ef"},"\n                        data-bind=\"src_image: {image_id: optionsLoggedInBand().photo, format: 'bio_navbar'}, css: { 'no-image-placeholder': !(optionsLoggedInBand().photo) }\"\n                    >\n                </div>\n                <!-- /ko -->\n                <!-- ko ifnot: optionsLoggedInBand() && optionsLoggedInBand().photo -->\n                <div class=\"userpic ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"page_identities.bands[0] ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["admin"],"expression":"is_admin ","type":"ncondition"}],"type":"ef"},"\">\n                    <img ",{"filters":[["image",["'bio_navbar'"]]],"name":"page_identities.fan.photo","type":"variable"}," class=\"hidden-while-loading\" data-bind=\"css: { 'no-image-placeholder': !(Identities.fan.photo) }\">\n                </div>\n                <!-- /ko -->\n            </div>\n        </a>\n\n        <ul class=\"menu user-menu hidden-while-loading\" data-bind=\"with: artistsMenu, css: { label: (artistsMenu.loggedInLabelMemberBands().length > 0 || artistsMenu.linkedNonLabelMemberBands().length > 1) }\">\n        <ol class=\"user-menu-wrapper\">\n            <!-- ARTIST -->\n            <!-- ko if: bmgr.bands().length >= 1 && loggedInBand() -->\n                <li class=\"submenu-item\">\n                    <a data-bind=\"attr: { href: loggedInBand().trackpipeLocalUrl()}\" class=\"name\">\n                        <strong class=\"menu-bandname\" data-bind=\"text: optionsLoggedInBand().title\">",{"filters":[["h",[]]],"name":"artistsmenu_title","type":"variable"},"</strong> <div data-bind=\"visible: optionsLoggedInBand().showPro\" class=\"menubar-badge-pro round3 ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!artistsmenu_show_pro ","type":"ncondition"}],"type":"ef"},"\">",{"nodelist":["PRO"],"type":"translate"},"</div>\n                        <!-- ko if: optionsLoggedInBand().showPhoto -->\n                        <div class=\"userpic ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!artistsmenu_show_photo ","type":"ncondition"}],"type":"ef"},"\">\n                            ",{"blocks":[{"attachment":["\n                                <img class=\"no-image-placeholder\"></img>\n                            "],"expression":"!page_identities.bands[0] || !page_identities.bands[0].photo ","type":"ncondition"},{"attachment":["\n                                <img ",{"filters":[["image",["'bio_navbar'"]]],"name":"page_identities.bands[0].photo","type":"variable"},"\n                                data-bind=\"src_image: {image_id: optionsLoggedInBand().photo, format: 'bio_navbar'}, css: { 'no-image-placeholder': !(optionsLoggedInBand().photo) }\">\n                            "],"type":"else_ncondition"}],"type":"ef"},"\n                        </div>\n                        <!-- /ko -->\n                    </a>\n                </li> \n\n                <li class=\"submenu-item\">\n                    <a data-bind=\"\n                        attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/profile?id=' + loggedInBand().id},\n                        css: {admin: optionsLoggedInBand().adminAccess}\"\n                    >\n                        <span>",{"nodelist":["edit profile"],"type":"translate"},"</span>\n                    </a>\n                </li>\n                <li class=\"submenu-item\">\n                    <a data-bind=\"\n                        attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/tools?id=' + loggedInBand().id},\n                        css: {admin: optionsLoggedInBand().adminAccess}\"\n                    >\n                        <span>",{"nodelist":["tools"],"type":"translate"},"</span>\n                    </a>\n                </li>\n\n                <li class=\"submenu-item\">\n                    ",{"blocks":[{"attachment":["\n                        <!-- ko if: isPageBand(loggedInBand().id) -->\n                        <a data-bind=\"attr: { href: '/no_js/edit_design'}\">",{"nodelist":["page design"],"type":"translate"},"</a>\n                        <!-- /ko -->\n                        <!-- ko ifnot: isPageBand(loggedInBand().id) -->\n                        <a data-bind=\"attr: { href: loggedInBand().trackpipeLocalUrl() + '?launch_edit_design=1'}\">",{"nodelist":["page design"],"type":"translate"},"</a>\n                        <!-- /ko -->\n                    "],"expression":"design_editable ","type":"ncondition"},{"attachment":["\n                        <a data-bind=\"attr: { href: loggedInBand().trackpipeLocalUrl() + '?launch_edit_design=1'}\">",{"nodelist":["page design"],"type":"translate"},"</a>\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                </li>\n\n                <li class=\"ui-menu-item ",{"blocks":[{"attachment":["disabled"],"expression":"menubar.page_path == '/edit_subscription' ","type":"ncondition"}],"type":"ef"}," submenu-item\">\n                    <!-- ko ifnot: loggedInBand().hasService() -->\n                        <a data-bind=\"attr: { href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/subscriptions?band_id=' + loggedInBand().id + '&from=menubar'}\">",{"nodelist":["subscription"],"type":"translate"},"</a>\n                    <!-- /ko -->\n                    <!-- ko if: loggedInBand().hasService() -->\n                        <a data-bind=\"attr: { href: loggedInBand().trackpipeLocalUrl() + '/' + loggedInBand().serviceUrlFragment() + '?from=menubar'}\">",{"nodelist":["subscription"],"type":"translate"},"</a>\n                    <!-- /ko -->\n                </li>\n            <!-- /ko -->\n            \n            <!-- FAN -->\n            <!-- ko if: ($parent.fan() && !$parent.fan().private) -->\n            <li class=\"submenu-item\">\n                <a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"\" class=\"name\">\n                    <strong class=\"menu-bandname\">",{"filters":[["h",[]]],"name":"page_identities.fan.name","type":"variable"},"</strong>\n                    <div class=\"userpic fanpic ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!page_identities.fan ","type":"ncondition"}],"type":"ef"},"\">\n                        ",{"blocks":[{"attachment":["\n                            <img class=\"no-image-placeholder\"></img>\n                        "],"expression":"!page_identities.fan.photo ","type":"ncondition"},{"attachment":["\n                            <img ",{"filters":[["image",["'bio_navbar'"]]],"name":"page_identities.fan.photo","type":"variable"},">\n                        "],"type":"else_ncondition"}],"type":"ef"},"\n                    </div>\n                </a>\n            </li>\n            <li class=\"submenu-item\"><a href=\"",{"filters":[["a",[]]],"name":"page_identities.fan.url","type":"variable"},"/purchases?from=menubar\"><span>",{"nodelist":["purchases"],"type":"translate"},"</span></a></li>\n            <!-- /ko -->\n            <li class=\"ui-widget-content ui-menu-divider\"></li>\n\n            <!-- LABEL ARTISTS -->\n            <!-- ko if: loggedInLabelMemberBands() && loggedInLabelMemberBands().length > 0 -->\n            <li class=\"menu-switch ui-menu-item submenu-item ui-state-disabled\" data-bind=\"visible: !showLinkedBands()\">\n                <span data-bind=\"attr: {href: loggedInBand().trackpipeLocalUrl() + '/artists?from=menubar_artist_dropdown'}, text: loggedInLabelMemberBandsCountStr()\"></span>\n            </li>\n\n            <ol class=\"label-artist-menu no-pro-badges ui-state-disabled ui-menu-item\" data-bind=\"visible: !showLinkedBands()\">\n            <input type=\"text\" class=\"artist-filter-text\" data-bind=\"textInput: labelMemberBandsSearchTerm, visible: loggedInLabelMemberBands().length > 10\" placeholder=\"",{"nodelist":["Search all artists"],"type":"translate"},"\">\n\n                <!-- ko foreach: filteredLoggedInLabelMemberBands() -->\n                    <li class=\"label-member-band submenu-item\" data-bind=\"template: {\n                        'name': 'band-menuitem-template-options'\n                    }\"></li>\n                <!-- /ko -->\n\n                <!-- ko if: filteredLoggedInLabelMemberBands().length == 0 -->\n                    <li class=\"no-results submenu-item\">",{"nodelist":["no results"],"type":"translate"},"</li>\n                <!-- /ko -->\n            </ol>\n            <li class=\"ui-widget-content ui-menu-divider\" data-bind=\"visible: !showLinkedBands()\"></li>\n            <!-- /ko -->\n\n            <!-- LINKED ACCOUNTS -->\n            <!-- ko if: linkedNonLabelMemberBands().length > 1 -->\n            <ol class=\"linked-accounts-wrapper\">\n                <li class=\"menu-switch ui-menu-item submenu-item linked-accounts-menu ui-state-disabled\" data-bind=\"click: function () {showLinkedBands(!showLinkedBands())}\">\n                <span data-bind=\"text: loggedInLinkedBandsCountStr()\"></span><div data-bind=\"css: { 'arrow-down': showLinkedBands(), 'arrow-right' : !showLinkedBands() }\"></div>\n                </li>\n                <ol class=\"ui-state-disabled linked-accounts-menu-content\" data-bind=\"visible: showLinkedBands()\">\n                <!-- ko foreach: linkedNonLabelMemberBands() -->\n                    <li class=\"submenu-item\" data-bind=\"template: {\n                        'name': 'band-menuitem-template'\n                    },\n                    css: {\n                        'hidden': ($data.id == $root.artistsMenu.loggedInBand().id)\n                    }\"></li>\n                <!-- /ko -->\n                </ol>\n            </ol>\n            <li class=\"ui-widget-content ui-menu-divider\"></li>\n            <!-- /ko -->\n\n\n            <!-- ALL USERS -->\n            <ol class=\"all-user-option\">\n                <li class=\"submenu-item\"><a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/settings?from=menubar\">",{"nodelist":["settings"],"type":"translate"},"</a></li>\n                <li class=\"submenu-item\"><a href=\"",{"filters":[["a",[]]],"name":"siteroot_current","type":"variable"},"/help?from=menubar\">",{"nodelist":["help"],"type":"translate"},"</a></li>\n                <li class=\"submenu-item\"><a class=\"logout-action\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout\">",{"nodelist":["log out"],"type":"translate"},"</a></li>\n            </ol>\n        </ol>\n        </ul>\n    </li>\n"],"type":"else_ncondition"}],"type":"ef"},"\n<!-- /ko -->\n\n<!-- ko ifnot: user() -->\n    ",{"blocks":[{"attachment":["\n    <li data-bind=\"visible: hasCart\" class=\"menubar-item cart-wrapper hidden-while-loading\">\n        <a data-bind=\"click: goCart\">\n            <svg width=\"24px\" height=\"23px\" viewBox=\"3 0 20 28\" class=\"menubar-cart-icon\"><use xlink:href=\"#menubar-cart-icon\"></svg>\n            <span class=\"cart-count\" data-bind=\"text: numCartItemsDisplay\"></span>\n        </a>\n    </li>\n    "],"expression":"cfg.header_rework_2018 && !page_identities.user && !hide_cart_icon ","type":"ncondition"}],"type":"ef"},"\n    ",{"blocks":[{"attachment":["\n        ",{"blocks":[{"attachment":["\n            ",{"blocks":[{"attachment":["\n                <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.user) ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"is_fan_page ","type":"ncondition"}],"type":"ef"},"\">\n                <a href=\"/gift_cards?from=menubar\">",{"nodelist":["gift cards"],"type":"translate"},"</a>\n                </li>\n            "],"expression":"!cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n            <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.user) ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"is_fan_page ","type":"ncondition"}],"type":"ef"},"\">\n                <a class=\"all-signup-link\">",{"nodelist":["sign up"],"type":"translate"},"</a>\n            </li>\n        "],"expression":"!hide_signup ","type":"ncondition"}],"type":"ef"},"\n        <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.user) ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"menubar.page_path == \"/login\" ","type":"ncondition"}],"type":"ef"},"\">\n            <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/login",{"blocks":[{"attachment":["?from=fan_page"],"expression":"is_fan_page ","type":"ncondition"},{"attachment":["?from=menubar"],"type":"else_ncondition"}],"type":"ef"},{"blocks":[{"attachment":[{"filters":[["a",[]]],"name":"menubar_login_bounce_param","type":"variable"}],"expression":"menubar_login_bounce_param ","type":"ncondition"}],"type":"ef"},"\">",{"nodelist":["log in"],"type":"translate"},"</a>\n        </li>\n    "],"expression":"!hide_login_signup ","type":"ncondition"}],"type":"ef"},"\n<!-- /ko -->\n",{"blocks":[{"attachment":["\n",{"blocks":[{"attachment":["\n<!-- ko ifnot: fan() -->\n    <!-- ko ifnot: user() -->\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.fan) || !(!page_identities.user) ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"is_fan_page ","type":"ncondition"}],"type":"ef"},"\">\n        <a class=\"fan-signup-modal-link\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans?from=menubar\"\n            ",{"blocks":[{"attachment":["\n            data-from=\"",{"filters":[["a",[]]],"name":"fan_signup_params.from","type":"variable"},"\"\n            data-email=\"",{"filters":[["a",[]]],"name":"fan_signup_params.email","type":"variable"},"\"\n            data-token=\"",{"filters":[["a",[]]],"name":"fan_signup_params.signup_token","type":"variable"},"\"\n            data-tsig=\"",{"filters":[["a",[]]],"name":"fan_signup_params.tsig","type":"variable"},"\"\n            data-verified=\"",{"filters":[["a",[]]],"name":"fan_signup_params.verified","type":"variable"},"\"\n            "],"expression":"fan_signup_params ","type":"ncondition"}],"type":"ef"},"\n            >",{"nodelist":["sign up"],"type":"translate"},"</a>\n    </li>\n    <!-- /ko -->\n    <!-- ko if: user() -->\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.fan) || !page_identities.user ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"is_fan_page ","type":"ncondition"}],"type":"ef"},"\">\n        <a class=\"fan-signup-modal-link\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fans?from=menubar\">",{"nodelist":["sign up as fan"],"type":"translate"},"</a>\n    </li>\n    <!-- /ko -->\n</li>\n<!-- /ko -->\n"],"expression":"ppp_menubar ","type":"ncondition"}],"type":"ef"},"\n",{"blocks":[{"attachment":["\n<!-- ko if: fan() -->\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!page_identities.fan ","type":"ncondition"}],"type":"ef"},"\">\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/",{"filters":[["a",[]]],"name":"page_identities.fan.username","type":"variable"},"\">\n            <div>\n                ",{"blocks":[{"attachment":["\n                <div class=\"userpic ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!identities.fan ","type":"ncondition"}],"type":"ef"},"\">\n                    <img ",{"filters":[["image",["'bio_navbar'"]]],"name":"identities.fan.photo","type":"variable"},">\n                </div>\n                "],"expression":"identities && identities.fan && identities.fan.photo ","type":"ncondition"}],"type":"ef"},"\n                <span class=\"fanname\">",{"filters":[["h",[]]],"name":"identities.fan.name","type":"variable"},"</span>\n            </div>\n        </a>\n    </li>\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!page_identities.fan ","type":"ncondition"}],"type":"ef"},"\">\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout\">",{"nodelist":["log out"],"type":"translate"},"</a>\n    </li>\n<!-- /ko -->\n"],"expression":"cc_menubar ","type":"ncondition"}],"type":"ef"},"\n",{"blocks":[{"attachment":["\n<!-- ko ifnot: fan() -->\n    <!-- ko ifnot: user() -->\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.fan) || !(!page_identities.user)","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"is_fan_page ","type":"ncondition"}],"type":"ef"},"\">\n       <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/login?from=menubar\">",{"nodelist":["log in"],"type":"translate"},"</a>\n    </li>\n    <!-- /ko -->\n    <!-- ko if: user() -->\n    <li class=\"menubar-item ",{"blocks":[{"attachment":["hidden-while-loading"],"expression":"!(!page_identities.fan) || !page_identities.user ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["mobile-hidden"],"expression":"is_fan_page ","type":"ncondition"}],"type":"ef"},"\">\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout?login=1\">",{"nodelist":["log in as fan"],"type":"translate"},"</a>\n    </li>\n    <!-- /ko -->\n<!-- /ko -->\n"],"expression":"ppp_menubar || cc_menubar ","type":"ncondition"}],"type":"ef"},"\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n\n</ul>\n</div>\n\n",{"blocks":[{"attachment":["\n\n<div class='corp-banners'>\n    ",{"blocks":[{"attachment":["\n        ",{"expression":"page_identities.fan && !page_identities.fan.verified && !page_identities.fan.private ","type":"let","variable":"is_unverified_fan"},"\n        ",{"expression":"fan_onboarding.show_verify_banner && is_unverified_fan && !skip_verification_banner ","type":"let","variable":"show_verify_banner"},"\n        ",{"expression":"fan_onboarding.email ","type":"let","variable":"verify_email"},"\n        ",{"template_name":"'home_2016/fan_verify_banner'","type":"include"},"\n    "],"expression":"fan_onboarding ","type":"ncondition"}],"type":"ef"},"\n</div>\n"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n\n<!-- Knockout template for list items in the artists menu -->\n<script type=\"text/html\" id=\"band-menuitem-template\">\n    ",{"blocks":[{"attachment":["\n    <a class=\"menu-artistitem\"\n        data-bind=\"\n            attr: {href: $root.artistsMenu.isPageBand(id) ? '' : trackpipeUrlHttps()},\n            css: {'is-pro': isPro()}\"\n    >\n        <span class=\"menu-artistpic\">\n            <img data-bind=\"src_image: {image_id: photo(), format: 'bio_navbar'}\">\n        </span>\n        <span data-bind=\"text: name()\" class=\"menu-bandname\"></span>\n        <span data-bind=\"visible: isPro()\" class=\"badge-pro round3\">",{"nodelist":["PRO"],"type":"translate"},"</span>\n    </a>\n    "],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n        <li class=\"menu-artistitem\"\n            data-bind=\"css: {'is-pro': isPro()}, click: function () {$root.artistsMenu.setLoggedInBand(id)}\"\n        >\n            <span class=\"menu-artistpic\">\n                <img data-bind=\"src_image: {image_id: photo(), format: 'bio_navbar'}, css: { 'no-image-placeholder': !photo() }\">\n            </span>\n            <span data-bind=\"text: name()\" class=\"menu-bandname menu-text\"></span>\n            <span data-bind=\"visible: isPro()\" class=\"menubar-badge-pro round3\">",{"nodelist":["PRO"],"type":"translate"},"</span>\n        </li>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n</script>\n\n<script type=\"text/html\" id=\"band-menuitem-template-options\">\n    ",{"blocks":[{"attachment":["\n        <a data-bind=\"attr: {href: trackpipeUrlHttps()}\" class=\"menu-artistitem\">\n            <span class=\"menu-artistpic\">\n                <img data-bind=\"src_image: {image_id: photo(), format: 'bio_navbar'}, css: { 'no-image-placeholder': !(photo()) }\">\n            </span>\n            <span data-bind=\"text: name()\" class=\"menu-bandname menu-text\"></span>\n            <span class=\"show-more\" data-bind=\"visible: $root.artistsMenu.bmgr.bandByID(id) || $root.artistsMenu.lmgr.isMemberBandAuthed(id), click: function () { $root.artistsMenu.setActiveLabelMemberBand(id)}\"></span>\n        </a>\n        <!-- ko if: ($root.artistsMenu.activeLabelMemberBand() == id) -->\n        <div class=\"label-artist-menu-links ui-menu-item\">\n            <span data-bind=\"visible: $root.artistsMenu.bmgr.bandByID(id) || $root.artistsMenu.lmgr.isMemberBandAuthed(id)\">\n                <a data-bind=\"\n                    attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/profile?id=' + id}\"\n                >\n                    <span class=\"menu-text\">",{"nodelist":["edit profile"],"type":"translate"},"</span>\n                </a>\n                <a data-bind=\"\n                    attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/tools?id=' + id}\"\n                >\n                    <span class=\"menu-text\">",{"nodelist":["tools"],"type":"translate"},"<span>\n                </a>\n                ",{"blocks":[{"attachment":["\n                    <!-- ko if: ($root.artistsMenu.isPageBand(id)) -->\n                    <a data-bind=\"attr: { href: '/no_js/edit_design'}\"><span class=\"menu-text\">",{"nodelist":["page design"],"type":"translate"},"</span></a>\n                    <!-- /ko -->\n                    <!-- ko ifnot: ($root.artistsMenu.isPageBand(id)) -->\n                    <a data-bind=\"attr: { href: trackpipeLocalUrl() + '?launch_edit_design=1'}\"><span class=\"menu-text\">",{"nodelist":["page design"],"type":"translate"},"</span></a>\n                    <!-- /ko -->\n                "],"expression":"design_editable ","type":"ncondition"},{"attachment":["\n                    <a data-bind=\"attr: { href: trackpipeLocalUrl() + '?launch_edit_design=1'}\"><span class=\"menu-text\">",{"nodelist":["page design"],"type":"translate"},"</span></a>\n                "],"type":"else_ncondition"}],"type":"ef"},"\n\n                <!-- ko ifnot: hasService() -->\n                    <a data-bind=\"attr: { href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/subscriptions?band_id=' + id + '&from=menubar'}\"><span class=\"menu-text\">",{"nodelist":["subscription"],"type":"translate"},"</span></a>\n                <!-- /ko -->\n                <!-- ko if: hasService() -->\n                    <a data-bind=\"attr: { href: trackpipeLocalUrl() + '/' + serviceUrlFragment() + '?from=menubar'}\"><span data-bind=\"text: serviceName()\" class=\"menu-text\">",{"nodelist":["subscription"],"type":"translate"},"</span></a>\n                <!-- /ko -->\n            </span>\n        </div>\n        <!-- /ko -->\n        <span class=\"show-less\" data-bind=\"visible: $root.artistsMenu.activeLabelMemberBand() == id && ($root.artistsMenu.bmgr.bandByID(id) || $root.artistsMenu.lmgr.isMemberBandAuthed(id)), click: function () { $root.artistsMenu.setActiveLabelMemberBand(id) }\">show less</span>\n\n    "],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n</script>\n\n\n<!-- Knockout template for the parent label -->\n<script type=\"text/html\" id=\"band-parentlabel-template\">\n    <div data-bind=\"css: {'artist-listing-with-links': $parent.columns() > 1}\">\n        <a class=\"menu-artistitem\" data-bind=\"attr: {href: trackpipeUrlHttps()}\">\n        <!-- ko if: $parent.columns() === 1 -->\n            <span class=\"menu-artistpic\">\n                <img data-bind=\"src_image: {image_id: photo(), format: 'bio_navbar'}\">\n            </span>\n            <span data-bind=\"text: name()\" class=\"menu-bandname\"></span>\n        <!-- /ko -->\n        <!-- ko if: $parent.columns() > 1 -->\n            <!-- ko if: photo() -->\n                <img class=\"photo\" data-bind=\"src_image: {image_id: photo(), format: 'fan_bio_thumb_small'}\">\n            <!-- /ko -->\n            <!-- ko ifnot: photo() -->\n                <div class=\"photo none\"></div>\n            <!-- /ko -->\n        <!-- /ko -->\n        </a>\n   \n        <div class=\"infobox\">\n            <p class=\"name\"><a data-bind=\"attr: {href: trackpipeUrl()}, text: name()\"></a></p>\n            <p class=\"actions\">\n                <a data-bind=\"attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/profile?from=menubar&id=' + id}\">",{"nodelist":["profile"],"type":"translate"},"</a> &middot;\n                <a data-bind=\"attr: {href: '",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/tools?from=menubar&id=' + id}\">",{"nodelist":["tools"],"type":"translate"},"</a> &middot;\n                <a data-bind=\"attr: {href: trackpipeLocalUrl() + '/stats?from=menubar'}\">",{"nodelist":["stats"],"type":"translate"},"</a>\n            </p>\n        </div>\n    </div>\n</script>\n</div>\n"],
"home/header_2015":["<div class=\"hd ",{"blocks":[{"attachment":["header-rework-2018"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"}," row ",{"blocks":[{"attachment":["logged-in"],"expression":"identities.user && user_type ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["tooltips-hidden"],"expression":"!is_client_render ","type":"ncondition"}],"type":"ef"}," ",{"blocks":[{"attachment":["corp-home"],"expression":"is_corp_home ","type":"ncondition"}],"type":"ef"},"\">\n    <div class=\"row\">\n        <div class=\"col col-7-12\">\n            ",{"blocks":[{"attachment":["\n                <h1 class=\"hd-logo\"><span>Bandcamp</span></h1>\n            "],"expression":"is_corp_home ","type":"ncondition"},{"attachment":["\n                <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"\"><h1 class=\"hd-logo\"><span>Bandcamp</span></h1></a>\n            "],"type":"else_ncondition"}],"type":"ef"},"\n            ",{"blocks":[{"attachment":["\n            <h2 class=\"hd-sub-head\">",{"nodelist":["Discover amazing new music and directly support the artists who make it."],"type":"translate"},"</h2>\n            "],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n            <h2 class=\"hd-sub-head\">",{"nodelist":["Discover amazing new music and <a ",{"nodelist":["class=\"blue-gradient\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/fair_trade_music_policy\""],"type":"translateVariable","var_name":"link"},">directly support</a> the artists who make it."],"type":"translate"},"</h2>\n            "],"type":"else_ncondition"}],"type":"ef"},"\n            ",{"blocks":[{"attachment":["\n            <ul class=\"hd-nav user-nav\">\n                ",{"blocks":[{"attachment":["\n                <li class=\"user-nav-thumb\">\n                    <span class=\"user-nav-thumb\">\n                        <img ",{"filters":[["image",["'bio_navbar'"]]],"name":"user_photo","type":"variable"},">\n                    </span>\n                </li>\n                "],"expression":"user_photo ","type":"ncondition"}],"type":"ef"},"\n                <li class=\"name\">\n                    ",{"blocks":[{"attachment":["\n                        ",{"nodelist":["Hi ",{"nodelist":[{"filters":[["h",[]]],"name":"fan_name","type":"variable"}],"type":"translateVariable","var_name":"name"},""],"type":"translate"},"\n                    "],"expression":"fan_name ","type":"ncondition"},{"attachment":["\n                        ",{"nodelist":["Hi ",{"nodelist":[{"filters":[["h",[]]],"name":"user_name","type":"variable"}],"type":"translateVariable","var_name":"name"},""],"type":"translate"},"\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                </li>\n\n                ",{"blocks":[{"attachment":["\n                    <li class=\"signup-tooltip-parent\" data-tooltip-id=\"f\">\n                        <a href=\"",{"filters":[["a",[]]],"name":"collection_url","type":"variable"},"/feed\">",{"nodelist":["feed"],"type":"translate"},"</a>\n                        <div class=\"signup-tooltip-outer feed-tooltip-outer\"></div>\n                    </li>\n\n                    ",{"blocks":[{"attachment":["\n                        <li class=\"signup-tooltip-parent\" data-tooltip-id=\"w\">\n                            <a href=\"",{"filters":[["a",[]]],"name":"collection_url","type":"variable"},"/wishlist\">",{"nodelist":["wishlist"],"type":"translate"},"</a>\n                            <div class=\"signup-tooltip-outer wishlist-tooltip-outer\"></div>\n                        </li>\n                    "],"expression":"has_wishlist && !has_collection ","type":"ncondition"},{"attachment":["\n                        <li class=\"signup-tooltip-parent\" data-tooltip-id=\"c\">\n                            <a href=\"",{"filters":[["a",[]]],"name":"collection_url","type":"variable"},"\">",{"nodelist":["collection"],"type":"translate"},"</a>\n                            <div class=\"signup-tooltip-outer collection-tooltip-outer\"></div>\n                        </li>\n                        <li class=\"signup-tooltip-parent\" data-tooltip-id=\"w\">\n                            <a href=\"",{"filters":[["a",[]]],"name":"collection_url","type":"variable"},"/wishlist\">",{"nodelist":["wishlist"],"type":"translate"},"</a>\n                            <div class=\"signup-tooltip-outer wishlist-tooltip-outer\"></div>\n                        </li>\n                    "],"expression":"has_wishlist ","type":"ncondition"},{"attachment":["\n                        <li class=\"signup-tooltip-parent\" data-tooltip-id=\"c\">\n                            <a href=\"",{"filters":[["a",[]]],"name":"collection_url","type":"variable"},"\">",{"nodelist":["collection"],"type":"translate"},"</a>\n                            <div class=\"signup-tooltip-outer collection-tooltip-outer\"></div>\n                        </li>\n                    "],"type":"else_ncondition"}],"type":"ef"},"\n                "],"expression":"collection_url && !identities.fan.private ","type":"ncondition"}],"type":"ef"},"\n\n                ",{"blocks":[{"attachment":["\n                <li><a href=\"",{"filters":[["a",[]]],"name":"band_url","type":"variable"},"\">your site</a></li>\n                "],"expression":"band_url ","type":"ncondition"},{"attachment":["\n                <li><a href=\"",{"filters":[["a",[]]],"name":"partner_url","type":"variable"},"\">your page</a></li>\n                "],"expression":"partner_url ","type":"ncondition"}],"type":"ef"},"\n\n                ",{"blocks":[{"attachment":["\n                <li class=\"cartitem\">\n                    <a href=\"/cart\">\n                        <span class=\"cart bc-home\">&nbsp;</span>\n                        <span class=\"cart-item-count\">",{"filters":[],"name":"cart_quantity","type":"variable"},"</span>\n                    </a>\n                </li>\n                "],"expression":"has_cart ","type":"ncondition"}],"type":"ef"},"\n\n                ",{"blocks":[{"attachment":["\n                    ",{"expression":"!cfg.header_rework_2018 && (band_url || partner_url) && collection_url ","type":"let","variable":"hide_gift_card_balance"},"\n                    ",{"template_name":"'home/header_gift_balance'","type":"include"},"\n                "],"expression":"gift_card_balance ","type":"ncondition"}],"type":"ef"},"\n            </ul>\n            "],"expression":"identities.user && user_type ","type":"ncondition"}],"type":"ef"},"\n        </div>\n        <div class=\"col col-5-12\">\n            <form class=\"searchwidget autocomplete-form signup-tooltip-parent\" id=\"autocomplete-form\" action=\"/search\" method=\"get\" data-tooltip-id=\"s\">\n                ",{"blocks":[{"attachment":["\n                <input name=\"q\" type=\"text\" class=\"you-autocomplete-me dismiss-tooltip-alt\" placeholder=\"",{"nodelist":["Search for artist, track or album"],"type":"translate"},"\" tabindex=\"1\" autocomplete=\"off\" maxlength=\"2048\">\n                "],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n                <input name=\"q\" type=\"text\" class=\"you-autocomplete-me dismiss-tooltip-alt\" placeholder=\"",{"nodelist":["Search and discover music"],"type":"translate"},"\" tabindex=\"1\" autocomplete=\"off\" maxlength=\"2048\">\n                "],"type":"else_ncondition"}],"type":"ef"},"\n                <div id=\"homepage-autocomplete-results\" class=\"homepage-autocomplete-results\" data-bind=\"with: AutocompleteVM\"> ",{"template_name":"'_autocomplete_search_widget'","type":"include"}," </div>\n                <input type=\"hidden\" name=\"from\" value=\"corphome\">\n                <button type=\"submit\"><span class=\"icon bc-home\"></span>",{"nodelist":["Search"],"type":"translate"},"</button>\n                <div class=\"signup-tooltip-outer search-tooltip-outer\"></div>\n            </form>\n            <ul class=\"hd-nav corp-nav\">\n                ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                <li>\n                    <a class=\"gift-cards-link\" href=\"/gift_cards?from=header\">",{"nodelist":["gift cards"],"type":"translate"},"</a>\n                </li>\n                "],"expression":"cfg.gift_cards ","type":"ncondition"}],"type":"ef"},"\n                <li class=\"signup-tooltip-parent\" data-tooltip-id=\"d\">\n                    <a class=\"discover-link\" href=\"/#discover\">",{"nodelist":["discover"],"type":"translate"},"</a>\n                    <div class=\"signup-tooltip-outer discover-tooltip-outer\"></div>\n                </li>\n                "],"expression":"!cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n                ",{"blocks":[{"attachment":["\n                ",{"blocks":[{"attachment":["\n                    ",{"template_name":"'corp_hiring_banner'","type":"include"},"\n                "],"expression":"has_corp_header ","type":"ncondition"}],"type":"ef"},"\n\n                ",{"blocks":[{"attachment":["\n                <li class=\"menubar-item cart-wrapper-corp-lo\">\n                    <a href=\"/cart\">\n                        <svg width=\"24px\" height=\"23px\" viewBox=\"3 0 20 28\" class=\"menubar-cart-icon\"><use xlink:href=\"#menubar-cart-icon\"></svg>\n                        <span class=\"cart-count\">",{"filters":[["a",[]]],"name":"cart_quantity","type":"variable"},"</span>\n                    </a>\n                </li>\n                "],"expression":"has_cart && !identities.user ","type":"ncondition"}],"type":"ef"},"\n                "],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n                ",{"blocks":[{"attachment":["\n                <li><a href=\"#\" class=\"all-signup-link\">",{"nodelist":["sign up"],"type":"translate"},"</a></li>\n                "],"expression":"!identities.user ","type":"ncondition"}],"type":"ef"},"\n                \n                ",{"blocks":[{"attachment":["\n                <li class=\"log-out-link\"><a class=\"logout-action\" href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/logout",{"blocks":[{"attachment":["?corp_home=1"],"expression":"is_corp_home ","type":"ncondition"}],"type":"ef"},"\" ",{"blocks":[{"attachment":["data-logout-override=\"corp_home\""],"expression":"is_corp_home ","type":"ncondition"}],"type":"ef"},">",{"nodelist":["log out"],"type":"translate"},"</a></li>\n                "],"expression":"identities.user && user_type ","type":"ncondition"}],"type":"ef"},"\n                <li class=\"log-in-link\"><a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/login",{"blocks":[{"attachment":["?from=home"],"expression":"is_corp_home ","type":"ncondition"}],"type":"ef"},"\">",{"nodelist":["log in"],"type":"translate"},"</a></li>\n                ",{"blocks":[{"attachment":["\n                <li class=\"cartitem\">\n                    <a href=\"/cart\">\n                        <span class=\"cart bc-home\">&nbsp;</span>\n                        <span class=\"cart-item-count\">",{"filters":[],"name":"cart_quantity","type":"variable"},"</span>\n                    </a>\n                </li>\n                "],"expression":"has_cart && !identities.user && !cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n            </ul>\n        </div>\n\n        \n        ",{"blocks":[{"attachment":["  \n        \n        <div class=\"hd-banner pre-translation\">\n            <p class=\"hd-banner-inner\"><a href=\"/jobs\">",{"nodelist":["Were hiring a Senior Fraud/Risk Engineer!"],"type":"translate"},"</a></p>\n        </div>\n        "],"expression":"!is_jobs_page ","type":"ncondition"}],"type":"ef"},"\n\n    </div>\n\n    <div class='corp-banners'>\n        ",{"expression":"identities.fan && !identities.fan.verified && !identities.fan.private ","type":"let","variable":"is_unverified_fan"},"\n        ",{"expression":"fan_onboarding.show_verify_banner && is_unverified_fan && !skip_verification_banner ","type":"let","variable":"show_verify_banner"},"\n        ",{"expression":"fan_onboarding.email ","type":"let","variable":"verify_email"},"\n        ",{"template_name":"'home_2016/fan_verify_banner'","type":"include"},"\n\n        ",{"blocks":[{"attachment":["\n        ",{"template_name":"'rock_the_vote_banner'","type":"include"},"\n        "],"expression":"show_rock_the_vote_banner && !show_verify_banner ","type":"ncondition"}],"type":"ef"},"\n    </div>\n</div>\n",{"blocks":[{"attachment":["\n<div class=\"hd-mobile row ",{"blocks":[{"attachment":["logged-in"],"expression":"identities.user && user_type ","type":"ncondition"}],"type":"ef"},"\">\n\n    \n    ",{"blocks":[{"attachment":["  \n    \n    <div class=\"hd-banner pre-translation\">\n        <p class=\"hd-banner-inner\"><a href=\"/jobs\">",{"nodelist":["Were hiring a Senior Fraud/Risk Engineer!"],"type":"translate"},"</a></p>\n    </div>\n    "],"expression":"!is_jobs_page ","type":"ncondition"}],"type":"ef"},"\n    \n\n    ",{"blocks":[{"attachment":["\n        <h1 class=\"hd-logo\"><span>Bandcamp</span></h1>\n    "],"expression":"is_corp_home ","type":"ncondition"},{"attachment":["\n        <a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"\"><h1 class=\"hd-logo\"><span>Bandcamp</span></h1></a>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n    ",{"blocks":[{"attachment":["\n    <ul class=\"hd-nav user-nav\">\n\n        ",{"blocks":[{"attachment":["\n            ",{"expression":"!cfg.header_rework_2018 && (band_url || partner_url) && collection_url ","type":"let","variable":"hide_gift_card_balance"},"\n            ",{"template_name":"'home/header_gift_balance'","type":"include"},"\n        "],"expression":"gift_card_balance ","type":"ncondition"},{"attachment":["\n            <li><a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/gift_cards\">",{"nodelist":["gift cards"],"type":"translate"},"</a></li>\n        "],"expression":"!cfg.header_rework_2018 && cfg.gift_cards && ((collection_url && !identities.fan.private) || band_url || partner_url) ","type":"ncondition"}],"type":"ef"},"\n\n                \n        \n        ",{"blocks":[{"attachment":["\n        <li><a href=\"",{"filters":[["a",[]]],"name":"collection_url","type":"variable"},"\">",{"nodelist":["collection"],"type":"translate"},"</a></li>\n        "],"expression":"collection_url && !identities.fan.private ","type":"ncondition"}],"type":"ef"},"\n\n        ",{"blocks":[{"attachment":["\n        <li><a href=\"",{"filters":[["a",[]]],"name":"band_url","type":"variable"},"\">your site</a></li>\n        "],"expression":"band_url ","type":"ncondition"},{"attachment":["\n        <li><a href=\"",{"filters":[["a",[]]],"name":"partner_url","type":"variable"},"\">your page</a></li>\n        "],"expression":"partner_url ","type":"ncondition"}],"type":"ef"},"\n\n        ",{"blocks":[{"attachment":["\n        <li>\n            <a class=\"home-cartitem\" href=\"/cart\">\n                <span class=\"cart bc-home\"></span>\n                <span class=\"cart-item-count\">",{"filters":[],"name":"cart_quantity","type":"variable"},"</span>\n            </a>\n        </li>\n        "],"expression":"has_cart ","type":"ncondition"}],"type":"ef"},"\n\n    </ul>\n    "],"expression":"identities.user && user_type ","type":"ncondition"},{"attachment":["\n    <ul class=\"hd-nav corp-nav ",{"blocks":[{"attachment":["has-cart"],"expression":"has_cart ","type":"ncondition"}],"type":"ef"},"\">\n       <li>\n       <ul>\n            \n            ",{"blocks":[{"attachment":["<li><span class=\"corp-nav-label\">for:</span></li>"],"expression":"!has_cart ","type":"ncondition"}],"type":"ef"},"\n            <li><a href=\"/artists?from=hpartists\">",{"nodelist":["artists"],"type":"translate"},"</a></li>\n            <li><a href=\"/fans?from=hpfans\">",{"nodelist":["fans"],"type":"translate"},"</a></li>\n            <li><a href=\"/labels?from=hplabels\">",{"nodelist":["labels"],"type":"translate"},"</a></li>\n        </ul>\n        </li>\n        <li class=\"log-in-link\"><a href=\"",{"filters":[["a",[]]],"name":"siteroot_https","type":"variable"},"/login",{"blocks":[{"attachment":["?from=home"],"expression":"is_corp_home ","type":"ncondition"}],"type":"ef"},"\">",{"nodelist":["log in"],"type":"translate"},"</a></li>\n        ",{"blocks":[{"attachment":["\n        <li>\n            <a class=\"home-cartitem\" href=\"/cart\">\n                <span class=\"cart bc-home\"></span>\n                <span class=\"cart-item-count\">",{"filters":[],"name":"cart_quantity","type":"variable"},"</span>\n            </a>\n        </li>\n        "],"expression":"has_cart ","type":"ncondition"}],"type":"ef"},"\n    </ul>\n    "],"type":"else_ncondition"}],"type":"ef"},"\n    <form class=\"searchwidget\" action=\"/search\" method=\"get\">\n        <input name=\"q\" type=\"text\" placeholder=\"",{"nodelist":["Search for artist, track or album"],"type":"translate"},"\" tabindex=\"1\" autocomplete=\"off\" maxlength=\"2048\">\n        <input type=\"hidden\" name=\"from\" value=\"corphome\">\n        <button type=\"submit\"><span class=\"icon bc-home\"></span>",{"nodelist":["Search"],"type":"translate"},"</button>\n    </form>\n    <div class='corp-banners'>\n        ",{"blocks":[{"attachment":["\n        ",{"template_name":"'rock_the_vote_banner'","type":"include"},"\n        "],"expression":"show_rock_the_vote_banner && !show_verify_banner && is_corp_home ","type":"ncondition"}],"type":"ef"},"\n    </div>\n</div>\n"],"expression":"!cfg.header_rework_2018 ","type":"ncondition"},{"attachment":["\n    ",{"template_name":"'menubar_phone'","type":"include"},"\n"],"expression":"show_header_2015 && !is_phone ","type":"ncondition"}],"type":"ef"},"\n"],
"rock_the_vote_banner":["<div class=\"corpbanner rock-the-vote\">\n    <div class=\"vote-logo-container\">\n        <a href=\"https://bandcamp.com/vote\">\n        <img class=\"vote-logo\" src=\"/img/icon-vote-bandcamp.png\"></img>\n        </a>\n    </div>\n    <div class=\"text\">\n        Today is election day! Do you know where to vote? <a href=\"https://www.rockthevote.org/voting-information/find-your-polling-place\">Find out here</a>.\n    </div>\n\n    <a class=\"dismiss-banner\" id=\"dismiss-rock-the-vote-notification\" href=\"#\">\n        <span class=\"ui-icon dismiss-icon\"></span>\n    </a>\n</div>\n"],
"_autocomplete_search_widget":[{"blocks":[{"attachment":["\n<div id=\"autocomplete-discover\" data-bind=\"css: {'autocompleted': showDiscover}\" class=\"header-rework-2018\">\n    <a class=\"discover-link best-selling\" data-bind=\"click: function () { discoverJumpRedirect('all'); }\">\n        <div>",{"nodelist":["best selling"],"type":"translate"},"</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link rock\" data-bind=\"click: function () { discoverJumpRedirect('rock'); }\">\n        <div>rock</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link hip-hop\" data-bind=\"click: function () { discoverJumpRedirect('hip-hop-rap'); }\">\n        <div>hip-hop/rap</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link alternative\" data-bind=\"click: function () { discoverJumpRedirect('alternative'); }\">\n        <div>alternative</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link electronic\" data-bind=\"click: function () { discoverJumpRedirect('electronic'); }\">\n        <div>electronic</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link metal\" data-bind=\"click: function () { discoverJumpRedirect('metal'); }\">\n        <div>metal</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link experimental\" data-bind=\"click: function () { discoverJumpRedirect('experimental'); }\">\n        <div>experimental</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link pop\" data-bind=\"click: function () { discoverJumpRedirect('pop'); }\">\n        <div>pop</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"discover-link\" data-bind=\"click: function () { discoverJumpRedirect('all'); }\">\n        <div>",{"nodelist":["view more"],"type":"translate"},"</div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n</div>\n"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\n<div id=\"autocomplete-results\" ",{"blocks":[{"attachment":["class=\"fade-in\""],"expression":"!cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"}," data-bind=\"css: {'autocompleted': show}\" class=\"",{"blocks":[{"attachment":["header-rework-2018"],"expression":"cfg.header_rework_2018 ","type":"ncondition"}],"type":"ef"},"\">\n    <a class=\"results-genre\" href=\"\" data-bind=\"visible: genreName, click: discoverGenre\">\n        <div class=\"genre-label\" data-bind=\"visible: genreName\">\n            ",{"nodelist":["Explore ",{"nodelist":["<span data-bind=\"text: genreName\"></span>"],"type":"translateVariable","var_name":"genre"}," music "],"type":"translate"},"\n        </div>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <p class=\"results-label\" data-bind=\"visible: genreName\">",{"nodelist":["Or browse results titled ",{"nodelist":["<span data-bind=\"text: genreName\"></span>"],"type":"translateVariable","var_name":"genre"},":"],"type":"translate"},"</p>\n    <ul id=\"autocomplete-result-item\" class=\"results-list\" data-bind=\"foreach: autocompleteResults\">\n        <li class=\"results-item\" data-bind=\"attr: {id: 'results-item-' + $index()}\">\n            <a data-bind=\"attr:{href: url}\">\n                <div class=\"results-art\" data-bind=\"css: {'blank-img': noImg, 'square': !artType, 'package-thumb': artType}\">\n                <!-- ko if: !noImg -->\n                    <img data-bind=\"attr: {src: img}\"></img>\n                <!-- /ko -->\n                </div>\n                <div class=\"results-info\">\n                    <span class=\"results-title\" data-bind=\"text: name\"></span>\n                    <p class=\"results-name\">\n                    <span data-bind=\"visible: bandName\">",{"nodelist":["by ",{"nodelist":["<span data-bind=\"text: bandName\"></span>"],"type":"translateVariable","var_name":"artist_name"},""],"type":"translate"},"</span><span data-bind=\"visible: !bandName\"><span data-bind=\"text: bandName\"></span></p>\n                    <span class=\"results-type\" data-bind=\"text: typeText\"></span>\n                </div>\n            </a>\n        </li>\n    </ul>\n    <a class=\"see-all\" id=\"see-all\" href=\"\" data-bind=\"visible: hasAutocompleteResults\">\n        ",{"nodelist":["See all results"],"type":"translate"},"\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n    <a class=\"autocomplete-tags\" id=\"autocomplete-tags\" data-bind=\"attr:{href: tagUrl}, visible: tagUrl\">\n        <span class=\"tag-label\">",{"nodelist":["Music tagged with"],"type":"translate"}," </span>\n        <span class=\"tag\" data-bind=\"text: tagName\"></span>\n        <div class=\"shape-container\">\n            <span class=\"arrow\"></span>\n        </div>\n    </a>\n</div>\n"]});
            }
        ;
var Captcha=function(){function load(){if(!deferred){deferred=$.Deferred();window.bcCaptchaOnloadCallback=function(){Log.debug("loaded recaptcha");deferred.resolve()};Log.debug("requesting recaptcha");$.cachedScript("https://www.google.com/recaptcha/api.js?onload\x3dbcCaptchaOnloadCallback\x26render\x3dexplicit")}return deferred.promise()}function _render(elemOrID,options){var instancePromise=instances[elemOrID];if(!instancePromise){var d=$.Deferred();instancePromise=d.promise();instances[elemOrID]=
instancePromise;load().then(function(){Log.debug("rendering recaptcha for element "+elemOrID);var instanceID=grecaptcha.render(elemOrID,options);d.resolve(instanceID)})}return instancePromise}function renderInvisible(){return _render("global-invisible-recaptcha",{"sitekey":$("#pagedata").data("blob").invisible_recaptcha_public_key,"size":"invisible","callback":function(token){if(scrollTopBeforeExecute!==null){$(window).scrollTop(scrollTopBeforeExecute);scrollTopBeforeExecute=null}executeCallback(token)}}).then(function(){$("#global-invisible-recaptcha").fadeIn()})}
function hideInvisible(){$("#global-invisible-recaptcha").fadeOut()}function execute(callback){var instancePromise=instances["global-invisible-recaptcha"];if(!instancePromise)throw"Must call Captcha.renderInvisible() before calling execute()";executeCallback=callback;instancePromise.then(function(instanceID){scrollTopBeforeExecute=$(window).scrollTop();Log.debug("executing invisible recaptcha (scrollTopBeforeExecute \x3d "+scrollTopBeforeExecute+")");grecaptcha.reset(instanceID);grecaptcha.execute(instanceID)})}
var deferred=null;var instances={};var executeCallback;var scrollTopBeforeExecute=null;return{renderInvisible:renderInvisible,execute:execute,hideInvisible:hideInvisible}}();
var Money=function(money){function validateInput(money){var amount;var currency;if(!money)throw"missing money input";amount=money.amount;currency=money.currency;if(typeof amount!=="number"||amount%1!==0)throw"invalid amount";if(typeof currency!=="string"||currency.length!==3)throw"invalid currency";}validateInput(money);return{amount:money.amount,currency:money.currency,is_money:true,add:function(otherMoney){if(!otherMoney.is_money)throw"type mismatch";if(otherMoney.currency!==this.currency)throw"currency mismatch";
return new Money({amount:this.amount+otherMoney.amount,currency:this.currency})},subtract:function(otherMoney){if(!otherMoney.is_money)throw"type mismatch";if(otherMoney.currency!==this.currency)throw"currency mismatch";return new Money({amount:this.amount-otherMoney.amount,currency:this.currency})},format:function(format){if(format===undefined)format=6;return TextFormat.money(this,format)}}};
(function(window,$,ko){var NEXT_STEP_TIMEOUT=500;var TEMPLATES={"f":"fan/tooltips/feed_tooltip","s":"fan/tooltips/search_tooltip","d":"fan/tooltips/discover_tooltip","b":"fan/tooltips/follow_tooltip","w":"fan/tooltips/wishlist_tooltip","x":"fan/tooltips/wishlist_button_tooltip","o":"fan/tooltips/fan_follow_tooltip","c":"fan/tooltips/collection_tooltip"};var FanOnboarding=function(init,root){var self=this;var $root=$(root);init=init||{};self.tooltips=init.tooltips;self.numTooltips=init.num_tooltips;
self.tooltipNumber=init.tooltip_number;self.currentIndex=init.current_index;self.complete=init.complete;self.$root=$root;self.showFirstWishlistTooltip=init.show_first_wishlist_tooltip;self.firstWishlistedItemTitle=init.first_wishlisted_item_title;self.firstWishlistedItemType=init.first_wishlisted_item_type;self.firstPurchasedItemTitle=init.first_purchased_item_title;self.firstPurchasedItemType=init.first_purchased_item_type;if(window.FanData)self.fanName=window.FanData.name;if(window.BandData)self.bandName=
window.BandData.name;self.hasSeenTooltips=init.has_seen_tooltips||false;self.hasCollection=init.has_collection;self.bindRockTheVoteBanner();self.rebind()};FanOnboarding.prototype.setFirstWishlistedItem=function(title,type){this.firstWishlistedItemTitle=title;this.firstWishlistedItemType=type};FanOnboarding.prototype.setTooltips=function(tooltips){var self=this;self.tooltips=tooltips;self.numTooltips=tooltips.length;self.tooltipNumber=1;self.currentIndex=0;self.complete=false};FanOnboarding.prototype.dismissTooltip=
function(el,fromAltLink){var self=this;if(!self.tooltips)return;var $parent=$(el).closest(".signup-tooltip-parent");$parent.addClass("hide-tooltip");setTimeout(function(){$parent.removeClass("show-tooltip")},500);var currentTooltip=self.tooltips[self.currentIndex];var tooltips=[currentTooltip];if(currentTooltip==="f")tooltips.push("b");if(currentTooltip==="b")tooltips.push("z");SignupAPI.dismissTooltips(tooltips);if(fromAltLink)setTimeout(function(){var href=$(el).attr("href");if(href)window.location.href=
$(el).attr("href")},500);else self.advance();$(window).off("resize.adjustCss");return false};FanOnboarding.prototype.dismissCollectionBanner=function(el){Crumb.ajax({url:"/api/fansignup/1/dismiss_collection_banner",data:{},dataAs:"JSON",type:"POST",success:function(response){if(response.error)Log.error("error dismissing banner")},error:function(jqXHR,errorType,exception){Log.error("ajax error: ",errorType,exception)}})};FanOnboarding.prototype.dismissFeedBanner=function(el){Crumb.ajax({url:"/api/fansignup/1/dismiss_feed_banner",
data:{},dataAs:"JSON",type:"POST",success:function(response){if(response.error)Log.error("error dismissing banner")},error:function(jqXHR,errorType,exception){Log.error("ajax error: ",errorType,exception)}})};FanOnboarding.prototype.advance=function(){var self=this;self.currentIndex=self.currentIndex+1;if(self.tooltips[self.currentIndex]){self.tooltipNumber=self.tooltipNumber+1;self.renderCurrentTooltip(true)}else $("body").removeClass("prevent-header-hiding")};FanOnboarding.prototype.rebind=function(){var self=
this;$(".signup-tooltip a.dismiss-tooltip",self.$root).off("click.dismiss");$(".signup-tooltip a.dismiss-tooltip",self.$root).on("click.dismiss",function(){return self.dismissTooltip(this)});$(".signup-tooltip-parent a.dismiss-tooltip",self.$root).off("click.dismiss");$(".signup-tooltip-parent a.dismiss-tooltip",self.$root).on("click.dismiss",function(){return self.dismissTooltip(this)});$(".signup-tooltip-parent .dismiss-tooltip-alt",self.$root).off("click.dismiss");$(".signup-tooltip-parent .dismiss-tooltip-alt",
self.$root).on("click.dismiss",function(){return self.dismissTooltip(this,true)})};FanOnboarding.prototype.dataForRender=function(){var self=this;return{"tooltips":self.tooltips,"num_tooltips":self.numTooltips,"tooltip_number":self.tooltipNumber,"current_index":self.currentIndex,"band_name":self.bandName,"fan_name":self.fanName,"feed_url":Identities.fan()?siteroot_https+"/"+Identities.fan().username+"/feed":null,"wishlist_url":Identities.fan()?siteroot_https+"/"+Identities.fan().username+"/wishlist":
null,"first_wishlisted_item_title":self.firstWishlistedItemTitle,"first_wishlisted_item_type":self.firstWishlistedItemType,"first_purchased_item_title":self.firstPurchasedItemTitle,"first_purchased_item_type":self.firstPurchasedItemType,"origin_page":window.FanSignup?FanSignup.originPage:null}};FanOnboarding.prototype.renderCurrentTooltip=function(showTimeout,parentElementOverride){var self=this;var tooltip=self.tooltips[self.currentIndex];var $parent=parentElementOverride?$(parentElementOverride):
$(".signup-tooltip-parent[data-tooltip-id\x3d'"+tooltip+"']");if(!$parent)return;if($parent.hasClass("show-tooltip"))return;var timeout=showTimeout?NEXT_STEP_TIMEOUT:0;var template=TEMPLATES[tooltip];if(template){$(".signup-tooltip-outer",$parent).empty();$(".signup-tooltip-outer",$parent).append(Templ.render(template,{"fan_onboarding":self.dataForRender(),"cfg":$("#pagedata").data("blob").cfg}))}else return;if(tooltip==="x"&&$parent.hasClass("collection-item-actions")){var $tooltipBody=$(".signup-tooltip-body",
$parent);var $tooltipDismiss=$(".dismiss-tooltip",$parent);var tooltipBodyWidth=$tooltipBody.width();var tooltipDismissWidth=$tooltipDismiss.width();var doAdjust=function(){var tooltipOffset=$(".signup-tooltip-outer",$parent).offset().left;if(tooltipOffset<-((400-tooltipBodyWidth)/2)+12)$tooltipBody.css({"text-align":"left","margin-left":-tooltipOffset-(400-tooltipBodyWidth)/2+12});else $tooltipBody.css({"text-align":"center","margin-left":0});if(tooltipOffset<-((400-tooltipDismissWidth)/2)+12)$tooltipDismiss.css({"text-align":"left",
"margin-left":-tooltipOffset-(400-tooltipDismissWidth)/2+12});else $tooltipDismiss.css({"text-align":"center","margin-left":0})};doAdjust();$(window).on("resize.adjustCss",function(){doAdjust()});window.doAdjust=doAdjust}self.rebind();setTimeout(function(){$parent.addClass("show-tooltip")},timeout);SignupAPI.markTooltipsViewed([tooltip])};FanOnboarding.prototype.initForView=function(elementOverride){var self=this;if(!self.tooltips||self.tooltips.length===0)return;if(!self.currentIndex)self.currentIndex=
0;self.renderCurrentTooltip(null,elementOverride);self.bindVerifyBanner()};FanOnboarding.prototype.showTooltip=function(tooltip,elementOverride){this.setTooltips([tooltip]);this.initForView(elementOverride)};FanOnboarding.prototype.skipWalkthrough=function(){var self=this;SignupAPI.dismissTooltips(self.tooltips)};FanOnboarding.prototype.showVerifyBanner=function(){$(".corpbanner.verify-email").show()};FanOnboarding.prototype.bindVerifyBanner=function(){$(".corpbanner.verify-email a").off("click.verify");
$(".corpbanner.verify-email .resend-verification-email").on("click.verify",function(){var email=$(".corpbanner.verify-email").data("email");window.verifyNag=window.verifyNag||new VerifyNag({"fan_email":email,"skipToEmail":true},function(changedEmail,resentEmail){if(changedEmail||resentEmail)$(".corpbanner.verify-email").addClass("hide")});window.verifyNag.openDialog();return false});$(".corpbanner.verify-email .dismiss-banner").on("click.verify",function(){SignupAPI.dismissVerificationBanner({});
$(".corpbanner.verify-email").addClass("hide");return false})};FanOnboarding.prototype.bindRockTheVoteBanner=function(){$(".corpbanner.rock-the-vote .dismiss-banner").on("click",function(){$(".corpbanner.rock-the-vote").addClass("hide");$(".bd.has-rock-the-vote-banner").removeClass("has-rock-the-vote-banner");$(".has-menubar.has-rock-the-vote-banner").removeClass("has-rock-the-vote-banner");SignupAPI.dismissRockTheVoteBanner({});return false})};var pagedata=$("#pagedata").data("blob");var data=pagedata.fan_onboarding||
{};var signupParams=pagedata.signup_params;$(document).ready(function(){var headerWrapper=$("#header-wrapper");var menubar=$("#menubar");if(headerWrapper||menubar){var onboarding=new FanOnboarding(data,$("body")[0]);window.FanOnboarding=onboarding;$("#dismiss-collection-banner").click(function(){$(".onboarding-collection-banner").addClass("hide");onboarding.dismissCollectionBanner();return false});$("#dismiss-feed-banner").click(function(){$(".onboarding-collection-banner").addClass("hide");onboarding.dismissFeedBanner();
return false});if(onboarding.tooltips&&onboarding.tooltips.length>0){var fanSignupPane=Url.getQueryParam(window.location.href,"fan_action_pane");if(!fanSignupPane||fanSignupPane!=="welcome_2")onboarding.initForView()}onboarding.bindVerifyBanner();var channel=new Cookie.CommChannel("fan_verification");if(signupParams&&signupParams.set_fan_verified)channel.send("verified",1);else if(!Identities.fan()||!Identities.fan().verified){channel.subscribe(function(event,args){if(args[1]=="verified"&&args[2]&&
Identities.fan()){Identities.fan().verified=1;$(".corpbanner.verify-email").addClass("hide")}});channel.startListening()}}})})(window,$,ko);
(function(window,$,ko){var formId="#signup-vm";var MAX_XHR_RETRIES=3;var signupErrorMsgs=null;var SignupAPI={createFanAccount:function(data){var d=$.Deferred();if(Identities.user())data.user_id=Identities.user().id;data.email=$.trim(data.email);data.name=$.trim(data.name);data.password=$.trim(data.password);Crumb.ajax({url:"/api/fansignup/1/signup",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else{Log.debug("failure response",response);return d.reject(response)}},
error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},login:function(data){var d=$.Deferred();data.email=$.trim(data.email);data.password=$.trim(data.password);Crumb.ajax({url:"/api/fansignup/1/login",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},logout:function(){var d=$.Deferred();Crumb.ajax({url:"/api/fansignup/1/logout",
data:{},dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},checkEmail:function(email){function doCheck(){$.post("/api/fansignup/1/check_email",JSON.stringify({"email":$.trim(email)})).then(function(data){return d.resolve(data)},function(){if(attempts==MAX_XHR_RETRIES){Log.debug("Network error");return d.reject()}else{attempts=attempts+1;setTimeout(function(){doCheck()},
500)}})}var d=$.Deferred();var attempts=0;doCheck();return d.promise()},sendForgotPasswordEmail:function(data){var d=$.Deferred();data.email=$.trim(data.email);Crumb.ajax({url:"/api/fansignup/1/forgot_password",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},resetPassword:function(data){var d=$.Deferred();data.token=$.trim(data.token);
data.password=$.trim(data.password);Crumb.ajax({url:"/api/fansignup/1/reset_password",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},sendAppLinkEmail:function(data){var d=$.Deferred();data.email=$.trim(data.email);data.fan_username=$.trim(data.fan_username);Crumb.ajax({url:"/api/fansignup/1/send_app_link_email",data:data,dataAs:"JSON",
type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},resendFanVerifyEmail:function(data){var d=$.Deferred();if(data.email)data.email=$.trim(data.email);Crumb.ajax({url:"/api/fansignup/1/resend_fan_verify_email",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,
errorType,exception){return d.reject()}});return d.promise()},dismissTooltips:function(tooltips){var d=$.Deferred();Crumb.ajax({url:"/api/fansignup/1/dismiss_tooltips",data:{tooltips:tooltips},dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},setWelcomePaneSeen:function(){var d=$.Deferred();Crumb.ajax({url:"/api/fansignup/1/set_welcome_pane_seen",
data:{},dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},markTooltipsViewed:function(tooltips){var d=$.Deferred();Crumb.ajax({url:"/api/fansignup/1/mark_tooltips_viewed",data:{tooltips:tooltips},dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,
errorType,exception){return d.reject()}});return d.promise()},dismissRockTheVoteBanner:function(data){var d=$.Deferred();Crumb.ajax({url:"/corpbanner/dismiss_rock_the_vote_banner_cb",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},dismissVerificationBanner:function(data){var d=$.Deferred();Crumb.ajax({url:"/api/corpbanner/1/dismiss_verification_banner",
data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},followGenres:function(selectedGenres){var d=$.Deferred();var data={"selected_genres":selectedGenres};Crumb.ajax({url:"/api/fansignup/1/follow_genres",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},
error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},subscribeToNewsletters:function(selectedNewsletters,bestOf){var d=$.Deferred();var data={"genre_ids":selectedNewsletters,"best_of":bestOf};Crumb.ajax({url:"/api/fansignup/1/subscribe_to_newsletters",data:data,dataAs:"JSON",type:"POST",success:function(response){if(response.ok)return d.resolve(response);else return d.reject(response)},error:function(jqXHR,errorType,exception){return d.reject()}});return d.promise()},
customGenreSearch:function(term,count){var d=$.Deferred();$.post("/api/fansignup/1/search_tag",JSON.stringify({"search_term":term,"count":count||10})).then(function(resp){if(resp.ok)return d.resolve(resp);else return d.reject(resp)},function(){return d.reject()});return d.promise()}};var SignupUtils={scrollToFirstError:function(){var $form=$(formId);if($form[0]){var $el=$form.find(".error:first");Dom.scrollToElement($el,-50,true);if(MediaView.mode!="phone")try{$el.focus().select()}catch(e){}}},scrollToTheTop:function(time){$("html, body").animate({scrollTop:0},
time||200)},asyncLogin:function(identities){Identities.initialData=identities;Identities.updateFromHash(identities);Identities.user(identities.user);Identities.fan(identities.fan);Identities.partner(identities.partner);Identities.isAdmin(identities.isAdmin);Identities.subscribedToPageBand(identities.subscribed_to_page_band);if(identities.fan&&identities.fan.url)$("#collect-item a.view, .collect-item a.view, .wishlisted-msg .view a").attr("href",identities.fan.url+"#wishlist")},renderMenubar:function(identities,
userData,actionParams){var data=userData||{};var pagedata=$("#pagedata").data("blob")||{};var cfg=pagedata.cfg||{};var userTesting=pagedata.user_testing||{};var mbWrapper=$("#menubar-wrapper");if(mbWrapper.length===0){$("body").prepend($('\x3cdiv id\x3d"menubar-wrapper"\x3e\x3c/div\x3e'));mbWrapper=$("#menubar-wrapper");if(cfg.header_rework_2018)mbWrapper.addClass("header-rework-2018")}data.fan_url=identities.fan&&identities.fan.url;data.is_fan_page=true;if(actionParams&&actionParams.action==="wishlist")data.has_wishlist=
true;Templ.renderElem(mbWrapper[0],"menubar",{page_identities:identities,menubar:data,cfg:cfg,user_testing:userTesting});if(cfg.header_rework_2018){if($("#header-wrapper").length>0)$("#header-wrapper").hide();$("#menubar-wrapper").addClass("header-rework-2018");$(".bd").removeClass("corp-header-padding");$(".bd").removeClass("corp-header-padding-2018")}Menubar.initialize();if(window.Logout)window.Logout.initialize()},renderHeader:function(identities,userData,actionParams){if($("#header-wrapper").length===
0)return;var data=userData||{};var pagedata=$("#pagedata").data("blob")||{};var cfg=pagedata.cfg||{};var userTesting=pagedata.user_testing||{};data.is_corp_home=pagedata.is_corp_home;data.has_cart=pagedata.has_cart;data.cart_quantity=pagedata.cart_quantity;data.identities=identities;data.cfg=cfg;data.user_testing=userTesting;data.is_client_render=true;if(data.gift_card_balance){if(data.currency_data&&!window.CurrencyData)window.CurrencyData=data.currency_data;data.gift_card_balance=new Money(data.gift_card_balance)}if(window.FanOnboarding&&
window.FanOnboarding.tooltips)data.fan_onboarding=window.FanOnboarding.dataForRender();else data.skip_verification_banner=true;if(actionParams&&actionParams.action==="wishlist")data.has_wishlist=true;data.show_rock_the_vote_banner=pagedata.show_rock_the_vote_banner;Templ.renderElem($("#header-wrapper")[0],"home/header_2015",data);if(data.show_rock_the_vote_banner)FanOnboarding.bindRockTheVoteBanner();if(window.initializeAutocomplete){window.AutocompleteVM=window.initializeAutocomplete();var $container=
$("#homepage-autocomplete-results");var vm=AutocompleteVM;if($container[0])ko.applyBindings(vm,$container[0])}if(window.Logout)window.Logout.initialize();$(".all-signup-link").click(function(){FanSignup.openPane("choose_account",true);return false})},cleanURL:function(){if(history)history.replaceState({},"",window.location.pathname)},signupError:function(err){if(!signupErrorMsgs)signupErrorMsgs={"logged_in_fan":TM("You\u2019re already logged in as a fan."),"wrong_email":TM("Your email address does not match what we have on file.")};
return signupErrorMsgs[err]}};window.SignupAPI=SignupAPI;window.SignupUtils=SignupUtils})(window,$,ko);
(function(window,$,ko){var pagedata=$("#pagedata").data("blob");var cfg=pagedata.cfg||{};var skipRedeem=Url.getQueryParam(window.location.href,"skip_redeem");var SignupPane=function(signup,init){function continueSubmitAfterCaptcha(captchaToken){var data={mode:MediaView.mode,username:self.username(),tsig:self.tsig,verified:self.verified};if(self.signupToken&&self.signupToken.length>0)data.signup_token=self.signupToken;if(self.saveCard())data.save_card=self.saveCard();if(self.enableCaptcha())data.captcha_token=
captchaToken;if(!self.loggedIn())data.email=self.email();if(self.signupToken)data.signup_token=self.signupToken;if(!self.loggedIn())data.password=self.password();if(self.selectedUser())data.user_id=self.selectedUser().user_id;if(signup.actionParams){data.action=signup.actionParams.action;data.action_item_id=signup.actionParams.actionItemId;data.action_band_id=signup.actionParams.actionBandId;data.action_item_type=signup.actionParams.actionItemType;data.action_url=signup.actionParams.actionURL;data.action_sig=
signup.actionParams.actionSig}if(signup.actionParams.action==="follow"){data.notify_me_band=self.notifyMeBand();data.notify_me_label=self.notifyMeLabel();data.action_label_id=self.labelId}if(signup.activationParams&&(signup.originPage==="home"||signup.originPage==="band")){data.activation_url=signup.activationParams.url;data.activation_sig=signup.activationParams.sig}if(self.email()===signup.initialEmail&&signup.initialEmailSignature)data.email_sig=signup.initialEmailSignature;data.is_corp_signup=
signup.originPage==="fans"||signup.originPage==="home"||signup.originPage==="corp";if(skipRedeem)data.skip_redeem=true;var signupFrom=signup.getSignupFrom();data.signup_from=signupFrom;if(signupFrom==="redeem"){data.resume_id=signup.actionParams.resumeId;data.resume_buy_id=signup.actionParams.resumeBuyId;data.resume_action=signup.actionParams.resumeAction}self.saving(true);SignupAPI.createFanAccount(data).then(function(response){if(response.crumbs)Crumb.put(response.crumbs);if(response.user_data)self.userDataForMenubar=
response.user_data;var action=signup.actionParams&&signup.actionParams.action;var stat=null;var isBandMember=response.identities.bands&&response.identities.bands.length>0;if(action)if(action==="wishlist")stat=isBandMember?"logged_out_wishlist_band_signup_completes":"logged_out_wishlist_new_signup_completes";else if(action==="follow"&&signup.actionParams.actionItemType==="f")stat=isBandMember?"logged_out_fan_follow_band_signup_completes":"logged_out_fan_follow_new_signup_completes";else{if(action===
"follow"&&(!signup.actionParams.actionItemType||signup.actionParams.actionItemType==="b"))stat=isBandMember?"logged_out_follow_band_signup_completes":"logged_out_follow_new_signup_completes"}else if(signupFrom==="corp")stat="corp_header_single_signup_fan_completes";else if(signupFrom==="menubar")stat="menubar_single_signup_fan_completes";if(stat)Stats.record({"kind":"click","click":stat});self.asyncIdentities=response.identities;self.nextURL=response.next_url;self.verificationNeeded=response.verification_needed;
self.tooltips=response.tooltips;if(response.tooltips&&window.FanOnboarding)window.FanOnboarding.setTooltips(response.tooltips);if(response.first_wishlisted_item_title)signup.actionParams.title=response.first_wishlisted_item_title;if(response.first_purchased_item_title)FanOnboarding.firstPurchasedItemTitle=response.first_purchased_item_title;if(response.first_purchased_item_type)FanOnboarding.firstPurchasedItemType=response.first_purchased_item_type;if(response.action_genre_id)signup.actionParams.genreId=
response.action_genre_id;SignupUtils.asyncLogin(response.identities);signup.updateState(self.exportState());if(signup.originPage==="redeem"){Redeem.rawCardData(response.gift_card_data);Redeem.rawUserBalance(response.user_balance);Redeem.showNewFan(true)}if(signup.portable&&MediaView.mode==="desktop")self.openGenrePicker();else if(!self.verificationNeeded)if(!signup.portable&&signup.actionParams.action)signup.onComplete();else self.openWelcome();else self.openAlmostThere()},function(response){if(response&&
response.error==="captcha_missing"){self.enableCaptcha(true);Captcha.renderInvisible()}if(response&&response.errors)Iter.each(response.errors,function(error){if(error.field&&error.field==="email"&&error.error==="existing_fan"&&self.loggedIn())self.username.error_key("existingFanLoggedIn");else if(error.field&&error.field==="email"&&error.error==="fan_already_linked_email"&&self.loggedIn())self.username.error_key("fanAlreadyLinkedEmail");else if(error.field){self[error.field].error_key(error.error);
if(error.field==="username"&&error.error==="duplicate"&&error.error_data){var suggestedUsername=error.error_data.suggested_username;if(suggestedUsername&&suggestedUsername.length>0)self.suggestedUsername(suggestedUsername)}}SignupUtils.scrollToFirstError()});else if(response&&response.error==="many_matched_users"&&response.error_data&&response.error_data.users&&response.error_data.users.length>0){self.chooserVisible(true);self.inlineLoginVisible(false);self.possibleUsers(response.error_data.users)}else if(response){var reason=
response.error&&SignupUtils.signupError(response.error)||TM("There was a problem signing up. Please try again.");NuDialog.alert(TM("Signup Error"),reason)}self.saving(false)})}var self=this;var USERNAME_REGEX=/^[a-zA-Z0-9_-]+$/;var UNDIES_REGEX=/^(_)\1*$/;var state=signup.state;Stats.record({"kind":"click","click":"fan_signup_start"});var isValidEmail=function(e){var emailRegex=/(^)([^\s\(\)"'\/><,@]+@\w([^\s\(\)"'\/><&,@]*\w)?\.\w[^\s\(\)"'\/><&,@]*\w)($)/;return emailRegex.test(e)};var title=signup.originPage===
"redeem"?TM("Sign up and redeem",null,"sign up for fan account and redeem gift card"):TM("Sign up for a Bandcamp fan account");self.title=Identities.user()?"":title;self.pageTitle=TM("Sign up");self.template="fan/signup/fan_signup_pane";self.resetOnClose=true;self.signupToken=signup.signupToken;self.tsig=signup.tsig;self.verified=signup.verified;self.width=500;self.position={my:"center center",at:"center center-60",of:window};self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);
self.afterRender=function(){$(".signup-heading").hide();$("#signup-title").show();self.visible(true);if(MediaView.mode==="desktop")if(self.loggedIn())$("#username-input").focus();else $("#email-input").focus()};self.close=function(updateState){var d=$.Deferred();if(updateState)signup.updateState(self.exportState());self.immediate(false);self.visible(false);Captcha.hideInvisible();d.resolve();return d.promise()};this.saving=ko.observable(false);this.inlineLoginVisible=ko.observable(false);self.loggedIn=
ko.observable(!!Identities.user());self.usernameIsURL=ko.computed(function(){return self.loggedIn()||self.inlineLoginVisible()});self.showExistingArtist=ko.computed(function(){return self.loggedIn()&&!signup.portable&&(!signup.actionParams||!signup.actionParams.action)});self.notifyMeBand=ko.observable(false);self.notifyMeLabel=ko.observable(false);if(signup.actionParams.action==="follow"&&signup.actionParams.itemType=="b"){var mailingListInfo=pagedata.signup_params.mailing_list_info;var the_button=
$("#follow-unfollow-band_"+signup.actionParams.actionBandId)[0];self.showNotifyMe=true;self.artist=the_button?the_button.dataset.bandName:BandData&&BandData.name;if(mailingListInfo){self.label=mailingListInfo.label_name;self.labelId=mailingListInfo.label_id}}self.username=ko.observable(state.fan_username);self.email=ko.observable(state.email);self.password=ko.observable(state.password);self.passwordMasked=ko.observable(false);self.saveCard=ko.observable(pagedata.signup_params.save_card);self.tos=
ko.observable(false);self.networkError=ko.observable(false);self.email.checking=ko.observable(false);self.email.checked=ko.observable(false);self.email.extend({errorKeys:{}});self.email.subscribe(function(){self.email.error_key(null);self.email.checked(false);self.inlineLoginVisible(false);if(isValidEmail($.trim(self.email()))&&!self.networkError())self.email.checking(true);if(isValidEmail(self.email()))self.email.checkEmail();else self.email.checking(false)});self.email.deferred=null;self.email.check=
null;self.email.checkEmail=function(){if(!self.networkError()){self.email.checking(true);self.email.check=null;var check=SignupAPI.checkEmail(self.email());self.email.check=check;check.then(function(resp,deferred){if(self.email.check!==check)return;self.email.checking(false);if(!resp||!resp.ok)Log.error(resp&&resp.error);else{var affiliation=resp.affiliation;if(affiliation==="fan")self.email.error_key("existing_fan");else if(affiliation==="fan_already_linked_email")self.email.error_key("fan_already_linked_email");
else if(affiliation==="band_member")self.inlineLoginVisible(true);self.email.checked(true)}},function(){if(self.email.check!==check)return;self.email.checking(false);self.networkError(true)})}};self.email.validate=function(){var email=self.email();if(self.loggedIn()){self.email.error_key(null);return}self.email.error_key(!isValidEmail(email)?"invalid":null)};if(state.email&&!self.loggedIn())setTimeout(function(){if(isValidEmail($.trim(self.email()))&&!self.networkError())self.email.checking(true);
if(isValidEmail(self.email()))self.email.checkEmail();else self.email.checking(false)},300);self.password.extend({errorKeys:{missing:TM("Please enter your password."),tooShort:TM("Your password must be at least 3 characters."),incorrect:TM("That password isn\u2019t correct. Please try again.")}});self.password.validate=function(){if(self.loggedIn())return self.password.error_key(null);self.password.error_key(!self.password()?"missing":self.password().length<3?"tooShort":null)};self.username.display=
ko.pureComputed({read:function(){return self.username()},write:function(val){if(val&&val.length>0)self.username(val.toLowerCase())}});self.username.extend({errorKeys:{}});self.username.validate=function(){var username=$.trim(self.username());self.username.error_key(!username?"missing":username.length<3?"tooShort":username.length>60?"tooLong":isValidEmail(username)?"isEmail":!USERNAME_REGEX.test(username)?"invalid":UNDIES_REGEX.test(username)?"undies":null)};self.username.label=ko.computed(function(){if(self.loggedIn()||
self.inlineLoginVisible())return TM("Choose your fan URL");else return TM("Username")});self.username.placeholder=ko.computed(function(){if(self.loggedIn()||self.inlineLoginVisible())return TM("choose your fan URL");else return TM("username")});self.username.subscribe(function(){self.username.error_key(null)});self.suggestedUsername=ko.observable();self.useSuggestedUsername=function(){self.username(self.suggestedUsername());self.suggestedUsername(null);self.username.error_key(null)};this.tos.extend({errorKeys:{missingValue:TM("Ahem... please agree to the terms.",
null,"don't need to translate the ahem")}});this.tos.validate=function(){self.tos.error_key(self.tos()?null:"missingValue")};this.chooserVisible=ko.observable(false);this.possibleUsers=ko.observableArray();this.formatUser=function(user){var list=[];if(user.fan_username)list.push(user.fan_username);if(user.bands&&user.bands.length>0)list=list.concat(Iter.collect(user.bands,function(b){return b.band_name}));return Templ.render("login/user_picker_text",{"username":user.username,"list":list})};this.selectedUser=
ko.observable();this.bottomLinkVisible=ko.computed(function(){return!self.loggedIn()&&!self.chooserVisible()});this.artistSignupVisible=ko.computed(function(){return!signup.portable&&!self.loggedIn()&&!self.chooserVisible()});this.enableCaptcha=ko.observable(cfg.fan_signup_use_captcha);if(this.enableCaptcha())Captcha.renderInvisible();this.has_errors=ko.computed(function(){var fields=["email","password","username","tos"];return Iter.find(fields,function(field){return self[field].error_key()})});this.clear_errors=
function(){Iter.each(["password","username","tos","email"],function(field){self[field].error_key(null)})};this.submitEnabled=ko.computed(function(){return!self.saving()&&!self.has_errors()});this.submitText=ko.computed(function(){if(self.saving())return TM("Please wait...",null,"waiting to complete signup");else if(self.chooserVisible())return TM("Go",null,"complete signup");else if(self.loggedIn())return TM("Complete setup");else if(self.username()==="jeanlucpicard")return"Make it so";else return TM("Sign up")});
this.validate=function(){var fields=["password","username","tos","email"];Iter.each(fields,function(field){self[field].validate()});return!self.has_errors()};this.submit=function(){if(!self.submitEnabled())return;if(!self.validate()){SignupUtils.scrollToFirstError();return}Stats.record({"kind":"click","click":"fan_signup_signup_continue"});self.saving(true);if(self.enableCaptcha()){var captchaTimeout=setTimeout(function(){self.saving(false)},1E4);Captcha.execute(function(token){clearTimeout(captchaTimeout);
continueSubmitAfterCaptcha(token)})}else continueSubmitAfterCaptcha(null)};this.openLogin=function(updateState){Stats.record({kind:"click",click:"fan_signup_signup_login"});self.close(updateState).then(function(){signup.openPane("login")})};this.openForgotPassword=function(){self.close(true).then(function(){signup.openPane("forgot_password")})};this.openAlmostThere=function(){self.close(true).then(function(){signup.openPane("almost_there");if(signup._dialog)signup._dialog.parent().addClass("no-close")})};
this.openWelcome=function(){self.close(true).then(function(){signup.openPane("welcome")})};this.openGenrePicker=function(){self.close(true).then(function(){signup.openPane("genre_picker")})};self.exportState=function(){return{"fanUsername":self.username(),"saveCard":self.saveCard(),"email":self.email(),"asyncIdentities":self.asyncIdentities,"nextURL":self.nextURL,"userDataForMenubar":self.userDataForMenubar,"verificationNeeded":self.verificationNeeded}};self.hash=function(){return{"download_item":pagedata.download_item,
"signup_params":pagedata.signup_params,"show_notify_me":self.showNotifyMe,"artist":self.artist,"label":self.label,"rendered":true,"cfg":cfg}}};window.SignupPane=SignupPane})(window,$,ko);
(function(window,$,ko){var LoginPane=function(signup,init){function continueSubmitAfterCaptcha(captchaToken){var loginData={username:self.email(),password:self.password()};if(self.twofactorVisible()){loginData.twofactor=self.twofactor();loginData.twofactor_remember=self.twofactorRemember()}if(captchaToken)loginData.captcha_token=captchaToken;if(signup.actionParams){loginData.action=signup.actionParams.action;loginData.action_item_id=signup.actionParams.actionItemId;loginData.action_band_id=signup.actionParams.actionBandId;
loginData.action_item_type=signup.actionParams.actionItemType;loginData.action_url=signup.actionParams.actionURL;loginData.action_sig=signup.actionParams.actionSig;loginData.resume_id=signup.actionParams.resumeId;loginData.resume_buy_id=signup.actionParams.resumeBuyId;loginData.resume_action=signup.actionParams.resumeAction}if(self.selectedUser())loginData.user_id=self.selectedUser().id;self.submitting(true);SignupAPI.login(loginData).then(function(response){if(response.crumbs)Crumb.put(response.crumbs);
var action=signup.actionParams&&signup.actionParams.action;if(action){var stat=null;var isBandMember=response.identities.bands&&response.identities.bands.length>0&&!response.identities.fan;if(action==="wishlist")stat=isBandMember?"logged_out_wishlist_login_as_band_no_fan":"logged_out_wishlist_login_as_fan";else if(action==="follow"&&signup.actionParams.actionItemType==="f")stat=isBandMember?"logged_out_fan_follow_login_as_band_no_fan":"logged_out_fan_follow_login_as_fan";else if(action==="follow"&&
(!signup.actionParams.actionItemType||signup.actionParams.actionItemType==="b"))stat=isBandMember?"logged_out_follow_login_as_band_no_fan":"logged_out_follow_login_as_fan";Stats.record({"kind":"click","click":stat})}if(response.user_data)self.userDataForMenubar=response.user_data;if(signup.originPage==="redeem"){Redeem.rawCardData(response.gift_card_data);Redeem.rawUserBalance(response.user_balance)}SignupUtils.asyncLogin(response.identities);if(response.identities.fan&&!response.identities.fan.private){self.asyncIdentities=
response.identities;self.nextURL=response.next_url;signup.updateState(self.exportState());if(state.nextPane)signup.openPane(state.nextPane);else signup.onComplete()}else if(!signup.actionParams||!signup.actionParams.action)window.location.href=response.next_url||siteroot_https;else{signup.updateState({"userName":response.username,"bands":response.bands||[]});var showDupeFan=false;if(response.affiliations){signup.affiliations=response.affiliations;if(response.affiliations.fan||response.affiliations.fan_already_linked_email)showDupeFan=
true}if(showDupeFan)self.showDupeFan();else self.showExistingArtist()}},function(response){if(response&&response.error==="captcha_missing"){self.enableCaptcha(true);Captcha.renderInvisible()}if(response&&response.errors){Iter.each(response.errors,function(error){Log.debug("error.field: "+error.field+"; error.reason: "+error.reason);if(error.field=="login.twofactor"&&error.reason=="missingValue"){if(self.twofactorVisible())self.twofactor.error_key("missingValue");else self.twofactorVisible(true);$("#two-factor-code-input").focus()}else if(error.field==
"login.user"&&error.reason=="matchedManyUsers"){self.userChooserVisible(true);self.possibleUsers(response.error_data.matched_users)}else if(error.field=="login.user"&&error.reason=="emailVerificationRequired"){NuDialog.alert(TM("Email confirmation required"),TM("To log in, please click the link in the email that we just sent to the address associated with your account."));signup.onComplete()}else{var observable={"user.name":self.email,"login.password":self.password,"login.twofactor":self.twofactor}[error.field];
if(!observable){Log.error("Unknown error field",error.field);observable=self.password}observable.error_key(error.reason)}});SignupUtils.scrollToFirstError()}else if(response){var defaultMsg=TM("There was an error logging in. Please try again.");NuDialog.alert(TM("Login Error"),defaultMsg)}self.submitting(false)})}var self=this;var state=signup.state;var cfg=$("#pagedata").data("blob").cfg;var title=signup.originPage==="redeem"?TM("Log in and redeem",null,"log in and redeem gift card"):TM("Log in");
self.title=self.pageTitle=title;self.template="fan/signup/fan_login_pane";self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.resetOnClose=true;self.afterRender=function(){$(".signup-heading").hide();$("#login-title").show();self.visible(true);if(MediaView.mode==="desktop")$("#email-input").focus()};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.showExisting=
ko.observable(!!state.email);self.email=ko.observable(state.email).extend({errorKeys:{missingValue:TM("Please enter your email or username."),noMatch:TM("We couldn\u2019t find that account. Please try again.")}});self.password=ko.observable().extend({errorKeys:{missingValue:TM("Please enter your password."),tooShort:TM("Your password is at least 3 characters."),noMatch:TM("Incorrect password. Please try again.")}});this.userChooserVisible=ko.observable(false);this.possibleUsers=ko.observableArray();
this.selectedUser=ko.observable();this.formatUser=function(user){var list=[];if(user.fan_username)list.push(user.fan_username);if(user.bands&&user.bands.length>0)list=list.concat(Iter.collect(user.bands,function(b){return b.band_name}));return Templ.render("login/user_picker_text",{"username":user.name,"list":list})};self.twofactor=ko.observable().extend({errorKeys:{missingValue:TM("Please enter your two-factor code."),noMatch:TM("Code validation failed. Please try again.")}});self.twofactorRemember=
ko.observable(false);self.twofactorVisible=ko.observable(false);self.twofactorHelpVisible=ko.observable(false);self.showTwoFactorHelp=function(){self.twofactorHelpVisible(true)};this.enableCaptcha=ko.observable(cfg.login_use_captcha);if(this.enableCaptcha())Captcha.renderInvisible();self.validate=function(){var email=$.trim(self.email());self.email.error_key(!email?"missingValue":null);self.password.error_key(!self.password()?"missingValue":self.password().length<3?"tooShort":null);var twoFactorError=
null;if(self.twofactorVisible())self.twofactor.error_key(self.twofactor()?null:"missingValue");return!self.email.error_key()&&!self.password.error_key()&&!twoFactorError};this.has_errors=ko.computed(function(){var fields=["email","password","twofactor"];return Iter.find(fields,function(field){return self[field].error_key()})});this.submitting=ko.observable(false);this.submitEnabled=ko.computed(function(){return!self.submitting()&&!self.has_errors()});self.submit=function(){if(!self.submitEnabled()||
self.submitting())return;if(!self.validate()){SignupUtils.scrollToFirstError();return}self.submitting(true);if(self.enableCaptcha()){var captchaTimeout=setTimeout(function(){self.submitting(false)},1E4);Captcha.execute(function(token){clearTimeout(captchaTimeout);continueSubmitAfterCaptcha(token)})}else continueSubmitAfterCaptcha(null)};self.showExistingArtist=function(){self.close().then(function(){signup.openPane("existing_artist")})};self.showDupeFan=function(){self.close().then(function(){signup.openPane("dupe_fan")})};
self.backToSignup=function(){self.close().then(function(){signup.openPane("signup")})};self.forgotPassword=function(){self.close().then(function(){signup.openPane("forgot_password")})};self.exportState=function(){return{"email":self.email(),"nextURL":self.nextURL,"asyncIdentities":self.asyncIdentities,"userDataForMenubar":self.userDataForMenubar}};self.hash=function(){return{"portable":signup.portable,"fan_signup_only":signup.originPage==="redeem"}}};window.LoginPane=LoginPane})(window,$,ko);
(function(window,$,ko){var ForgotPasswordPane=function(signup,init){var self=this;var EMAIL_REGEX=/(^)([^\s\(\)"'\/><,@]+@\w([^\s\(\)"'\/><&,@]*\w)?\.\w[^\s\(\)"'\/><&,@]*\w)($)/;var state=signup.state;self.title=TM("Forgot password");self.pageTitle=TM("Forgot Your Password?");self.template="fan/signup/fan_forgot_password_pane";self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.afterRender=function(){self.visible(true)};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());
self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.email=ko.observable(state.email).extend({errorKeys:{empty:"Please enter your email address.",disabled:"Sorry, password reset for that account is disabled.",invalid:"That email address doesn't check out. Example: cool@guy.com",no_match:"We weren't able to find an account by that email address."}});self.email.validate=function(){var email=$.trim(self.email());self.email.error_key(!email||email.length===0?"empty":!EMAIL_REGEX.test(email)?
"invalid":null)};self.email.subscribe(function(){self.email.error_key(null)});self.validate=function(){self.email.validate()};self.has_errors=ko.computed(function(){return!!self.email.error_key()});self.submitting=ko.observable(false);self.sent=ko.observable(false);self.submitDisabled=ko.computed(function(){return!self.email()||self.has_errors()||self.submitting()||self.sent()});self.submit=function(){self.validate();if(self.has_errors()){SignupUtils.scrollToFirstError();return}self.submitting(true);
SignupAPI.sendForgotPasswordEmail({email:self.email()}).then(function(response){self.submitting(false);self.sent(true)},function(response){self.submitting(false);if(response&&response.errors){Iter.each(response.errors,function(error){if(self[error.field]&&self[error.field].error_key)self[error.field].error_key(error.reason)});SignupUtils.scrollToFirstError()}else if(response){var defaultMsg="An error occurred - please try again.";NuDialog.alert("Error",response&&response.error||defaultMsg)}})};self.backToSignup=
function(){self.close().then(function(){signup.openPane("signup")})};self.exportState=function(){return{"email":self.email()}};self.hash=function(){return{}}};window.ForgotPasswordPane=ForgotPasswordPane})(window,$,ko);
(function(window,$,ko){var ResetPasswordPane=function(signup,init){var self=this;self.title=self.pageTitle=TM("Reset password");self.template="fan/signup/fan_reset_password_pane";self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.afterRender=function(){self.visible(true)};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.password=ko.observable("").extend({errorKeys:{empty:"Please enter a new password."}});
self.password.validate=function(){var password=self.password();self.password.error_key(!password||password.length===0?"empty":null)};self.validate=function(){self.password.validate()};self.has_errors=ko.computed(function(){return!!self.password.error_key()});self.submitDisabled=ko.computed(function(){return!self.password()||self.submitting()});self.unrecoverableError=ko.observable(false);self.reset=ko.observable(false);self.submitting=ko.observable(false);self.submit=function(){self.validate();if(self.has_errors()){SignupUtils.scrollToFirstError();
return}self.submitting(true);SignupUtils.resetPassword({password:self.password(),token:init.token}).then(function(response){self.reset(true);SignupUtils.asyncLogin(response);self.backToSignup()},function(response){self.submitting(false);if(response&&response.errors){Iter.each(response.errors,function(error){if(error.field==="password")if(error.reason==="unrecoverable_error")self.unrecoverableError(true);else self.password.error_key(error.reason)});SignupUtils.scrollToFirstError()}else if(response){var defaultMsg=
"An error occurred - please try again.";NuDialog.alert("Error",response&&response.error_message||defaultMsg)}})};self.backToSignup=function(){self.close().then(function(){signup.openPane("signup")})};self.exportState=function(){return{}};self.hash=function(){return{}}};window.ResetPasswordPane=ResetPasswordPane})(window,$,ko);
(function(window,$,ko){var ExistingArtistPane=function(signup,init){var self=this;var state=signup.state;var pagedata=$("#pagedata").data().blob;self.title="";self.pageTitle=TM("Sign up");self.template="fan/signup/fan_existing_artist_pane";self.width=505;self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.afterRender=function(){self.visible(true)};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);
d.resolve();return d.promise()};self.submit=function(){self.close(true).then(function(){signup.openPane("signup")})};self.logout=function(){SignupAPI.logout().then(function(){signup.updateState({"email":null,"userName":null,"bands":[]});SignupUtils.asyncLogin({});if(window.location.pathname==="/")SignupUtils.renderHeader({});signup.resetInitial();self.close(true).then(function(){signup.openPane("signup")})})};self.exportState=function(){return{}};self.hash=function(){return{"action":signup.actionParams.action,
"action_item_type":signup.actionParams.actionItemType,"unsupported_device":pagedata.unsupported_device,"user_name":state.userName,"bands":state.bands||[]}}};window.ExistingArtistPane=ExistingArtistPane})(window,$,ko);
(function(window,$,ko){var ActionPane=function(signup,init){var self=this;self.title="";self.template="fan/signup/fan_action_pane";self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.afterRender=function(){self.visible(true)};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};this.openSignup=function(){var action=signup.actionParams&&signup.actionParams.action;if(action){var stat=
null;if(action==="wishlist")stat="logged_out_wishlist_signup";else if(action==="follow"&&signup.actionParams.actionItemType==="f")stat="logged_out_fan_follow_signup";else if(action==="follow"&&(!signup.actionParams.actionItemType||signup.actionParams.actionItemType==="b"))stat="logged_out_follow_signup";Stats.record({"kind":"click","click":stat})}if(MediaView.mode==="phone"){if(signup.actionParams.queryString)window.location.href=siteroot_https+"/fan_signup"+signup.actionParams.queryString+"\x26action\x3d"+
signup.actionParams.action+"\x26from\x3d"+signup.actionParams.from+"\x26pane\x3dsignup";else window.location.href=siteroot_https+"/fan_signup?action\x3d"+signup.actionParams.action+"\x26from\x3d"+signup.actionParams.from+"\x26pane\x3dsignup";return}if(Url.isCustomDomain())if(signup.subdomainURL){var params={"fan_action_pane":"signup"};if(signup.actionParams.action){params.fan_action=signup.actionParams.action;params.item_id=signup.actionParams.actionItemId;params.item_type=signup.actionParams.actionItemType;
params.band_id=signup.actionParams.actionBandId}window.location.href=Url.addQueryParams(signup.subdomainURL,params)}else window.location.href=siteroot_https+"/fans";else self.close().then(function(){signup.openPane("signup")})};this.openLogin=function(){var action=signup.actionParams&&signup.actionParams.action;if(action){var stat=null;if(action==="wishlist")stat="logged_out_wishlist_login";else if(action==="follow"&&signup.actionParams.actionItemType==="f")stat="logged_out_fan_follow_login";else if(action===
"follow"&&(!signup.actionParams.actionItemType||signup.actionParams.actionItemType==="b"))stat="logged_out_follow_login";Stats.record({"kind":"click","click":stat})}if(MediaView.mode==="phone"){if(signup.actionParams.queryString)window.location.href=siteroot_https+"/fan_signup"+signup.actionParams.queryString+"\x26action\x3d"+signup.actionParams.action+"\x26from\x3d"+signup.actionParams.from+"\x26pane\x3dlogin";else window.location.href=siteroot_https+"/fan_signup?action\x3d"+signup.actionParams.action+
"\x26from\x3d"+signup.actionParams.from+"\x26pane\x3dlogin";return}if(Url.isCustomDomain())if(signup.subdomainURL){var params={"fan_action_pane":"login"};if(signup.actionParams.action)params.fan_action=signup.actionParams.action;window.location.href=Url.addQueryParams(signup.subdomainURL,params)}else window.location.href=siteroot_https+"/fans";else self.close().then(function(){signup.openPane("login")})};self.exportState=function(){return{}};self.hash=function(){return{"action":signup.actionParams.action,
"action_item_type":signup.actionParams.actionItemType}}};window.ActionPane=ActionPane})(window,$,ko);
(function(window,$,ko){var AlmostTherePane=function(signup,init){var self=this;var state=signup.state;self.title=TM("Ready, set, activate!",null,"we're directing the user to activate their account");self.pageTitle=TM("Sign up");self.template="fan/signup/fan_almost_there_pane";self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.portable=signup.portable;self.is_phone=Browser.media_mode==="phone";self.noClose=false;self.afterRender=function(){self.visible(true);$(".signup-heading").hide();
$("#almost-there-title").show()};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.submit=function(){Stats.record({"kind":"click","click":"fan_signup_almost_there_continue"});if(signup.fanOnboarding&&self.portable)self.openWelcome2();else if(self.portable||signup.actionParams.action)signup.onComplete();else self.openWelcome()};self.openWelcome=function(){self.close().then(function(){signup.openPane("welcome")})};
self.openWelcome2=function(){self.close().then(function(){signup.openPane("welcome_2")})};self.exportState=function(){return{}};self.hash=function(){return{"email":state.email,"username":state.fanUsername,"portable":self.portable,"is_phone":self.is_phone}}};window.AlmostTherePane=AlmostTherePane})(window,$,ko);
(function(window,$,ko){var WelcomePane=function(signup,init){var self=this;var state=signup.state;var pagedata=$("#pagedata").data().blob;self.platform_app_url=pagedata.platform_app_url;self.mobile_app_url=pagedata.mobile_app_url;self.app_store_url=pagedata.app_store_url;self.play_store_url=pagedata.play_store_url;self.unsupported_device=pagedata.unsupported_device;self.is_phone=Browser.media_mode==="phone";self.followOnly=pagedata.signup_params.follow_only;self.wishlistOnly=pagedata.signup_params.wishlist_only;
self.noClose=true;self.isActivationView=signup.initialPane==="welcome"&&!signup.portable;self.isBandMember=Identities.bmgr.bands().length>0||signup.state.asyncIdentities&&signup.state.asyncIdentities.bands&&signup.state.asyncIdentities.bands.length>0;if(signup.portable&&MediaView.mode!=="phone")self.title=TM("Welcome");else self.title="";self.pageTitle=TM("Welcome");self.template="fan/signup/fan_welcome_pane";if(!signup.portable)$("#propOpenWrapper").addClass("welcome");if($(".bc-toplogo"))$(".bc-toplogo").hide();
self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.appLinkSent=ko.observable(false);self.appLinkEmail=state.email;var isValidEmail=function(e){return e&&e.indexOf("@")!==-1};self.sendAppLinkEmail=function(){self.appLinkSent(true);var email=state.email;if(isValidEmail(email))SignupAPI.sendAppLinkEmail({fan_username:state.fanUsername,email:email}).then(function(resp){if(!resp||!resp.ok){Log.error(resp&&resp.error);NuDialog.alert(TM("Signup Error"),TM("There was a problem sending the email. Please try again."));
self.appLinkSent(false)}});else{NuDialog.alert(TM("Signup Error"),TM("There was a problem sending the email. Please try again."));self.appLinkSent(false)}};self.closeAppLinkModal=function(){self.$dialog.dialog("close")};self.appLinkModal=function(){if(state.email&&!self.appLinkSent())self.sendAppLinkEmail();self.$dialog=NuDialog.showTemplate("fan/signup/fan_email_link",{},{dialogClass:"nu-dialog no-close blank-title",buttons:{}});ko.applyBindings(self,self.$dialog[0])};self.afterRender=function(){self.visible(true);
$(".signup-heading").hide();$("#signup-title").hide();$(".fan-signup .top-divider").hide();if(signup.initialPane==="welcome")$("#sign-up-active").show();else if(self.isBandMember)$("#sign-up-welcome-artist").show();else{$("#sign-up-welcome .sign-up-welcome-fan-name").text(state.fanUsername);$("#sign-up-welcome").show()}};self.close=function(){var d=$.Deferred();$("#propOpenWrapper").removeClass("welcome");signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();
return d.promise()};self.buttonEnabled=ko.observable(true);self.submit=function(){self.buttonEnabled(false);signup.onComplete()};self.getApp=function(){window.location.href=self.platform_app_url};self.exportState=function(){return{}};self.hash=function(){return{"email":state.email,"username":state.fanUsername,"action":signup.actionParams.action,"unsupported_device":self.unsupported_device,"platform_app_url":self.platform_app_url,"mobile_app_url":self.mobile_app_url,"app_store_url":pagedata.app_store_url,
"play_store_url":pagedata.play_store_url,"is_phone":self.is_phone,"portable":signup.portable,"is_band_member":self.isBandMember,"is_activation_view":self.isActivationView}}};window.WelcomePane=WelcomePane})(window,$,ko);
(function(window,$,ko){var VerifyNag=function(initial,closeCallback){var self=this;self.title=TM("Activate your account");self.fanEmail=ko.observable(initial.fan_email);self.skipToEmail=initial.skipToEmail;self.changingEmail=ko.observable(false);self.submitted=ko.observable(false);self.resentEmail=ko.observable(false);if(self.skipToEmail)self.changingEmail(true);self.emailError=ko.observable();self.alreadyAFanError=ko.computed(function(){return self.emailError()=="already_a_fan"});self.fanAlreadyLinkedEmailError=
ko.computed(function(){return self.emailError()=="fan_already_linked_email"});self.invalidEmailError=ko.computed(function(){return self.emailError()=="invalid_email"});self.openDialog=function(){self._dialog=NuDialog.showTemplate("fan/signup/fan_verify_nag_pane",{email:self.fanEmail()},{dialogClass:"nu-dialog center-title no-close",draggable:true,width:MediaView.mode==="phone"?"90%":500,modal:true,title:self.title,buttons:{},closeOnEscape:false});ko.applyBindings(self,$("#nag-vm")[0])};self.closeDialog=
function(){if(!self.skipToEmail)self.changingEmail(false);self.submitted(false);if(!self._dialog)return;self._dialog.dialog("close");if(closeCallback){var changedEmail=self.fanEmail()!==initial.fan_email?self.fanEmail():null;var resentEmail=self.resentEmail();closeCallback(changedEmail,resentEmail)}};self.submit=function(){if(!self.changingEmail()||self.submitted())self.closeDialog();else self.resendEmail()};self.cancel=function(){self.closeDialog()};self.resendEmail=function(){self.resentEmail(true);
var data={email:self.fanEmail()};SignupAPI.resendFanVerifyEmail(data).then(function(response){if(response.ok)self.submitted(true)},function(response){if(response.errors&&response.errors[0]&&response.errors[0].field=="email")self.emailError(response.errors[0].reason)})};self.changeEmail=function(){self.changingEmail(true)}};window.VerifyNag=VerifyNag})(window,$,ko);
(function(window,$,ko){var DupeFanPane=function(signup,init){var self=this;var state=signup.state;self.title="";self.pageTitle=TM("Signup error");self.template="fan/signup/fan_dupe_fan_pane";self.width=505;self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.afterRender=function(){self.visible(true)};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.submit=
function(){self.close(true)};self.email=state.email;self.logout=function(){SignupAPI.logout().then(function(){self.close(true).then(function(){window.location.href=siteroot_https+"/login"})})};self.exportState=function(){return{}};self.hash=function(){return{"fan":signup.affiliations&&signup.affiliations.fan,"fan_already_linked_email":signup.affiliations&&signup.affiliations.fan_already_linked_email,"email":self.email}}};window.DupeFanPane=DupeFanPane})(window,$,ko);
(function(window,$,ko){var ChooseAccountPane=function(signup,init){var self=this;var state=signup.state;self.title=TM("Sign up for a Bandcamp account");self.pageTitle=TM("Sign up for a Bandcamp account");self.template="fan/signup/fan_choose_account_pane";self.width=500;self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);self.afterRender=function(){var stat=null;if(signup.originPage==="home"||signup.originPage==="corp")stat="corp_header_single_signup";else stat="menubar_single_signup";
self.visible(true);Stats.record({"kind":"click","click":stat})};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.openFanSignup=function(){var stat=null;var isSubscribePage=window.SubscribeVM!==undefined;if(signup.originPage==="home"||signup.originPage==="corp")stat="corp_header_single_signup_fan";else stat="menubar_single_signup_fan";Stats.record({"kind":"click","click":stat});self.close().then(function(){if(isSubscribePage)window.location.href=
siteroot_https+"?fan_action_pane\x3dsignup";else signup.openPane("signup")})};self.exportState=function(){return{}};self.hash=function(){return{"fans_from":signup.originPage==="home"||signup.originPage==="corp"?"hpfans":"menubar","artists_from":signup.originPage==="home"||signup.originPage==="corp"?"hpartists":"menubar","labels_from":signup.originPage==="home"||signup.originPage==="corp"?"hplabels":"menubar"}}};window.ChooseAccountPane=ChooseAccountPane})(window,$,ko);
(function(window,$,ko){var MIN_GENRES_WIDE=5;var MIN_GENRES_SKINNY=4;var MIN_SEARCH_TIME=0;var WIDTH_WIDE=720;var WIDTH_SKINNY=555;var MIN_HEIGHT=350;var MAX_HEIGHT=540;var MAX_RESULTS=10;var PICKER_HEIGHT_CONSTANT=360;var MOBILE_PICKER_HEIGHT_CONSTANT=294;var SEARCH_RESULTS_CONSTANT=296;var computePickerHeight=function(windowHeight,isMobile){var pickerHeight;if(windowHeight>900)pickerHeight=MAX_HEIGHT;else if(isMobile)pickerHeight=windowHeight-MOBILE_PICKER_HEIGHT_CONSTANT;else if(windowHeight<=
700)pickerHeight=MIN_HEIGHT;else pickerHeight=windowHeight-PICKER_HEIGHT_CONSTANT;return pickerHeight};window.computePickerHeight=computePickerHeight;var computeSearchResultsTop=function(windowHeight,hasSelectedGenres,isMobile){var resultsTop;if(isMobile)return windowHeight-148;if(windowHeight>900)resultsTop=604;else if(windowHeight<=700)resultsTop=414;else resultsTop=windowHeight-SEARCH_RESULTS_CONSTANT;if(hasSelectedGenres)resultsTop=resultsTop+26;return resultsTop};var GenreVM=function(picker,
init,parentGenre,isCustom,selected,isSearch){var self=this;self.name=init.name;self.normName=init.norm_name;self.geonameName=init.geoname_name;self.format=init.format;self.displayName=ko.computed({read:function(){var selectedGenres=picker.selectedGenres();var name;var nameMatch=false;selectedGenres.forEach(function(sg){if(sg!==self&&sg.name===self.name)nameMatch=true});name=nameMatch&&parentGenre?parentGenre.name+" / "+self.name:self.name;var facets=[];if(name)facets.push(name);if(self.geonameName)facets.push(self.geonameName);
if(self.format&&self.format!=="all")facets.push(self.format);return facets.join(" / ").toLowerCase()},deferEvaluation:true});self.value=init.value||init.norm_name;self.id=init.id||init.tag_id||init.genre_id;self.discoverId=init.discover_id;self.parentGenre=parentGenre;self.isFake=false;self.isCustom=!!isCustom;self.isSearch=isSearch;self.expanded=ko.observable(isCustom);self.selected_=ko.observable(!!selected);self.selected=ko.computed({read:function(){if(!self.expanded())if(self.subgenres&&self.subgenres().length>
0)return!!Iter.find(self.subgenres(),function(sg){return sg.selected()})||self.selected_();return self.selected_()},write:function(val){self.selected_(val)}});self.isLong=self.value==="electronic";self.cssId=self.value+"-box";self.visible=ko.observable(false);self.hiding=ko.observable(false);self.collapsing=false;self.toggleSelect=function(fromSelectedBar){picker.searchHasFocus(false);var currentValue=self.selected();self.selected(!currentValue);if(picker.isFirstPane&&picker.isFirstPane())$("#signup-vm .mobile #"+
self.value+"-box").toggleClass("selected",!currentValue);if(currentValue){self.hiding(true);self.visible(false);var rm=function(){picker.selectedGenres.remove(self);self.hiding(false)};if(picker.selectedGenres().length>1)setTimeout(function(){rm()},300);else rm()}else{picker.selectedGenres.unshift(self);setTimeout(function(){self.visible(true)},0)}if(!parentGenre&&!Iter.find(self.subgenres(),function(sg){return sg.selected()})){if(!fromSelectedBar)self.collapsing=true;self.expanded(false);if(!picker.mobile())picker.$genres.masonry()}else if(parentGenre&&
!parentGenre.selected()&&!Iter.find(parentGenre.subgenres(),function(sg){return sg.selected()})){parentGenre.expanded(false);if(!fromSelectedBar)parentGenre.collapsing=true;if(!picker.mobile())picker.$genres.masonry()}};self.expand=function(data,e){if(self.expanded()||self.collapsing){self.collapsing=false;return}if(!self.selected()){self.selected(true);$("#signup-vm .mobile #"+self.value+"-box").toggleClass("selected",self.selected());picker.selectedGenres.unshift(self);setTimeout(function(){self.visible(true)},
0)}else $("#signup-vm .mobile #"+self.value+"-box").toggleClass("selected",self.selected());self.expanded(true);Iter.each(picker.genres,function(g){if(g!==self)g.expanded(false)});if(!picker.mobile())picker.$genres.masonry()};self.hasExpandedClass=ko.computed(function(){if(self.normName==="podcasts"||self.normName==="audiobooks")return false;else if(self.isSearch)return true;else return self.expanded()});self.subgenres=ko.observableArray()};var GenrePickerPane=function(signup,init){var self=this;
var state=signup.state;var isWide=$(window).width()>768;if(!init.standalone)Stats.record({"kind":"click","click":"fan_signup_genre_start"});self.isWide=isWide;self.title=null;self.overflowDialog=true;self.pageTitle=TM("Choose your favorite genres");self.template="fan/signup/fan_genre_picker_pane";self.width=isWide?WIDTH_WIDE:WIDTH_SKINNY;self.standalone=ko.observable(init.standalone);self.mobile=ko.observable(signup.mobile);var windowWidth=$(window).width();var windowHeight=$(window).height();var isMobile=
self.mobile&&self.mobile();var gowh=!isMobile?computePickerHeight(windowHeight)+"px":null;var srt=!isMobile?computeSearchResultsTop(windowHeight)+"px":null;self.genres_overflow_wrapper_height=ko.observable(gowh);self.search_results_top=ko.observable(computeSearchResultsTop(srt));self.hash=function(){var h={"fan_name":state.fanUsername,"genres_overflow_wrapper_height":self.genres_overflow_wrapper_height(),"search_results_top":self.search_results_top(),"skinny":windowWidth<=768};return h};if(self.standalone()){Stats.record({"kind":"click",
"click":"fan_manage_genre_start"});self.templateName=ko.observable(self.template);self.templateHash=ko.observable(self.hash());self.$dialog=ko.observable()}if(self.mobile()){self.currentPane=ko.observable("genres");self.showGenres=ko.computed(function(){return self.currentPane()=="genres"});self.showSubgenres=ko.computed(function(){return self.currentPane()=="subgenres"});self.isFirstPane=ko.computed(function(){return self.currentPane()=="genres"})}self.visible=ko.observable(false);self.immediate=
ko.observable(!!init.immediate);self.minGenres=ko.observable(isWide?MIN_GENRES_WIDE:MIN_GENRES_SKINNY);self.submitting=ko.observable(false);self.submitEnabled=ko.computed(function(){return!self.submitting()});self.genres=[];self.suggestedNewsletters=[];var gvm;if(init.genres){var action=FanSignup.actionParams.action;var preferedGenre=Iter.find(init.genres,function(g){return g.id==FanSignup.actionParams.genreId});if((action==="follow"||action==="wishlist")&&preferedGenre){gvm=new GenreVM(self,preferedGenre);
if(init.subgenres[preferedGenre.value])Iter.each(init.subgenres[preferedGenre.value],function(sg){gvm.subgenres.push(new GenreVM(self,sg,gvm))});self.genres.push(gvm)}Iter.eachWithIndex(init.genres,function(g,index){if(preferedGenre&&preferedGenre.id==g.id)return;gvm=new GenreVM(self,g);if(init.subgenres[g.value])Iter.each(init.subgenres[g.value],function(sg){gvm.subgenres.push(new GenreVM(self,sg,gvm))});self.genres.push(gvm)})}self.selectedGenres=ko.observableArray();self.selectedGenres.noAnimation=
ko.observable(true);self.showPageLeft=ko.observable(false);self.showPageRight=ko.observable(false);self.selectedGenresSubscription=self.selectedGenres.subscribe(function(genres){setTimeout(function(){var scrollLeft=self.$selectedGenresEl.scrollLeft();var containerWidth=self.$selectedGenresEl.width();var scrollWidth=self.$selectedGenresEl[0].scrollWidth;self.showPageLeft(scrollLeft>0);self.showPageRight(scrollLeft+containerWidth<scrollWidth);$(".search-results",self.$root).css({"top":computeSearchResultsTop($(window).height(),
genres.length>0,self.mobile())})},200)});self.prefillSelectedGenres=function(followingGenres){self.prefilledGenres=ko.observableArray();var values=Object.keys(followingGenres).map(function(g){return followingGenres[g]});values.forEach(function(fg){var isCustom=true;if(!fg.geoname_name&&(!fg.format||fg.format==="all"))self.genres.forEach(function(g){if(fg.genre_id===g.id)if(fg.tag_id===0){isCustom=false;g.selected(true);var notSelected=self.selectedGenres().indexOf(g)==-1;if(notSelected){self.selectedGenres.unshift(g);
self.prefilledGenres.unshift(g);setTimeout(function(){g.visible(true)},0)}}else if(g.subgenres&&g.subgenres().length>0){g.subgenres().forEach(function(sg){if(fg.norm_name===sg.normName){isCustom=false;sg.selected(true);self.selectedGenres.unshift(sg);self.prefilledGenres.unshift(sg);setTimeout(function(){sg.visible(true)},0)}});g.selected(!g.selected_());g.selected(!g.selected_())}},self);if(isCustom){var gvm=new GenreVM(self,{"name":fg.name,"norm_name":fg.norm_name,"value":fg.norm_name,"id":fg.discover_id,
"discover_id":fg.discover_id,"geoname_name":fg.geoname_name,"format":fg.format},null,true,true);self.selectedGenres.unshift(gvm);self.prefilledGenres.unshift(gvm);setTimeout(function(){gvm.visible(true)},0)}},this)};self.searchClick=function(){if(self.searchTerm()&&self.searchTerm().length>0&&self.searchResults().length===0)self.doSearch(self.searchTerm());return false};self.searchWrapperClick=function(){self.scrollToSearch()};self.scrollToSearch=function(){self.$genresWrapper.animate({"scrollTop":self.$genresWrapper[0].scrollHeight},
100)};self.deselectClick=function(vm,ev){if($.contains($(".search-input-wrapper",self.$root[0])[0],ev.target)||$.contains($(".search-results",self.$root[0])[0],ev.target))return;self.searchHasFocus(false);self.searchSelectIndex(null);self.searchResults([]);return true};self.searchHasFocus=ko.observable(false);self.searchResults=ko.observableArray([]);self.searchTerm=ko.observable();self.truncatedSearchTerm=ko.computed(function(){var term=self.searchTerm();return Text.truncate(term,15,"...")});self.searching=
ko.observable(false);self.searchSelectIndex=ko.observable(null);self.searchSelectIndex.subscribe(function(val){if(val===0)self.searchHasFocus(true);else self.searchHasFocus(false)});self.doSearch=function(term){var cleanedResults=[];var cleanedResultsNameHash={};term=$.trim(term.toString()).toLowerCase();self.searching(true);var startTime=(new Date).getTime();var finish=function(r){if(term!==$.trim(self.searchTerm().toString()).toLowerCase())return;self.searching(false);if(r.length===0)r.push({"isEmpty":true});
self.searchResults(r)};var count=MAX_RESULTS;SignupAPI.customGenreSearch(term,count).then(function(response){if(term!==$.trim(self.searchTerm().toString()).toLowerCase())return;if(!response.matching_tags||response.matching_tags===0){finish(cleanedResults);return}Iter.each(response.matching_tags,function(r){var name=r.tag_name.toLowerCase();if(cleanedResults.length>=MAX_RESULTS||cleanedResultsNameHash[name])return;var termIndex=name.indexOf(term);var beforeString=name.slice(0,termIndex);var afterString=
name.slice(termIndex+term.length,name.length);var presetMatch=false;var parentGenreID=null;var displayName=termIndex>=0?beforeString+"\x3cb\x3e"+Text.escapeHtml(term)+"\x3c/b\x3e"+afterString:name;cleanedResults.push({"displayName":displayName,"name":name,"normName":r.tag_norm_name,"isCustom":!presetMatch,"count":r.count,"countText":TP("{{count}} match","{{count}} matches",r.count)});cleanedResultsNameHash[r.name]=true});var elapsedTime=(new Date).getTime()-startTime;if(elapsedTime<MIN_SEARCH_TIME)setTimeout(function(){finish(cleanedResults)},
MIN_SEARCH_TIME-elapsedTime);else finish(cleanedResults)},function(){var elapsedTime=(new Date).getTime()-startTime;if(elapsedTime<MIN_SEARCH_TIME)setTimeout(function(){finish(cleanedResults)},MIN_SEARCH_TIME-elapsedTime);else finish(cleanedResults)})};self.searchTerm.subscribe(function(val){self.searching(false);if(val&&val.length>2){self.searchResults([]);self.doSearch(val)}else self.searchResults([])});self.collapseSearch=function(clearSearchTerm){self.searchResults([]);if(clearSearchTerm)self.searchTerm(null);
self.searchHasFocus(false);self.searchSelectIndex(0)};self.expandSearch=function(){self.searchResults([]);self.doSearch(self.searchTerm())};self.selectSearchResult=function(data){if(data.isCustom){self.selectCustomGenre(data.name,data.normName);return}self.collapseSearch(true);Iter.each(self.genres,function(g){g.expanded(false);if(!data.parentGenreID&&data.name===g.name){g.selected(true);g.expanded(true);if(!self.mobile())self.$genres.masonry();if(!Iter.find(self.selectedGenres(),function(ssg){return ssg.name===
g.name})){self.selectedGenres.unshift(g);setTimeout(function(){g.visible(true)},0)}}else if(data.parentGenreID===g.id){g.expanded(true);if(!self.mobile())self.$genres.masonry();Iter.each(g.subgenres(),function(sg){if(data.name===sg.name){sg.selected(true);if(!Iter.find(self.selectedGenres(),function(ssg){return ssg.name===sg.name})){self.selectedGenres.unshift(sg);setTimeout(function(){sg.visible(true)},0)}}})}else g.expanded(false)});if(!self.mobile())self.$genres.masonry()};self.selectCustomGenre=
function(name,normName){self.collapseSearch(true);var gvm=new GenreVM(self,{"name":name,"norm_name":normName},null,true,true);self.selectedGenres.unshift(gvm);setTimeout(function(){gvm.visible(true)},0)};self.searchInputKeypress=function(data,e){var code=e.keyCode||e.which;self.scrollToSearch();switch(code){case 9:e.preventDefault();self.searchSelectIndex(self.searchSelectIndex()+1);if(self.searchSelectIndex()===1)$(".search-results li:first",self.$root[0]).focus();break;case 38:e.preventDefault();
if(self.searchSelectIndex()===0)return;self.searchSelectIndex(self.searchSelectIndex()-1);break;case 40:e.preventDefault();self.searchSelectIndex(self.searchSelectIndex()+1);if(self.searchSelectIndex()===1)$(".search-results li:first",self.$root[0]).focus();break;case 13:e.preventDefault();if(self.searchResults().length===0&&self.searchTerm()&&self.searchTerm().length>0)self.expandSearch();break;case 27:e.preventDefault();self.searchHasFocus(false);self.searchResults([]);return false;default:return true}};
self.searchInputMouseover=function(data,e){if(self.searchResults().length===0)return;e.preventDefault();self.searchSelectIndex(0)};self.searchResultsKeypress=function(data,e){var code=e.keyCode||e.which;self.scrollToSearch();switch(code){case 38:e.preventDefault();self.searchSelectIndex(self.searchSelectIndex()-1);if(self.searchSelectIndex()===0)$(".search-wrapper input",self.$root[0]).focus();break;case 40:e.preventDefault();if(self.searchSelectIndex()===self.searchResults().length)return;self.searchSelectIndex(self.searchSelectIndex()+
1);break;case 13:var index=self.searchSelectIndex()-1;var result=self.searchResults()[index];if(result)if(result.isCustom)self.selectCustomGenre(result.name,result.normName);else self.selectSearchResult(result);break;case 27:self.searchResults([]);break;default:return true}};self.searchResultsMouseover=function(index){self.searchSelectIndex(index+1)};var scrollRatio=.5;self.pageLeft=function(){var containerWidth=self.$selectedGenresEl.width();var scrollWidth=self.$selectedGenresEl[0].scrollWidth;
var currentScrollLeft=self.$selectedGenresEl.scrollLeft();var newScrollLeft=currentScrollLeft-scrollRatio*containerWidth;self.searchResults([]);self.$selectedGenresEl.animate({"scrollLeft":newScrollLeft},200);setTimeout(function(){self.showPageLeft(newScrollLeft>0);self.showPageRight(newScrollLeft+containerWidth<scrollWidth)},200)};self.pageRight=function(){var containerWidth=self.$selectedGenresEl.width();var scrollWidth=self.$selectedGenresEl[0].scrollWidth;var currentScrollLeft=self.$selectedGenresEl.scrollLeft();
var newScrollLeft=currentScrollLeft+scrollRatio*containerWidth;self.searchResults([]);self.$selectedGenresEl.animate({"scrollLeft":newScrollLeft},200);setTimeout(function(){self.showPageLeft(newScrollLeft>0);self.showPageRight(newScrollLeft+containerWidth<scrollWidth)},200)};self.resetScroll=function(){self.searchResults([]);var scrollLeft=self.$selectedGenresEl.scrollLeft();var containerWidth=self.$selectedGenresEl.width();var scrollWidth=self.$selectedGenresEl[0].scrollWidth;self.$selectedGenresEl.animate({"scrollLeft":0},
200);self.showPageLeft(scrollLeft>0);self.showPageRight(scrollLeft+containerWidth<scrollWidth)};self.scrollTop=function(){$(".genres-overflow-wrapper").scrollTop(0)};self.exportSelectedGenres=function(){var selectedGenres=self.selectedGenres();var values=[];Iter.each(selectedGenres,function(g){if(g.parentGenre)values.push({"genre_norm_name":g.parentGenre.normName,"name":g.name,"subgenre_norm_name":g.normName});else values.push({"genre_norm_name":g.normName,"name":g.name,"subgenre_norm_name":null})});
return values};self.afterRender=function(){var postrender=function(){self.$root=$("#signup-vm");if(!self.mobile())self.$genres=$(".genres",self.$root[0]).masonry({itemSelector:".genre",stamp:".search",columnWidth:162});self.visible(true);if(self.standalone())$("#signup-vm").toggleClass("standalone");self.$selectedGenresEl=$("ul.selected-genres",self.$root[0]);self.$genresWrapper=$(".genres-overflow-wrapper",self.$root[0]);self.$selectedGenresEl.on("scroll",function(){var scrollLeft=self.$selectedGenresEl.scrollLeft();
var containerWidth=self.$selectedGenresEl.width();var scrollWidth=self.$selectedGenresEl[0].scrollWidth;self.searchResults([]);self.showPageLeft(scrollLeft>0);self.showPageRight(scrollLeft+containerWidth<scrollWidth)});self.$genresWrapper.on("scroll",function(){if(self.searchResults().length>0)self.collapseSearch(false)});if($(window).height()>$(".ui-dialog").height()+30)$("body").addClass("prevent-scroll");setTimeout(function(){self.selectedGenres.noAnimation(false)},0)};if(signup.additionalBundleLoaded)postrender();
else signup.additionalBundlePromise.done(function(){postrender()});$(window).resize(function(){var valid_dialog=signup._pane&&!signup._dialog&&!(FanSignup._pane instanceof GenrePickerPane)||self.standalone()&&!!self.$dialog();if(!valid_dialog)return;var dialog=signup._dialog||self.$dialog();self.searchResults([]);var width=$(window).width();var height=$(window).height();if(width<=768){self.minGenres(MIN_GENRES_SKINNY);dialog.dialog("option","width",WIDTH_SKINNY);self.$root.addClass("skinny")}else{self.minGenres(MIN_GENRES_WIDE);
dialog.dialog("option","width",WIDTH_WIDE);self.$root.removeClass("skinny")}$(".genres-overflow-wrapper",self.$root).css({"height":computePickerHeight(height,self.mobile())});$(".search-results",self.$root).css({"top":computeSearchResultsTop(height,self.selectedGenres().length>0,self.mobile())});dialog.dialog("option","position",{my:"center center",at:"center center",of:window})})};self.submitEnabled=ko.computed(function(){return!self.submitting()});self.next=function(){if(self.standalone()){self.saveGenrePreferences();
return}if(self.mobile()&&self.currentPane()=="genres"){self.currentPane("subgenres");return}var genresForFollow=self.exportSelectedGenres();if(genresForFollow.length>0){if(self.submitting())return;self.submitting(true);Stats.record({"kind":"click","click":"fan_signup_genre_pick"});SignupAPI.followGenres(genresForFollow).then(function(response){self.submitting(false);if(response.error);else{self.suggestedNewsletters=response.suggested_newsletters;self.switchPane("newsletter_picker")}},function(response){self.submitting(false)})}else if(self.standalone());
else{Stats.record({"kind":"click","click":"fan_signup_genre_skip"});self.switchPane("newsletter_picker")}};self.saveGenrePreferences=function(){if(self.submitting())return;self.submitting(true);var toFollow=[];var toUnfollow=[];self.prefilledGenres().forEach(function(pg){if(self.selectedGenres().indexOf(pg)===-1){Stats.record({kind:"click",click:"fan_manage_genre_picker_unfollow"});toUnfollow.unshift({genre_id:pg.id||pg.parentGenre&&pg.parentGenre.id,genre_norm_name:pg.id?pg.normName:pg.parentGenre&&
pg.parentGenre.normName,subgenre_norm_name:!pg.id&&pg.normName,discover_id:pg.discoverId})}},self);self.selectedGenres().forEach(function(pg){if(self.prefilledGenres().indexOf(pg)===-1){Stats.record({kind:"click",click:"fan_manage_genre_picker_follow"});toFollow.unshift({genre_id:pg.id||pg.parentGenre&&pg.parentGenre.id,genre_norm_name:pg.id?pg.normName:pg.parentGenre&&pg.parentGenre.normName,subgenre_norm_name:!pg.id&&pg.normName})}},self);if(toFollow.length>0||toUnfollow.length>0){Stats.record({"kind":"click",
"click":"fan_manage_genre_pick"});Fanpage.saveGenrePreferences(toFollow,toUnfollow)}else{self.submitting(false);self.$dialog().dialog("close")}};self.switchPane=function(pane){self.close(true).then(function(){signup.openPane(pane)})};self.close=function(){var d=$.Deferred();if(self.standalone()){self.resetScroll();$("body").removeClass("prevent-scroll")}else signup.updateState(self.exportState());self.immediate(false);self.visible(false);self.selectedGenresSubscription.dispose();d.resolve();return d.promise()};
self.exportState=function(){return{"selectedGenres":self.exportSelectedGenres(),"suggestedNewsletters":self.suggestedNewsletters}}};window.GenrePickerPane=GenrePickerPane})(window,$,ko);
(function(window,$,ko){var NewsletterVM=function(init){var self=this;self.selected=ko.observable(false);self.title=init.title;self.name=init.name;self.genreId=init.genre_id;self.description=init.description};var NewsletterPickerPane=function(signup,init){var self=this;var state=signup.state;Stats.record({"kind":"click","click":"fan_signup_newsletter_start"});self.title=null;self.template="fan/signup/fan_newsletter_picker_pane";self.width=480;self.visible=ko.observable(false);self.immediate=ko.observable(!!init.immediate);
self.afterRender=function(){self.visible(true);if(signup.mobile)signup._dialog.dialog("option","position",{my:"center center",at:"center center"})};self.close=function(){var d=$.Deferred();signup.updateState(self.exportState());self.immediate(false);self.visible(false);d.resolve();return d.promise()};self.newsletters=[];Iter.each(state.suggestedNewsletters,function(sn){var vm=new NewsletterVM(sn);self.newsletters.push(vm)});self.selectedNewsletters=ko.computed(function(){var chosen=Iter.findAll(self.newsletters,
function(n){return n.selected()});return chosen});self.bestOfSelected=ko.observable(false);self.hasSelectedGenres=state.selectedGenres.length>0;self.hasSuggestedNewsletters=state.suggestedNewsletters.length>0;self.hasNonNewsletterGenres=self.hasSelectedGenres&&state.selectedGenres.length!==state.suggestedNewsletters.length;self.exportSelectedNewsletters=function(){var selectedNewsletters=self.selectedNewsletters();return Iter.collect(selectedNewsletters,function(sn){return sn.genreId})};self.skip=
function(){Iter.each(self.newsletters,function(n){n.selected(false)});self.submit()};self.submitting=ko.observable(false);self.submitEnabled=ko.computed(function(){return!self.submitting()});self.chooseBestOf=function(){self.bestOfSelected(true);self.submit()};self.submit=function(){var postAction=function(){self.switchPane("welcome_2")};var selectedNewsletters=self.exportSelectedNewsletters();var bestOf=self.bestOfSelected();if(selectedNewsletters.length>0||bestOf){if(self.submitting())return;self.submitting(true);
Stats.record({"kind":"click","click":"fan_signup_newsletter_pick"});SignupAPI.subscribeToNewsletters(selectedNewsletters,bestOf).then(function(response){self.submitting(false);if(response.error);else postAction()},function(response){self.submitting(false)})}else{Stats.record({"kind":"click","click":"fan_signup_newsletter_skip"});postAction()}};self.switchPane=function(pane){self.close(true).then(function(){signup.openPane(pane)})};self.exportState=function(){return{}};self.hash=function(){return{"genres":state.selectedGenres,
"email":state.email}}};window.NewsletterPickerPane=NewsletterPickerPane})(window,$,ko);
(function(window,$,ko){var Welcome2Pane=function(signup,init){var self$$0=this;self$$0.hideTitlebar=false;self$$0.template="fan/signup/fan_welcome_2_pane";self$$0.title=null;self$$0.width=!window.FanOnboarding.hasSeenTooltips&&!window.FanOnboarding.complete?520:500;self$$0.fromEmail=!signup._pane;self$$0.showTooltips=!window.FanOnboarding.hasSeenTooltips&&!window.FanOnboarding.complete;self$$0.visible=ko.observable(false);self$$0.immediate=ko.observable(!!init.immediate);self$$0.skipWalkthrough=false;
self$$0.afterRender=function(){SignupAPI.setWelcomePaneSeen();if(self$$0.fromEmail&&self$$0.showTooltips)Stats.record({"kind":"click","click":"fan_signup_welcome_email_start"});else if(self$$0.showTooltips)Stats.record({"kind":"click","click":"fan_signup_welcome_2_start"});self$$0.visible(true)};self$$0.close=function(){var d=$.Deferred();signup.updateState(self$$0.exportState());self$$0.immediate(false);self$$0.visible(false);d.resolve();return d.promise()};self$$0.submit=function(){var self=this;
if(self.fromEmail&&self.showTooltips)if(self.skipWalkthrough)Stats.record({"kind":"click","click":"fan_signup_welcome_email_skip"});else Stats.record({"kind":"click","click":"fan_signup_welcome_email_pick"});else if(self.showTooltips)if(self.skipWalkthrough)Stats.record({"kind":"click","click":"fan_signup_welcome_2_skip"});else Stats.record({"kind":"click","click":"fan_signup_welcome_2_pick"});self.close().then(function(){if(!self.skipWalkthrough&&(signup.originPage==="corp"||signup.originPage===
"fans"||signup.originPage==="ppp"||!signup.originPage))signup.openHomepageWelcome();else signup.onComplete()})};self$$0.skip=function(){self$$0.skipWalkthrough=true;self$$0.submit()};self$$0.exportState=function(){return{"skipWalkthrough":self$$0.skipWalkthrough}};self$$0.hash=function(){return{"show_tooltips":self$$0.showTooltips}}};window.Welcome2Pane=Welcome2Pane})(window,$,ko);
(function(window,$,ko){if(window.location.pathname==="/fan_signup")return;var formId="#signup-vm";var pagedata$$1=$("#pagedata").data("blob");var signupParams=pagedata$$1.signup_params||{};var cfg$$0=pagedata$$1.cfg||{};var PANES={"signup":SignupPane,"login":LoginPane,"forgot_password":ForgotPasswordPane,"reset_password":ResetPasswordPane,"existing_artist":ExistingArtistPane,"almost_there":AlmostTherePane,"action":ActionPane,"welcome":WelcomePane,"dupe_fan":DupeFanPane,"choose_account":ChooseAccountPane,
"genre_picker":GenrePickerPane,"newsletter_picker":NewsletterPickerPane,"welcome_2":Welcome2Pane};var ORIGIN_TO_FROM_TYPE={"fans":"fans","corp":"corp","ppp":"signupdwnld","band":"menubar","home":"home","fan":"collection_banner","redeem":"gift_card_redeem"};var Signup=function(initial){var self=this;self._dialog=null;self._element=null;self._pane=null;self.portable=true;self.mobile=initial.is_phone;self.originPage=null;var pagedata$$0=$("#pagedata").data("blob");var isCorp=Url.toHash(window.location.href).host===
Url.toHash(siteroot_https).host;if(isCorp)if(window.location.pathname==="/fans")self.originPage="fans";else if(window.location.pathname==="/download")self.originPage="ppp";else if(window.location.pathname==="/")self.originPage="home";else if(window.location.pathname.indexOf("/redeem")===0)self.originPage="redeem";else if(pagedata$$0.collection_data!==undefined)self.originPage="fan";else self.originPage="corp";else self.originPage="band";var isHomepage=self.originPage==="home";var isCorpPage=self.originPage===
"corp";var isBandPage=self.originPage==="band";var isFanPage=self.originPage==="fan";var isRedeem=self.originPage==="redeem";var isPPP=self.originPage==="ppp";self.getSignupFrom=function(){if(self.actionParams&&self.actionParams.action){var action=self.actionParams.action;var actionItemType=self.actionParams.actionItemType;if(action==="wishlist")return"wishlist";else if(action==="follow"&&actionItemType==="f")return"fan_follow";else if(action==="follow")return"follow";else if(action==="redeem")return"gift_card_redeem"}else if(self.signupFrom)return self.signupFrom;
else return ORIGIN_TO_FROM_TYPE[self.originPage]};self.openHomepageWelcome=function(){if(!isHomepage){SignupUtils.asyncLogin(self.state.asyncIdentities);self.doAction();window.location.href=siteroot_https;self.closeDialog()}};self.onComplete=function(fromCloseClick){var asyncIdentities=self.state.asyncIdentities;var userDataForMenubar=self.state.userDataForMenubar;var actionParams=self.actionParams;var doTooltips=function(){if(window.FanOnboarding)if(self.state.skipWalkthrough)window.FanOnboarding.skipWalkthrough();
else{var $tooltipParent=null;if(actionParams&&actionParams.action==="wishlist"&&actionParams.title)window.FanOnboarding.setFirstWishlistedItem(actionParams.title,actionParams.actionItemType);if(!(isHomepage&&actionParams&&actionParams.action))$("html, body").animate({scrollTop:0},300);if(actionParams&&actionParams.action&&(actionParams.action==="wishlist"||actionParams.action==="follow")&&isHomepage)$("body").removeClass("scroll-detected").addClass("prevent-header-hiding");if(actionParams&&actionParams.action&&
actionParams.action==="follow"&&actionParams.actionItemType==="f"&&isHomepage){var $followEl=$(".follow-fan[data-follow-fan\x3d"+actionParams.actionItemId+"]");FanOnboarding.fanName=$followEl.data("fan-name");$tooltipParent=$followEl.closest(".signup-tooltip-parent")}setTimeout(function(){window.FanOnboarding.initForView($tooltipParent)},300)}};if(!asyncIdentities){if(self.currentPane()==="welcome_2")doTooltips();if(!isPPP)SignupUtils.cleanURL();self.closeDialog();return}SignupUtils.asyncLogin(asyncIdentities);
var pagedata=$("#pagedata").data("blob")||{};var cfg=pagedata.cfg||{};if(isBandPage||isFanPage||cfg.header_rework_2018)SignupUtils.renderMenubar(asyncIdentities,userDataForMenubar,actionParams);else if(isHomepage||isCorpPage)SignupUtils.renderHeader(asyncIdentities,userDataForMenubar,actionParams);else if(isRedeem){SignupUtils.renderHeader(asyncIdentities,userDataForMenubar,false);Redeem.rawUserBalance(userDataForMenubar.gift_card_balance);Redeem.submit()}else if($("#menubar")[0])SignupUtils.renderMenubar(asyncIdentities,
userDataForMenubar,actionParams.action==="wishlist");else if($(".hd")[0])SignupUtils.renderHeader(asyncIdentities,userDataForMenubar,actionParams);initial.email=self.state.email;if(Identities.fan()&&!Identities.fan().verified&&actionParams.action&&self._pane instanceof LoginPane){window.verifyNag=window.verifyNag||new VerifyNag({"fan_email":initial.email});window.verifyNag.openDialog()}else self.doAction();self.closeDialog();if(!isPPP)SignupUtils.cleanURL();if(!fromCloseClick)doTooltips();if(isPPP)window.location.reload()};
self.closeDialog=function(){if(!self._dialog)return;if("HomeControl"in window&&HomeControl.feedReader)HomeControl.feedReader.playPauseFeed(false);self._dialog.dialog("close")};self.openDialog=function(title){title=title||"Signup";self._element=$("\x3cdiv\x3e");var w=MediaView.mode==="phone"?"90%":500;var h="auto";if(self.mobile){w=$(window).width()-16;h=$(window).height()-16}self._dialog=NuDialog.alertHTML(title,self._element,{dialogClass:"nu-dialog center-title",draggable:true,width:w,height:h,modal:true,
title:title,buttons:{},close:function(){$("body").removeClass("prevent-scroll");self._element.remove();self._dialog=null;self.currentPane(null);if(self._pane.resetOnClose)self.resetState();Captcha.hideInvisible()},closeOnEscape:false})};self.state={};self.resetState=function(){self.state={"userName":initial.user_name||null,"bands":initial.bands||[],"fanUsername":initial.suggested_name&&initial.suggested_name.length>0?initial.suggested_name:null,"email":initial.email||null,"asyncIdentities":null,"nextURL":null,
"nextPane":initial.next_pane,"userDataForMenubar":null,"selectedGenres":[],"verificationNeeded":true,"suggestedNewsletters":[],"skipWalkthrough":false}};self.resetState();self.updateState=function(updates){$.each(updates,function(k,v){if(self.state[k]!==undefined&&v!==undefined)self.state[k]=v})};self.resetInitial=function(){initial.user_name=null;initial.bands=[];initial.email=null};self.additionalBundle=$("#fan-signup-addnl-bundle").data("url");self.loadAdditionalBundle=function(){if(self.additionalBundleLoaded||
!self.additionalBundle)return;self.additionalBundlePromise=$.cachedScript(self.additionalBundle);self.additionalBundlePromise.done(function(){Log.debug("loaded signup library on demand");self.additionalBundleLoaded=true})};self.additionalBundleLoaded=false;self.currentPane=ko.observable();self.openPane=function(paneName,skipAnimation){self.currentPane(paneName);if("HomeControl"in window&&HomeControl.feedReader)HomeControl.feedReader.playPauseFeed(true);if(PANES[paneName]){if(!self._dialog){self.openDialog();
self.loadAdditionalBundle()}var data={};$.extend(data,initial,{"immediate":skipAnimation});self._pane=new PANES[paneName](self,data);self._dialog.dialog("option","title",self._pane.title);var classes=["nu-dialog","fan-signup-portable"];if(self._pane.hideTitlebar)classes.push("hide-title");else if(!self._pane.title||self._pane.title==="")classes.push("blank-title");else classes.push("center-title");if(self._pane.overflowDialog)classes.push("overflow-dialog");if(self._pane.transparentBackground)classes.push("transparent-background");
if(self._pane.noClose)classes.push("no-close");if(self.mobile)classes.push("mobile-onboarding");self._dialog.dialog("option","dialogClass",classes.join(" "));if(self._pane.width&&MediaView.mode==="desktop")self._dialog.dialog("option","width",self._pane.width);else if(MediaView.mode==="desktop")self._dialog.dialog("option","width",500);self._dialog.dialog("option","minHeight","auto");var hash=$.extend(self._pane.hash(),{});self._element.html(Templ.render(self._pane.template,hash));ko.applyBindings(self._pane,
$(formId)[0]);if(MediaView.mode==="phone")if(self.mobile){if(self.currentPane()==="genre_picker")self._dialog.dialog("option","position",{my:"top+8px",at:"top"})}else self._dialog.dialog("option","position",{my:"top",at:"top+30%"});else if(self._pane.position)self._dialog.dialog("option","position",self._pane.position);else self._dialog.dialog("option","position",{my:"center center",at:"center center",of:window});if(!self.mobile||self.mobile&&self.currentPane()==="newsletter_picker")self._dialog.dialog("option",
"height","auto");self._pane.afterRender();if($(window).height()>$(".fan-signup-portable:visible").height()+30)$("body").addClass("prevent-scroll");else $("body").removeClass("prevent-scroll");var $closeButton=$("a.ui-dialog-titlebar-close",self._dialog.siblings(".ui-dialog-titlebar"));if($closeButton&&!self._pane.noClose){$closeButton.off("click.manual-close");$closeButton.on("click.manual-close",function(){$("body").removeClass("prevent-scroll");$(".top-banner.welcome-non-fan").addClass("hide");
if(self._pane instanceof SignupPane)Stats.record({"kind":"click","click":"fan_signup_signup_close"});self.onComplete(true);if("HomeControl"in window&&HomeControl.feedReader)HomeControl.feedReader.playPauseFeed(false);if(self._pane.resetOnClose)self.resetState()})}}};self.initialEmail=initial.email;self.initialEmailSignature=initial.email_sig;self.actionParams={action:initial.action,actionItemId:initial.action_item_id,actionItemType:initial.action_item_type,actionBandId:initial.action_band_id};self.doAction=
function(){var action=self.actionParams.action;var itemType=self.actionParams.actionItemType;var itemId=self.actionParams.actionItemId;var bandId=self.actionParams.actionBandId;var collectData=self.actionParams.collectData;if(!action)return;if(action==="wishlist")FanControls2.wishlist(itemType,itemId,bandId,collectData);else if(action==="follow"){var followType=itemType;var followId=itemId;if(!followType||followType==="b")FanControls2.followBand(bandId,true);else if(followType==="f")FanControls2.followFan(followId,
collectData)}};if(self.originPage==="corp"||self.originPage==="ppp")self.activationParams={};else self.activationParams={url:initial.activation_url,sig:initial.activation_sig};self.signupFrom=initial.from;self.signupToken=initial.signup_token;self.tsig=initial.tsig;self.verified=initial.verified;if(initial.affiliations)self.affiliations=initial.affiliations;self.subdomainURL=initial.subdomain_url;self.genres=initial.genres;self.subgenres=initial.subgenres};var signup=new Signup(signupParams);window.FanSignup=
signup;$(document).ready(function(){$(".all-signup-link").click(function(){signup.openPane("choose_account",true);return false});$(".fan-signup-modal-link").click(function(){var from=$(this).data("from");var email=$(this).data("email");var signupToken=$(this).data("token");var tsig=$(this).data("tsig");var verified=$(this).data("verified");if(from!==undefined)signup.signupFrom=from;if(email!==undefined){signup.state.email=email;signup.initialEmail=email}if(signupToken!==undefined)signup.signupToken=
signupToken;if(tsig!==undefined)signup.tsig=tsig;if(verified!==undefined)signup.verified=verified;signup.openPane("signup",true);return false});if(signupParams.pane)setTimeout(function(){window.FanSignup.openPane(signupParams.pane,true)},200)})})(window,$,ko);